---
title: 2024ict寒假任务
date: 2024-03-30 16:38:37
tags: []
categories:
cover: https://gitee.com/Charles-Webber/blog-image1/raw/master/img/wallhaven-zpzgvg.jpg
---
# 2024ict寒假任务



## ensp部分

![image-20240224012013720](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240224012013720.png)

```c
//命令历史
vlan batch 10 20 30 40 71 61 72 62 100 200
  //链路聚合  
  int Eth-Trunk 1
  trunkport GigabitEthernet 0/0/6
  trunkport GigabitEthernet 0/0/7
    //接入层设置链路类型
int g0/0/2
    port link-type trunk
 port trunk allow-pass vlan 40
        int g0/0/3
    port link-type trunk
 port trunk allow-pass vlan 40
        int g0/0/1
    port link-type access
 port default vlan 40
    //汇聚层设置链路类型（注意vlan 20 和30可以互通）
    int g0/0/1
     port link-type trunk
 port trunk allow-pass vlan 10
        int g0/0/2
     port link-type trunk
 port trunk allow-pass vlan 20 30
    //聚合链路设置
    
interface Eth-Trunk1
 port link-type trunk
 port trunk allow-pass vlan 10 20 30 40 200
//服务器的交换机链路状态
    sw8:
vlan batch 17 77
  port default vlan 77
  int g0/0/3
  port default vlan 17
  int g0/0/2
  port link-type access
  port default vlan 100

    sw7:
  int g0/0/3
  int g0/0/2
  port link-type trunk
  port trunk allow-pass vlan 10 20 30 40 200
  int g0/0/1
  port link-type access
  port default vlan 200
//stp配置
  //sw5
  stp region-configuration
  region-name monika
  instance 10 vlan 10
  instance 20 vlan 20 30
  instance 40 vlan 40
  instance 1 vlan 100
  active region-configuration
//根桥设置,sw1-4和sw7不配置
sw5：
stp instance 2 root secondary
stp instance 10 root primary
stp instance 20 root primary
stp instance 40 root secondary
    sw6：
      stp instance 2 root pri
stp instance 10 root secondary
stp instance 20 root secondary
stp instance 40 root pri
      //虚拟接口设置
  int vlanif 40
  ip ad 192.168.40.5 24
  dis th
  int vlanif 200
  ip ad 192.168.200.5 24
  int vlanif 61
  ip ad 192.168.61.5 24
  int vlanif 71
  ip ad 192.168.71.5 24
//路由器配置ip
      ar7：
      int g0/0/0
      ip ad 192.168.71.7 24
      int g0/0/1
      ip ad 192.168.72.7 24
       int g3/0/0
      ip ad 192.168.67.7 24
      int g0/0/2
      ip ad 192.168.78.7 24
      int g4/0/0
      ip ad 192.168.77.7 24
      
        ar6：
      int g0/0/0
      ip ad 192.168.62.6 24
      int g0/0/1
      ip ad 192.168.61.6 24
       int g3/0/0
      ip ad 192.168.67.6 24
      int g0/0/2
      ip ad 192.168.68.6 24
      int g4/0/0
      ip ad 192.168.17.6 24
      
      //配置vrrp
 interface Vlanif10
 vrrp vrid 10 virtual-ip 192.168.10.254
      。。。。。
      //配置dhcp
      //服务器
      ip pool vlan10
 gateway-list 192.168.10.254 
 network 192.168.10.0 mask 255.255.255.0 
 excluded-ip-address 192.168.10.5 192.168.10.6 
      ip pool vlan40
 gateway-list 192.168.40.254 
 network 192.168.40.0 mask 255.255.255.0 
 excluded-ip-address 192.168.40.5 192.168.40.6 
      //中继
      dhcp en

  int vlan 10
        dhcp select relay
  dhcp relay server-ip 192.168.200.55

  int vlan 20
        dhcp select relay
  dhcp relay server-ip 192.168.200.55
  int vlan 30
        dhcp select relay
  dhcp relay server-ip 192.168.200.55
  int vlan 40
        dhcp select relay
  dhcp relay server-ip 192.168.200.55
//ospf配置
      //交换机5，6
      ospf
      ar 0
       network 192.168.62.6 0.0.0.0
      network 192.168.72.6 0.0.0.0
            ar 10
       network 192.168.10.6 0.0.0.0
  ar 20
  network 192.168.20.6 0.0.0.0
  ar 30
  network 192.168.30.6 0.0.0.0
  ar 40
  network 192.168.40.6 0.0.0.0
//路由器r7
      ospf
      ar 0
       network 192.168.71.7 0.0.0.0
      network 192.168.72.7 0.0.0.0
        network 192.168.67.7 0.0.0.0
       network 192.168.78.7 0.0.0.0
       network 192.168.87.7 0.0.0.0
//路由器r6
      ospf
      ar 0
       network 192.168.61.6 0.0.0.0
      network 192.168.62.6 0.0.0.0
        network 192.168.67.6 0.0.0.0
       network 192.168.68.6 0.0.0.0
       network 192.168.86.6 0.0.0.0
      //交换机8
                      ospf
      ar 0
      network 192.168.87.8 0.0.0.0
       network 192.168.86.8 0.0.0.0
      ar 100
      network 192.168.100.8 0.0.0.0
      //ar8
      ospf
      ar 0
       network 192.168.78.8 0.0.0.0
      network 192.168.68.8 0.0.0.0
   
      ip route-static 0.0.0.0 0 114.114.114.9 preference 120
      ip route-static 0.0.0.0 0 114.114.115.9
      //bfd配置
      //sw6
 bfd tor8 bind peer-ip 8.8.8.8 source-ip 6.6.6.6
 discriminator local 66
 discriminator remote 68
 min-tx-interval 100
 min-rx-interval 100
 commit
      //r8
            bfd tosw5 bind peer-ip 5.5.5.5 source-ip 8.8.8.8
 discriminator local 58
 discriminator remote 55
 min-tx-interval 100
 min-rx-interval 100
 commit
      

      //vrrp联动bfd
  int vlan 10
  vrrp vrid 10 track bfd-session 55 reduced 30
  int vlan 20
  vrrp vrid 20 track bfd-session 55 reduced 30
  int vlan 30
  vrrp vrid 30 track bfd-session 55 reduced 30
//三层安全，pc1不允许互通其他
  acl 2001
  rule 5 deny source 192.168.10.0 0.0.0.255
  int g0/0/1
  traffic-filter outbound acl 2001
//pc2和3不能访问pc4
       acl 2002
  rule deny source 192.168.20.0 0.0.0.255
       rule deny source 192.168.30.0 0.0.0.255
  int g0/0/1
  traffic-filter outbound acl 2002
      //pc2-4不能访问外网
      int g0/0/1
      undo traffic-filter outbound acl 2001
  acl 2001
  rule 10 deny source 114.114.116.1 0.0.0.0
  int g0/0/1
  traffic-filter outbound acl 2001
//telnet配置
      telnet server enable
      user-interface vty 0 4
      authentication-mode aaa
      user privilege level 15
      q
      aaa
        local-user monika password cipher 357159
 
 local-user monika privilege level 15
 local-user monika service-type telnet


```

 

rule 5 permit source 192.168.10.0 0.0.0.255
 rule 10 deny

vlan设计：

访客区规划到单独的vlan

营销和行政属于不同vlan

研发属于不同vlan

明确放行哪些vlan，不能all

配置管理vlan



二层消除环路：

使用mstp技术实现防环，域名为jian

根桥集中在汇聚层，vrrp的master和根桥一样

互连的两条使用e-thunk（图）



三层网络设计:

ip和vlan对应

大部分ip由dhcp服务器分配

![image-20240224002655473](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240224002655473.png)

![image-20240224002945881](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240224002945881.png)

![image-20240224003518089](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240224003518089.png)

![image-20240224011722302](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240224011722302.png)

![](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240224011820990.png)

![image-20240224011855910](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240224011855910.png)

![image-20240225124544740](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240225124544740.png)

## Linux部分



### 任务一：创建一个Linux用户



#### 1.新增用户

##### 1.1 adduser

```c
创建命令：sudo adduser monika
删除命令：sudo deluser monika
```

**结果截图**

*要求输入一堆信息

![image-20240222213429728](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/f2317f02-fb59-4ecb-bc0e-7db65bdae5ca.png)![image-20240222213811715](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240222213811715.png)

##### 1.2 useradd 

*不会创建主目录和指定shell版本

```c
创建命令：sudo useradd yuri
删除命令：sudo userdel yuri
为用户指定登录密码：sudo passwd 123456
//需要自己命令指定目录和shell
为用户指定命令解释程序(通常为/bin/bash)：sudo usermod -s /bin/bash yuri
为用户指定用户主目录：sudo useradd -d /home/yuri yuri -m
```



**带参数的useradd命令**

```c
-d： 指定用户的主目录

-m： 如果存在不再创建，但是此目录并不属于新创建用户；如果主目录不存在，则强制创建； -m和-d一块使用。

-s： 指定用户登录时的shell版本

-M： 不创建主目录

```

栗子：![image-20240222164042914](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/76807855-37ae-4a1a-8528-f854fbc877eb.png)

**结果截图**

![image-20240222213916686](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240222213916686.png)

##### 2.删除用户

```c
//deluser
只删除用户：sudo deluser tt
连同用户的主目录和邮箱一起删除：sudo deluser --remove-home tt
连同用户拥有的所有文件删除：sudo deluser --remove-all-files tt
//userdel
只删除用户：sudo userdel tt
连同用户主目录一起删除：sudo derlser -r tt
```



### 任务二：爱心代码

请看vcr



### 任务三： 安装Linux版本的HDFS分布式存储并设置伪分布式集群安装（单机运行）



#### cat一份文件

![image-20240223104714710](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240223104714710.png)





#### 查看Datanode的工作状态

![image-20240223105018889](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240223105018889.png)



modify是文件内容变换，change是文件属性变化，当Atime在Mtime和Ctime之前才会被修改

access

change

modify

## 拷打环节

### vrrp（网络层，ip报文封装，112）

- VRRP路由器（VRRP Router）：运行VRRP协议的设备，它可能属于一个或多个虚拟路由器。

- 虚拟路由器（Virtual Router）：又称VRRP备份组，由一个Master设备和多个Backup设备组成，被当作一个共享局域网内主机的缺省网关。

- Master路由器（Virtual Router Master）：承担转发报文任务的VRRP设备。

- Backup路由器（Virtual Router Backup）：一组没有担转发任务的VRRP设备，当Master设备出现故障时，它们将通过竞选成为新的Master设备。

- VRID：虚拟路由器的标识。

- 虚拟IP地址(Virtual IP Address)：虚拟路由器的IP地址，一个虚拟路由器可以有一个或多个IP地址，由用户配置。

- IP地址拥有者（IP Address Owner）：如果一个VRRP设备将虚拟路由器IP地址作为真实的接口地址，则该设备被称为IP地址拥有者。如果IP地址拥有者是可用的，通常它将成为Master。

- 虚拟MAC地址（Virtual MAC Address）：虚拟路由器根据虚拟路由器ID生成的MAC地址。一个虚拟路由器拥有一个虚拟MAC地址，**格式为：00-00-5E-00-01-{VRID}(VRRP for IPv4)；00-00-5E-00-02-{VRID}(VRRP for IPv6)。**当虚拟路由器回应ARP请求时，使用虚拟MAC地址，而不是接口的真实MAC地址。

  

#### VRRP报文：

VRRP协议报文用来将Master设备的优先级和状态通告给同一备份组的所有Backup设备。

VRRP**协议报文封装在IP报文**中，发送到分配给VRRP的IP组播地址。在IP报文头中，源地址为发送报文接口的主IP地址（不是虚拟IP地址），**目的地址是224.0.0.18，TTL是255，协议号是112。**

#### VRRP状态机：

VRRP协议中定义了三种状态机：初始状态（Initialize）、活动状态（Master）、备份状态（Backup）。其中，只有处于Master状态的设备才可以转发那些发送到虚拟IP地址的报文。



#### VRRP的工作过程：

VRRP备份组中的设备根据优先级选举出Master。Master设备通过发送**免费ARP报文**，将虚拟MAC地址通知给与它连接的设备或者主机，从而承担报文转发任务。

Master设备周期性向备份组内所有Backup设备**发送VRRP通告报文，以公布其配置信息（优先级等）和工作状况。**
如果Master设备出现故障，VRRP备份组中的Backup设备将根据优先级重新选举新的Master。

VRRP**备份组状态切换时**，Master设备由一台设备切换为另外一台设备，新的Master设备会立即发送携带虚拟路由器的虚拟MAC地址和虚拟IP地址信息的**免费ARP报文**，刷新与它连接的主机或设备中的MAC表项，从而把用户流量引到新的Master设备上来，整个过程对用户完全透明。

原Master设备故障恢复时，若该设备为IP地址拥有者（优先级为255），将直接切换至Master状态。若该设备优先级小于255，将首先切换至Backup状态，且其优先级恢复为故障前配置的优先级。

Backup设备的优先级高于Master设备时，由Backup设备的工作方式（抢占方式和非抢占方式）决定是否重新选举Master。

**抢占模式：在抢占模式下，如果Backup设备的优先级比当前Master设备的优先级高，则主动将自己切换成Master。**

**非抢占模式：在非抢占模式下，只要Master设备没有出现故障，Backup设备即使随后被配置了更高的优先级也不会成为Master设备。**



### traffic-filter

#### acl分类

- 基本acl，2000-2999
- 高级acl，3000-3999
- 二层acl，4000-4999
- 用户自定义acl，5000-5999
- 用户acl，6000-6999



#### traffic-policy对比！！！！

- Traffic Policy：Traffic Policy主要用于对网络中的流量进行管理和控制。Traffic Policy可以设置如下参数：端口带宽、限速、限流、优先级、队列等。通过Traffic Policy，管理员可以按照自己的需求来规划和配置网络带宽资源，以保证业务的正常运行和网络的高效利用。
- Traffic Filter：Traffic Filter主要用于对网络中的数据包进行过滤和拦截。Traffic Filter可以根据IP地址、源端口、目标端口、协议类型等参数对数据包进行匹配，并选择性地允许或者禁止其通过特定的端口或者路由器。Traffic Filter通常用于实现网络安全防护和数据隔离等功能。

#### traffic-policy怎么配置！！！



#### DHCP中继

 DHCP客户使用IP广播来寻找同一网段上的DHCP服务器。当服务器和客户段处在不同网段，即被路由器分割开来时，路由器是不会转发这样广播包的。因此可能需要在每个网段上设置一个DHCP服务器，虽然DHCP只消耗很小的一部分资源的，但多个 DHCP服务器，毕竟要带来管理上的不方便。DHCP中继的使用使得一个DHCP服务器同时为多个网段服务成为可能，配置DHCP中继的网络设备可以在不同网段上从DHCP总服务器获取IP地址分配给下面的各主机，路由器或者三层交换机都可以充当DHCP中继



#### dhcp工作原理

1. dhcp discover发现dhcp服务器
2. dhcp offer告诉对方可以提供ip
3. dhcp request 请求ip
4. dhcp ack 给ip

除此之外还有4种报文

dhcp nak 服务器拒绝分配ip

dhcp release 主机不要ip了，给服务器说一声

dhcp decline 主机说这个ip用不了

dhcp inform不怎么用



### bfd（应用层协议，封装在udp中，3785）

**BFD在两台网络设备上建立会话，用来检测网络设备间的双向转发路径，为上层应用服务**。会话建立后会周期性地快速发送BFD报文，如果在检测时间内没有收到BFD报文则认为该双向转发路径发生了故障，通知被服务的上层应用进行相应的处理。
**BFD协议本身没有邻居发现机制，BFD邻居的创建依赖于上层的应用**。根据BFD会话建立过程可以将其分为动态BFD和静态BFD。

**动态BFD**：是通过上层应用(例如OSPF)的邻居发现机制，有上层应用将邻居信息发送到BFD模块，BFD则根据接收到的邻居信息创建会话并建立自己的邻居。
**静态BFD**：是通过静态配置手动添加对端的邻居信息来创建会话，静态BFD配置完后，会定时发送BFD控制报文。只有对端接口也开启BFD的情况下并对本端的BFD报文做出正确应答后，双方建立邻居信息。



**Echo报文采用UDP封装，目的端口号为3785，目的IP地址为发送接口的地址，源IP地址由配置产生（配置的源IP地址要避免产生ICMP重定向）。**



#### 状态机

-  BSM_AdminDown		   

-  BSM_Down		             

- BSM_Init		        

- BSM_Up

  

  会话状态变化通过**BFD报文的State字段传递**，系统根据自己本地的会话状态和接收到的对端BFD报文驱动状态改变。

  **BFD状态机的建立和拆除都采用三次握手机制。**

  ![在这里插入图片描述](https://gitee.com/Charles-Webber/blog-image1/raw/master/img/a21baf54-62bf-49c7-aa6e-25c352dfef7f.png)

  - 互发down报文，收到对方的down后，迁移到init状态
  - 互发init报文，收到对方的init报文后就迁移到UP





#### mstp（二层协议）

