<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>asuka&amp;ayanami | asuka&amp;ayanami</title><meta name="author" content="charles-webber"><meta name="copyright" content="charles-webber"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#78D77D"><meta name="description" content="数据通信10从计网入门到网络黑客大成 [TOC] MAC地址表项配置配置静态mac表项1mac-address static mac-address interface-type inter-number vlan XX    配置mac黑洞MAC表项1mac-address blackhole mac-address 【vlan xx】    配置动态MAC表项的老化时间1mac-address">
<meta property="og:type" content="article">
<meta property="og:title" content="asuka&amp;ayanami">
<meta property="og:url" content="http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A110/index.html">
<meta property="og:site_name" content="asuka&amp;ayanami">
<meta property="og:description" content="数据通信10从计网入门到网络黑客大成 [TOC] MAC地址表项配置配置静态mac表项1mac-address static mac-address interface-type inter-number vlan XX    配置mac黑洞MAC表项1mac-address blackhole mac-address 【vlan xx】    配置动态MAC表项的老化时间1mac-address">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg">
<meta property="article:published_time" content="2024-07-10T07:22:42.514Z">
<meta property="article:modified_time" content="2024-05-04T04:04:29.453Z">
<meta property="article:author" content="charles-webber">
<meta property="article:tag" content="i need something to cure me">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A110/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'asuka&ayanami',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-05-04 12:04:29'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#FF855DFF')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#78D77D')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/clock.min.css" /><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="asuka&ayanami" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/6o/wallhaven-6o36qq.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fa-solid fa-bell"></i><span> ACG</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> Message</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">asuka&amp;ayanami</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fa-solid fa-bell"></i><span> ACG</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> Message</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-10T07:22:42.514Z" title="发表于 2024-07-10 15:22:42">2024-07-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-05-04T04:04:29.453Z" title="更新于 2024-05-04 12:04:29">2024-05-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="数据通信10"><a href="#数据通信10" class="headerlink" title="数据通信10"></a>数据通信10</h1><p>从计网入门到网络黑客大成</p>
<p>[TOC]</p>
<h2 id="MAC地址表项配置"><a href="#MAC地址表项配置" class="headerlink" title="MAC地址表项配置"></a>MAC地址表项配置</h2><h3 id="配置静态mac表项"><a href="#配置静态mac表项" class="headerlink" title="配置静态mac表项"></a>配置静态mac表项</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mac-address <span class="type">static</span> mac-address interface-type inter-number vlan XX</span><br></pre></td></tr></table></figure>



<h3 id="配置mac黑洞MAC表项"><a href="#配置mac黑洞MAC表项" class="headerlink" title="配置mac黑洞MAC表项"></a>配置mac黑洞MAC表项</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mac-address blackhole mac-address 【vlan xx】</span><br></pre></td></tr></table></figure>



<h3 id="配置动态MAC表项的老化时间"><a href="#配置动态MAC表项的老化时间" class="headerlink" title="配置动态MAC表项的老化时间"></a>配置动态MAC表项的老化时间</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mac-address aging-time ading-time</span><br></pre></td></tr></table></figure>



<h3 id="MAC地址表安全配置举例"><a href="#MAC地址表安全配置举例" class="headerlink" title="MAC地址表安全配置举例"></a>MAC地址表安全配置举例</h3><p><strong>防止其他人的mac地址表攻击：</strong>发送大量的假的mac地址占据交换机的mac地址表，然后接收它的泛洪信息以破解命令(kali	的macof)</p>
<h3 id="端口安全技术"><a href="#端口安全技术" class="headerlink" title="端口安全技术"></a>端口安全技术</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">port-security enable</span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">port-security mac-address sticky<span class="comment">//开启粘性mac模式</span></span><br><span class="line">port-security max-mac-num xx<span class="comment">//前xx个加入的pc的mac地址会记录，只有这些可以上网</span></span><br><span class="line">port-security protect-action &#123; protect | <span class="keyword">restrict</span> | shutdown &#125;<span class="comment">//配置端口安全保护动作</span></span><br><span class="line"><span class="comment">/*protect：当学习到的MAC地址数达到接口限制数时，接口丢弃源地址在MAC表以外的报文。</span></span><br><span class="line"><span class="comment">restrict：当学习到的MAC地址数超过接口限制数时，接口丢弃源地址在MAC表以外的报文，同时发出告警。</span></span><br><span class="line"><span class="comment">shutdown：当学习到的MAC地址数超过接口限制数时，将接口Error-Down，同时发出告警。*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="DHCP-snooping（窥探）"><a href="#DHCP-snooping（窥探）" class="headerlink" title="DHCP snooping（窥探）"></a>DHCP snooping（窥探）</h2><h3 id="出现背景"><a href="#出现背景" class="headerlink" title="出现背景"></a>出现背景</h3><p>一种攻击方式是打掉原来局域网的dhcp服务器然后再自己当上dhcp，为其他主机写ip地址，并且将相关的网关设置成自己，以此来”引流”</p>
<p><strong>dos dhcp discover 不断广播discover报文把原来的服务器搞崩，然后自己再假冒dhcp服务器分发ip</strong></p>
<h3 id="实验配置"><a href="#实验配置" class="headerlink" title="实验配置"></a>实验配置</h3><p>先<strong>全部设置为不信任端口</strong>（这时候收不到一点offer），再手动设置信任端口，信任端口可以通过offer包，不信任端口不通过offer包</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dhcp snooping enable<span class="comment">//全局</span></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span><span class="comment">//进入接口或者vlan</span></span><br><span class="line">dhcp snooping enable</span><br><span class="line"></span><br><span class="line">dhcp snooping trusted<span class="comment">//配置信任端口</span></span><br></pre></td></tr></table></figure>





<h2 id="IPSG"><a href="#IPSG" class="headerlink" title="IPSG"></a>IPSG</h2><p><strong>IP源防攻击</strong></p>
<p>出现原因：一些攻击者通过伪造合法用户的IP地址获取网络访问权限，非法访问网络</p>
<p><strong>实验配置</strong></p>
<p>基于dhcp snooping功能</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP source check user-bind enable</span><br></pre></td></tr></table></figure>

<p>如果说有人在一个路由器上接线并且伪造了原网络的一个设备的ip的话，路由器查ipsg的绑定表发现不对后会堵塞掉新接入的那个端口</p>
<h2 id="VXLAN：虚拟拓展局域网–隧道技术"><a href="#VXLAN：虚拟拓展局域网–隧道技术" class="headerlink" title="VXLAN：虚拟拓展局域网–隧道技术"></a>VXLAN：虚拟拓展局域网–隧道技术</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><strong>将三层的设备两两相连，在逻辑上构成一个二层交换机，实现l2封装在l4上并且在l3中传输</strong></p>
<p><strong><u>采用mac in udp 封装，将以太报文封装在ip报文上</u></strong></p>
<h3 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h3><h4 id="bdif"><a href="#bdif" class="headerlink" title="bdif"></a>bdif</h4><p>BDIF接口的功能与VLANIF接口类似，是基于BD创建的三层逻辑接口，用以实现不同子网之间的通信，或VXLAN网络与非VXLAN网络之间的通信。</p>
<h4 id="VAP"><a href="#VAP" class="headerlink" title="VAP"></a>VAP</h4><p>虚拟接入点VAP，即VXLAN业务接入点，可以是二层子接口或VLAN</p>
<p>当接入节点是二层子接口时，通过在二层子接口上配置<strong>流封装类型</strong>（那4种）实现不同的接口接入不同的数据报文，将二层子接口关联广播域BD后，可实现数据报文通过BD转发。当业务接入点是VLAN时，需要将VLAN绑定到广播域BD，也可以实现数据报文通过BD转发。</p>
<h4 id="spine-leaf"><a href="#spine-leaf" class="headerlink" title="spine-leaf"></a>spine-leaf</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231209145518270.png" alt="image-20231209145518270"></p>
<p>vxlan<strong>配置在leaf（交换机）之间</strong>，完成vxlan的封装和解封装，spine节点（<strong>路由器）只进行路由转发</strong>，类似于之前学习到的ibgp之间进行配置，而中间那个路由器就不管了</p>
<h4 id="NVE"><a href="#NVE" class="headerlink" title="NVE"></a>NVE</h4><p>网络虚拟边缘节点NVE，实现网络虚拟化功能的网络实体。报文经过NVE封装转换后，NVE间就可基于三层基础网络建立二层虚拟化网络。（设备和服务器上的虚拟交换机VSwitch都可以作为NVE）</p>
<ul>
<li><p>硬件模式：所有的NVE都部署在支持NVE的设备上，所有的VXLAN报文封装与解封装都在设备上进行。</p>
</li>
<li><p>软件模式：所有的NVE都部署在vSwitch（开放的虚拟交换机）上，所有的VXLAN报文封装与解封装都在vSwitch上进行。</p>
</li>
<li><p>混合模式：部分NVE部署在vSwitch上，部分NVE部署在支持NVE的设备上，在vSwitch和设备上都有可能会进行VXLAN报文封装与解封装。</p>
</li>
</ul>
<h3 id="vxlan出现的原因"><a href="#vxlan出现的原因" class="headerlink" title="vxlan出现的原因"></a>vxlan出现的原因</h3><ol>
<li>虚拟机的动态迁移需要无障碍接入</li>
<li>租户过多，传统的valn技术不再适用，需要隔离海量的租户</li>
</ol>
<h3 id="服务器虚拟化技术"><a href="#服务器虚拟化技术" class="headerlink" title="服务器虚拟化技术"></a>服务器虚拟化技术</h3><p>将<strong>物理服务器</strong>分成多个<strong>虚拟服务器</strong>，这些服务器<strong>通过虚拟交换机（vswitch）与外界相连</strong></p>
<p>虚拟化的问题：</p>
<ol>
<li>vlan个数不够</li>
<li>mac地址表过大</li>
</ol>
<h3 id="服务器动态迁移"><a href="#服务器动态迁移" class="headerlink" title="服务器动态迁移"></a>服务器动态迁移</h3><p>原服务器正常运行的同时，将系统从一个物理服务器迁移到另一个物理服务器上，这要求服务器的<strong>tcp会话状态不变</strong>（ip不改变），所以<strong>只能在二层之中进行迁移</strong>，但是大型网络都会有三层结构，服务器迁移就需要<strong>vxlan技术将三层设备抽象成二层交换机</strong></p>
<h3 id="vxlan的报文格式"><a href="#vxlan的报文格式" class="headerlink" title="vxlan的报文格式"></a>vxlan的报文格式</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231209150126013.png" alt="image-20231209150126013"></p>
<h4 id="VTEP"><a href="#VTEP" class="headerlink" title="VTEP"></a>VTEP</h4><p><strong>VXLAN Tunnel Endpoints，VXLAN隧道端点</strong></p>
<p>就是之前的leaf节点，完成vxlan的封装和解封装</p>
<p>VTEP既可以是一台<strong>独立的网络设备</strong>（比如华为的CloudEngine系列交换机），也可以是在服务器中的<strong>虚拟交换机</strong>（vswitch）</p>
<h4 id="VNI"><a href="#VNI" class="headerlink" title="VNI"></a>VNI</h4><p><strong>VXLAN Network Identifier，VXLAN 网络标识符</strong></p>
<p>解决掉vlan id 不足的问题，功能类似，一个vni代表一个租户（虚拟机）</p>
<p>二层&#x2F;三层vni？</p>
<h4 id="vxlan报文"><a href="#vxlan报文" class="headerlink" title="vxlan报文"></a>vxlan报文</h4><ul>
<li><p>vxlan header :24比特的vni字段用来定义不同的租户，类似于vlan id。还有vxlan flags（0000 1000），两个保留字段</p>
</li>
<li><p>udp header：vxlan头部和原始数据帧组成udp数据。源udp端口通过哈希算法得到，源端口固定为4789</p>
</li>
<li><p>外部 IP 头部：源ip—源端vtep的ip地址   目的ip—目的端vtep的ip地址</p>
</li>
<li><p>外部mac头部：源mac—源端vtep的mac地址   目的mac—目的端vtep的mac地址</p>
</li>
</ul>
<h3 id="哪些vtep建立隧道连接"><a href="#哪些vtep建立隧道连接" class="headerlink" title="哪些vtep建立隧道连接"></a>哪些vtep建立隧道连接</h3><h4 id="大二层网络"><a href="#大二层网络" class="headerlink" title="大二层网络"></a>大二层网络</h4><p>两两互连</p>
<h4 id="同一大二层域BD"><a href="#同一大二层域BD" class="headerlink" title="同一大二层域BD"></a>同一大二层域BD</h4><p>类似于之前的vlan区域，但是vxlan这里叫BD（bridge-domain）</p>
<p><strong>创建配置</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bride-domain <span class="number">10</span><span class="comment">//创建bd 10</span></span><br><span class="line">vxlan vni <span class="number">5000</span><span class="comment">//bd 10下与之关联的是vni 500</span></span><br><span class="line"><span class="comment">//感觉像进入端口配置模式acess再default的感觉</span></span><br></pre></td></tr></table></figure>

<p>一个vni对应一个bd，一个bd下可以有多个vni</p>
<h3 id="哪些报文会走vxlan隧道"><a href="#哪些报文会走vxlan隧道" class="headerlink" title="哪些报文会走vxlan隧道"></a>哪些报文会走vxlan隧道</h3><h4 id="传统派"><a href="#传统派" class="headerlink" title="传统派"></a>传统派</h4><p>传统vlan技术中定义了三种不同类型的接口：Access、Trunk、Hybrid。这三种类型的接口虽然应用场景不同，但它们的最终目的是一样的：一是<strong>根据配置来检查哪些报文是允许通过的</strong>；二是判断对<strong>检查通过的报文做怎样的处理。</strong></p>
<h4 id="维新派"><a href="#维新派" class="headerlink" title="维新派"></a>维新派</h4><p>VXLAN网络中，VTEP上的<strong>“二层子接口”的逻辑接口</strong>也承担着类似的任务。二层子接口主要做两件事：一是<strong>根据配置来检查哪些报文需要进入VXLAN隧道</strong>；二是<strong>判断对检查通过的报文做怎样的处理</strong>。支持的流封装类型有<strong>dot1q</strong>、<strong>untag</strong>、<strong>qinq</strong>和<strong>default</strong>四种类型：</p>
<ul>
<li>dot1q：对于带有<strong>一层VLAN Tag</strong>的报文，该类型接口<strong>只接收与指定VLAN Ta</strong>g匹配的报文；对于带有<strong>两层VLAN</strong><br><strong>Tag的报文</strong>，该类型接口<strong>只接收外层VLAN Tag</strong>与指定VLAN Tag匹配的报文。（1层对应，两层对vni）</li>
<li>untag：该类型接口只接收<u>不带VLAN Tag</u>的报文。（0）</li>
<li>qinq：该类型接口<strong>只接收带有指定两层VLAN Tag</strong>的报文。（两层都对）</li>
<li>default：允许接口<strong>接收所有报文</strong>，不区分报文中是否带VLAN Tag。该类型接口都<strong>不会对原始报文进行任何VLAN Tag处理</strong>，包括添加、替换或剥离。（1）</li>
</ul>
<p><u>类型三变四，任务类似</u></p>
<p><strong>将二层子接口加入到指定的BD，再根据二层子接口上的配置，设备就可以确定报文属于哪个BD了</strong></p>
<h4 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a><strong>栗子</strong></h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20201112101102241.png" alt="在这里插入图片描述"></p>
<ol>
<li><p>分别在VTEP的物理接口10GE 1&#x2F;0&#x2F;1上，分别针对VM1和VM2封装不同的二层子接口1&#x2F;0&#x2F;1.1</p>
</li>
<li><p>在VTEP的接入口上创建两个二层子接口，分别配置为dot1q和untag的封装类型，并将其分别加入不同的BD</p>
</li>
<li><p>vSwitch的上行口配置成Trunk模式，这样vSwitch发给VTEP的报文中，既有带tag的VM1流量，又有untag的VM2流量（pvid是20，truck口出去的时候会把vlan 20的标签删掉）</p>
</li>
</ol>
<p>标签复习一下：</p>
<table>
<thead>
<tr>
<th>access</th>
<th>truck</th>
</tr>
</thead>
<tbody><tr>
<td>收：没标签，打上，进入|有标签，丢弃数据</td>
<td>收：没有vid，打上pvid，进入|有vid，允许进入，不允许丢弃</td>
</tr>
<tr>
<td><strong>发：去掉标签</strong></td>
<td>发：<strong>vid&#x3D;&#x3D;pvid，去标签</strong>发|vid！&#x3D;pvid，直接发送</td>
</tr>
</tbody></table>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/v2-8b9d084da4096742fcd8215187274765_1440w.webp" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="number">10</span>GE1/<span class="number">0</span>/<span class="number">1.1</span> mode l2<span class="comment">//创建二层接口</span></span><br><span class="line">encapsulation dolt1q vid <span class="number">10</span><span class="comment">//只允许vlan tag 10的报文进入vxlan隧道</span></span><br><span class="line">bride-domain <span class="number">10</span><span class="comment">//绑定bd 10</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="type">int</span> <span class="number">10</span>GE1/<span class="number">0</span>/<span class="number">1.2</span> mode l2<span class="comment">//创建二层接口</span></span><br><span class="line">encapsulation untag<span class="comment">//只允许vlan tag 20的报文进入vxlan隧道</span></span><br><span class="line">bride-domain <span class="number">20</span><span class="comment">//绑定bd 20</span></span><br></pre></td></tr></table></figure>

<p><strong>本质上还是靠标签进行确认</strong></p>
<h3 id="VXLAN隧道的建立"><a href="#VXLAN隧道的建立" class="headerlink" title="VXLAN隧道的建立"></a>VXLAN隧道的建立</h3><h4 id="手动"><a href="#手动" class="headerlink" title="手动"></a>手动</h4><p><strong>用户手动指定VXLAN隧道的源IP为本端VTEP的IP、目的IP为对端VTEP的IP</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> Nve <span class="number">1</span><span class="comment">//创建逻辑接口Nve 1</span></span><br><span class="line">source <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="comment">//源ip</span></span><br><span class="line">vni <span class="number">5000</span> head-end peer-<span class="built_in">list</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span><span class="comment">//对端ip（1）</span></span><br><span class="line">vni <span class="number">5000</span> head-end peer-<span class="built_in">list</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.3</span><span class="comment">//对端ip（2）</span></span><br></pre></td></tr></table></figure>



<p><strong>头端复制列表</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20201112103425968.png" alt="**头端复制列表**"></p>
<p>感觉上类似于转发表，Peer List指明同一个bd下的vtep有哪些</p>
<p>，bum指Broadcast&amp;Unknown-unicast&amp;Multicast，广播&amp;未知单播&amp;组播报文，一个vtep收到bum时会发给其他的对端vtep</p>
<h4 id="自动"><a href="#自动" class="headerlink" title="自动"></a>自动</h4><p>evpn学</p>
<h3 id="VXLAN隧道的选择"><a href="#VXLAN隧道的选择" class="headerlink" title="VXLAN隧道的选择"></a>VXLAN隧道的选择</h3><h4 id="VXLAN网关"><a href="#VXLAN网关" class="headerlink" title="VXLAN网关"></a>VXLAN网关</h4><p>不同的vni之间的主机不能相互通信，为此出现了vxlan网关</p>
<ul>
<li>VXLAN二层网关：用于终端接入VXLAN网络，也可用于同一VXLAN网络的子网通信。</li>
<li>VXLAN三层网关：用于VXLAN网络中跨子网通信以及访问外部网络。</li>
</ul>
<p>其中三层网关又分为<strong>集中式网关与分布式网关</strong></p>
<h4 id="集中式网关"><a href="#集中式网关" class="headerlink" title="集中式网关"></a>集中式网关</h4><h3 id="集中式VXLAN中不同子网互通流程"><a href="#集中式VXLAN中不同子网互通流程" class="headerlink" title="集中式VXLAN中不同子网互通流程"></a>集中式VXLAN中不同子网互通流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231213144040730.png" alt="image-20231213144040730"></p>
<ol>
<li>A将报文先交给vtep1，源ip是自己，源mac是自己，目标ip是b的ip，<strong>目标mac是自己网关的mac（下一跳</strong>：bdif 10）</li>
<li>vtep1收到报文之后识别到报文要走vni隧道，进行报文封装，将源ip和mac修改成vtep1的ip和mac地址</li>
<li>vtep3收到报文发现数据要去b，于是根据路由表得到下一跳（bdif20），将源ip和mac进行修改</li>
<li>bdif20收到报文后进行发送的过程和vtep1发的过程类似</li>
<li>vtep2收到数据后解封装发送给b</li>
</ol>
<p><strong>集中式网关由spine结点做三层网关，分布式也可以用leaf节点做三层网关</strong></p>
<h2 id="实验配置-1"><a href="#实验配置-1" class="headerlink" title="实验配置"></a>实验配置</h2><h3 id="配置同网段用户通过VXLAN隧道互通"><a href="#配置同网段用户通过VXLAN隧道互通" class="headerlink" title="配置同网段用户通过VXLAN隧道互通"></a>配置同网段用户通过VXLAN隧道互通</h3><h4 id="拓扑图"><a href="#拓扑图" class="headerlink" title="拓扑图"></a><strong>拓扑图</strong></h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231214001656597.png" alt="image-20231214001656597"></p>
<ol>
<li>基础配置：设备名称，ip地址，vlan，接口模式等</li>
<li>配置ospf路由协议，使得环回口互通</li>
<li>vxlan配置</li>
<li>验证</li>
</ol>
<h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">ce1</span><br><span class="line">bridge-domain <span class="number">10</span></span><br><span class="line"> vxlan vni <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GE1/0/0</span></span><br><span class="line"> undo portswitch</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> un shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">int lo 0</span></span><br><span class="line">ip ad <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GE1/0/1</span></span><br><span class="line"> undo shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">interface GE1/0/1.1 mode l2</span></span><br><span class="line"> encapsulation dot1q vid <span class="number">10</span></span><br><span class="line"> bridge-domain <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Nve1</span></span><br><span class="line"> source <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span></span><br><span class="line"> vni <span class="number">10</span> head-end peer-<span class="built_in">list</span> <span class="number">30.30</span><span class="number">.30</span><span class="number">.30</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">ospf 1</span></span><br><span class="line"> area <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">#</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ce2</span><br><span class="line">bridge-domain <span class="number">10</span></span><br><span class="line"> vxlan vni <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GE1/0/0</span></span><br><span class="line"> undo portswitch</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">12.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> un shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">interface GE1/0/1</span></span><br><span class="line"> undo portswitch</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> un shutdown</span><br><span class="line"> <span class="meta">#</span></span><br><span class="line"><span class="meta">int lo 0</span></span><br><span class="line">ip ad <span class="number">20.20</span><span class="number">.20</span><span class="number">.20</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">ospf 1</span></span><br><span class="line"> area <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">23.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">20.20</span><span class="number">.20</span><span class="number">.20</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">#</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ce3</span><br><span class="line">bridge-domain <span class="number">10</span></span><br><span class="line"> vxlan vni <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GE1/0/0</span></span><br><span class="line"> undo portswitch</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">23.1</span><span class="number">.1</span><span class="number">.3</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> un shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">int lo 0</span></span><br><span class="line">ip ad <span class="number">30.30</span><span class="number">.30</span><span class="number">.30</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GE1/0/1</span></span><br><span class="line"> undo shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">interface GE1/0/1.1 mode l2</span></span><br><span class="line"> encapsulation dot1q vid <span class="number">10</span></span><br><span class="line"> bridge-domain <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Nve1</span></span><br><span class="line"> source <span class="number">30.30</span><span class="number">.30</span><span class="number">.30</span></span><br><span class="line"> vni <span class="number">10</span> head-end peer-<span class="built_in">list</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">ospf 1</span></span><br><span class="line"> area <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">23.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">30.30</span><span class="number">.30</span><span class="number">.30</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">#</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lsw2</span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">2</span> to <span class="number">4094</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"> port link-type access</span><br><span class="line"> port <span class="keyword">default</span> vlan <span class="number">10</span></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lsw3</span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">2</span> to <span class="number">4094</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"> port link-type access</span><br><span class="line"> port <span class="keyword">default</span> vlan <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h4 id="结果验证"><a href="#结果验证" class="headerlink" title="结果验证"></a>结果验证</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231213234315233.png" alt="image-20231213234315233"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231214001503541.png" alt="image-20231214001503541"></p>
<h3 id="配置不同网段用户通过VXLAN三层网关通信"><a href="#配置不同网段用户通过VXLAN三层网关通信" class="headerlink" title="配置不同网段用户通过VXLAN三层网关通信"></a>配置不同网段用户通过VXLAN三层网关通信</h3><h4 id="拓扑图-1"><a href="#拓扑图-1" class="headerlink" title="拓扑图"></a><strong>拓扑图</strong></h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231214013253705.png" alt="image-20231214013253705"></p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><ol>
<li>分别在ce1、ce2和ce3上配置ospf路由协议，保证网络三层互通。</li>
<li>分别在ce1和ce3上配置业务接入点实现区分业务流量。</li>
<li>分别在ce1、ce2和ce3上配置VXLAN隧道转发业务流量。</li>
<li><strong>在ce2上配置VXLAN三层网关，实现不同网段用户通过VXLAN三层网关互</strong></li>
</ol>
<p><strong><u>和同网段实验的区别就在于中间设备进行了配置：分别和leaf建立隧道并且设立了三层网关bdif</u></strong></p>
<h4 id="实验配置-2"><a href="#实验配置-2" class="headerlink" title="实验配置"></a>实验配置</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ce1</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">sysname Device1</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">bridge-domain 10</span></span><br><span class="line"> vxlan vni <span class="number">5010</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet1/0/1</span></span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet1/0/2</span></span><br><span class="line"> undo shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet1/0/2.1 mode l2</span></span><br><span class="line"> encapsulation dot1q vid <span class="number">10</span></span><br><span class="line"> rewrite pop single</span><br><span class="line"> bridge-domain <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface LoopBack1</span></span><br><span class="line"> ip address <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Nve1</span></span><br><span class="line"> source <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line"> vni <span class="number">5010</span> head-end peer-<span class="built_in">list</span> <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">ospf 1</span></span><br><span class="line"> area <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">return</span></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">ce2</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">sysname Device2</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">bridge-domain 10</span></span><br><span class="line"> vxlan vni <span class="number">5010</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">bridge-domain 20</span></span><br><span class="line"> vxlan vni <span class="number">5020</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Vbdif10</span></span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.10</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Vbdif20</span></span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.20</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet1/0/1</span></span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet1/0/2</span></span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface LoopBack1</span></span><br><span class="line"> ip address <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Nve1</span></span><br><span class="line"> source <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span></span><br><span class="line"> vni <span class="number">5010</span> head-end peer-<span class="built_in">list</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line"> vni <span class="number">5020</span> head-end peer-<span class="built_in">list</span> <span class="number">4.4</span><span class="number">.4</span><span class="number">.4</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">ospf 1</span></span><br><span class="line"> area <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">192.168</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">return</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ce3</span><br><span class="line">#</span><br><span class="line">sysname Device3</span><br><span class="line">#</span><br><span class="line">bridge-domain 20</span><br><span class="line"> vxlan vni 5020</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/1</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address 192.168.2.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/2</span><br><span class="line"> undo shutdown</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/2.1 mode l2</span><br><span class="line"> encapsulation dot1q vid 20</span><br><span class="line"> rewrite pop single</span><br><span class="line"> bridge-domain 20</span><br><span class="line">#</span><br><span class="line">interface LoopBack1</span><br><span class="line"> ip address 4.4.4.4 255.255.255.255</span><br><span class="line">#</span><br><span class="line">interface Nve1</span><br><span class="line"> source 4.4.4.4</span><br><span class="line"> vni 5020 head-end peer-list 3.3.3.3</span><br><span class="line">#</span><br><span class="line">ospf 1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 4.4.4.4 0.0.0.0</span><br><span class="line">  network 10.2.1.0 0.0.0.255</span><br><span class="line">  network 192.168.2.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lsw2</span><br><span class="line">    vlan <span class="number">10</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">2</span> to <span class="number">4094</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"> port link-type access</span><br><span class="line"> port <span class="keyword">default</span> vlan <span class="number">10</span></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lsw3</span><br><span class="line">    vlan <span class="number">20</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">2</span> to <span class="number">4094</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"> port link-type access</span><br><span class="line"> port <span class="keyword">default</span> vlan <span class="number">20</span></span><br></pre></td></tr></table></figure>



<h4 id="结果检验"><a href="#结果检验" class="headerlink" title="结果检验"></a>结果检验</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231214012446954.png" alt="image-20231214012446954"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://charles-webebr.github.io">charles-webber</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A110/">http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A110/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://charles-webebr.github.io" target="_blank">asuka&ayanami</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A111/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div><div class="next-post pull-right"><a href="/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A19/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NzUzOS8zNDAwMw=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/6o/wallhaven-6o36qq.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">charles-webber</div><div class="author-info__description">never give up,keep moving</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/charles-webber"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://bilibili.com/" target="_blank" title="bilibili"><i class="fa-regular fa-heart"></i></a><a class="social-icon" href="mailto:1484145649@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://leetcode.cn/" target="_blank" title="gaming()"><i class="fa-solid fa-gamepad"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Dear Miss.? When i think of you'I'm reminded of the beautiful plains of Iowa.The distance between us is breaking my spirit. My time and experiences without you are meaningless to me. Falling in love with you was the easiest thing i have ever done.Nothing matters but you.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A110"><span class="toc-number">1.</span> <span class="toc-text">数据通信10</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MAC%E5%9C%B0%E5%9D%80%E8%A1%A8%E9%A1%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">MAC地址表项配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81mac%E8%A1%A8%E9%A1%B9"><span class="toc-number">1.1.1.</span> <span class="toc-text">配置静态mac表项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEmac%E9%BB%91%E6%B4%9EMAC%E8%A1%A8%E9%A1%B9"><span class="toc-number">1.1.2.</span> <span class="toc-text">配置mac黑洞MAC表项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%8A%A8%E6%80%81MAC%E8%A1%A8%E9%A1%B9%E7%9A%84%E8%80%81%E5%8C%96%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.3.</span> <span class="toc-text">配置动态MAC表项的老化时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MAC%E5%9C%B0%E5%9D%80%E8%A1%A8%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.1.4.</span> <span class="toc-text">MAC地址表安全配置举例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF"><span class="toc-number">1.1.5.</span> <span class="toc-text">端口安全技术</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DHCP-snooping%EF%BC%88%E7%AA%A5%E6%8E%A2%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">DHCP snooping（窥探）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BA%E7%8E%B0%E8%83%8C%E6%99%AF"><span class="toc-number">1.2.1.</span> <span class="toc-text">出现背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">实验配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IPSG"><span class="toc-number">1.3.</span> <span class="toc-text">IPSG</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VXLAN%EF%BC%9A%E8%99%9A%E6%8B%9F%E6%8B%93%E5%B1%95%E5%B1%80%E5%9F%9F%E7%BD%91%E2%80%93%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">1.4.</span> <span class="toc-text">VXLAN：虚拟拓展局域网–隧道技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">1.4.2.</span> <span class="toc-text">相关概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bdif"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">bdif</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VAP"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">VAP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#spine-leaf"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">spine-leaf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NVE"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">NVE</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vxlan%E5%87%BA%E7%8E%B0%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.4.3.</span> <span class="toc-text">vxlan出现的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">1.4.4.</span> <span class="toc-text">服务器虚拟化技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A8%E6%80%81%E8%BF%81%E7%A7%BB"><span class="toc-number">1.4.5.</span> <span class="toc-text">服务器动态迁移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vxlan%E7%9A%84%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.4.6.</span> <span class="toc-text">vxlan的报文格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VTEP"><span class="toc-number">1.4.6.1.</span> <span class="toc-text">VTEP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VNI"><span class="toc-number">1.4.6.2.</span> <span class="toc-text">VNI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vxlan%E6%8A%A5%E6%96%87"><span class="toc-number">1.4.6.3.</span> <span class="toc-text">vxlan报文</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%AA%E4%BA%9Bvtep%E5%BB%BA%E7%AB%8B%E9%9A%A7%E9%81%93%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.7.</span> <span class="toc-text">哪些vtep建立隧道连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A7%E4%BA%8C%E5%B1%82%E7%BD%91%E7%BB%9C"><span class="toc-number">1.4.7.1.</span> <span class="toc-text">大二层网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8C%E4%B8%80%E5%A4%A7%E4%BA%8C%E5%B1%82%E5%9F%9FBD"><span class="toc-number">1.4.7.2.</span> <span class="toc-text">同一大二层域BD</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E6%8A%A5%E6%96%87%E4%BC%9A%E8%B5%B0vxlan%E9%9A%A7%E9%81%93"><span class="toc-number">1.4.8.</span> <span class="toc-text">哪些报文会走vxlan隧道</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E6%B4%BE"><span class="toc-number">1.4.8.1.</span> <span class="toc-text">传统派</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%B4%E6%96%B0%E6%B4%BE"><span class="toc-number">1.4.8.2.</span> <span class="toc-text">维新派</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%97%E5%AD%90"><span class="toc-number">1.4.8.3.</span> <span class="toc-text">栗子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VXLAN%E9%9A%A7%E9%81%93%E7%9A%84%E5%BB%BA%E7%AB%8B"><span class="toc-number">1.4.9.</span> <span class="toc-text">VXLAN隧道的建立</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8"><span class="toc-number">1.4.9.1.</span> <span class="toc-text">手动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8"><span class="toc-number">1.4.9.2.</span> <span class="toc-text">自动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VXLAN%E9%9A%A7%E9%81%93%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">1.4.10.</span> <span class="toc-text">VXLAN隧道的选择</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VXLAN%E7%BD%91%E5%85%B3"><span class="toc-number">1.4.10.1.</span> <span class="toc-text">VXLAN网关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E4%B8%AD%E5%BC%8F%E7%BD%91%E5%85%B3"><span class="toc-number">1.4.10.2.</span> <span class="toc-text">集中式网关</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E4%B8%AD%E5%BC%8FVXLAN%E4%B8%AD%E4%B8%8D%E5%90%8C%E5%AD%90%E7%BD%91%E4%BA%92%E9%80%9A%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.11.</span> <span class="toc-text">集中式VXLAN中不同子网互通流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-1"><span class="toc-number">1.5.</span> <span class="toc-text">实验配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%90%8C%E7%BD%91%E6%AE%B5%E7%94%A8%E6%88%B7%E9%80%9A%E8%BF%87VXLAN%E9%9A%A7%E9%81%93%E4%BA%92%E9%80%9A"><span class="toc-number">1.5.1.</span> <span class="toc-text">配置同网段用户通过VXLAN隧道互通</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%9B%BE"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">拓扑图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E9%AA%8C%E8%AF%81"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">结果验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E7%BD%91%E6%AE%B5%E7%94%A8%E6%88%B7%E9%80%9A%E8%BF%87VXLAN%E4%B8%89%E5%B1%82%E7%BD%91%E5%85%B3%E9%80%9A%E4%BF%A1"><span class="toc-number">1.5.2.</span> <span class="toc-text">配置不同网段用户通过VXLAN三层网关通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%9B%BE-1"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">拓扑图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-2"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">实验配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E6%A3%80%E9%AA%8C"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">结果检验</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%80%83%E6%A0%B8%E6%80%BB%E7%BB%93/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%80%83%E6%A0%B8%E6%80%BB%E7%BB%93/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.130Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/openwrt/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/openwrt/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.128Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/openuler2/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/openuler2/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.126Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/openeuler4/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/openeuler4/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.123Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/openeuler3/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/openeuler3/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.121Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div></div></div></div></div></main><footer id="footer" style="background: -#77D78D"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By charles-webber</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Nice to meet you!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><div class="aplayer no-destroy" data-id="770116495" data-server="netease" data-type="playlist"   data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true" ></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'be1b66712a57497892f4e70a9fc0e4f9';
  var gaud_map_key = 'ec1c17e08135f345b1f956f3fa268b0c# 锟�??得�?�拷图web锟斤拷锟斤拷key';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.6534116,27.96920845';
  var clock_default_rectangle_enable = 'true';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/clock.min.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('article-sort-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__slideInRight');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item swiper_container_card" style="height: auto;width: 100%"><div id="random"><div id="random-banner"><canvas id="peoplecanvas"></canvas></div><a id="random-hover" style="width:100%;height:auto;" href="javascript:toRandomPost()" rel="external nofollow noreferrer" one-link-mark="yes"><i class="fa fa-paper-plane" style="margin-left:10px"></i><div style="margin-left:10px">随便逛逛<i class="fa-solid fa-arrow-right" style="margin-left:10px"></i></div></a></div><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/10/09/python学习之路/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://wallhaven.cc/w/85j9qo" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-09</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/10/09/python学习之路/&quot;);" href="javascript:void(0);" alt="">python learning</a><div class="blog-slider__text">python learning for AI</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/10/09/python学习之路/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/11/27/预习作业：/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2022/11/27/预习作业：/S:\Blog\source\_posts\从0开始学习c语言\wallhaven-28p95m.png" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-27</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/11/27/预习作业：/&quot;);" href="javascript:void(0);" alt="">c for class</a><div class="blog-slider__text">a freshman's practice</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/11/27/预习作业：/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/10/29/answer/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/zy/wallhaven-zygeko.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/10/29/answer/&quot;);" href="javascript:void(0);" alt="">answer</a><div class="blog-slider__text">a freshman's practice</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/10/29/answer/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/js/swiper.min.js"></script><script defer data-pjax src="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper_init.js"></script><script data-pjax src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/gsap/3.9.1/gsap.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/people.min.js"></script><script async src="/anzhiyu/random.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>