<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>数据通信 | asuka&amp;ayanami</title><meta name="author" content="charles-webber"><meta name="copyright" content="charles-webber"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#78D77D"><meta name="description" content="ict培训数据通信">
<meta property="og:type" content="article">
<meta property="og:title" content="数据通信">
<meta property="og:url" content="http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/index.html">
<meta property="og:site_name" content="asuka&amp;ayanami">
<meta property="og:description" content="ict培训数据通信">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://images.wallpaperscraft.com/image/single/sakura_flowers_bloom_125940_1280x720.jpg">
<meta property="article:published_time" content="2024-07-10T07:46:10.557Z">
<meta property="article:modified_time" content="2024-07-10T08:22:31.329Z">
<meta property="article:author" content="charles-webber">
<meta property="article:tag" content="数据通信">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images.wallpaperscraft.com/image/single/sakura_flowers_bloom_125940_1280x720.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '数据通信',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-07-10 16:22:31'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#FF855DFF')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#78D77D')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/clock.min.css" /><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="asuka&ayanami" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/6o/wallhaven-6o36qq.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fa-solid fa-bell"></i><span> ACG</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> Message</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://images.wallpaperscraft.com/image/single/sakura_flowers_bloom_125940_1280x720.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">asuka&amp;ayanami</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fa-solid fa-bell"></i><span> ACG</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> Message</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">数据通信</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-10T07:46:10.557Z" title="发表于 2024-07-10 15:46:10">2024-07-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-10T08:22:31.329Z" title="更新于 2024-07-10 16:22:31">2024-07-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">39.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>152分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="数据通信"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="数据通信1"><a href="#数据通信1" class="headerlink" title="数据通信1"></a><strong>数据通信1</strong></h1><p>核心思想：积极提问，积极甩锅</p>
<h2 id="开课知识科普："><a href="#开课知识科普：" class="headerlink" title="开课知识科普："></a>开课知识科普：</h2><h2 id="osi七层结结构"><a href="#osi七层结结构" class="headerlink" title="osi七层结结构"></a>osi七层结结构</h2><p>osi中的网络层可能会用，更详细，排错会使用osi分层排错，从底层往上层逐级修bug</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230924093959737.png" alt="image-20230924093959737"></p>
<h3 id="物理层："><a href="#物理层：" class="headerlink" title="物理层："></a>物理层：</h3><p>定义电压，接口，网线长度等</p>
<h3 id="数据链路层："><a href="#数据链路层：" class="headerlink" title="数据链路层："></a>数据链路层：</h3><p>承上启下，承担翻译官的功能，不同线路对数据包装，分为MAC层和LLC层，主要协议是PPP</p>
<h5 id="MAC层："><a href="#MAC层：" class="headerlink" title="MAC层："></a>MAC层：</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230924103900397.png" alt="image-20230924103900397"></p>
<p>怎么找非法主机的MAC地址——ARP协议</p>
<p>1.先广播发送一个ARP请求</p>
<p>2.目标收到ARP协议后再发送一个ARP回应报文</p>
<p>缺点：安全性较差，可以欺骗路由器说我是他的用户，这样所有信息就跑别的地方了</p>
<p>二级交换机可以配ip，但它的本质工作不是这个，现在二层和三层的界限和模糊</p>
<h3 id="网络层："><a href="#网络层：" class="headerlink" title="网络层："></a>网络层：</h3><p>osi的网络编址不是ip（NSAP）</p>
<p>子网号是网络地址的一部分</p>
<p>网络地址是小区，主机地址是你家门牌号</p>
<h4 id="abc类地址分类"><a href="#abc类地址分类" class="headerlink" title="abc类地址分类"></a><strong>abc类地址分类</strong></h4><p>已经变得不太重要了，主要还是看子网掩码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230924110725911.png" alt="image-20230924110725911"></p>
<p>首部：0-10-110-1110</p>
<p>子网掩码是多少就写多少个一再补0，再将点的中间按下面转换</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230924112952207.png" alt="image-20230924112952207"></p>
<p>子网划分：</p>
<p>公式：2的n次方-2&gt;&#x3D;需求</p>
<p>n为主机位</p>
<p>网络位&#x3D;32-主机位</p>
<p>例子：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230924113739771.png" alt="image-20230924113739771"></p>
<p>30位的一个IP给终端，一个IP给网关</p>
<p>一般使用的子网划分地址为172.16.和10.</p>
<h4 id="特殊IP地址："><a href="#特殊IP地址：" class="headerlink" title="特殊IP地址："></a>特殊IP地址：</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230924110807920.png" alt="image-20230924110807920"></p>
<p>广播分为在一个网络广播和对所有主机广播</p>
<h4 id="私有地址："><a href="#私有地址：" class="headerlink" title="私有地址："></a>私有地址：</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230924111025286.png" alt="image-20230924111025286"></p>
<p>B类16的0到31的255</p>
<h4 id="地址聚合："><a href="#地址聚合：" class="headerlink" title="地址聚合："></a>地址聚合：</h4><p>就是将二进制相同的部分当做主机位</p>
<h4 id="代理ARP"><a href="#代理ARP" class="headerlink" title="代理ARP"></a>代理ARP</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230924115526084.png" alt="image-20230924115526084"></p>
<p>会产生ARP欺骗的类似效果</p>
<h4 id="Gratuitous-ARP"><a href="#Gratuitous-ARP" class="headerlink" title="Gratuitous ARP"></a>Gratuitous ARP</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230924115838202.png" alt="image-20230924115838202"></p>
<p>即请求自己的IP地址的MAC地址。</p>
<p>作用:1.验证IP是否冲突</p>
<p>2.更换物理网卡</p>
<h4 id="RARP"><a href="#RARP" class="headerlink" title="RARP"></a>RARP</h4><p> RARP使只知道自己硬件地址的主机能够知道其IP地址。ARP是知道IP求MAC，RARP是知道MAC求IP</p>
<h4 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h4><p>版本：不是4就是6</p>
<p>首部长度和总长度配合来算载荷</p>
<p>服务类型：TOS包括共8位，包括3 bit的优先权字段（取值可以从000-111所有值），4 bit的TOS子字段和1 bit未用位但必须置0。</p>
<p>标识符：数据报由于长度超过网络的MTU而必须分片时，这个标识字段的值就被复制到所有的数据报片的标识字段中。相同的标识字段的值使分片后的各数据报片最后能正确地重装成为原数据</p>
<p>标志：标志字段中的最低位为MF（More Fragment）。MF&#x3D;1即表示后面“还有分片”的数据报。MF&#x3D;0表示这已是若干数据报片中的最后一个。</p>
<p>  标志字段中间的一位记为DF（Don’t Fragment），意思是“不能分片”。只有当DF&#x3D;0时才允许分片。</p>
<p>片偏移：<strong>片偏移指的是较长的分组在分片后，某片在原分组中的相对位置</strong></p>
<p>生存时间： 每经过一个路由器减一</p>
<p>协议：嗯记，每个协议有特定的数字，例如TCP（6），UDP（17）</p>
<h3 id="传输层："><a href="#传输层：" class="headerlink" title="传输层："></a>传输层：</h3><p>经典——TCP&#x2F;UDP，除此之外还有很多其他的协议，如OSPF</p>
<h4 id="tcp首部格式"><a href="#tcp首部格式" class="headerlink" title="tcp首部格式"></a>tcp首部格式</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230924143112188.png" alt="image-20230924143112188"></p>
<h4 id="三次握手："><a href="#三次握手：" class="headerlink" title="三次握手："></a>三次握手：</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230924143522270.png" alt="image-20230924143522270"></p>
<p>这里是显式确认</p>
<p>用户希望a，对方回应确认a+1，希望得b，用户回应确认b+1</p>
<p>&#x2F;&#x2F;后来补充，每个步骤相对应的状态机</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240429142442113.png" alt="image-20240429142442113"></p>
<p>客户端发出syn请求（a），进入<strong>syn_sent状态</strong>，对方接收到后回复a+1的ack,进入到<strong>SYN—RCVD状态</strong>，并且要求对方回复b，客户端接收到后回复b+1，<strong>进入到establish状态</strong>，对方<strong>接收到后也成为establish状态</strong></p>
<h4 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230924144920245.png" alt="image-20230924144920245"></p>
<p>tcp是建立在IP不可靠上的，tcp用三次握手和四次挥手来保证可靠传输</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240429143114076.png" alt="image-20240429143114076">建立<strong>连接后大家都是establish状态，</strong>接着客户端<strong>发起结束请求</strong>，<strong>进入FIN-WAIT1状态</strong>，发送u，对方<strong>接收到后进入到CLOSE-WAIT</strong>状态，并且回复u+1，对方<strong>接收到后进入FIN-WAIT2状态，</strong>接着服务端再发送最后确认信号seq&#x3D;w，进入<strong>LAST—ACK状态</strong>，对方接收到后<strong>进入TIME-WAIT状态</strong>，发送w+1，<strong>等待一段时间后进入CLOSED状态</strong>，对方服务器<strong>接收到回复后进入到CLOSED状态</strong></p>
<h4 id="UDP的首部格式"><a href="#UDP的首部格式" class="headerlink" title="UDP的首部格式"></a>UDP的首部格式</h4><p>与TCP对比</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230924145427701.png" alt="image-20230924145427701"></p>
<p>机房：</p>
<p>列头柜不要摸，380v高压！！！</p>
<p>接口：FC，SC，LC，ST</p>
<p>光纤：靠颜色区分，黄色是单模（SM）光纤（1310nm），多模光纤（850nm）：om1，2（橘黄色）om3（蓝色），om4（紫色）</p>
<h2 id="设备配置"><a href="#设备配置" class="headerlink" title="设备配置"></a>设备配置</h2><p>1.console配置–实地配置</p>
<p>2.telent配置–远程配置</p>
<p>配置方式：1.仅靠密码控制</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;Quidway&gt;system-view -----进入配置模式</span><br><span class="line">[Quidway]interface vlan <span class="number">1</span> -----进入管理vlan</span><br><span class="line">[Quidway-Vlanif1]ip address <span class="number">192.168</span><span class="number">.28</span><span class="number">.49</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> -----配置管理ip地址</span><br><span class="line">[Quidway-Vlanif1]quit -----退出</span><br><span class="line">[Quidway]telnet server enable -----打开telnet服务 （一般默认开启）</span><br><span class="line">[Quidway]user-interface vty <span class="number">0</span> <span class="number">4</span> -----用户指定虚拟用户终端接口</span><br><span class="line">[Quidway-ui-vty0<span class="number">-4</span>]authentication-mode password -----配置用户终端接口认证方式 密码验证</span><br><span class="line">[Quidway-ui-vty0<span class="number">-4</span>]<span class="built_in">set</span> authentication password cipher huawei123 -----设置接口验证密码,密码为huawei123</span><br><span class="line">[Quidway-ui-vty0<span class="number">-4</span>]user privilege level <span class="number">15</span> -----设置用户优先级 （可选）</span><br><span class="line">[Quidway-ui-vty0<span class="number">-4</span>]idle-timeout <span class="number">1</span> -----设置登陆超时为一分钟 （可选）</span><br><span class="line">[Quidway-ui-vty0<span class="number">-4</span>]<span class="keyword">return</span> -----返回用户视图</span><br><span class="line">&lt;Quidway&gt;save -----保存</span><br></pre></td></tr></table></figure>

<p>2.用户名加密码控制（aaa）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;Quidway&gt;system-view -----进入配置模式</span><br><span class="line">[Quidway]interface vlan <span class="number">1</span> -----进入管理vlan</span><br><span class="line">[Quidway-Vlanif1]ip address <span class="number">192.168</span><span class="number">.28</span><span class="number">.49</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> -----配置管理ip地址</span><br><span class="line">[Quidway-Vlanif1]quit -----退出</span><br><span class="line">[Quidway]telnet server enable -----打开telnet服务 （一般默认开启）</span><br><span class="line">[Quidway]user-interface vty <span class="number">0</span> <span class="number">4</span> -----用户指定虚拟用户终端接口</span><br><span class="line">[Quidway-ui-vty0<span class="number">-4</span>]authentication-mode aaa -----配置用户终端接口认证方式 aaa验证</span><br><span class="line">[Quidway-ui-vty0<span class="number">-4</span>]user privilege level <span class="number">15</span> -----设置用户优先级</span><br><span class="line">[Quidway-ui-vty0<span class="number">-4</span>]idle-timeout <span class="number">1</span> -----设置登陆超时为一分钟</span><br><span class="line">[Quidway-ui-vty0<span class="number">-4</span>]quit -----退出</span><br><span class="line">[Quidway]aaa -----进入aaa</span><br><span class="line">[Quidway-aaa]local-user huawei password cipher huawei123 -----创建用户名huawei 密码huawei123</span><br><span class="line">[Quidway-aaa]local-user huawei privilege level <span class="number">15</span> -----设置用户优先级</span><br><span class="line">[Quidway-aaa]local-user huawei service-type telnet -----授权用户使用telnet</span><br><span class="line">[Quidway-ui-vty0<span class="number">-4</span>]<span class="keyword">return</span> -----返回用户视图</span><br><span class="line">&lt;Quidway&gt;save -----保存</span><br></pre></td></tr></table></figure>

<p>实验远程连接成功：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//image-20230925232936666.png" alt="image-20230925232936666"></p>
<p>3.ssh,类telnet，但是更加安全</p>
<p>配置方式：1.账号密码方式（与telnet差不多，略）</p>
<p>2.密钥控制:</p>
<ol>
<li>服务器端生成本地密钥对<br>ecc local-key-pair create</li>
<li>配置VTY用户界面</li>
</ol>
<p>user-interface vty 0 4</p>
<p> authentication-mode aaa</p>
<p> user privilege level 3</p>
<p>protocol inbound ssh</p>
<ol start="3">
<li>创建SSH用户Client001，ecc认证（自己取名字）</li>
</ol>
<p>SSH Server:<br>ssh user client001<br>ssh user client001 authentication-type password</p>
<ol start="4">
<li>客户端先生成一个本地密钥对</li>
</ol>
<p>SSH Server:<br>sysname client002<br>ecc local-key-pair create</p>
<ol start="5">
<li>查看密钥信息</li>
</ol>
<p>display ecc local-key-pair public</p>
<ol start="6">
<li>想办法将密钥复制发送到服务器端，再输入保存在服务器里</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SSH Server:</span><br><span class="line">ecc peer-public-key <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span><span class="comment">//</span></span><br><span class="line"> public-key-code begin<span class="comment">//</span></span><br><span class="line">  <span class="number">0400</span>CB04 <span class="number">85</span>C462A2 <span class="number">2169E6</span>B4 CD089C0D <span class="number">4E27</span>A587 C7D8AAE3 A3FD2714 A7414857</span><br><span class="line">  <span class="number">747B</span>C1F8 E4797A8E CBA0FCE6 <span class="number">475260F</span>E BB5F3C5B <span class="number">219594</span>DF D7A59B3C <span class="number">1</span>C5CEEA2</span><br><span class="line">  <span class="number">6</span>ADD5400 B10DF3F1 DDC7A255 <span class="number">38</span>A27469 <span class="number">2B</span>D67DBD AE0A0B40 C3B9C7DC <span class="number">6</span>D7C83DD</span><br><span class="line">  <span class="number">5F</span>BB3E84 CC057512 <span class="number">1B</span>6D652B <span class="number">1E722161</span> <span class="number">3915932B</span> <span class="number">003</span>C2B7E CC591551 <span class="number">4</span>A4F31E1</span><br><span class="line">  <span class="number">5</span>D5E140E F9（这段就是密钥）</span><br><span class="line"> public-key-code end<span class="comment">//</span></span><br><span class="line"> peer-public-key end<span class="comment">//</span></span><br></pre></td></tr></table></figure>

<ol start="7">
<li><p>服务端为这个密钥起名字并与用户绑定,打开stelnet服务<br>ssh user client002 assign ecc-key ecckey001</p>
<pre><code> stelnet server enable
</code></pre>
</li>
<li><p>首次认证并连接<br>ssh client first-time enable</p>
<pre><code> stelnet 1.1.1.1
</code></pre>
</li>
</ol>
<p>（rsa与ecc配置命令类似）</p>
<h2 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h2><p>asl，qs，mpo是啥？</p>
<p>代理ARP？</p>
<p><strong>代理ARP</strong>是 ARP协议 的一个变种。 对于没有配置缺省网关的计算机要和其他网络中的计算机实现通信，网关收到源计算机的 ARP 请求会使用自己的 MAC 地址与目标计算机的 IP地址对源计算机进行应答。 代理ARP就是将一个主机作为对另一个主机ARP进行应答—-度娘</p>
<h2 id><a href="#" class="headerlink" title></a></h2><h1 id="数据通信2"><a href="#数据通信2" class="headerlink" title="数据通信2"></a>数据通信2</h1><p>[TOC]</p>
<h2 id="ICMP（互联网控制信息协议）"><a href="#ICMP（互联网控制信息协议）" class="headerlink" title="ICMP（互联网控制信息协议）"></a>ICMP（互联网控制信息协议）</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>ping以及traceroute工作基于icmp，icmp是网络层协议，如果某个包丢失了，那么icmp报文就要把丢失原因告知</p>
<h3 id="ping使用icmp的流程"><a href="#ping使用icmp的流程" class="headerlink" title="ping使用icmp的流程"></a>ping使用icmp的流程</h3><ol>
<li>源服务器向目的服务器发送ICMP回显请求消息数据包</li>
<li>目的服务器发送回显应答</li>
<li>源服务器显示相关数据</li>
</ol>
<h3 id="traceroute命令"><a href="#traceroute命令" class="headerlink" title="traceroute命令"></a>traceroute命令</h3><ol>
<li><p>首先 traceroute 会将 IP 包的 TTL 设置 为 1，然后发送 UDP 包，他会填入一个端口号（不可达）作为 UDP 目标端口号（默认是：33434-33534）</p>
</li>
<li><p>当目的主机收到 UDP 包后，会返回 ICMP 差错报文消息（类型 3，代码 3）。参照上面的表，该错报文类型是端口不可达，说明发送方发出的 UDP 包到达了目的主机（该报文中含有IP地址）</p>
</li>
<li><p>*有的路由器禁用 ICMP ，那么他就根本不会返回这个 ICMP 差错报文，所以是看不到中间经过的路由IP的。</p>
</li>
<li><p>traceroute 在类 Unix&#x2F;Linux 系统中默认使用的是 UDP 协议，也可以通过参数修改为使用 ICMP 协议；Windows 操作系统中只使用 ICMP 协议</p>
</li>
</ol>
<p>*有时候ApingB可以通，但是反过来就不行了，可能是B的防火墙把ICMP过滤掉了，但是把ICMP封装到UDP或者TCP就可以了</p>
<h3 id="协议类型"><a href="#协议类型" class="headerlink" title="协议类型"></a>协议类型</h3><p>ICMP有type码和code码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230929091544569.png" alt="image-20230929091544569"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230929091610758.png" alt="image-20230929091610758"></p>
<h2 id="FTP-Client"><a href="#FTP-Client" class="headerlink" title="FTP-Client"></a>FTP-Client</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230929091725044.png" alt="image-20230929091725044"></p>
<p>路由器启动会从硬盘读取一个镜像然后启动操作系统（.bin） 更换系统就是把它的这个镜像文件替换就好了</p>
<h3 id="换镜像操作："><a href="#换镜像操作：" class="headerlink" title="换镜像操作："></a>换镜像操作：</h3><ol>
<li><p>搭建FTP服务器（网络上有很多这种视频帮助搭建，例如windows的 IIS）</p>
</li>
<li><p>配置和镜像都要备份（FTP加自己的IP地址）</p>
</li>
<li><p>put（上传）加路径就能把配置上传到你的云上</p>
</li>
<li><p>从服务器下载镜像文件更换</p>
</li>
</ol>
<h2 id="文件管理FTP"><a href="#文件管理FTP" class="headerlink" title="文件管理FTP"></a>文件管理FTP</h2><ol>
<li>配置路由器Ip</li>
<li>服务器端配置ftp的用户名和密码</li>
<li>服务器开启ftp服务</li>
<li>客户端登陆ftp服务器，dir查看路径，get下载</li>
</ol>
<h2 id="-1"><a href="#-1" class="headerlink" title></a></h2><h2 id="DHCP（UDP）"><a href="#DHCP（UDP）" class="headerlink" title="DHCP（UDP）"></a>DHCP（UDP）</h2><p>本质：配IP</p>
<h3 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230929105515002.png" alt="image-20230929105515002"></p>
<h3 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230929105632077.png" alt="image-20230929105632077"></p>
<p>ipv6时代DHCP更加不可或缺</p>
<p>DHCP租期不易过长，不然会有大量IP被占用（占着茅坑不拉屎）–两小时推荐</p>
<h3 id="DHCP系统组成"><a href="#DHCP系统组成" class="headerlink" title="DHCP系统组成"></a>DHCP系统组成</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230929110439020.png" alt="image-20230929110439020"></p>
<h3 id="DHCP的地址分配方式"><a href="#DHCP的地址分配方式" class="headerlink" title="DHCP的地址分配方式"></a>DHCP的地址分配方式</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230929110844992.png" alt="image-20230929110844992"></p>
<h3 id="IP地址的动态获取过程"><a href="#IP地址的动态获取过程" class="headerlink" title="IP地址的动态获取过程"></a>IP地址的动态获取过程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230929111125227.png" alt="image-20230929111125227"></p>
<ol>
<li>discover–能不能给我分配一个ip地址？</li>
<li>offer–给它一个IP地址</li>
<li>request–我能不能用这个IP？</li>
<li>ack（允许）–nak（不允许）</li>
</ol>
<h2 id="DHCP实验"><a href="#DHCP实验" class="headerlink" title="DHCP实验"></a>DHCP实验</h2><h3 id="基于端口"><a href="#基于端口" class="headerlink" title="基于端口"></a>基于端口</h3><p>*进入端口，配置pool，打开服务</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930092042484.png" alt="image-20230930092042484"></p>
<ol>
<li><p>首先最关键的就是将路由器的端口ip配置</p>
</li>
<li><p>打开dhcp服务</p>
</li>
<li><p>配置地址池，也就是网段，主机会被分配到这些ip地址中的其中一个（元素：网段，网关，dns地址，租约时间）</p>
</li>
<li><p>排除不需要的地址</p>
</li>
<li><p>主机启动dhcp模式，输入ipconfig查看获取的ip地址</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20200516095009195.png" alt="在这里插入图片描述"></p>
</li>
</ol>
<h3 id="全局DHCP"><a href="#全局DHCP" class="headerlink" title="全局DHCP"></a>全局DHCP</h3><p>*配置pool，进入端口，打开全局</p>
<p>*图片案例同上</p>
<ol>
<li>还是先为端口配置ip地址</li>
<li>接着创建地址池（IP pool 1）</li>
<li>为这个地址池配置元素（网段，网关，dns服务器，租约）</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930091813581.png" alt="image-20230930091813581"></p>
<ol start="4">
<li>排除不分配的地址</li>
<li>为接口启动全局dhcp服务##</li>
<li>pc机输入ipconfig查看分配的ip地址</li>
</ol>
<h3 id="中继DHCP"><a href="#中继DHCP" class="headerlink" title="中继DHCP"></a>中继DHCP</h3><p>*配置服务器端口pool，声明下一跳，网关路由连上服务器端口</p>
<p>分为了服务端路由器和网关路由（中继）</p>
<h4 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h4><ol>
<li>端口配置ip</li>
<li>关键：告知路由器要到达某一网段的下一跳在哪（静态路由：ip route-static 192.168.1.0 255.255.255.0 10.0.0.2）</li>
<li>接着就是配置pool池的元素（网段，网关，dns服务器，排除ip，租期时间）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ip pool vlan100//pool池创建</span><br><span class="line"> gateway-list 192.168.100.254 //网关</span><br><span class="line"> network 192.168.100.0 mask 255.255.255.0 //地址段</span><br><span class="line"> excluded-ip-address 192.168.100.99 //保留地址</span><br><span class="line"> lease day 0 hour 3 minute 0 //设置租期</span><br><span class="line"> dns-list 114.114.114.114 //dns</span><br><span class="line">#</span><br></pre></td></tr></table></figure>



<ol start="4">
<li><strong>为端口打开全局DHCP服务（很容易忘记）</strong></li>
</ol>
<p>dhcp select global</p>
<h4 id="网关路由"><a href="#网关路由" class="headerlink" title="网关路由"></a>网关路由</h4><ol>
<li>接口配置ip</li>
<li>在端口做代理，指明（绑定）dhcp服务器的端口</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930105742459.png" alt="image-20230930105742459"></p>
<h2 id="华为设备密码破解"><a href="#华为设备密码破解" class="headerlink" title="华为设备密码破解"></a>华为设备密码破解</h2><p>*user-interface 是管理接口</p>
<h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>*如果进入端口后启动aaa模式然后一直quit，就会登不上设备（用户名和密码都没有设置）</p>
<h4 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h4><p>ensp做不了</p>
<ol>
<li>交换机断电重启，按ctrl+b（华为设备一般账号名admin，密码为admin@huawei，忘记了就打咨询电话）</li>
<li>在bootrom 中选择清除console密码</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210423085811348.jpeg" alt="img"></p>
<ol start="3">
<li>确认后选择模式1启动，设置新的密码</li>
</ol>
<h2 id="LLDP"><a href="#LLDP" class="headerlink" title="LLDP"></a>LLDP</h2><p>通过打开协议将不清晰的网络架构生成出来</p>
<p>display lldp neighbor brief—-查看一个设备所有接口的连接情况</p>
<p>display lldp neighbor interface g0&#x2F;0&#x2F;0—-查看某一具体接口连接情况</p>
<p>步骤：</p>
<ol>
<li>远程控制其中的一台设备</li>
<li>display lldp neighbor brief查看一个设备所有接口的连接情况</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231005195645420.png" alt="image-20231005195645420"></p>
<ol start="3">
<li><p>画大致的拓扑图，再进入具体接口看IP：display lldp neighbor interface g0&#x2F;0&#x2F;0—-查看某一具体接口连接情况</p>
</li>
<li><p>重复前三点，直到拓扑完善</p>
</li>
</ol>
<p>*注意：有些线路可能无法显示，解决方法是？</p>
<h2 id="VLAN技术"><a href="#VLAN技术" class="headerlink" title="VLAN技术"></a>VLAN技术</h2><ol>
<li>创建vlan （vlan 2或者 vlan batch 2 3）</li>
<li>进入端口</li>
<li>切换模式为access</li>
<li>划分vlan（port default vlan 2）</li>
</ol>
<p>逻辑上将一个大的交换机划分成两个以上，两个不同的vlan间无法正常通信</p>
<h2 id="VLAN标签"><a href="#VLAN标签" class="headerlink" title="VLAN标签"></a>VLAN标签</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230929162902372.png" alt="image-20230929162902372"></p>
<p>802.1q或者串口封装为vlan打上标签</p>
<p>vlan数量1-4094</p>
<p>本征vlan不打标签（一般将用不到的vlan设置成本征镜像vlan）</p>
<p>arp会从非接收端先广播发送给相同vlan的部分再发送到trunk口</p>
<p>*两个交换机的本征vlan必需相同，不然很可能丢包（port trunk vid 2）</p>
<hr>
<h1 id="数据通信3"><a href="#数据通信3" class="headerlink" title="数据通信3"></a>数据通信3</h1><h2 id="VLAN路由"><a href="#VLAN路由" class="headerlink" title="VLAN路由"></a>VLAN路由</h2><p>不同vlan不能通信，划分成了不同的广播域和网段（虚拟）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930093842745.png" alt="image-20230930093842745"></p>
<p>创建vlan相当于创建了一个网段，但是还缺少了网关，而vlanif接口就解决了这个问题，就相当于vlan网络的网关，这样交换机就能将不同vlan的信息进行转发（拥有他们的ip地址）</p>
<p>*同网段可以通信，跨网段不能通信，可能是pc的网关没配</p>
<p>如果右边的pc3想pingpc4是无法直接通过sw2转发，因为没有配置vlanif接口，这个时候就要依靠左边的sw1（此时扮演的就是vlan路由）pc3通过sw2转发到sw1，sw1发现是转发给vlan2的，把标签改变再转发</p>
<h2 id="VLAN-单臂路由"><a href="#VLAN-单臂路由" class="headerlink" title="VLAN-单臂路由"></a>VLAN-单臂路由</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930101050638.png" alt="image-20230930101050638"></p>
<p>配置一个不用的vlan id 是很重要的！！！</p>
<p>单臂路由一条线路怎么加两个以上的vlan呢？</p>
<p>在一个物理端口上添加虚拟端口int g0&#x2F;0&#x2F;0.1,dot1q terminal vid ？连上vlan，配置ip作为网关，打开arp broadcast enable</p>
<h2 id="以太网端口技术"><a href="#以太网端口技术" class="headerlink" title="以太网端口技术"></a>以太网端口技术</h2><h3 id="自协商"><a href="#自协商" class="headerlink" title="自协商"></a>自协商</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930110343580.png" alt="image-20230930110343580"></p>
<p>带宽很大而主机不需要这么带宽是时，路由器可以根据主机的带宽进行自协商分配带宽（auto negotiation）</p>
<p><strong>以太网的接口模式</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930111242876.png" alt="image-20230930111242876"></p>
<h3 id="流量控制"><a href="#流量控制" class="headerlink" title="流量控制"></a>流量控制</h3><p>老师省略了，查资料发现根本看不明白：)</p>
<h3 id="链路聚合"><a href="#链路聚合" class="headerlink" title="链路聚合"></a>链路聚合</h3><p>将物理线路逻辑上聚合为一条线路</p>
<p><em>配置一致（速度一样）</em> <em>最多八根</em></p>
<p>*带宽做加法</p>
<ol>
<li>全局创建eth-trunk 1</li>
<li>端口输入eth-trunk</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930114602155.png" alt="image-20230930114602155">例子</li>
</ol>
<p>优点：增大容错率，其中一个线路寄了网络不会寄；带宽增加</p>
<p><em>注意</em> 逻辑上两个物理变成逻辑接口了，vlan配置都基于这个逻辑接口</p>
<h4 id="手动模式"><a href="#手动模式" class="headerlink" title="手动模式"></a>手动模式</h4><p>指LAG不启用任何链路聚合协议，Eth-Trunk的建立、成员接口的加入由手工配置。</p>
<p>（手敲代码）</p>
<h4 id="LACP模式"><a href="#LACP模式" class="headerlink" title="LACP模式"></a>LACP模式</h4><h5 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h5><p>指LAG启用LACP链路聚合协议，Eth-Trunk的建立、成员接口的加入基于LACP协议协商完成。</p>
<h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><p>由LACP确定聚合组中的活动和非活动链路，又称为M:N模式，即M条活动链路与N条备份链路的模式。这种模式提供了更高的链路可靠性，并且可以在M条链路中实现不同方式的负载均衡。（M里面哪条链路寄了就从N条中选择一条替换）</p>
<h5 id="实验配置"><a href="#实验配置" class="headerlink" title="实验配置"></a>实验配置</h5><ol>
<li>交换机创建eth-trunk接口</li>
<li>模式确认为lacp模式</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231005201753041.png" alt="image-20231005201753041"></p>
<ol start="3">
<li>将端口加入到eth-trunk中，设置优先级（就是确认谁是M谁是N）</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231005202014987.png" alt="image-20231005202014987"></p>
<ol start="3">
<li><p>设置活动接口数量（M有多少个）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231005202025173.png" alt="image-20231005202025173"></p>
</li>
</ol>
<h5 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231005203606433.png" alt="image-20231005203606433"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/download" alt="手工模式与LACP模式的对比"></p>
<h4 id="跨交换机的链路聚合"><a href="#跨交换机的链路聚合" class="headerlink" title="跨交换机的链路聚合"></a>跨交换机的链路聚合</h4><p>以后教</p>
<h3 id="端口镜像"><a href="#端口镜像" class="headerlink" title="端口镜像"></a>端口镜像</h3><p>把某一个接口的数据复制到你指定的端口，相当于多播 </p>
<ol>
<li>先将你要添加的端口作为observe-port</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231005204920979.png" alt="image-20231005204920979"></p>
<ol start="2">
<li>再将监听的端口mirror添加到observe-port（模式，in&#x2F;out&#x2F;both）</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231005204950325.png" alt="image-20231005204950325"></p>
<h2 id="STP的原理及配置"><a href="#STP的原理及配置" class="headerlink" title="STP的原理及配置"></a>STP的原理及配置</h2><p>*一些叫法：802.1D，802.1W，802.1S（3个版本）</p>
<p>802.1D衍生：华为设备：STP 思科设备：PVST—&gt;PVST+</p>
<p>802.1W衍生：华为设备：R（快速）STP 思科设备：PVRST</p>
<p>802.1S衍生：华为：MSTP</p>
<p>*本质上就是防止闭环</p>
<p>*主要是进行调优，理论知识更重要</p>
<h3 id="交换机的转发流程"><a href="#交换机的转发流程" class="headerlink" title="交换机的转发流程"></a>交换机的转发流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930143112850.png" alt="image-20230930143112850"></p>
<ol>
<li>先将信息来源的mac地址登记</li>
<li>查看转发表进行转发</li>
<li>找不到，泛洪</li>
</ol>
<h3 id="环路问题"><a href="#环路问题" class="headerlink" title="环路问题"></a>环路问题</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930143349605.png" alt="image-20230930143349605">PC机占用率拉满</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930143743905.png" alt="image-20230930143743905"></p>
<p>在E0&#x2F;3和E0&#x2F;4之间反复横跳</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><h4 id="消除环路"><a href="#消除环路" class="headerlink" title="消除环路"></a>消除环路</h4><p>阻塞某一端口（无关端口）–block（仅能接收一种报文BPDU）</p>
<h4 id="根交换机"><a href="#根交换机" class="headerlink" title="根交换机"></a>根交换机</h4><p>一个广播域选一个根交换机（判读依据：<em><strong>BID&#x3D;桥ID&#x3D;网桥优先级（32768）+MAC地址</strong></em>），比小不比大，优先级可以更改。（增量4096）</p>
<h4 id="根端口"><a href="#根端口" class="headerlink" title="根端口"></a>根端口</h4><p>一个非根桥交换机上选一个根端口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930152937878.png" alt="image-20230930152937878"></p>
<ol>
<li><p>开始都会发送SPDU报文进行第一次选举（比较根桥id大小）</p>
</li>
<li><p>然后比较到达根桥累计路径开销（1G-20000，小的优先）</p>
</li>
<li><p>第二点相同时，比较发送者桥ID（中继桥id小优先）</p>
</li>
<li><p>第三点相同时，比较发送者端口（发送端口小的相连的为根端口）：端口&#x3D;端口优先级（128）+端口号（只能改优先级，增量16）</p>
</li>
<li><p>比较自己的端口号</p>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930154303861.png" alt="image-20230930154303861"></p>
<h4 id="指定端口"><a href="#指定端口" class="headerlink" title="指定端口"></a>指定端口</h4><p>一个冲突域内选一个指定端口（一般是一个网段）</p>
<p>先找出根交换机（root），再找出根端口（Root port），再找出指定端口（Designed port），最后生成无关端口（NP）</p>
<h4 id="端口状态描述"><a href="#端口状态描述" class="headerlink" title="端口状态描述"></a>端口状态描述</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930160810200.png" alt="image-20230930160810200"></p>
<p>头脑风暴了哥们,这里的重启时间是真的搞不明白</p>
<p>从断链到重启大约需要50s</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930161657390.png" alt="image-20230930161657390"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930161740965.png" alt="image-20230930161740965"></p>
<h4 id="stp配置"><a href="#stp配置" class="headerlink" title="stp配置"></a>stp配置</h4><p>*理论很烧脑，实验很简单</p>
<p>特殊：stp root primary&#x2F;secondary（降低优先级）</p>
<p>一般：stp mode stp 和stp priority 4096（设置交换机的优先级）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930162718508.png" alt="image-20230930162718508"></p>
<p>要改变b的根端口，修改a的端口优先级（int g0&#x2F;0&#x2F;0  stp port priority 32）或者改b的端口开销（int g0&#x2F;0&#x2F;0  stp cost 2000）</p>
<h2 id="RSTP（快！）"><a href="#RSTP（快！）" class="headerlink" title="RSTP（快！）"></a>RSTP（快！）</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930163114220.png" alt="image-20230930163114220"></p>
<ol>
<li>状态只有三个了</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930163602080.png" alt="image-20230930163602080"></p>
<ol start="2">
<li>端口角色变成4个</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930163620583.png" alt="image-20230930163620583"></p>
<ol start="3">
<li>BPDU格式变化</li>
</ol>
<h2 id="拓扑变更"><a href="#拓扑变更" class="headerlink" title="拓扑变更"></a>拓扑变更</h2><p>每两秒发送的bdpu（hello）是configuration报文</p>
<p>*TCN：topo change notification</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930165036940.png" alt="image-20230930165036940"></p>
<p>收到TC老化时间会从300s减少到15s</p>
<p>这些叫flag信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20230930165319736.png" alt="image-20230930165319736"></p>
<h1 id="课后作业"><a href="#课后作业" class="headerlink" title="课后作业"></a>课后作业</h1><h2 id="故障排查"><a href="#故障排查" class="headerlink" title="故障排查"></a>故障排查</h2><h3 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231005212238276.png" alt="image-20231005212238276"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231005212317830.png" alt="image-20231005212317830"></p>
<h3 id="问题来源："><a href="#问题来源：" class="headerlink" title="问题来源："></a>问题来源：</h3><ol>
<li>pc的网关就ping不通,发现是vlanif地址没有配置</li>
<li>部分pc的地址错误</li>
<li>有些接口被shutdown了</li>
<li>交换机3的两个接口没有配置</li>
<li>交换机2的vlan 100 和200没有创建（马虎了没有发现导致卡了很久）</li>
<li>同一网段接口pvid不同</li>
</ol>
<h2 id="mstp-多生成树"><a href="#mstp-多生成树" class="headerlink" title="mstp(多生成树)"></a>mstp(多生成树)</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231006164129296.png" alt="image-20231006164129296"></p>
<ol>
<li>实例–基于实例来生成二叉树</li>
<li>每个实例包含一个或者多个VLAN</li>
<li>vlan会按照所在的生成树结构转发数据</li>
</ol>
<h3 id="单实例"><a href="#单实例" class="headerlink" title="单实例"></a>单实例</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/592e27d2e87046fcab33a7ac32419200.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]stp region-configuration 	  <span class="comment">//进入设备的MST域视图，针对MST域的相关配置需在该视图下进行。</span></span><br><span class="line">[Huawei-mst-region]region-name HCNP	  <span class="comment">//修改MST域名称</span></span><br><span class="line">[Huawei-mst-region]revision-level <span class="number">1</span>	  <span class="comment">//将MST域的修订级别修改为1，缺省为0</span></span><br><span class="line">[Huawei-mst-region]active region-configuration   <span class="comment">//激活上述配置</span></span><br><span class="line">Info: This operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[Huawei-mst-region]q</span><br><span class="line">[Huawei]stp mode mstp </span><br><span class="line">[Huawei]stp root primary   <span class="comment">//指定主根桥(或者打：stp priority 0，数字越小优先级越高)，备份桥stp secondary</span></span><br><span class="line">[Huawei]stp enable </span><br><span class="line">[Huawei]</span><br></pre></td></tr></table></figure>

<h3 id="多实例"><a href="#多实例" class="headerlink" title="多实例"></a>多实例</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/dda938c4f4704c41a5999b1639e7dae0.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]stp region-configuration </span><br><span class="line">[Huawei-mst-region]region-name ##</span><br><span class="line">[Huawei-mst-region]instance <span class="number">1</span> vlan <span class="number">2</span> to <span class="number">10</span></span><br><span class="line">[Huawei-mst-region]instance <span class="number">2</span> vlan <span class="number">11</span> to <span class="number">20</span></span><br><span class="line">[Huawei-mst-region]active region-configuration </span><br><span class="line">Info: This operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[Huawei-mst-region]q</span><br><span class="line">[Huawei]stp mode mstp </span><br><span class="line">[Huawei]stp instance <span class="number">0</span> root primary <span class="comment">//按照实际设计要求设置，不同交换机主要更改这个</span></span><br><span class="line">[Huawei]stp instance <span class="number">1</span> root primary </span><br><span class="line">[Huawei]stp instance <span class="number">2</span> root secondary </span><br><span class="line">[Huawei]stp enable </span><br><span class="line"><span class="comment">//mstp配置模式-》命名，vlan添加到实例-》交换机在实例中优先级设置-》启动</span></span><br></pre></td></tr></table></figure>

<h2 id="综合实验"><a href="#综合实验" class="headerlink" title="综合实验"></a>综合实验</h2><p>主要考察vlan划分，链路聚合和dhcp配置的知识点# 数据通信3</p>
<p>[TOC]</p>
<h2 id="MSTP的原理与配置"><a href="#MSTP的原理与配置" class="headerlink" title="MSTP的原理与配置"></a>MSTP的原理与配置</h2><h3 id="MSTP的基本概念"><a href="#MSTP的基本概念" class="headerlink" title="MSTP的基本概念"></a>MSTP的基本概念</h3><p>问题：单个生成树的弊端—一部分VLAN路径不通&#x2F;路径可能过长</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014091131471.png" alt="image-20231014091131471"></p>
<p>stp判断向量：根交换机-路径开销–桥ID–端口ID–自己的端口id（有STP就要考虑优化问题）</p>
<h3 id="多生成树实例"><a href="#多生成树实例" class="headerlink" title="多生成树实例"></a>多生成树实例</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014092050882.png" alt="image-20231014092050882"></p>
<p>vlan2的3700和5700-B断开</p>
<p>vlan3的3700和5700-A断开</p>
<p>*每根线都得到了利用，且能够避免环路</p>
<p>*默认的实例为instance 0</p>
<h3 id="MSTP配置"><a href="#MSTP配置" class="headerlink" title="MSTP配置"></a>MSTP配置</h3><ol>
<li>将vlan划分到不同的实例</li>
<li>设置交换机的优先级（dis stp可以查看桥ID和路径开销），配置优先级要突出在哪一个实例下（stp instance 1 priority 0）</li>
<li>注意：交换机可能会出bug，需要配置一个备份交换机（stp instance 1 priority 4096）</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014101751340.png" alt="image-20231014101751340"></p>
<h3 id="MSTP区域"><a href="#MSTP区域" class="headerlink" title="MSTP区域"></a>MSTP区域</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014100039452.png" alt="image-20231014100039452"></p>
<p>将多个交换机划分不同的区域，一个区域可以看成一个交换机，这个根桥叫域根</p>
<h3 id="端口角色"><a href="#端口角色" class="headerlink" title="端口角色"></a>端口角色</h3><p><strong>根端口</strong>	在非根桥上，离根桥最近的端口是本交换设备的根端口。根交换设备没有根端口。根端口负责向树根方向转发数据。</p>
<p><strong>指定端口</strong>	对一台交换设备而言，它的指定端口是向下游交换设备转发BPDU报文的端口。</p>
<p><strong>Alternate端口</strong>	从配置BPDU报文发送角度来看，Alternate端口就是由于学习到其它网桥发送的配置BPDU报文而阻塞的端口。 从用户流量角度来看，Alternate端口提供了从指定桥到根的另一条可切换路径，作为根端口的备份端口。</p>
<p><strong>Backup端口</strong>	从配置BPDU报文发送角度来看，Backup端口就是由于学习到自己发送的配置BPDU报文而阻塞的端口。 从用户流量角度来看，Backup端口作为指定端口的备份，提供了另外一条从根节点到叶节点的备份通路。</p>
<p><strong><u>新鲜的知识点啊</u></strong></p>
<p><strong>Master端口</strong>	1、 Master端口是MST域和总根相连的所有路径中最短路径上的端口，它是交换设备上连接MST域到总根的端口。 2、 Master端口是域中的报文去往总根的必经之路。 3、 Master端口是特殊域边缘端口，Master端口在CIST上的角色是Root Port，在其它各实例上的角色都是Master端口。（在多个实例中有一个最好的路径，那么这个实例这个端口叫根端口，在其他实例之中叫master端口）</p>
<p><strong>域边缘端口</strong>	<strong>域边缘端口是指位于MST域的边缘并连接其它MST域或SST的端口。</strong></p>
<p><strong>边缘端口</strong>	1、如果指定端口位于整个域的边缘，不再与任何交换设备连接，这种端口叫做边缘端口。2、 边缘端口一般与用户终端设备直接连接。 3、 端口使能MSTP功能后，会默认启用边缘端口自动探测功能，当端口在（2 × Hello Timer + 1）秒的时间内收不到BPDU报文，自动将端口设置为边缘端口，否则设置为非边缘端口。</p>
<p><strong><u>alternate端口是根端口的备份，backup是指定端口的备份</u></strong></p>
<p><strong><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240518203634565.png" alt="image-20240518203634565"></strong></p>
<h3 id="边缘端口"><a href="#边缘端口" class="headerlink" title="边缘端口"></a>边缘端口</h3><p>*stp edged-port设置为边缘端口后tcn报文根本发不出来</p>
<p>P（提议：我要成为指定端口）</p>
<p>先将非边缘端口down掉，再发送提议确定新的指定端口，再恢复其他端口（？）</p>
<h3 id="实验配置-1"><a href="#实验配置-1" class="headerlink" title="实验配置"></a>实验配置</h3><ol>
<li>stp region-configuration</li>
<li>region-name mstp（改名）</li>
<li>revision-level 1（版本）</li>
<li>instance 10 vlan 100（vlan 绑定实例）</li>
<li>instance 20 vlan 200</li>
<li>active regionconfiguration（激活配置</li>
</ol>
<h3 id="优先级（根桥）设置"><a href="#优先级（根桥）设置" class="headerlink" title="优先级（根桥）设置"></a>优先级（根桥）设置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231015230719333.png" alt="image-20231015230719333"></p>
<p>vlan 100通过sw1&#x2F;sw2-sw3-sw5<br>vlan 200通过sw1&#x2F;sw2-sw4-sw5</p>
<p>对比两条线路发现不同点就在sw3和sw4，所以它们分别就作为实例10的根桥和实例20的根桥</p>
<p>这样vlan100的数据只会由sw3转发</p>
<p>vlan100只会由sw4转发</p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p><strong>路由基于路由表进行数据转发</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014111246920.png" alt="image-20231014111246920"></p>
<p>问题：AR1没有PC2网段</p>
<h3 id="路由来源"><a href="#路由来源" class="headerlink" title="路由来源"></a>路由来源</h3><ol>
<li>静态路由(static)</li>
</ol>
<p>pc1连pc2</p>
<p>IP route-static <code>192.168.2.0 24</code>(目标)<code>12.1.1.2</code>(下一跳)</p>
<p>IP route-static <code>192.168.2.0 24</code>(目标)<code>23.1.1.3</code>(下一跳)</p>
<p>pc2连pc1（去的地址打了，回来的还没打）</p>
<p>IP route-static <code>192.168.1.0 24</code>(目标)<code>23.1.1.2</code>(下一跳)</p>
<p>IP route-static <code>192.168.1.0 24</code>(目标)<code>12.1.1.1</code>(下一跳)</p>
<p>本地出接口模式：下一跳可以写g0&#x2F;0&#x2F;0</p>
<p>（不是点到点网络不能用，最好别用）</p>
<p>下一跳的ip地址（你要把数据给谁就写谁的ip地址）</p>
<ol start="2">
<li><p>动态路由(具体协议名)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014113914426.png" alt="image-20231014113914426"></p>
</li>
<li><p>直连路由(Direct)</p>
</li>
</ol>
<p>每个交换机接口连接的网段是可以直接记录在路由表的</p>
<ul>
<li><p>配置完成后pc1和pc2可以互通，但这不代表pc1可以ping通AR3（本质上就是看设备中路由表有没有目的地址的路由，而并不是类似于水管管道处处通畅）</p>
</li>
<li><p>实际上路由表正确也可能出错:crying_cat_face:</p>
</li>
<li><p>静态路由可以根据优先级和NQA可以做浮动路由，很方便</p>
</li>
</ul>
<h3 id="现实抓包"><a href="#现实抓包" class="headerlink" title="现实抓包"></a>现实抓包</h3><p>debug命令—debugging IP icmp verbose（可以选择参数）</p>
<p><code>ACL可以优化debug体验</code></p>
<p>terminal debugging</p>
<h3 id="路由协议分类"><a href="#路由协议分类" class="headerlink" title="路由协议分类"></a>路由协议分类</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014114436399.png" alt="image-20231014114436399"></p>
<ol>
<li>道听途说，基于跳数</li>
<li>会将不同线路进行对比选择，线路已知，基于开销</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014114910705.png" alt="image-20231014114910705"></p>
<h3 id="路由表"><a href="#路由表" class="headerlink" title="路由表"></a>路由表</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014114929706.png" alt="image-20231014114929706"></p>
<p>不同协议之间对比优先级（开销参考不同），相同协议比较开销（地位同等才有对比的意义）</p>
<p><strong>优先级</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014115440271.png" alt="image-20231014115440271"></p>
<h3 id="等价路由：ECMP"><a href="#等价路由：ECMP" class="headerlink" title="等价路由：ECMP"></a>等价路由：ECMP</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014140630950.png" alt="image-20231014140630950"></p>
<p>开销相同的时候会有多个下一跳</p>
<h3 id="最长匹配原则"><a href="#最长匹配原则" class="headerlink" title="最长匹配原则"></a>最长匹配原则</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014140802739.png" alt="image-20231014140802739"></p>
<p>新的地址进入路由表，会优先与子网掩码大的网段先匹配</p>
<p>（0.0.0.0&#x2F;0为默认路由-指向外网，在路由表里面兜底）</p>
<h3 id="路由环路"><a href="#路由环路" class="headerlink" title="路由环路"></a>路由环路</h3><p>默认路由配置不当容易产生路由环路</p>
<h3 id="浮动路由"><a href="#浮动路由" class="headerlink" title="浮动路由"></a>浮动路由</h3><p>静态路由可以配置相同的目标网段但不同的下一跳，优先级设置不同即为浮动路由</p>
<h2 id="动态路由协议"><a href="#动态路由协议" class="headerlink" title="动态路由协议"></a>动态路由协议</h2><h3 id="协议概述"><a href="#协议概述" class="headerlink" title="协议概述"></a>协议概述</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014151533861.png" alt="image-20231014151533861"></p>
<h3 id="路由泛洪"><a href="#路由泛洪" class="headerlink" title="路由泛洪"></a>路由泛洪</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014151621676.png" alt="image-20231014151621676"></p>
<p>伟大的互联网分享精神：每个路由器会和自己的直连路由器分享自己的路由表，路由器将自己没有的路由添加（30s更新一次）</p>
<p>更新原则：</p>
<ol>
<li><p>覆盖：相同路径，选取跳数小的进行覆盖</p>
</li>
<li><p>删除：180s后没有更新认为为无效路由，进行删除—线路断掉，发送路由更新，跳数为16跳，16跳不可达，删除！</p>
</li>
</ol>
<h3 id="路由环路-1"><a href="#路由环路-1" class="headerlink" title="路由环路"></a>路由环路</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014152642148.png" alt="image-20231014152642148"></p>
<h4 id="解决环路方法–最大跳数16"><a href="#解决环路方法–最大跳数16" class="headerlink" title="解决环路方法–最大跳数16"></a>解决环路方法–最大跳数16</h4><p>180s才能删除，可是30s就更新一次，导致应该删除的路径跳数一直增加，一直存在</p>
<p>解决方法：跳数为16时即认为不可达，直接删除</p>
<h4 id="解决环路方法–水平分割"><a href="#解决环路方法–水平分割" class="headerlink" title="解决环路方法–水平分割"></a>解决环路方法–水平分割</h4><p>*我给你发的消息，你就不要再发给我了（燕子你不要走啊~）</p>
<h4 id="解决环路方法–路由抑制"><a href="#解决环路方法–路由抑制" class="headerlink" title="解决环路方法–路由抑制"></a>解决环路方法–路由抑制</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014154012852.png" alt="image-20231014154012852"></p>
<p>就是某一个路由器的路由down掉后会立刻向周边路由器“投毒”，发送带16跳的路由更新</p>
<h3 id="RIP"><a href="#RIP" class="headerlink" title="RIP"></a>RIP</h3><p><strong>RIPv1基本上用不上了</strong></p>
<h4 id="协议概述-1"><a href="#协议概述-1" class="headerlink" title="协议概述"></a>协议概述</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014154903388.png" alt="image-20231014154903388"></p>
<p>水平分割、毒性逆转、最大跳数和触发更新</p>
<h4 id="V1和V2区别"><a href="#V1和V2区别" class="headerlink" title="V1和V2区别"></a>V1和V2区别</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014155045614.png" alt="image-20231014155045614"></p>
<p>v2是主播地址：224.0.0.9</p>
<p>v1是广播地址：255.255.255.255</p>
<p>无类：ip地址不按A,B,C类地址进行设置，不超范围就随便打，抓包有掩码</p>
<p>有类：按主类地址进行设置，不用写掩码，抓包也没有掩码</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231014160108210.png" alt="image-20231014160108210"></p>
<p>建议：加上undo summary防止多个地址合并例如10.1.1.0变成10.0.0.0</p>
<p>*network不仅宣告了网段，还启动了接口的rip接收和发送功能，相反的，想要手动关闭功能就用silent-interface 接口&#x2F;all</p>
<h4 id="RIP接口密码登录模式"><a href="#RIP接口密码登录模式" class="headerlink" title="RIP接口密码登录模式"></a>RIP接口密码登录模式</h4><p>rip authentication-mode simple ciper 357159</p>
<p>rip authentication-mode md5 nonstandard ciper alex357159 <strong>1</strong></p>
<p>两边的key值要一样，认证不匹配路由表不存在</p>
<h1 id="数据通信4"><a href="#数据通信4" class="headerlink" title="数据通信4"></a>数据通信4</h1><p>[TOC]</p>
<h2 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/QQ%E5%9B%BE%E7%89%8720231024210659.png" alt="QQ图片20231024210659"></p>
<p>这里的DD报文打错了，其实是DBD报文</p>
<h2 id="OSPF路由协议基础"><a href="#OSPF路由协议基础" class="headerlink" title="OSPF路由协议基础"></a>OSPF路由协议基础</h2><p>dis ospf peer(full算建立完成)</p>
<p>dis ospf lsdb</p>
<p>ospf router-id xxxx</p>
<p>ospf的协议字段为89</p>
<p>是内部网关协议的一种，基于链路状态算法</p>
<h3 id="基本特点"><a href="#基本特点" class="headerlink" title="基本特点"></a>基本特点</h3><ol>
<li>CIDR（无类域间路由）是一种用于对互联网IP地址进行聚合和分配的技术。它通过改变IP地址的分配方式，有效地解决了IPv4地址空间不足的问题。</li>
<li>无路由自环</li>
<li>收敛速度快</li>
<li>使用IP组播收发协议数据224.0.0.5（村民）和 224.0.0.6（村长）（rip v1是224.0.0.9）</li>
<li>支持多条等值路由</li>
<li>协议报文认证(rip v2 的那种认证)</li>
</ol>
<h3 id="链路状态算法的路由计算过程"><a href="#链路状态算法的路由计算过程" class="headerlink" title="链路状态算法的路由计算过程"></a>链路状态算法的路由计算过程</h3><ol>
<li>建立邻接关系（物理和逻辑上很亲密），不等同邻居关系</li>
<li>泛洪LSA（类似于rip的泛洪），将收到的信息放进LSDB数据库里面</li>
<li>通过SPF算法计算最短路径树</li>
<li>计算路由并且存入IP路由表中</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021093340407.png" alt="image-20231021093340407"></p>
<h3 id="OSPF的基本概念"><a href="#OSPF的基本概念" class="headerlink" title="OSPF的基本概念"></a>OSPF的基本概念</h3><h4 id="自治系统AS"><a href="#自治系统AS" class="headerlink" title="自治系统AS"></a>自治系统AS</h4><p>在互联网中，一个或多个实体管辖下的所有IP网络和路由器的组合，它们对互联网执行共同的路由策略</p>
<h4 id="Router-ID"><a href="#Router-ID" class="headerlink" title="Router ID"></a>Router ID</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021094025564.png" alt="image-20231021094025564"></p>
<p>很多ospf的服务需要id，来源：</p>
<ol>
<li>手动分配 2.通过活动环回口接口的最大IP 3.通过物理环回口接口的最大IP</li>
</ol>
<p>（没有邻接关系随便改，否则要重启）</p>
<h4 id="划分区域"><a href="#划分区域" class="headerlink" title="划分区域"></a>划分区域</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021094712402.png" alt="image-20231021094712402"></p>
<p>area 0：骨干区域，有且只有一个，其他区域必须和骨干区域直连</p>
<h4 id="路由器分类"><a href="#路由器分类" class="headerlink" title="路由器分类"></a>路由器分类</h4><p>BR（略）: 所有接口都在area0</p>
<p>ABR（区域边界路由器）：一个在area0 其他的在其他区域</p>
<p>IR（略）：全部接口在其他区域</p>
<p>ASBR（自治系统边界路由器）：使用BGP连接另外一个AS</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021095718238.png" alt="image-20231021095718238"></p>
<h4 id="OSPF的五个报文"><a href="#OSPF的五个报文" class="headerlink" title="OSPF的五个报文"></a>OSPF的五个报文</h4><ol>
<li>Hello报文</li>
<li>DD报文</li>
<li>LSR报文</li>
<li>LSU报文</li>
<li>LSACK报文</li>
</ol>
<h4 id="OSPF的七个邻居状态"><a href="#OSPF的七个邻居状态" class="headerlink" title="OSPF的七个邻居状态"></a>OSPF的七个邻居状态</h4><ol>
<li>Down</li>
<li>Init</li>
<li>Two way</li>
<li>Exstart</li>
<li>Exchange</li>
<li>Loading </li>
<li>Full</li>
</ol>
<h3 id="实验基本配置"><a href="#实验基本配置" class="headerlink" title="实验基本配置"></a>实验基本配置</h3><ol>
<li>ospf 进程</li>
<li>area X进入区域配置</li>
<li>network宣告网段</li>
<li>（如果需要）设置stub区域或者nssa区域</li>
</ol>
<h2 id="进阶知识"><a href="#进阶知识" class="headerlink" title="进阶知识"></a>进阶知识</h2><h3 id="邻居和邻接"><a href="#邻居和邻接" class="headerlink" title="邻居和邻接"></a>邻居和邻接</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021104339150.png" alt="image-20231021104339150"></p>
<p>当线路中出现多余的信息转发，就需要DR（村长）和BDR（副村长）</p>
<p>224.0.0.5—其他路由器给DR发信息</p>
<p>224.0.0.6—DR给其他路由器发信息</p>
<h3 id="DR和BDR的选举过程"><a href="#DR和BDR的选举过程" class="headerlink" title="DR和BDR的选举过程"></a>DR和BDR的选举过程</h3><p>其他路由器只会和DR建立邻接关系</p>
<ol>
<li><p>一开始是先选举BDR，如果发现区域没有DR就成为DR</p>
</li>
<li><p>DR寄了之后BDR成为新的DR，然后再将id大的改为BDR</p>
</li>
</ol>
<h3 id="OSPF支持的网络类型"><a href="#OSPF支持的网络类型" class="headerlink" title="OSPF支持的网络类型"></a>OSPF支持的网络类型</h3><p>点对点通信，广播通信，多播，NBMA</p>
<p>（p2p和p2mp不进行DR和BDR的选举–两个人还选什么村长）</p>
<p>（广播和NBMA进行DR和BDR的选举）</p>
<p>那么我们怎么更改类型呢？</p>
<ol>
<li><p>进入接口</p>
</li>
<li><p>ospf network-type xxx</p>
</li>
</ol>
<p>两个接口不一致时只可以建立邻接关系，但是不能交换路由条目</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021110624606.png" alt="image-20231021110624606"></p>
<h3 id="邻居建立"><a href="#邻居建立" class="headerlink" title="邻居建立"></a>邻居建立</h3><h5 id="邻居状态"><a href="#邻居状态" class="headerlink" title="邻居状态"></a>邻居状态</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021110938049.png" alt="img"></p>
<ol>
<li>down</li>
<li>attempt（nbma里面会出现）</li>
<li>int：向外发送hello包（空包，没有地址，有自己的router-id），对方收到hello包再回复它的router-id，进入到2-way</li>
<li>2-way（选DR，BDR）：能进入2-way的条件是收到的hello中有自己的router-id</li>
<li>exstart(选master和servant)：2-way进start条件：1. 选完BDR（第一个BDR会立刻成为DR）2. 等待40s 3. 不选DR和BDR的链路跳过2-way进入exstart</li>
</ol>
<p>显示确认：ack发1回2，发2回3</p>
<p>隐式确认：发送序列号为1，回复的数据包也得是1</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021113134250.png" alt="image-20231021113134250"></p>
<p>DBD：类似书本的目录，进行master的选举，servant的序列号改为master的序列号</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021113545862.png" alt="image-20231021113545862"></p>
<ol start="6">
<li><p>exchange交换DBD包（有内容）</p>
</li>
<li><p>loading：我给你发request，你给我回update</p>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021115239349.png" alt="image-20231021115239349"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021115431457.png" alt="image-20231021115431457"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021115633017.png" alt="image-20231021115633017"></p>
<h5 id="邻居关系建立"><a href="#邻居关系建立" class="headerlink" title="邻居关系建立"></a>邻居关系建立</h5><ol>
<li><strong>router-id不能相同</strong></li>
<li>区域必须相同</li>
<li>认证类型必须相同，密码也要相同         </li>
<li>直连接口掩码必须相同</li>
<li>hello包，死亡时间必须设置一样</li>
<li><strong>直连路由器接口不能同时设置接口优先级为0</strong></li>
<li>相同区域的路由器的LSDB必须保持一致（几类LSA相同）</li>
<li>两端mtu的值应该设置成一样</li>
</ol>
<h3 id="LSA（6种常见）"><a href="#LSA（6种常见）" class="headerlink" title="LSA（6种常见）"></a>LSA（6种常见）</h3><p>不是一种报文类型，全部放在LS update报文中</p>
<h4 id="Router-LSA（1）"><a href="#Router-LSA（1）" class="headerlink" title="Router-LSA（1）"></a>Router-LSA（1）</h4><p>Router-LSA是一种最基本的LSA，即Type1 LSA。</p>
<p>OSPF网络里的每一台路由设备都会发布Type1 LSA。这种类型的LSA用于描述设备的链路状态和开销，在路由器所属的区域内传播。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210607095914282.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210607095914474.png" alt="img"></p>
<h4 id="Network-LSA（2）"><a href="#Network-LSA（2）" class="headerlink" title="Network-LSA（2）"></a>Network-LSA（2）</h4><p>Network-LSA，也就是Type2 LSA，由DR（Designated Router）产生，描述本网段的链路状态，在所属的区域内传播。如图所示，R3向R2发送一条Network-LSA，列出了所有与DR形成完全邻接关系的路由器的Router ID。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210607095914337.png" alt="img"></p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210607095914470.png" alt="img"></p>
<h4 id="Network-summary-LSA（3）"><a href="#Network-summary-LSA（3）" class="headerlink" title="Network-summary-LSA（3）"></a>Network-summary-LSA（3）</h4><p>Network-summary-LSA，也叫Type3 LSA，由ABR发布，用来描述区域间的路由信息。ABR将Network-summary-LSA发布到一个区域，通告该区域到其他区域的目的地址。实际上，ABR是将区域内部的Type1和Type2的信息收集起来并汇总之后扩散出去，这就是Summary的含义。如图所示，R2作为ABR，将Area 0和Area 1中的路由信息分别发布对方区域。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210607095914376.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210607095914471.png" alt="img"></p>
<h4 id="ASBR-Summary-LSA（4）"><a href="#ASBR-Summary-LSA（4）" class="headerlink" title="ASBR-Summary-LSA（4）"></a>ASBR-Summary-LSA（4）</h4><p>ASBR-summary-LSA，也叫Type4 LSA，由ABR发布，描述到ASBR的路由信息，并通告给除ASBR所在区域的其他相关区域。如图所示，R3作为ABR通告ASBR-summary-LSA到Area 0中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210607095914344.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210607095914463.png" alt="img"></p>
<h4 id="AS-external-LSA（5）"><a href="#AS-external-LSA（5）" class="headerlink" title="AS-external-LSA（5）"></a>AS-external-LSA（5）</h4><p>AS-external-LSA，也叫Type5 LSA，由ASBR产生，描述到AS外部的路由，通告到除Stub区域和NSSA区域以外所有的区域。如图所示，R4作为ASBR发布了一条OSPF AS到外部目的网络的路由信息。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210607095914338.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210607095914473.png" alt="img"></p>
<h4 id="NSSA-LSA（7）"><a href="#NSSA-LSA（7）" class="headerlink" title="NSSA LSA（7）"></a>NSSA LSA（7）</h4><p>除了上述几种LSA之外，还有一种比较特殊的LSA，NSSA LSA，也叫Type7 LSA。NSSA LSA由ASBR产生，描述到AS外部的路由，仅在NSSA区域内传播。NSSA区域的ABR收到NSSA LSA时，会有选择地将其转化为Type5 LSA，以便将外部路由信息通告到OSPF网络的其它区域。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/102d5942944f48edb1452a0f99fec6e3.png" alt="在这里插入图片描述"></p>
<h2 id="实验配置-2"><a href="#实验配置-2" class="headerlink" title="实验配置"></a>实验配置</h2><h3 id="虚连接的配置"><a href="#虚连接的配置" class="headerlink" title="虚连接的配置"></a>虚连接的配置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231021154333804.png" alt="image-20231021154333804"></p>
<p>区域2没有和区域0相连，区域0和1就无法获取到区域2的路由信息，需要配置虚拟连接以获得area2的路由信息</p>
<p>area2要经过area1和area0连接，所以在area1中设置</p>
<p>在AR2中指向Ar3（v-link peer #router-id）</p>
<p>AR3中指向AR2（v-link peer #router-id）</p>
<p>vlink和回环路由？？？</p>
<h3 id="OSPF特殊区域"><a href="#OSPF特殊区域" class="headerlink" title="OSPF特殊区域"></a>OSPF特殊区域</h3><p>末梢路由就是只与一个路由器连接</p>
<p>stub：不接受4类，5类，7类LSA</p>
<p>totally stub：不接受3，4，5，7类LSA</p>
<p>NSSA（Not-So-Stubby Area）：不接受4，5 LSA类</p>
<p><strong>与nssa区域连接的abr在收到七类的lsa会转成5类</strong></p>
<p>totally NSSA 区域：不接受3，4，5</p>
<h4 id="实验配置-3"><a href="#实验配置-3" class="headerlink" title="实验配置"></a>实验配置</h4><h5 id="stub"><a href="#stub" class="headerlink" title="stub"></a>stub</h5><p>就在区域的两台路由器里面打个stub就好了</p>
<p>进入区域，输入stub</p>
<h5 id="nssa"><a href="#nssa" class="headerlink" title="nssa"></a>nssa</h5><p>就在区域的两台路由器里面打个nssa就好了</p>
<p>进入区域，输入nssa</p>
<h3 id="ospf下放默认路由"><a href="#ospf下放默认路由" class="headerlink" title="ospf下放默认路由"></a>ospf下放默认路由</h3><h4 id="手动配置"><a href="#手动配置" class="headerlink" title="手动配置"></a>手动配置</h4><p>在路由器的ospf进程下下放默认路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ospf</span><br><span class="line">default-route-advertise</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20200224093436860.png" alt="在这里插入图片描述"></p>
<h4 id="特殊区域配置"><a href="#特殊区域配置" class="headerlink" title="特殊区域配置"></a>特殊区域配置</h4><p>基于上面的特殊区域的后stub和nssa会自动下发默认路由（注意协议优先级，若已经有了优先级更高的协议产生的默认路由则不会显示）</p>
<p>stub路由表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231024221242320.png" alt="image-20231024221242320"></p>
<p>NSSA路由表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20200224133021628.png" alt="在这里插入图片描述"></p>
<h3 id="ospf认证"><a href="#ospf认证" class="headerlink" title="ospf认证"></a>ospf认证</h3><h4 id="区域认证："><a href="#区域认证：" class="headerlink" title="区域认证："></a>区域认证：</h4><ol>
<li>simple认证：authentication-mode simple plain huawei1</li>
<li>md5认证：authentication-mode md5 1 huawei3</li>
<li>key chain 认证：authentication-mode md5 1 huawei3 key 1</li>
</ol>
<p>进入区域进行相关的配置</p>
<p>区域内设置必须完全一致</p>
<h4 id="链路认证："><a href="#链路认证：" class="headerlink" title="链路认证："></a>链路认证：</h4><ol>
<li>simple认证（同上）</li>
<li>md5认证（同上）</li>
<li>key chain 认证（同上）</li>
</ol>
<p>进入接口进行相关的配置</p>
<p>接口内的设置必须完全一致</p>
<h3 id="ospf路由聚合（？）"><a href="#ospf路由聚合（？）" class="headerlink" title="ospf路由聚合（？）"></a>ospf路由聚合（？）</h3><p>看不懂喵，等待教学：</p>
<h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><ol>
<li><p>与Rip不同，OSPF不支持自动路由聚合，仅支持手动路由聚合。</p>
</li>
<li><p>OSPF聚合路由分为区域间路由聚合和外部路由聚合<br>1）区域间路由聚合必须配置在ABR路由器上，指的是ABR在把与自己直接相连区域中的Type-1和Type-2LSA转换成Type-3LSA时，对生成的Type-3LSA进行聚合。<br>2）外部路由聚合必须配置在ASBR路由器上，值得时ASBR对Type-5LSA进行聚合</p>
</li>
<li><p>区域间路由聚合是ABR对自己直接相连区域内的路由进行聚合，从而减少传播至与自己直接相连的其他区域的Type-3LSA的数量。<br>强调：区域间路由只能聚合由Type-1LSA或Type-2LSA产生的路由；如果路由是由外部或其他区域传到本区域的，则这样的ABR路由不进行聚合。</p>
</li>
<li><p>外部路由聚合是指在ASBR路由器上针对引入OSPF网络的外部路由进行聚合，目的是减少在OSPF网络中的Type-5LSA的数量。外部路由聚合必须在外部路由进入OSPF网络的ASBR上进行；外部路由进入OSPF网络后，在ABR上是无法对相应的Type-5LSA进行聚合的。</p>
</li>
<li><p>对于NSSA区域，当该区域的ABR将Type-7LSA转换为Type-5LSA时，该ABR也可以充当ASBR的角色，并对Type－５LSA进行聚合。</p>
</li>
<li><p>注意：当NSSA区域存在多台ABR时，必须由Router－ID最大的ABR进行Type－７LSA到Type－５LSA转换的操作。NSSA区域的外部路由聚合有两种方式，一种是在NSSA区域的ASBR上直接对外部路由进行聚合，另一种是在NSSA区域中Router－ID最大的，负责将Type－７LSA转成Type－５LSA的ABR进行聚合。</p>
</li>
</ol>
<p>注：<br>外部路由聚合，如本区域有多个ABR，必须在router-id最大的ABR上完成<br>需先添加vlan和配置每个路由器的接口IP，以及路由协议，没给代码，要自己完成<br>交换机端口还要配access模式，不要忘记<br>OSPF路由区域间路由聚合（可在本区域ABR上完成）<br>外部路由聚合（可在ASBR上完成，也可在本区域ABR上完成）</p>
<h4 id="命令配置"><a href="#命令配置" class="headerlink" title="命令配置"></a>命令配置</h4><h5 id="区域内部聚合"><a href="#区域内部聚合" class="headerlink" title="区域内部聚合"></a>区域内部聚合</h5><p>进入到要配置的设备中的ospf进程&gt;&gt;&gt;area X，输入命令abr-summary 20.0.0.0 255.255.252.0</p>
<h5 id="外部链路聚合"><a href="#外部链路聚合" class="headerlink" title="外部链路聚合"></a>外部链路聚合</h5><p>进入到要配置的设备中的ospf进程，输入命令：abr-summary 20.0.0.0 255.255.252.0</p>
<h3 id="ospf多进程"><a href="#ospf多进程" class="headerlink" title="ospf多进程"></a>ospf多进程</h3><p>不同的进程号就是不同的进程，一台设备可以在不同的进程下，但是一个接口只能在一个接口下</p>
<h2 id="ACL：第一代防火墙"><a href="#ACL：第一代防火墙" class="headerlink" title="ACL：第一代防火墙"></a>ACL：第一代防火墙</h2><h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h3><h4 id="基本ACL：（根据）源IP地址（过滤）"><a href="#基本ACL：（根据）源IP地址（过滤）" class="headerlink" title="基本ACL：（根据）源IP地址（过滤）"></a>基本ACL：（根据）源IP地址（过滤）</h4><h4 id="高级ACL：整个网段、某个IP、协议"><a href="#高级ACL：整个网段、某个IP、协议" class="headerlink" title="高级ACL：整个网段、某个IP、协议"></a>高级ACL：整个网段、某个IP、协议</h4><h4 id="二层ACL：mac地址、802-1q、二层协议类型"><a href="#二层ACL：mac地址、802-1q、二层协议类型" class="headerlink" title="二层ACL：mac地址、802.1q、二层协议类型"></a>二层ACL：mac地址、802.1q、二层协议类型</h4><h4 id="用户自定义ACL-？"><a href="#用户自定义ACL-？" class="headerlink" title="用户自定义ACL:？"></a>用户自定义ACL:？</h4><h4 id="用户ACL-？"><a href="#用户ACL-？" class="headerlink" title="用户ACL:？"></a>用户ACL:？</h4><h3 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h3><ol>
<li>标识</li>
<li>规则{1. 编号-从小到大 2. 动作：permit&#x2F;deny 3. 匹配项}</li>
</ol>
<h3 id="匹配机制"><a href="#匹配机制" class="headerlink" title="匹配机制"></a>匹配机制</h3><ol>
<li>检查是否开启了ACL服务（是，进行下一步）</li>
<li>检查是否设置了规则（是，进行下一步）</li>
<li>检查设置规则的编号，从小到大检索</li>
<li>检查规则是否执行（permit&#x2F;deny）</li>
<li>规则如果是permit，执行后停止匹配，继续检索下一个规则</li>
</ol>
<h2 id="ospf故障排查"><a href="#ospf故障排查" class="headerlink" title="ospf故障排查"></a>ospf故障排查</h2><ol>
<li><p>首先查看接口ip是否配置</p>
</li>
<li><p>我看每台交换机都有配置一个换回接口，除了telnet登录使用，还有什么作用？（<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29864185/article/details/106902375?ops_request_misc=%7B%22request_id%22:%22169824703616800226547436%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=169824703616800226547436&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-106902375-null-null.142%5Ev96%5Epc_search_result_base7&utm_term=%E8%B7%AF%E7%94%B1%E5%99%A8%E7%8E%AF%E5%9B%9E%E6%8E%A5%E5%8F%A3&spm=1018.2226.3001.4187">路由器环回接口(loopback)详解-CSDN博客</a>）</p>
</li>
<li><p>查看路由表里有没有其他的协议已经配置导致ospf邻居建立失败</p>
</li>
<li><p>ospf区域宣告直连网段就是将路由器所在的接口的网段进行宣告（环回接口要接到哪个区域呢？还是不用接？）</p>
</li>
<li><p>正常stub区域设置，注意stub区域不能使用telnet</p>
</li>
<li><p>vlink虚链路建立注意点：1. 除了router-id和优先级设置不同其他配置都要一样（hello包配置一样）2. vlink指向的是router-id而不是ip地址，注意不要配错！！！</p>
</li>
<li><p>抓包抓的是ip地址！！！被这个坑惨了</p>
</li>
</ol>
<h1 id="数据通信5"><a href="#数据通信5" class="headerlink" title="数据通信5"></a>数据通信5</h1><p>[TOC]</p>
<h2 id="访问控制列表实现包过滤（acl）"><a href="#访问控制列表实现包过滤（acl）" class="headerlink" title="访问控制列表实现包过滤（acl）"></a>访问控制列表实现包过滤（acl）</h2><p>两大作用：过滤and分类</p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>实现数据包识别功能</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028090829419.png" alt="image-20231028090829419"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028091148097.png" alt="image-20231028091148097"></p>
<h3 id="ACL包过滤技术"><a href="#ACL包过滤技术" class="headerlink" title="ACL包过滤技术"></a>ACL包过滤技术</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028091529526.png" alt="image-20231028091529526"></p>
<p>ACL如果想过滤，肯定要在数据流必经之路：接口上配置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028091809721.png" alt="image-20231028091809721"></p>
<h3 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h3><p><em>规则：找谁     动作：做啥</em></p>
<p><em>越详细的规则越优先</em></p>
<p><em>所有规则都没匹配，匹配默认规则：都可以通过</em></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028091921207.png" alt="image-20231028091921207"></p>
<p>（默认规则最好也自己配）</p>
<h3 id="通配符掩码"><a href="#通配符掩码" class="headerlink" title="*通配符掩码"></a>*通配符掩码</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028093023191.png" alt="image-20231028093023191"></p>
<p>0表示匹配，1代表忽略</p>
<p>192.168.1.0-127</p>
<p>192.168.1.0</p>
<p>0.0.0.127</p>
<p>——————</p>
<p>192.168.1.10000000</p>
<p>192.168.1.128</p>
<p>0.0.0.127</p>
<p>——————</p>
<p>10.1.1.0&#x2F;24（匹配奇数）</p>
<p>10.1.1.255</p>
<p>0.0.0.254</p>
<p>——————</p>
<p>10.1.1.0&#x2F;24（匹配偶数）</p>
<p>10.1.1.254</p>
<p>0.0.0.254</p>
<h3 id="ACL的标识"><a href="#ACL的标识" class="headerlink" title="ACL的标识"></a>ACL的标识</h3><ol>
<li>利用数字序号标识访问控制列表</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028100933079.png" alt="image-20231028100933079"></p>
<p>2000和3000可以选择的参数不同，3000的是高级acl，可以使用的参数更多，更高级（源ip目标ip，源端口目标端口，协议）</p>
<p>2000看作一个进程，里面会有多条规则</p>
<ol start="2">
<li>命名型ACL：通过名称代替编号来标识ACL</li>
</ol>
<h3 id="ACL的分类（按规则定义方式）"><a href="#ACL的分类（按规则定义方式）" class="headerlink" title="ACL的分类（按规则定义方式）"></a>ACL的分类（按规则定义方式）</h3><table>
<thead>
<tr>
<th>分类</th>
<th>适用的IP版本</th>
<th>规则定义描述</th>
<th>编号范围</th>
</tr>
</thead>
<tbody><tr>
<td>基本ACL</td>
<td>IPv4</td>
<td>仅使用报文的<strong>源IP地址</strong>、分片信息和生效时间段信息来定义规则。</td>
<td>2000～2999</td>
</tr>
<tr>
<td>高级ACL</td>
<td>IPv4</td>
<td>既可使用IPv4报文的<strong>源IP地址</strong>，也可使用<strong>目的IP地址</strong>、IP协议类型、ICMP类型、TCP源&#x2F;目的端口、UDP源&#x2F;目的端口号、生效时间段等来定义规则。</td>
<td>3000～3999</td>
</tr>
<tr>
<td>二层ACL</td>
<td>IPv4&amp;IPv6</td>
<td>使用报文的<strong>以太网帧头信息</strong>来定义规则，如根据源MAC（Media Access Control）地址、目的MAC地址、二层协议类型等。</td>
<td>4000～4999</td>
</tr>
<tr>
<td>用户自定义ACL</td>
<td>IPv4&amp;IPv6</td>
<td>使用<strong>报文头、偏移位置、字符串掩码和用户自定义字符串</strong>来定义规则，即以报文头为基准，指定从报文的第几个字节开始与字符串掩码进行“与”操作，并将提取出的字符串与用户自定义的字符串进行比较，从而过滤出相匹配的报文。</td>
<td>5000～5999</td>
</tr>
<tr>
<td>用户ACL</td>
<td>IPv4</td>
<td>既可使用IPv4报文的<strong>源IP地址</strong>，也可使用<strong>目的IP地址</strong>、IP协议类型、ICMP类型、TCP源端口&#x2F;目的端口、UDP源端口&#x2F;目的端口号等来定义规则。</td>
<td>6000～6031</td>
</tr>
<tr>
<td>基本ACL6</td>
<td>IPv6</td>
<td>可使用IPv6报文的<strong>源IPv6地址</strong>、分片信息和生效时间段来定义规则。</td>
<td>2000～2999</td>
</tr>
<tr>
<td>高级ACL6</td>
<td>IPv6</td>
<td>可以使用IPv6报文的<strong>源IPv6地址</strong>、<strong>目的IPv6地址</strong>、IPv6协议类型、ICMPv6类型、TCP源&#x2F;目的端口、UDP源&#x2F;目的端口号、生效时间段等来定义规则。</td>
<td>3000～3999</td>
</tr>
</tbody></table>
<h3 id="应用方面"><a href="#应用方面" class="headerlink" title="应用方面"></a>应用方面</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028223212084.png" alt="image-20231028223212084"></p>
<h3 id="生效时间（儿童锁）"><a href="#生效时间（儿童锁）" class="headerlink" title="生效时间（儿童锁）"></a>生效时间（儿童锁）</h3><p>配置要求：某公司要求，在上班时间只允许员工浏览与工作相关的几个网站，下班或周末时间才可以访问其他互联网网站；再如，在每天20:00～22:00的网络流量的高峰期，为防止P2P、下载类业务占用大量带宽对其他数据业务的正常使用造成影响，需要对P2P、下载类业务的带宽进行限制。</p>
<p>解决方法：基于时间的ACL过滤</p>
<h4 id="第一种模式——周期时间段"><a href="#第一种模式——周期时间段" class="headerlink" title="第一种模式——周期时间段"></a>第一种模式——周期时间段</h4><p>以星期为参数来定义时间范围，表示规则以一周为周期（如每周一的8至12点）循环生效。</p>
<p>格式：<strong>time-range</strong> <em>time-name</em> <em>start-time</em> <strong>to</strong> <em>end-time</em> { <em>days</em> } &amp;&lt;1-7&gt;</p>
<p>栗子： time-range test 8:00 to 18:00 working-day  </p>
<ul>
<li><p><em>time-name</em>：时间段名称，以英文字母开头的字符串。</p>
</li>
<li><p><em>start-time</em> <strong>to</strong> <em>end-time</em>：开始时间和结束时间。格式为[小时:分钟] to [小时:分钟]。</p>
</li>
<li><p>days</p>
<p>：有多种表达方式。</p>
<ul>
<li><strong>Mon</strong>、<strong>Tue</strong>、<strong>Wed</strong>、<strong>Thu</strong>、<strong>Fri</strong>、<strong>Sat</strong>、<strong>Sun</strong>中的一个或者几个的组合，也可以用数字表达，0表示星期日，1表示星期一，……6表示星期六。</li>
<li><strong>working-day</strong>：从星期一到星期五，五天。</li>
<li><strong>daily</strong>：包括一周七天。</li>
<li><strong>off-day</strong>：包括星期六和星期日，两天。</li>
</ul>
</li>
</ul>
<h4 id="第二种模式——绝对时间段"><a href="#第二种模式——绝对时间段" class="headerlink" title="第二种模式——绝对时间段"></a>第二种模式——绝对时间段</h4><p>从某年某月某日的某一时间开始，到某年某月某日的某一时间结束，表示规则在这段时间范围内生效。</p>
<p>栗子：time-range test from 00:00 2014&#x2F;01&#x2F;01 to 23:59 2014&#x2F;12&#x2F;31  </p>
<ul>
<li><em>time-name</em>：时间段名称，以英文字母开头的字符串。</li>
<li><em>time1</em>&#x2F;<em>time2</em>：格式为[小时:分钟]。</li>
<li><em>date1</em>&#x2F;<em>date2</em>：格式为[YYYY&#x2F;MM&#x2F;DD]，表示年&#x2F;月&#x2F;日。</li>
</ul>
<h3 id="实验配置-4"><a href="#实验配置-4" class="headerlink" title="实验配置"></a>实验配置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028225103053.png" alt="image-20231028225103053"></p>
<p>任务一：pc1不能和pc2进行通信，使用的是基本acl，但是pc1可以和别pc通信，就是在ar1上进行acl设置拒绝pc1的地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.在ar1上创建acl2000</span><br><span class="line">2.写规则：</span><br><span class="line">acl number 2000  </span><br><span class="line">rule 5 deny source 10.1.2.254 0 </span><br><span class="line">rule 10 permit</span><br><span class="line">3.进入端口绑定acl2000：</span><br><span class="line">traffic-filter outbound acl 2000</span><br><span class="line">ospf enable 1 area 0.0.0.1</span><br><span class="line">//需要分析是接入还是流出，本体在g0/0/0的出接口使得pc2不能进入pc1但是可以进如192，168.1.0网段</span><br></pre></td></tr></table></figure>

<p>任务二：仅允许10.1.2.0&#x2F;24中Clent1通过http访问server1</p>
<p>分析可得涉及协议要使用高级acl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  acl 3000</span><br><span class="line">  rule permit tcp source 10.1.2.250 0 destination 192.168.1.250 0 destination-po</span><br><span class="line">rt eq 80</span><br><span class="line">  rule deny tcp source any destination 		192.168.1.250 0 destination-port eq 80</span><br><span class="line">    int g0/0/0</span><br><span class="line">      traffic-filter outbound acl 3000</span><br></pre></td></tr></table></figure>

<p>这里in或者out没影响</p>
<p>结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028110827168.png" alt="image-20231028110827168"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028110841641.png" alt="image-20231028110841641"></p>
<h4 id="普通acl（2000-2999）"><a href="#普通acl（2000-2999）" class="headerlink" title="普通acl（2000-2999）"></a>普通acl（2000-2999）</h4><p>栗子</p>
<p><strong>rule permit&#x2F;deny source 10.1.1.250 0.0.0.0</strong> </p>
<p>没有目的地址，没有协议</p>
<h4 id="高级acl（3000-3999）"><a href="#高级acl（3000-3999）" class="headerlink" title="高级acl（3000-3999）"></a>高级acl（3000-3999）</h4><p><strong>rule permit&#x2F;deny tcp source 10.1.2.250 0 destination 192.168.1.250 0 destination-port eq 80</strong></p>
<p>有目的地址，有协议</p>
<p><strong>高级acl尽量靠近源，普通acl尽量靠近目标</strong></p>
<h2 id="NAT组网"><a href="#NAT组网" class="headerlink" title="NAT组网"></a>NAT组网</h2><h3 id="Basic-NAT"><a href="#Basic-NAT" class="headerlink" title="Basic NAT"></a>Basic NAT</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028142148039.png" alt="image-20231028142148039"></p>
<p> Basic NAT只转化IP，不映射端口。</p>
<h3 id="NAPT"><a href="#NAPT" class="headerlink" title="NAPT"></a>NAPT</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028150554383.png" alt="image-20231028150554383"></p>
<p><strong>NAPT除了转化IP，还做端口映射</strong>，可以用于多个内部地址映射到少量（甚至一个）外部地址。</p>
<p><strong>解决basic nat抢地址的问题</strong></p>
<h4 id="端口NAT："><a href="#端口NAT：" class="headerlink" title="端口NAT："></a>端口NAT：</h4><p>[R2]acl 2000</p>
<p>[R2-acl-basic-2000]rule  permit  </p>
<p>[R2]inter g0&#x2F;0&#x2F;0 </p>
<p>[R2-GigabitEthernet0&#x2F;0&#x2F;0]nat outbound 2000 </p>
<h4 id="端口映射（转发）："><a href="#端口映射（转发）：" class="headerlink" title="端口映射（转发）："></a>端口映射（转发）：</h4><p>[R1-GigabitEthernet0&#x2F;0&#x2F;2]nat server protocol tcp global  current-interface 8003 inside 10.1.3.250 80（访问0&#x2F;0&#x2F;2的ip地址的8083端口会转发到10.1.3.250的80端口） 、</p>
<h4 id="Easy-IP"><a href="#Easy-IP" class="headerlink" title="Easy IP"></a>Easy IP</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028153204765.png" alt="image-20231028153204765"></p>
<p>用于拨号上网中</p>
<h3 id="动态NAT"><a href="#动态NAT" class="headerlink" title="动态NAT"></a>动态NAT</h3><p><strong>在外部网络中定义了一个或多个合法地址，采用动态分配的方法映射到内部网络。</strong></p>
<p>栗子：<br>步骤一：使用分类那些主机进行NAT转换<br>[R1]acl 2000<br>[R1-acl-basic-2000]rule deny source 10.1.1.0 0.0.0.255<br>[R1-acl-basic-2000]rule  permit source any<br>[R1-acl-basic-2000]quit<br>步骤二：定义公网地址池范围<br>[R1]nat address-group 0 192.168.1.66 192.168.1.67<br>步骤三：出接口上配置NAT<br>[R1-GigabitEthernet0&#x2F;0&#x2F;2]nat outbound 2000 address-group 0</p>
<h4 id="静态NAT"><a href="#静态NAT" class="headerlink" title="静态NAT"></a>静态NAT</h4><p>将内部网络中的每个主机都永久映射成外部网络中的某个合法的地址，多用于服务器(需要单独的一个公网地址)</p>
<p>栗子:</p>
<p>[R1-GigabitEthernet0&#x2F;0&#x2F;2]nat static global 192.168.1.68 inside 10.1.1.254 </p>
<h2 id="PPP协议"><a href="#PPP协议" class="headerlink" title="PPP协议"></a>PPP协议</h2><h3 id="帧格式"><a href="#帧格式" class="headerlink" title="帧格式"></a>帧格式</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028235310480.png" alt="image-20231028235310480"></p>
<h3 id="链路建立过程"><a href="#链路建立过程" class="headerlink" title="链路建立过程"></a>链路建立过程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028235531692.png" alt="image-20231028235531692"></p>
<p>在Link Dead阶段，PPP链路进行初始化，当物理层接口联通后，状态自动进入到Link Establishment阶段。</p>
<p>进入到Link Establishment阶段，通信双方互相发送LCP报文，进行参数协商，如果参数协商失败，则会回退到Link Dead阶段。如果参数协商成功，并且双方需要认证，则进入到authentication阶段，如果不需要认证，则会直接进入到Network Layer Protocol阶段。</p>
<p>在Authentication阶段，通信双方会进行认证。<br>在Network Layer Protocol阶段，双方会再次进行协商，这次协商主要协商网络层参数，比如发送自己的IP地址、子网掩码等信息，看是否存在IP地址冲突或者不属于一个网段等情况。如果参数协商一致，那么此时就可以进行正常的数据包传送了。</p>
<p>在Link Termination阶段，代表PPP链接终止，除了Link Dead阶段之外，任何协商过程失败都会进入这一阶段，而如果处于Network Layer Protocol阶段，管理员手动关闭了链路，也会进入这一状态。</p>
<h3 id="协议组成"><a href="#协议组成" class="headerlink" title="协议组成"></a>协议组成</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028162827573.png" alt="image-20231028162827573"></p>
<h3 id="PPP地址协商"><a href="#PPP地址协商" class="headerlink" title="PPP地址协商"></a>PPP地址协商</h3><p>服务器：</p>
<ol>
<li><p>创建地址池<br>ip pool aa<br>gateway-list 12.1.1.2<br>network 12.1.1.0 mask 255.255.255.0</p>
</li>
<li><p>指定给对端分配的ip地址池<br>remote address pool aa</p>
</li>
</ol>
<p>客户端：</p>
<ol>
<li>interface Serial4&#x2F;0&#x2F;0<br>link-protocol ppp</li>
<li>#通过PPP协商机制自动获取ip地址<br>ip address ppp-negotiate</li>
</ol>
<h3 id="PAP验证"><a href="#PAP验证" class="headerlink" title="PAP验证"></a>PAP验证</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231028163138673.png" alt="image-20231028163138673"></p>
<p><strong>明文，被验证方先发</strong></p>
<h4 id="认证方"><a href="#认证方" class="headerlink" title="认证方"></a>认证方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial4/0/0]ppp authentication-mode pap                 开启pap认证</span><br><span class="line">aaa                                                             进入aaa认证</span><br><span class="line">local-user 用户 password cipher 密码                             配置用户账号和密码</span><br><span class="line">local-user 用户 service-type ppp                                服务用于ppp验证</span><br></pre></td></tr></table></figure>



<h4 id="被认证方"><a href="#被认证方" class="headerlink" title="被认证方"></a>被认证方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial4/0/0]link-protocol ppp</span><br><span class="line"></span><br><span class="line">ppp pap local-user 用户 password cipher 密码</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="CHAP验证"><a href="#CHAP验证" class="headerlink" title="CHAP验证"></a>CHAP验证</h3><p><strong>密文，验证方先发</strong></p>
<h4 id="认证方-1"><a href="#认证方-1" class="headerlink" title="认证方"></a>认证方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface Serial4/0/0                               进入接口</span><br><span class="line">ppp authentication-mode chap                        开启chap认证</span><br><span class="line">local-user admin password cipher 密码                配置账户密码   </span><br><span class="line">local-user admin service-type ppp                   将账户密码用于ppp服务</span><br></pre></td></tr></table></figure>





<h4 id="被认证方-1"><a href="#被认证方-1" class="headerlink" title="被认证方"></a>被认证方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface Serial4/0/0                    进入接口</span><br><span class="line">ppp chap user admin                      认证用户</span><br><span class="line">ppp chap password cipher 密码            认证密码</span><br></pre></td></tr></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231029004351286.png" alt="image-20231029004351286"></p>
<h2 id="预习"><a href="#预习" class="headerlink" title="预习"></a>预习</h2><p>预习：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/K7Q2N0XHXY~U3UY[1IJ6[DG.jpg" alt="img"></p>
<h3 id="地址前缀列表"><a href="#地址前缀列表" class="headerlink" title="地址前缀列表"></a>地址前缀列表</h3><h4 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h4><p>  地址前缀列表是一种包含一组路由信息过滤规则的过滤器，用户可以在规则中定义前缀和掩码范围，用于匹配路由。</p>
<h4 id="匹配依据"><a href="#匹配依据" class="headerlink" title="匹配依据"></a>匹配依据</h4><p>   地址前缀列表进行匹配的依据有两个：掩码长度和掩码范围。</p>
<p>掩码长度：地址前缀列表匹配的对象是<strong>IP地址前缀</strong>，前缀由IP地址和掩码长度共同定义。<u>例如，10.1.1.1&#x2F;16这条路由，掩码长度是16，这个地址的有效前缀为16位，即10.1.0.0。</u></p>
<p>掩码范围（？）：对于前缀相同，掩码不同的路由，可以指定待匹配的前缀掩码长度范围来实现精确匹配或者在一定掩码长度范围内匹配。10.1.128.1&#x2F;24和10.1.128.1&#x2F;25<br>匹配顺序</p>
<h4 id="顺序匹配"><a href="#顺序匹配" class="headerlink" title="顺序匹配"></a>顺序匹配</h4><p>按索引号从小到大顺序进行匹配。<br>唯一匹配：待过滤路由只要与一个表项匹配，就不会再去尝试匹配其他表项。<br>默认拒绝：默认所有未与任何一个表项匹配的路由都视为未通过地址前缀列表的过滤。因此在一个地址前缀列表中创建了一个或多个deny模式的表项后，需要创建一个表项来允许所有其他路由通过。（和acl很像啊）</p>
<h4 id="和acl的区别"><a href="#和acl的区别" class="headerlink" title="和acl的区别"></a>和acl的区别</h4><p>栗子：</p>
<p>匹配以下地址</p>
<p>192.168.200.0&#x2F;30<br> 192.168.200.4&#x2F;30<br> 192.168.206.96&#x2F;30<br>192.168.206.100&#x2F;30<br>192.168.206.108&#x2F;30<br>192.168.206.112&#x2F;30</p>
<p>acl：rule 5 permit source 192.168.0.0 0.0.255.255（全通）</p>
<p>ip-prefix：ip ip-prefix test0721 index 10 permit 192.168.0.0 16（不通过）</p>
<p>修改为： ip ip-prefix test0721 permit 192.168.0.0 16 greater-equal 30 less-equal 32 后和acl等价</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231029140436824.png" alt="image-20231029140436824"></p>
<h3 id="路由策略（？）"><a href="#路由策略（？）" class="headerlink" title="路由策略（？）"></a>路由策略（？）</h3><h4 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h4><p>路由策略（Routing Policy）的作用是当路由器在发布、接收和引入路由信息时，可根据实际组网需要实施一些策略，以便对路由信息进行过滤或改变路由信息的属性</p>
<h4 id="应用方式"><a href="#应用方式" class="headerlink" title="应用方式"></a>应用方式</h4><ol>
<li>可利用Filter-Policy工具对RTA向OSPF引入的路由和RTC写入路由表的路由进行过滤</li>
<li>可利用Route-Policy工具，在RTA引入直连路由时对路由进行过滤</li>
</ol>
<h3 id="策略路由（？）"><a href="#策略路由（？）" class="headerlink" title="策略路由（？）"></a>策略路由（？）</h3><p>传统的路由策略没有负载分担，策略路由有负载分担，提高带宽使用率，策略路由PBR分为三种：</p>
<ol>
<li>本地策略路由</li>
<li>智能策略路由</li>
<li>接口策略路由</li>
</ol>
<p><strong>和路由策略的区别</strong></p>
<table>
<thead>
<tr>
<th>路由策略</th>
<th>策略路由</th>
</tr>
</thead>
<tbody><tr>
<td>基于控制平面，会影响路由表表项</td>
<td>基于转发平面，不会影响路由表表项，且设备收到报文，就会查找策略路由进行匹配转发，如匹配失败，则再由路由表进行转发</td>
</tr>
<tr>
<td>只能基于目的地址进行策略制定</td>
<td>可基于源地址、目的地址、协议类型、报文大小等进行制定</td>
</tr>
<tr>
<td>与路由协议相结合使用</td>
<td>需手工逐跳配置，以保证报文按照策略进行转发</td>
</tr>
<tr>
<td>常用工具：Route-Policy、Filter-Policy等</td>
<td>常用工具：Traffic-Fliter、Traffic-Policy、Policy-Based-Route等</td>
</tr>
</tbody></table>
<h3 id="路由引入（？）"><a href="#路由引入（？）" class="headerlink" title="路由引入（？）"></a>路由引入（？）</h3><p>看不懂史密达</p>
<h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>由于不同路由协议之间的<strong>路由算法、机制、开销等不同</strong>，不同的路由协议之间无法直接分享彼此的路由；此时就需要通过路由引入技术将某个路由协议的路由引入到另一个路由协议中也可以相同路由协议之间引入</p>
<h4 id="方式"><a href="#方式" class="headerlink" title="方式"></a>方式</h4><ol>
<li>单点双向</li>
<li>单点单向</li>
<li>多点双向路由# 数据通信6</li>
</ol>
<p>[TOC]</p>
<p>需要地址前缀匹配的原因是acl不能对子网掩码进行过滤，无能为力</p>
<p>IP ip-prefix ben deny 23.1.1.0&#x2F;24（不打就代表24）</p>
<h2 id="路由选择工具"><a href="#路由选择工具" class="headerlink" title="路由选择工具"></a>路由选择工具</h2><h3 id="使用ACL过滤路由"><a href="#使用ACL过滤路由" class="headerlink" title="使用ACL过滤路由"></a>使用ACL过滤路由</h3><p>先进行路由分类，再用filter-policy过滤</p>
<ol>
<li>配置相关地址</li>
<li>rip配置</li>
<li>acl进行配置（2000）</li>
<li>使用filter-policy 2000 import(入方向)&#x2F;export（出方向）</li>
</ol>
<p><strong>acl默认拒绝，针对的是数据包，不能对网络号相同但是子网掩码不同进行过滤</strong></p>
<p>栗子：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231109164129372.png" alt="image-20231109164129372"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">AR1</span><br><span class="line"><span class="comment">//ip地址的配置</span></span><br><span class="line">   <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">    ip ad <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">   <span class="type">int</span> loop <span class="number">0</span><span class="comment">//配置环回口地址</span></span><br><span class="line">    ip ad <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.128</span></span><br><span class="line">       <span class="type">int</span> loop <span class="number">1</span><span class="comment">//配置环回口地址</span></span><br><span class="line">    ip ad <span class="number">192.168</span><span class="number">.1</span><span class="number">.129</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.192</span></span><br><span class="line">       <span class="type">int</span> loop <span class="number">2</span><span class="comment">//配置环回口地址</span></span><br><span class="line">    ip ad <span class="number">192.168</span><span class="number">.1</span><span class="number">.220</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.240</span></span><br><span class="line">    <span class="comment">//宣告网段</span></span><br><span class="line">    rip相关配置省略</span><br><span class="line">  </span><br><span class="line">    </span><br><span class="line">AR2</span><br><span class="line">    <span class="comment">//配置端口ip地址</span></span><br><span class="line">    <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">    ip ad <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">    <span class="comment">//配置acl的分类</span></span><br><span class="line">    acl num <span class="number">2000</span></span><br><span class="line">    rule deny source <span class="number">192</span>，<span class="number">168.1</span><span class="number">.128</span> <span class="number">0</span></span><br><span class="line">    rule <span class="number">10</span> permit（默认是禁止所以要允许全部）</span><br><span class="line">    <span class="comment">//rip配置：宣告网段，开启rip，调用acl</span></span><br><span class="line">    rip <span class="number">1</span></span><br><span class="line">    ver <span class="number">2</span></span><br><span class="line">    network <span class="number">12.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    filter-policy <span class="number">2000</span> import（路由引入时进行路由过滤）</span><br></pre></td></tr></table></figure>



<h3 id="前缀过滤路由"><a href="#前缀过滤路由" class="headerlink" title="前缀过滤路由"></a>前缀过滤路由</h3><h4 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h4><p>  地址前缀列表是一种包含一组路由信息过滤规则的过滤器，用户可以在规则中定义前缀和掩码范围，用于匹配路由。</p>
<h4 id="匹配依据-1"><a href="#匹配依据-1" class="headerlink" title="匹配依据"></a>匹配依据</h4><p>   地址前缀列表进行匹配的依据有两个：掩码长度和掩码范围。</p>
<p>掩码长度：地址前缀列表匹配的对象是<strong>IP地址前缀</strong>，前缀由IP地址和掩码长度共同定义。<u>例如，10.1.1.1&#x2F;16这条路由，掩码长度是16，这个地址的有效前缀为16位，即10.1.0.0。</u></p>
<p>掩码范围（？）：对于前缀相同，掩码不同的路由，可以指定待匹配的前缀掩码长度范围来实现精确匹配或者在一定掩码长度范围内匹配。（greater-equal 30 less-equal 32 —–30到32的长度）</p>
<h4 id="顺序匹配-1"><a href="#顺序匹配-1" class="headerlink" title="顺序匹配"></a>顺序匹配</h4><p>按索引号从小到大顺序进行匹配。<br>唯一匹配：待过滤路由只要与一个表项匹配，就不会再去尝试匹配其他表项。<br>默认拒绝：默认所有未与任何一个表项匹配的路由都视为未通过地址前缀列表的过滤。因此在一个地址前缀列表中创建了一个或多个deny模式的表项后，需要创建一个表项来允许所有其他路由通过。（和acl很像啊）</p>
<h3 id="基于BGP的部分工具"><a href="#基于BGP的部分工具" class="headerlink" title="基于BGP的部分工具"></a>基于BGP的部分工具</h3><p>自治系统路径信息访问列表（ as-path-filter）</p>
<ul>
<li>仅用于BGP协议，匹配BGP路由信息的自治系统路径域</li>
</ul>
<p>团体属性列表（ community-filter）</p>
<ul>
<li>仅用于BGP协议，匹配BGP路由信息的自治系统团体域</li>
</ul>
<h2 id="路由策略"><a href="#路由策略" class="headerlink" title="路由策略"></a>路由策略</h2><h3 id="路由引入"><a href="#路由引入" class="headerlink" title="路由引入"></a>路由引入</h3><h4 id="rip-x2F-ospf引入"><a href="#rip-x2F-ospf引入" class="headerlink" title="rip&#x2F;ospf引入"></a>rip&#x2F;ospf引入</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231109180514586.png" alt="image-20231109180514586"></p>
<p>配置相关基本rip和ospf区域地址</p>
<p>rip引入：在ABR——R1上配置import-route rip1</p>
<p>ospf引入：在ABR——R1上配置import-route ospf 1 cost 3</p>
<h3 id="路由过滤"><a href="#路由过滤" class="headerlink" title="路由过滤"></a>路由过滤</h3><h4 id="acl过滤路由"><a href="#acl过滤路由" class="headerlink" title="acl过滤路由"></a>acl过滤路由</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231109180912799.png" alt="image-20231109180912799"></p>
<p>要求：在R3配置rip路由过滤，将4.4.4.4路由过滤掉</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">acl num <span class="number">1145</span></span><br><span class="line">rule <span class="number">5</span> deny source <span class="number">4.4</span><span class="number">.4</span><span class="number">.4</span> <span class="number">0</span> </span><br><span class="line">rule <span class="number">10</span> permit </span><br><span class="line">rip <span class="number">1</span></span><br><span class="line"><span class="built_in">filter</span>-policy <span class="number">2000</span> <span class="keyword">import</span></span><br></pre></td></tr></table></figure>

<h4 id="IP前缀列表过滤"><a href="#IP前缀列表过滤" class="headerlink" title="IP前缀列表过滤"></a>IP前缀列表过滤</h4><p>要求：过滤R3的192.168.1.0&#x2F;24 的路由条目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip-prefix alex deny 192.168.1.0 24 greater-equal 25 less-equal 25</span><br><span class="line">ip-prefix alex permit</span><br><span class="line">rip </span><br><span class="line">filter-policy ip-prefix alex import </span><br></pre></td></tr></table></figure>



<h4 id="使用OSPF过滤路由"><a href="#使用OSPF过滤路由" class="headerlink" title="使用OSPF过滤路由"></a>使用OSPF过滤路由</h4><p><strong>只能在in方向</strong>，<strong>永远不要在ospf的出方向做过滤</strong></p>
<p>**路由表中虽然没有路由但是过滤器的数据库里面还存在，但是rip是直接删除</p>
<p>要求：在R4上过滤3.3.3.0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//基本属性配置</span><br><span class="line">ospf 1</span><br><span class="line">import-route rip 1</span><br><span class="line">int loop 0 </span><br><span class="line">ip ad 3.3.3.3 24 </span><br><span class="line">network 3.0.0.0</span><br><span class="line">//实验配置</span><br><span class="line">ip-prefix alex deny 3.3.3.0 24 </span><br><span class="line">ip-prefix alex permit</span><br><span class="line">ospf</span><br><span class="line">filter-policy ip-prefix alex import </span><br></pre></td></tr></table></figure>



<h4 id="路由引入时过滤路由"><a href="#路由引入时过滤路由" class="headerlink" title="路由引入时过滤路由"></a>路由引入时过滤路由</h4><ul>
<li><p>路由引入的作用是让不同路由协议域之间进行路由共享</p>
</li>
<li><p>路由引入时记得带一个开销值，不同设备默认值不同（参考带宽&#x2F;接口带宽—往上取整）</p>
</li>
<li><p>输入display IP ip-routing table  xxxx verbose以查看某条路由的详细信息</p>
</li>
<li><p>type（1）开销可以改变|type（2）开销一直不变（cost &#x3D;100M&#x2F;接口带宽）</p>
</li>
</ul>
<p>要求：rip在引入ospf域的路由时不将3.3.3.0引入</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ip-prefix alex deny <span class="number">3.3</span><span class="number">.3</span><span class="number">.0</span> <span class="number">24</span> </span><br><span class="line">ip-prefix alex permit</span><br><span class="line">route-policy cw permit node <span class="number">10</span> </span><br><span class="line"><span class="keyword">if</span>-match ip-prefix alex</span><br><span class="line">ospf </span><br><span class="line">import-route rip <span class="comment">//route-policy cw</span></span><br></pre></td></tr></table></figure>











<h2 id="路由引入导致次优路径"><a href="#路由引入导致次优路径" class="headerlink" title="路由引入导致次优路径"></a>路由引入导致次优路径</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231104140346637.png" alt="image-20231104140346637"></p>
<p>问题：数据包会从100的rip和15的isisi中选择15的isis的路进行转发而绕远路耗费更多的资源</p>
<p><strong>改协议的优先级&#x2F;接口的优先级只能解决一时的问题，而不能完美解决次优路径</strong></p>
<p>对此我们需要对某一个具体的路由进行优先级配置：</p>
<ol>
<li>基于前缀列表匹配地址后在优先级设置中使用route-policy（先前缀列表设置ip ip-prefix test0721 permit 192.168.0.0 16 greater-equal 30 less-equal 32</li>
<li>再设置route-policy</li>
<li>再if-match test0721</li>
<li>再apply preference 160</li>
</ol>
<h2 id="防止路由环路"><a href="#防止路由环路" class="headerlink" title="防止路由环路"></a>防止路由环路</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231104163234350.png" alt="image-20231104163234350"></p>
<p>问题：我发的数据包到头又还给了我自己（老师把知识给我我再还回去:smile:）</p>
<p>解决方法：</p>
<p>将数据打上标签（类似vlan）</p>
<p>在ABR1上禁止标签10，再打上20的标签（rip-ospf方向）</p>
<p>在ABR2上禁止标签20，再打上10的标签（ospf-rip方向）</p>
<p>这样相当于一个rip域上只有20标签的数据，ospf上只有10的标签的数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">r1</span><br><span class="line">route-policy r1 deny node <span class="number">10</span> </span><br><span class="line"><span class="keyword">if</span>-match tag <span class="number">10</span></span><br><span class="line">route-policy r1 deny node <span class="number">20</span> </span><br><span class="line">apply tag <span class="number">20</span></span><br><span class="line">rip</span><br><span class="line">import-route ospf <span class="number">1</span> route-policy r1</span><br><span class="line"></span><br><span class="line">r2</span><br><span class="line">route-policy r2 deny node <span class="number">10</span> </span><br><span class="line"><span class="keyword">if</span>-match tag <span class="number">20</span></span><br><span class="line">route-policy r1 deny node <span class="number">20</span> </span><br><span class="line">apply tag <span class="number">10</span></span><br><span class="line">rip</span><br><span class="line">import-route ospf <span class="number">1</span> route-policy r2</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="策略路由"><a href="#策略路由" class="headerlink" title="策略路由"></a>策略路由</h2><h3 id="定义-4"><a href="#定义-4" class="headerlink" title="定义"></a>定义</h3><p><em><strong>*策略路由简称PBR（Policy-Based Routing），是针对某种数据包，直接制定的选路策略*</strong></em></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20210209104917756.png" alt="在这里插入图片描述"></p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231109184146269.png" alt="image-20231109184146269"></p>
<h1 id="数据通信7"><a href="#数据通信7" class="headerlink" title="数据通信7"></a>数据通信7</h1><p>[TOC]</p>
<h2 id="策略路由-1"><a href="#策略路由-1" class="headerlink" title="策略路由"></a>策略路由</h2><h2 id="策略路由的作用"><a href="#策略路由的作用" class="headerlink" title="策略路由的作用"></a>策略路由的作用</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231116224550728.png" alt="image-20231116224550728"></p>
<h2 id="策略路由和路由策略的区别"><a href="#策略路由和路由策略的区别" class="headerlink" title="策略路由和路由策略的区别"></a>策略路由和路由策略的区别</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231116224731322.png" alt="image-20231116224731322"></p>
<p>路由策略基于控制平面，策略路由基于转发平面</p>
<h2 id="接口策略路由"><a href="#接口策略路由" class="headerlink" title="接口策略路由"></a>接口策略路由</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p><em><strong>*策略路由简称PBR是针对某种数据包，直接制定的选路策略。*</strong></em></p>
<p><em><strong>*策略路由的做法是，首先用ACL来定义一种特别的数据包（比如源地址为张三的包），然后再针对这个ACL定义的包，配置一个选路策略（走线路1）*</strong></em></p>
<h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一步：定义感兴趣流，也就是策略路由要针对什么样的数据包做动作 如：用acl 3000来定义1.0访问3.0的数据包。</span></span><br><span class="line"></span><br><span class="line">acl <span class="number">3000</span></span><br><span class="line"></span><br><span class="line">rule <span class="number">5</span> permit ip source <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> dest <span class="number">10.1</span><span class="number">.3</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第二步：定义流分类，流分类是关联ACL的。如：用名字为huawei-control1的流分类，来关联acl 3000</span></span><br><span class="line"></span><br><span class="line">traffic classifier huawei-control1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>-match acl <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第三步：定义流行为，流行为是配置选路规则的，如：用名字为huuawei-control1的流行为，做一个选路策略，选路的规则，是下一跳12.1.1.2</span></span><br><span class="line"></span><br><span class="line">traffic behavior huawei-control1</span><br><span class="line"></span><br><span class="line">redirect ip-nexthop <span class="number">12.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第四步：定义流策略，流策略是将前面配好的流分类和流行为进行关联</span></span><br><span class="line"></span><br><span class="line">traffic policy huawei-control1</span><br><span class="line"></span><br><span class="line">classifier huawei-control1 behavior huawei-control1</span><br><span class="line"></span><br><span class="line"><span class="comment">//第五步：在路由器的入接口调用流策略</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">traffic-policy huawei-control1 inbound</span><br></pre></td></tr></table></figure>



<h2 id="IPV6"><a href="#IPV6" class="headerlink" title="IPV6"></a>IPV6</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112140802526.png" alt="image-20231112140802526"></p>
<h3 id="IPV6协议概述"><a href="#IPV6协议概述" class="headerlink" title="IPV6协议概述"></a>IPV6协议概述</h3><h3 id="IPV6和IPV4"><a href="#IPV6和IPV4" class="headerlink" title="IPV6和IPV4"></a>IPV6和IPV4</h3><p>v4的局限：</p>
<ol>
<li>地址空间不足且分配不均匀</li>
<li>达瓦</li>
</ol>
<p>v6的优势</p>
<ol>
<li><p>128位非常多</p>
</li>
<li><p>层次化的路由设计</p>
</li>
<li><p>效率高，扩展灵活</p>
</li>
<li><p>即插即用</p>
</li>
<li><p>更安全</p>
</li>
<li><p>引入了流标签的概念</p>
<p>IPv6地址没有了ARP（NDP（Neighbor Discovery Protocol）是ICMPv6的子协议，由于在IPv6中没有ARP协议，所以在IPv6上层定义了NDP协议实现ARP的地址解析，冲突地址检测等功能以及IPV6的邻居发现功能。）</p>
</li>
</ol>
<h3 id="IPv6地址分类"><a href="#IPv6地址分类" class="headerlink" title="IPv6地址分类"></a>IPv6地址分类</h3><h3 id="IPv6地址结构"><a href="#IPv6地址结构" class="headerlink" title="IPv6地址结构"></a>IPv6地址结构</h3><p>一个IPv6地址可以分为如下两部分：</p>
<ul>
<li>网络前缀：n比特，相当于IPv4地址中的网络ID</li>
<li>接口标识：128-n比特，相当于IPv4地址中的主机ID</li>
</ul>
<h3 id="IPv6单播地址"><a href="#IPv6单播地址" class="headerlink" title="IPv6单播地址"></a>IPv6单播地址</h3><h4 id="链路本地地址（fe80-x2F-10—-1111111010）"><a href="#链路本地地址（fe80-x2F-10—-1111111010）" class="headerlink" title="链路本地地址（fe80::&#x2F;10—-1111111010）"></a>链路本地地址（fe80::&#x2F;10—-1111111010）</h4><p>不用自己配，爽</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112145905666.png" alt="image-20231112145905666"></p>
<p>*mac地址是48位</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112150224922.png" alt="image-20231112150224922"></p>
<h4 id="唯一本地地址"><a href="#唯一本地地址" class="headerlink" title="唯一本地地址"></a>唯一本地地址</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112150516615.png" alt="image-20231112150516615"></p>
<h4 id="全球单播地址"><a href="#全球单播地址" class="headerlink" title="全球单播地址"></a>全球单播地址</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112150732596.png" alt="image-20231112150732596"></p>
<h3 id="IPv6任播地址"><a href="#IPv6任播地址" class="headerlink" title="IPv6任播地址"></a><strong>IPv6任播地址</strong></h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112152811488.png" alt="image-20231112152811488"></p>
<p>仁波就是特殊的单播，谁近找谁</p>
<h3 id="IPv6组播地址"><a href="#IPv6组播地址" class="headerlink" title="IPv6组播地址"></a>IPv6组播地址</h3><p>ipv6没有广播地址，广播就是组播的一个特列</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112152422360.png" alt="image-20231112152422360"></p>
<p>特殊地址：0：0：0：0：0：0：0：1环回地址</p>
<p>（在v4中127.后面的都是环回地址）</p>
<h3 id="IPV6的数据包封装"><a href="#IPV6的数据包封装" class="headerlink" title="IPV6的数据包封装"></a>IPV6的数据包封装</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112142041712.png" alt="image-20231112142041712"></p>
<p>《下头》</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112143106292.png" alt="image-20231112143106292"></p>
<p>可以用这个next header 无线拓展报文长度</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112143345884.png" alt="image-20231112143345884"></p>
<h3 id="IPv6地址的表示方式"><a href="#IPv6地址的表示方式" class="headerlink" title="IPv6地址的表示方式"></a>IPv6地址的表示方式</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112143432386.png" alt="image-20231112143432386"></p>
<ol>
<li><p>用16进制表示，4位为一个hexo数，我们叫冒号16进制</p>
</li>
<li><p>简化表达：<strong>两个冒号之间开头的0可以省略</strong>，全0写个0<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112143747666.png" alt="image-20231112143747666"></p>
</li>
<li><p>连续的0可以用::代替（双冒号只能出现一次）</p>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112144235631.png" alt="image-20231112144235631"></p>
<ol start="4">
<li>网络位和主机位（&#x2F;x确认网络号）</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112144615747.png" alt="image-20231112144615747"></p>
<h3 id="IPv6地址的配置"><a href="#IPv6地址的配置" class="headerlink" title="IPv6地址的配置"></a>IPv6地址的配置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112144633454.png" alt="image-20231112144633454"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231112144652990.png" alt="image-20231112144652990"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">R1 ipv6 </span><br><span class="line">R1 <span class="built_in">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">ipv6 en//关键</span><br><span class="line">ipv6 add <span class="number">2001</span>::<span class="number">1</span>/<span class="number">64</span></span><br><span class="line">//ping ipv6 地址</span><br></pre></td></tr></table></figure>





<h3 id="IPv6的静态路由引入"><a href="#IPv6的静态路由引入" class="headerlink" title="IPv6的静态路由引入"></a>IPv6的静态路由引入</h3><p>和IPv4很像，把IP改为IPv6就行了</p>
<p>ipv6 route-static XXXXX</p>
<p>栗子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ipv6 route <span class="number">2001</span>:ab1:<span class="number">0</span>:<span class="number">3</span>::/<span class="number">64</span> <span class="number">2001</span>:ab1:<span class="number">0</span>:<span class="number">2</span>::<span class="number">1</span></span><br><span class="line">ipv6 route <span class="number">2001</span>:ab1:<span class="number">0</span>:<span class="number">4</span>::/<span class="number">64</span> <span class="number">2001</span>:ab1:<span class="number">0</span>:<span class="number">2</span>::<span class="number">1</span></span><br><span class="line"><span class="comment">//IPv6的静态路由配置与IPv4类似。</span></span><br><span class="line"><span class="comment">//具体解释是：到达2001:ab1:0:3::/64的网络，其下一跳为2001:ab1:0:2::1</span></span><br></pre></td></tr></table></figure>



<h3 id="IPv6的OSPFv3"><a href="#IPv6的OSPFv3" class="headerlink" title="IPv6的OSPFv3"></a>IPv6的OSPFv3</h3><ul>
<li>新增两种LSA<ul>
<li>Link LSA：用于路由器宣告各个链路上对应的链路本地地址及其所配置的IPv6全局地址，仅在链路内洪泛。</li>
<li>Intra Area Prefix LSA：用于向其他路由器宣告本路由器或本网络（广播网及NBMA）的IPv6全局地址信息，在区域内洪泛。</li>
</ul>
</li>
</ul>
<p>栗子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[R1]ospfv3 <span class="number">2</span></span><br><span class="line">[R1-ospfv3<span class="number">-2</span>]router-id <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span><span class="comment">//但是建立连接的时候router-id还是ipv4的，所以我们建立不了邻居关系，要自己输入id（要在ospfv3里面输入id）</span></span><br><span class="line">[R1-ospfv3<span class="number">-2</span>]quit</span><br><span class="line"></span><br><span class="line">**[R1]interface GigabitEthernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span>**<span class="comment">//太方便了，连地址都不用宣告了，它直接将接口接入到了区域里</span></span><br><span class="line">[R1-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]ospfv3 <span class="number">2</span> area <span class="number">0</span></span><br><span class="line">[R1-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]quit</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h3 id="IPv6的rip"><a href="#IPv6的rip" class="headerlink" title="IPv6的rip"></a>IPv6的rip</h3><p>原理概述<br>RIPng (RIP next generation，下一代RIP协议）<strong>是IPv4中 RIPv2协议在IPv6网络上的扩展。</strong></p>
<p>UDP端口号:使<strong>用UDP的521端口</strong>(RIP使用520端口)发送和接收路由信息;组播地址:使<strong>用FF02::9作</strong>为链路本地范围内的RIPng路由器组播地址;</p>
<p>目的地址和下一跳地址:<strong>使用128 bit的IPv6地址，并使用前缀长度来代替子网掩码</strong>。</p>
<p>RIPng 协议路由算法和RIPv2一样，同样支持水平分割、毒性逆转和触发更新功能，用来防止环路。<strong>默认情况下，启用水平分割功能和触发更新，不启用毒性逆转功能。</strong></p>
<p>也很简单，就在接口下ripng+进程号+enable</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int g0/0/0</span><br><span class="line">ripng 1 enable</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>预习：</p>
<ol>
<li><p>BGP</p>
<p>动态路由协议可以按照工作范围分为IGP以及EGP。</p>
<p>IGP工作在同一个AS内，主要用来发现和计算路由，为AS内提供路由信息的交换；</p>
<p>而EGP工作在AS与AS之间，在AS间提供无环路的路由信息交换，BGP则是EGP的一种。</p>
<p>BGP是一种增强的路径矢量路由协议，同时BGP是拥有丰富的策略控制技术的外部网关协议。多运行于AS与AS之间。</p>
</li>
<li><p>IS-IS</p>
</li>
</ol>
<p>IS-IS和OSPF有很多相同和不同的地方</p>
<p>IS-IS有些术语和OSPF有所不同<br>1.一台路由器就是一个中间系统（Intermediate System，IS）<br>2.一台主机就是一个端系统（End System，ES）<br>因此，主机和路由器之间的通信的协议被称为ES-IS协议<br>被路由器用来进行彼此通告路由的协议称为IS-IS协议</p>
<h1 id="数据通信8"><a href="#数据通信8" class="headerlink" title="数据通信8"></a>数据通信8</h1><p>[TOC]</p>
<h2 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h2><p><strong>介绍</strong></p>
<ul>
<li><p>bgp的前身叫egp</p>
</li>
<li><p><strong>自治系统内部ibgp</strong>，外部ebgp</p>
</li>
<li><p>可以将一个自治系统看成运营商，运营商的内部用什么协议无所谓，之间必须用bgp统一沟通方法</p>
</li>
</ul>
<p><strong>ibgp和ebgp对比</strong></p>
<ul>
<li>ibgp作用于区域内部，engp作用于区域之间</li>
<li>使用的bgp的属性不同</li>
<li>避免环路的措施不同：i—不转发学习到的路由前缀  e—as_path里有自己就会丢弃，as短越优先</li>
</ul>
<h2 id="bgp特征"><a href="#bgp特征" class="headerlink" title="bgp特征"></a>bgp特征</h2><p><strong>是一种增强的距离矢量路由协议</strong></p>
<p><strong>特点</strong></p>
<ul>
<li><p>设计避免了路由环路</p>
</li>
<li><p>路由附加信息多</p>
</li>
<li><p>路由过滤和路由策略多</p>
</li>
<li><p>可靠的路由更新机制</p>
</li>
<li><p><strong>丰富的Metric度量方法</strong></p>
</li>
<li><p>从设计上避免了环路的发生</p>
</li>
<li><p>支持CIDR（无类别域间选路）</p>
</li>
<li><p>每一个设备只能有一个as</p>
</li>
</ul>
<h2 id="BGP五条5报文"><a href="#BGP五条5报文" class="headerlink" title="BGP五条5报文"></a>BGP五条5报文</h2><ul>
<li><p>open：建立邻居关系（打开心扉）</p>
</li>
<li><p>KeepAlive：字面意思，维持邻居关系</p>
</li>
<li><p>Update：更新路由的报文</p>
</li>
<li><p>Notification：翻译为注意，相当于一个告警,当你配错了会指出你的问题</p>
</li>
<li><p>route-refresh:用于在改变<strong>路由策略</strong>后请求对等体重新发送路由信息（请求更新）</p>
</li>
</ul>
<h2 id="BGP的状态机"><a href="#BGP的状态机" class="headerlink" title="BGP的状态机"></a>BGP的状态机</h2><p>connect：tcp的连接（三次握手）</p>
<p>open-sent：tcp连接成功后发送open报文</p>
<p>open-confirm：准备接收对方报文（keep alive？notici？）</p>
<p>active：connet的tcp连接失败进入active不断尝试tcp建立</p>
<p>established：建立完成后的状态</p>
<p>idle：出现错误之后的状态</p>
<p><strong>可能的active原因（待补充）</strong></p>
<ul>
<li>过滤了本设备IP流量或者TCP流量或者TCP-179端口数据</li>
<li>本BGP设备配置错误的对等体地址</li>
</ul>
<h2 id="工作过程"><a href="#工作过程" class="headerlink" title="工作过程"></a>工作过程</h2><h3 id="连接过程"><a href="#连接过程" class="headerlink" title="连接过程"></a>连接过程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231121233214701.png" alt="image-20231121233214701"></p>
<ol>
<li>先进入到connect进行tcp三次握手tcp连接（失败后进入alive不断进行tcp连接，成功后发送open-sent ）</li>
<li>之后发送open报文</li>
<li>进入到openconfirm 后等待对方发送报文（接收到keep alive 进入established ，收到noticification进入到idle）</li>
<li>之后在established之间发update报文更新新加入路由，发keep alive维持邻居关系（ospf 是hello）</li>
<li><strong>idle是bgp的初始状态，任何状态出错都会回到idle</strong></li>
</ol>
<h3 id="可靠路由更新"><a href="#可靠路由更新" class="headerlink" title="可靠路由更新"></a>可靠路由更新</h3><p><strong>BGP也会利用IGP</strong></p>
<ul>
<li><p>协议：tcp 端口：179</p>
</li>
<li><p>无周期（路由）更新</p>
</li>
<li><p>更新增加的路由</p>
</li>
<li><p>周期发keepalive报文检测tcp连通</p>
</li>
</ul>
<h2 id="实验配置-5"><a href="#实验配置-5" class="headerlink" title="实验配置"></a>实验配置</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231118111336011.png" alt="image-20231118111336011"></p>
<ol>
<li><p>先宣告as：bgp 1（as 1）</p>
</li>
<li><p>宣告相连as：peer xxxx（目的地址）asnumber xxxx（双向奔赴）</p>
</li>
<li><p>如果要使用环回口进行bgp连接不能直接加目的地址，还要加上自己的发送环回口：（1）peer  4.4.4.4 asnumer 16（2）<strong>peer 4.4.4.4 connect-interface loop 0</strong>（注意：bgp建立邻居关系不能使用默认路由 ）</p>
</li>
<li><p><strong>nexthop</strong>：ibgp得到的路由信息只是简单的copy，但是中间的路由器下一跳路由表里面没有，增加一个下一跳行为（<strong>方式一</strong>：添加静态路由  <strong>方式二</strong>：<strong>next-hop-local</strong>—–[R2-bgp]peer 4.4.4.4 next-hop-local ）(?)</p>
</li>
<li><p>ebgp的一个特性是ttl值默认为1，那么在两个路由器之间跳数大于1时tcp就连接不了（双向修改ttl—peer 6.6.6.6 ebgp-max-hop 255）</p>
</li>
<li><p><strong>路由黑洞</strong>：中间的路由器缺少路由丢包  </p>
<pre><code> 解决方法：
</code></pre>
</li>
</ol>
<ul>
<li><p>直接写一个静态路由（缺点有些路由器空间可能不够）</p>
</li>
<li><p>配置MPLS，用MPLS的标签交换数据包（?）</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[R2]route recursive-lookup tunnel </span><br><span class="line">[R2]mpls lsr-id <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line">[R2]mpls </span><br><span class="line">[R2]mpls ldp </span><br><span class="line">[R2]inter g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[R2-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]mpls </span><br><span class="line">[R2-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]mpls ldp </span><br><span class="line"></span><br><span class="line">[R2]display  mpls lsp #查看标签转发规则</span><br><span class="line"></span><br><span class="line">[R3]route recursive-lookup tunnel </span><br><span class="line">[R3]mpls lsr-id <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> </span><br><span class="line">[R3]mpls 	</span><br><span class="line">[R3]mpls ldp </span><br><span class="line">[R3]inter g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[R3-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]mpls</span><br><span class="line">[R3-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]mpls ldp </span><br><span class="line">[R3]inter g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[R3-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]mpls </span><br><span class="line">[R3-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]mpls ldp</span><br><span class="line"></span><br><span class="line">[R4]route recursive-lookup tunnel </span><br><span class="line">[R4]mpls lsr-id <span class="number">4.4</span><span class="number">.4</span><span class="number">.4</span></span><br><span class="line">[R4]mpls </span><br><span class="line">[R4]mpls ldp </span><br><span class="line">[R4]inter g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[R4-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]mpls </span><br><span class="line">[R4-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]mpls ldp </span><br></pre></td></tr></table></figure>

<p>解释：在进入到mpls区域里面之前不打标签（r2的0接口），进入到mpls之后启动mpls ldp的接口会为数据打上标签，按照标签表进行转发（可以打dis mpls lsp 查看标签表），出mpls的出接口不做配置，会自己将标签解除。</p>
<ul>
<li>使用路由联盟和路由反射</li>
<li>bgp同步</li>
<li>路由引入</li>
<li></li>
</ul>
<ol start="7">
<li><p><strong>bgp认证</strong>：bgp 1 然后peer 4.4.4.4 password cipher 123456</p>
</li>
<li><p><strong>bgp中使用路由策略</strong>：1.acl 2000 2.rule x deny&#x2F;permit 3.peer 4.4.4.4 as-num 16 filter-policy 2000 export&#x2F;import</p>
</li>
<li><p><strong>路由聚合</strong>：</p>
</li>
</ol>
<p>方式1(自动)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. bgp 1</span><br><span class="line">2. import-route direct</span><br><span class="line">3. summary automatic（只能聚合路由引入的路由）</span><br></pre></td></tr></table></figure>

<p>方式2（静态）：</p>
<p>太暴力了，能不能自定义聚合的长度呢？</p>
<p>有！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[R1]bgp 1</span><br><span class="line">[R1-bgp]network 10.1.0.0 24</span><br><span class="line">[R1-bgp]network 10.1.1.0 24</span><br><span class="line">[R1-bgp]network 10.1.2.0 24</span><br><span class="line">[R1-bgp]network 10.1.3.0 24</span><br><span class="line">[R1-bgp]ip route-static 10.1.0.0 22 null 0</span><br></pre></td></tr></table></figure>

<p>用引入路由聚合会直接聚合范围太大了，可以用引入静态路由的方法，优点是既可以自定义掩码长度，又可以防止成环（一个路由down了就跑到10.10.0.0 22 ，又因为是null 0直接就丢弃了，不会再去请求路由了）</p>
<pre><code>方式3（手动）：
</code></pre>
<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[R1]bgp <span class="number">1</span></span><br><span class="line">[R1-bgp]network <span class="number">10</span><span class="variable">.1</span><span class="variable">.0</span><span class="variable">.0</span> <span class="number">24</span></span><br><span class="line">[R1-bgp]network <span class="number">10</span><span class="variable">.1</span><span class="variable">.1</span><span class="variable">.0</span> <span class="number">24</span></span><br><span class="line">[R1-bgp]network <span class="number">10</span><span class="variable">.1</span><span class="variable">.2</span><span class="variable">.0</span> <span class="number">24</span></span><br><span class="line">[R1-bgp]network <span class="number">10</span><span class="variable">.1</span><span class="variable">.3</span><span class="variable">.0</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[R1-bgp]aggregate <span class="number">10</span><span class="variable">.1</span><span class="variable">.0</span><span class="variable">.0</span> <span class="number">22</span>   使用此命令会使明细路由和汇总路由同时被宣告</span><br><span class="line">[R1-bgp]aggregate <span class="number">10</span><span class="variable">.1</span><span class="variable">.0</span><span class="variable">.0</span> <span class="number">22</span> detail-suppressed   只宣告汇总路由</span><br></pre></td></tr></table></figure>



<ol start="10">
<li><p><strong>peer group</strong></p>
<p>就是为了方便打命令，类似于ctrl + v</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[R2-bgp]group benben </span><br><span class="line">[R2-bgp]peer benben as-number <span class="number">16</span> </span><br><span class="line">[R2-bgp]peer <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> group benben</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​	</p>
<h2 id="BGP管理距离（优先级）"><a href="#BGP管理距离（优先级）" class="headerlink" title="BGP管理距离（优先级）"></a>BGP管理距离（优先级）</h2><p>ibgp：200</p>
<p>ebgp：255</p>
<h2 id="bgp表的分析"><a href="#bgp表的分析" class="headerlink" title="bgp表的分析"></a>bgp表的分析</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231118100119104.png" alt="image-20231118100119104"></p>
<ol>
<li>path用来防环操作</li>
<li>ogn表示用什么学习到路由，i代表igp，e代表bgp，？代表其他</li>
<li>*&gt;奇怪的命名，bgp和ibgp的这个符号不同(i)</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">                   </span><br><span class="line">Origin : i - IGP, e - EGP, ? - incomplete（引入路由）</span><br></pre></td></tr></table></figure>



<h2 id="BGP属性和路径选择处理"><a href="#BGP属性和路径选择处理" class="headerlink" title="BGP属性和路径选择处理"></a><strong>BGP属性和路径选择处理</strong></h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231123105752364.png" alt="image-20231123105752364"></p>
<h3 id="BGP的属性"><a href="#BGP的属性" class="headerlink" title="BGP的属性"></a>BGP的属性</h3><table>
<thead>
<tr>
<th>属性名</th>
<th>传播范围</th>
<th>默认值</th>
<th>评判标准</th>
</tr>
</thead>
<tbody><tr>
<td>PV</td>
<td>不传播</td>
<td>0</td>
<td>越大越好</td>
</tr>
<tr>
<td>LP</td>
<td>IGBP之间传播</td>
<td>100</td>
<td>越大越好</td>
</tr>
<tr>
<td>AS_PATH</td>
<td>EBGP 之间</td>
<td>无</td>
<td>记录数越少越好</td>
</tr>
<tr>
<td>OGN</td>
<td>EBGP 之间</td>
<td>根据起源类型决定</td>
<td>i&gt;e&gt;?</td>
</tr>
<tr>
<td>MED</td>
<td>EBGP 之间</td>
<td>继承了路由表中该路由条目的开销值</td>
<td>越小越优先</td>
</tr>
</tbody></table>
<h3 id="属性分类"><a href="#属性分类" class="headerlink" title="属性分类"></a>属性分类</h3><table>
<thead>
<tr>
<th>公认必遵（Well-known mandatory</th>
<th>公认任意（Well-known discretionary）</th>
<th>可选过渡（Optional transtive）</th>
<th>可选非过渡（Optional non-transtive）</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Origin(起源)</strong></td>
<td><strong>LOCAL-PREF（本地优先级）</strong></td>
<td><strong>AGGREGATOR（聚合）</strong></td>
<td><strong>MED（多出口鉴别器）</strong></td>
</tr>
<tr>
<td><strong>AS_PATH（AS路径）</strong></td>
<td><strong>ATOMIC_AGGREGATE（原子聚合）</strong></td>
<td><strong>COMMUNITY（团体）</strong></td>
<td><strong>ORIGINATOR_ ID（发起人ID）</strong></td>
</tr>
<tr>
<td><strong>NEXT_HOP（下一跳）</strong></td>
<td>&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</td>
<td>&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</td>
<td><strong>WEIGHT（权重值）</strong></td>
</tr>
</tbody></table>
<h3 id="BGP的路径选择"><a href="#BGP的路径选择" class="headerlink" title="BGP的路径选择"></a>BGP的路径选择</h3><ol>
<li><strong>WEIGHT&#x2F;Prefval属性</strong></li>
</ol>
<ul>
<li><p>多条路径weight&#x2F;prefval值高就先选哪一个</p>
</li>
<li><p>本地有效</p>
</li>
<li><p>路由策略永远都是import</p>
<p>  方式一：</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[r4-bgp]peer <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> preferred-value <span class="number">100</span></span><br></pre></td></tr></table></figure>

<pre><code>方式二：
</code></pre>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>，抓取流量</span><br><span class="line">[r4]ip ip-prefix PV permit <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line"><span class="number">2</span>，做路由策略</span><br><span class="line">[r4]route-policy PV permit node <span class="number">10</span></span><br><span class="line">[r4-route-policy]<span class="keyword">if</span>-match ip-prefix pv</span><br><span class="line">[r4-route-policy]apply preferred-value <span class="number">100</span></span><br><span class="line">[r4]route-policy PV permit node <span class="number">20</span> --- 注意，必须要配置空表放通剩余所有流量</span><br><span class="line"><span class="number">3</span>，在BGP中调用路由策略</span><br><span class="line">[r4-bgp]peer <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> route-policy PV import</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>local preference</strong></li>
</ol>
<ul>
<li>Local preference是被用作去通告IBGP邻居怎样去离开他们的AS</li>
<li>Local preference被仅仅被发送给IBGP邻居的，（即仅同一AS内，是AS内部最常用的选路属性）</li>
<li>默认值是100</li>
</ul>
<p>方式一（全局）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[r3-bgp]<span class="keyword">default</span> local-preference <span class="number">200</span> --- R3之后发给IBGP对等体的路由的LP属性都将被改为<span class="number">200</span></span><br></pre></td></tr></table></figure>

<p>方式二（精细）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在R3的出方向做</span><br><span class="line"><span class="number">1</span>，抓取流量</span><br><span class="line">[r3]ip ip-prefix lp permit <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line"><span class="number">2</span>，做路由策略</span><br><span class="line">[r3]route-policy lp permit node <span class="number">10</span></span><br><span class="line">[r3-route-policy]<span class="keyword">if</span>-match ip-prefix lp</span><br><span class="line">[r3-route-policy]apply local-preference <span class="number">300</span></span><br><span class="line">[r3]route-policy lp permit node <span class="number">20</span></span><br><span class="line"><span class="number">3</span>，在BGP进程中调用</span><br><span class="line">[r3-bgp]peer <span class="number">4.4</span><span class="number">.4</span><span class="number">.4</span> route-policy lp export</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>路由起源于<strong>本地优先</strong>于从其他bgp邻居中学习到</li>
</ol>
<p>手工聚合 &gt; 自动聚合 &gt; network &gt; import</p>
<ol start="4">
<li><strong>ASPath越短越优先</strong></li>
</ol>
<ul>
<li><pre><code>**仅在EBGP中有效**
</code></pre>
</li>
<li>AS_PATH属性在进行选路时，<strong>仅关注AS号的长短</strong>，不关注内容。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">方法一：在R1的出方向修改AS_PATH属性。</span><br><span class="line"><span class="number">1</span>，抓取流量</span><br><span class="line">[r1]ip ip-prefix as permit <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line"><span class="number">2</span>，配置路由策略</span><br><span class="line">[r1]route-policy as permit node <span class="number">10</span></span><br><span class="line">[r1-route-policy]<span class="keyword">if</span>-match ip-prefix as</span><br><span class="line">[r1-route-policy]apply as-path <span class="number">11</span> <span class="number">22</span> <span class="number">33</span> ?</span><br><span class="line"><span class="comment">/*additive*/</span> Append to original As Number ---- 在原有AS_PATH属性的基础上添加配置的AS号</span><br><span class="line"><span class="comment">/*overwrite*/</span> Overwrite original As Number ---- 直接覆盖原有的AS_PATH属性值</span><br><span class="line">  </span><br><span class="line">[r1-route-policy]apply as-path <span class="number">11</span> <span class="number">22</span> <span class="number">33</span> additive --- 建议使用添加，因为AS_path属性主要任务用来防止环路，将原有属性覆盖可能导致路由回传，造成环路产生。</span><br><span class="line">[r1]route-policy as permit node <span class="number">20</span><span class="comment">//放行其他</span></span><br><span class="line"><span class="number">3</span>，在BGP中调用策略</span><br><span class="line">[r1-bgp]peer <span class="number">12.0</span><span class="number">.0</span><span class="number">.2</span> route-policy as export</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ol start="5">
<li><strong>路由起源属性</strong></li>
</ol>
<ul>
<li><pre><code>    **全局有效**
</code></pre>
</li>
<li>I — 代表该<strong>路由信息起源于IGP协议</strong></li>
<li>E — 代表该路由信息<strong>起源于EGP协议</strong> — EGP指的是BGP之前使用的外部网关协议</li>
<li>？ — 通过除了以上两种方式学习到的路由 -<strong>– 重发布导入的路由</strong>起源码都是？</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">控制选路的方法：</span><br><span class="line"><span class="number">1</span>，抓流量</span><br><span class="line">[r2]ip ip-prefix ogn permit <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line"><span class="number">2</span>，配置路由策略</span><br><span class="line">[r2]route-policy ogn permit node <span class="number">10</span></span><br><span class="line">[r2-route-policy]<span class="keyword">if</span>-match ip-prefix ogn</span><br><span class="line">[r2-route-policy]apply origin incomplete</span><br><span class="line">[r2]route-policy ogn permit node <span class="number">20</span></span><br><span class="line"><span class="number">3</span>，在BGP中进行调用</span><br><span class="line">[r2-bgp]peer <span class="number">12.0</span><span class="number">.0</span><span class="number">.1</span> route-policy ogn import</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<ol start="6">
<li><p><strong>MED</strong>：</p>
<ul>
<li>只能用于EGBP</li>
<li>路由引入的cost值引入到bgp里面不变，存到med中，开销小优先（多路选择）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">在R2上配置，影响R1的选路</span><br><span class="line"><span class="number">1</span>，抓取流量</span><br><span class="line">[r2]ip ip-prefix med permit <span class="number">4.4</span><span class="number">.4</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line"><span class="number">2</span>，配置路由策略</span><br><span class="line">[r2]route-policy med permit node <span class="number">10</span></span><br><span class="line">[r2-route-policy]<span class="keyword">if</span>-match ip-prefix med</span><br><span class="line">[r2-route-policy]apply cost <span class="number">10</span></span><br><span class="line">[r2]route-policy med permit node <span class="number">20</span></span><br><span class="line"><span class="number">3</span>，在BGP进程中调用</span><br><span class="line">[r2-bgp]peer <span class="number">12.0</span><span class="number">.0</span><span class="number">.1</span> route-policy med export</span><br><span class="line">注意：MED值影响的是别的AS的流量通过多个出口进入到本AS内部，如果流入的不是同一个AS，即收到的路由条目中AS_PATH属性最左边的AS号不同，则将不比较第六条，直接比较第<span class="number">7</span>条。</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231118161507165.png" alt="image-20231118161507165"></p>
<pre><code> 剩下的省略...
</code></pre>
</li>
</ol>
<p>总结（？）：</p>
<ol>
<li>一个路由器有多个出口时一般用weight&#x2F;pv来控制选路</li>
<li>一个AS内有多个出口时一般用Local_pref</li>
<li>影响其他人选路用MED out方向，影响自己选路用MED in方向</li>
<li>影响多个AS选路用AS-path</li>
<li>origin next-hop一般不用，有时会影响BGP的正常选路</li>
</ol>
<h2 id="路由反射"><a href="#路由反射" class="headerlink" title="路由反射"></a>路由反射</h2><ul>
<li><p>水平分割不允许ibgp转发从ibgp学习到的路由，但是你把它升级成路由反射器再配置相应的客户机就可以进行路由转发了</p>
</li>
<li><p>当RR从<strong>客户机</strong>收到一个路由更新时，会将它发送给<strong>客户机和非客户机。</strong></p>
</li>
<li><p>当RR从<strong>非客户机</strong>收到一个路由更新时，只发送给<strong>客户机</strong>路由器，而不发送给其他非客户机路由器</p>
</li>
<li><p>当RR从<strong>EBGP</strong>收到一个路由更新时，会将它发送给<strong>客户机和非客户机。</strong></p>
<p>  <strong><u>省流：非非不传，其他全传</u></strong></p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231122004449268.png" alt="image-20231122004449268"></p>
<p>在图中的ar2和3建立一个连接，ar3和4建立一个连接（r3做rr，r2和r4做客户端）</p>
<p><strong>配置</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[r3]bgp <span class="number">16</span></span><br><span class="line">[r3-bgp]peer <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span>  reflect-client </span><br><span class="line">[r3-bgp]peer <span class="number">34.1</span><span class="number">.1</span><span class="number">.4</span>  reflect-client</span><br></pre></td></tr></table></figure>



<p>路由反射问题解决：</p>
<ul>
<li><strong>反射簇</strong>解决路由<strong>环路</strong></li>
<li><strong>Originator ID属性</strong>解决<strong>再次学习</strong>问题</li>
</ul>
<h2 id="路由联盟"><a href="#路由联盟" class="headerlink" title="路由联盟"></a>路由联盟</h2><p>在大的as中分割出更小的as</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231118163953382.png" alt="image-20231118163953382"></p>
<p>在这个图中r1发送给r2，r2可以再把数据给r3，一般的r3不能发给r4，但是我们做了两个小的as，那么逻辑上r2和r3就成为了ebgp，可以进行路由转发</p>
<p><strong>配置</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*在R1上配置：*/</span></span><br><span class="line">bgp <span class="number">1</span></span><br><span class="line">peer <span class="number">12.0</span><span class="number">.0</span><span class="number">.2</span> as-number <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*R2上关键配置：*/</span></span><br><span class="line">bgp <span class="number">65512</span> <span class="comment">//本机AS为成员AS号（小as）</span></span><br><span class="line">confederation id <span class="number">2</span><span class="comment">//联盟ID，外部路由器看来，连接AS仍然为2</span></span><br><span class="line">confederation peer-as <span class="number">65512</span> <span class="comment">//说明本机连接了其他哪些成员AS，都是小区域（as3）</span></span><br><span class="line"></span><br><span class="line">peer <span class="number">23.0</span><span class="number">.0</span><span class="number">.3</span> as-number <span class="number">65512</span> <span class="comment">//和成员建立EBGP邻居关系</span></span><br><span class="line">    </span><br><span class="line">peer <span class="number">12.0</span><span class="number">.0</span><span class="number">.1</span> as-number <span class="number">1</span> <span class="comment">//和非成员建立IBGP邻居关系</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*R3上关键配置：*/</span></span><br><span class="line">bgp <span class="number">65512</span> <span class="comment">//本机AS为成员AS号（小as）</span></span><br><span class="line">confederation id <span class="number">2</span><span class="comment">//联盟ID，外部路由器看来，连接AS仍然为2</span></span><br><span class="line">confederation peer-as <span class="number">65512</span> <span class="comment">//说明本机连接了其他哪些成员AS（as3）</span></span><br><span class="line">confederation peer-as <span class="number">65513</span> <span class="comment">//说明本机连接了其他哪些成员AS（as3）</span></span><br><span class="line"></span><br><span class="line">peer <span class="number">23.0</span><span class="number">.0</span><span class="number">.2</span> as-number <span class="number">65512</span> <span class="comment">//和成员建立EBGP邻居关系</span></span><br><span class="line">    </span><br><span class="line">peer <span class="number">34.0</span><span class="number">.0</span><span class="number">.4</span> as-number <span class="number">63513</span><span class="comment">//和非成员建立IBGP邻居关系</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*R4上关键配置：*/</span></span><br><span class="line">bgp <span class="number">65513</span> <span class="comment">//本机AS为成员AS号（小as）</span></span><br><span class="line">confederation id <span class="number">2</span><span class="comment">//联盟ID，外部路由器看来，连接AS仍然为2</span></span><br><span class="line">confederation peer-as <span class="number">65512</span> <span class="comment">//说明本机连接了其他哪些成员AS（as3）</span></span><br><span class="line">confederation peer-as <span class="number">65513</span> <span class="comment">//说明本机连接了其他哪些成员AS（as3）</span></span><br><span class="line"></span><br><span class="line">peer <span class="number">45.0</span><span class="number">.0</span><span class="number">.5</span> as-number <span class="number">65513</span> <span class="comment">//和成员建立EBGP邻居关系</span></span><br><span class="line">    </span><br><span class="line">peer <span class="number">34.0</span><span class="number">.0</span><span class="number">.3</span> as-number <span class="number">63512</span><span class="comment">//和非成员建立IBGP邻居关系</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">/*R5上关键配置：*/</span></span><br><span class="line">bgp <span class="number">65513</span> <span class="comment">//本机AS为成员AS号（小as）</span></span><br><span class="line">confederation id <span class="number">2</span><span class="comment">//联盟ID，外部路由器看来，连接AS仍然为2</span></span><br><span class="line">    </span><br><span class="line">confederation peer-as <span class="number">65513</span> <span class="comment">//说明本机连接了其他哪些成员AS（as3）</span></span><br><span class="line"></span><br><span class="line">peer <span class="number">45.0</span><span class="number">.0</span><span class="number">.4</span> as-number <span class="number">65513</span> <span class="comment">//和成员建立EBGP邻居关系</span></span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="数据通信9"><a href="#数据通信9" class="headerlink" title="数据通信9"></a>数据通信9</h1><p>[TOC]</p>
<h2 id="smart-link（断了选路）"><a href="#smart-link（断了选路）" class="headerlink" title="smart-link（断了选路）"></a>smart-link（断了选路）</h2><h3 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h3><p>实现两根线的备份，和生成树类似，但是不用计算</p>
<p><strong>设置一个master和slave，主挂了次就顶上来</strong></p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a><strong>特点</strong></h3><ol>
<li>两根上行链路只走一条，打破回路</li>
<li>主链路故障后流量会立刻切换到备用的链路上</li>
<li>配置简单</li>
<li>没有协议交互报文，大大提升收敛速度</li>
</ol>
<h3 id="实验配置-6"><a href="#实验配置-6" class="headerlink" title="实验配置"></a>实验配置</h3><p><strong>samrt-link的功能与生成树冲突，因此要先关闭stp</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">stp disable</span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">stp disable</span><br><span class="line">smart-link group <span class="number">1</span></span><br><span class="line">port g0/<span class="number">0</span>/<span class="number">0</span> master </span><br><span class="line">port g0/<span class="number">0</span>/<span class="number">2</span> slave</span><br><span class="line">restore enable<span class="comment">//回切功能打开</span></span><br><span class="line">time wtr <span class="number">30</span><span class="comment">//等待回切时间</span></span><br></pre></td></tr></table></figure>





<h2 id="monitor-link（一起断）"><a href="#monitor-link（一起断）" class="headerlink" title="monitor-link（一起断）"></a>monitor-link（一起断）</h2><h3 id="概述-4"><a href="#概述-4" class="headerlink" title="概述"></a>概述</h3><p>为了解决smart-link的的缺点</p>
<h3 id="实验配置-7"><a href="#实验配置-7" class="headerlink" title="实验配置"></a>实验配置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231202110137413.png" alt="image-20231202110137413"></p>
<p>将交换机LSW2 1和2端口配置monitor link，将2号口设置为uplink，1号口设置为downink</p>
<p>将交换机LSW3 1和2端口配置monitor link，将2号口设置为uplink，1号口设置为downink</p>
<p>R1</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">stp disable</span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">stp disable</span><br><span class="line">smart-link enable</span><br><span class="line">port g0/<span class="number">0</span>/<span class="number">1</span> master</span><br><span class="line">port g0/<span class="number">0</span>/<span class="number">2</span> slave</span><br><span class="line">flush send contorl-vlan <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>R2</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">stp disable</span><br><span class="line">smart-link flush receive control-vlan <span class="number">1</span></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">stp disable</span><br><span class="line">smart-link flush receive control-vlan <span class="number">1</span></span><br><span class="line">smart-link enable</span><br><span class="line">monitor-link group <span class="number">1</span></span><br><span class="line">port g0/<span class="number">0</span>/<span class="number">1</span> uplink</span><br><span class="line">port g0/<span class="number">0</span>/<span class="number">2</span> downlink <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>R3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int g0/0/1</span><br><span class="line">stp disable</span><br><span class="line">smart-link flush receive control-vlan 1</span><br><span class="line">int g0/0/2</span><br><span class="line">stp disable</span><br><span class="line">smart-link flush receive control-vlan 1</span><br><span class="line">smart-link enable</span><br><span class="line">monitor-link group 1</span><br><span class="line">port g0/0/1 uplink</span><br><span class="line">port g0/0/2 downlink 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="VRRP（备份-一个断了另一个补上）"><a href="#VRRP（备份-一个断了另一个补上）" class="headerlink" title="VRRP（备份-一个断了另一个补上）"></a>VRRP（备份-一个断了另一个补上）</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231202103235036.png" alt="image-20231202103235036"></p>
<h3 id="概述-5"><a href="#概述-5" class="headerlink" title="概述"></a>概述</h3><ul>
<li><p>虚拟路由器备份协议，用于一个pc有多个链路选择但是仅有一个网关（<strong>网关备份</strong>）</p>
</li>
<li><p>先在多个路由器里面选一个主机（master），其他的作为备份机（back-up）</p>
</li>
<li><p>pc在找自己的网关的时候会发送arp请求报文，只有master会回应arp请求</p>
</li>
</ul>
<h3 id="实验配置-8"><a href="#实验配置-8" class="headerlink" title="实验配置"></a>实验配置</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vrrp vrid <span class="number">1</span></span><br><span class="line">vrrp vrid <span class="number">1</span> virtual-ip <span class="number">10.234</span><span class="number">.0</span><span class="number">.1</span><span class="comment">//不存在的ip地址</span></span><br></pre></td></tr></table></figure>

<p><strong>虚拟mac地址<u>00:00:5e:00:01</u>:xx</strong>(16进制)</p>
<p>？那么master是<strong>怎么选举</strong>出来的呢？</p>
<ol>
<li>比较优先级，默认100（<strong>具备抢占性</strong>，可以自己关）</li>
<li>比较ip地址（<strong>不具备抢占性</strong>，一开始配置的就是master，如果需要更换，把接口关了再开，就会切换了）</li>
</ol>
<h3 id="链路状态监测"><a href="#链路状态监测" class="headerlink" title="链路状态监测"></a>链路状态监测</h3><h4 id="基于端口-1"><a href="#基于端口-1" class="headerlink" title="基于端口"></a>基于端口</h4><p><strong>下行链路做的vrrp，那么向上的链路down了怎么办呢？</strong></p>
<p>我们可以做一个<strong>vrrp跟踪</strong>来监控特定端口，如果端口出现异常使得优先级降低，这样就可以切换master了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vrrp vrid <span class="number">1</span> track <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span> reduced <span class="number">10</span> </span><br></pre></td></tr></table></figure>

<h4 id="基于nqa"><a href="#基于nqa" class="headerlink" title="基于nqa"></a>基于nqa</h4><p><strong>但是这样也有问题，线路没断就不会切换，要使用nqa来解决（判断标准更多）</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[RouterA] nqa test-instance user test</span><br><span class="line">[RouterA-user-test] test-type icmp</span><br><span class="line">[RouterA-user-test] destination-address ipv4 <span class="number">20.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">[RouterA-user-test] frequency <span class="number">20</span></span><br><span class="line">[RouterA-user-test] probe-count <span class="number">5</span></span><br><span class="line">[RouterA-user-test] fail-percent <span class="number">80</span></span><br><span class="line">[RouterA-user-test] start now</span><br><span class="line">[RouterA-user-test] quit</span><br></pre></td></tr></table></figure>





<h2 id="MUX-VLAN（分隔vlan）"><a href="#MUX-VLAN（分隔vlan）" class="headerlink" title="MUX-VLAN（分隔vlan）"></a>MUX-VLAN（分隔vlan）</h2><h3 id="访问规则"><a href="#访问规则" class="headerlink" title="访问规则"></a>访问规则</h3><ul>
<li>在隔离域内部的主机既不能和本域主机通信，也不可以和外部通信</li>
<li>在一个组里面的主机可以互相通信</li>
<li>主vlan可以和所有的主机通信</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231206224235529.png" alt="image-20231206224235529"></p>
<h3 id="实验配置-9"><a href="#实验配置-9" class="headerlink" title="实验配置"></a>实验配置</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- vlan batch <span class="number">100</span> <span class="number">200</span> <span class="number">300</span> <span class="number">400</span></span><br><span class="line"></span><br><span class="line">- vlan <span class="number">100</span></span><br><span class="line">- mux-vlan  </span><br><span class="line"></span><br><span class="line">- subordinate separate <span class="number">400</span>（该vlan内pc谁都联系不了）</span><br><span class="line"></span><br><span class="line">- subordinate group <span class="number">200</span> <span class="number">300</span>（该vlan200内pc可以互相通信，但是<span class="number">200</span>和<span class="number">300</span>不可以）</span><br><span class="line"></span><br><span class="line">- 其他就和之前学的vlan划分类似：</span><br><span class="line"></span><br><span class="line">- interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">  port link-type access</span><br><span class="line">  port <span class="keyword">default</span> vlan <span class="number">100</span></span><br><span class="line">  **port mux-vlan enable**<span class="comment">//但是多了句</span></span><br></pre></td></tr></table></figure>

<h2 id="VLAN聚合（SUPER-VLAN）"><a href="#VLAN聚合（SUPER-VLAN）" class="headerlink" title="VLAN聚合（SUPER VLAN）"></a>VLAN聚合（SUPER VLAN）</h2><h4 id="概述-6"><a href="#概述-6" class="headerlink" title="概述"></a>概述</h4><p>定义Super-VLAN和Sub-VLAN</p>
<p>实现所有Sub-VLAN共用一个网关与外部网络通信，并用ARP Proxy实现Sub-VLAN间的三层通信，从而在实现普通VLAN的隔离广播域的同时，达到节省IP地址的目的。</p>
<h4 id="实验配置-10"><a href="#实验配置-10" class="headerlink" title="实验配置"></a>实验配置</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231206230552259.png" alt="image-20231206230552259"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">lsw2</span><br><span class="line">vlan <span class="number">10</span></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">port link-type access</span><br><span class="line">port <span class="keyword">default</span> vlan <span class="number">10</span>  </span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">port link-type access</span><br><span class="line">port <span class="keyword">default</span> vlan <span class="number">10</span></span><br><span class="line"></span><br><span class="line">lsw3</span><br><span class="line">vlan <span class="number">20</span></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">port link-type access</span><br><span class="line">port <span class="keyword">default</span> vlan <span class="number">20</span>  </span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">port link-type access</span><br><span class="line">port <span class="keyword">default</span> vlan <span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lsw4</span><br><span class="line">vlan <span class="number">30</span></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">port link-type access</span><br><span class="line">port <span class="keyword">default</span> vlan <span class="number">30</span>  </span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">port link-type access</span><br><span class="line">port <span class="keyword">default</span> vlan <span class="number">30</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">lsw1 </span><br><span class="line">vlan batch <span class="number">10</span> <span class="number">20</span> <span class="number">30</span> <span class="number">100</span> <span class="number">200</span></span><br><span class="line">vlan <span class="number">100</span> </span><br><span class="line">aggregate-vlan<span class="comment">// 打开vlan聚合</span></span><br><span class="line">access-vlan <span class="number">10</span> <span class="number">20</span> <span class="number">30</span><span class="comment">//聚合对象是10 20 30</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">port link-type access</span><br><span class="line">port <span class="keyword">default</span> vlan <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">port link-type trunk</span><br><span class="line">port trunk allow-pass vlan <span class="number">10</span> <span class="number">20</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line">port link-type trunk</span><br><span class="line">port trunk allow-pass vlan <span class="number">10</span> <span class="number">20</span> <span class="number">30</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="VLAN-QinQ（vlan的嵌套映射增加）"><a href="#VLAN-QinQ（vlan的嵌套映射增加）" class="headerlink" title="VLAN-QinQ（vlan的嵌套映射增加）"></a>VLAN-QinQ（vlan的嵌套映射增加）</h2><p>QinQ是指在802.1Q VLAN的基础上增加一层802.1Q VLAN标签，从而拓展VLAN的使用空间。在<strong>公网</strong>的传输过程中，设备只根据<strong>外层VLAN Tag转发报文</strong>，并根据报文的外层VLAN Tag进行MAC地址学习，而用户的<strong>私网VLAN Tag将被当作报文的数据部分进行传输。</strong></p>
<h3 id="实验配置-11"><a href="#实验配置-11" class="headerlink" title="实验配置"></a>实验配置</h3><ol>
<li>LSW1和LSW2的gi0&#x2F;0&#x2F;1上配置QinQ。外层VLAN是100或300。</li>
<li>PC的IP地址是192.168.10.x&#x2F;24，X是PC编号。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231206231436788.png" alt="image-20231206231436788"></p>
<h4 id="简单qinq-多vlan映射一个vlan"><a href="#简单qinq-多vlan映射一个vlan" class="headerlink" title="简单qinq(多vlan映射一个vlan)"></a>简单qinq(多vlan映射一个vlan)</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">lsw1</span><br><span class="line">    vlan batch <span class="number">100</span><span class="comment">//创建vlan</span></span><br><span class="line">    <span class="comment">//配置qinq端口//</span></span><br><span class="line">    <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">    port link-type dolt1q-tunnel<span class="comment">//关键就是这句命令</span></span><br><span class="line">    port <span class="keyword">default</span> vlan <span class="number">100</span></span><br><span class="line">    q</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置trunk口，在g0/0/2开启trunk模式并且允许vlan100</span></span><br><span class="line">  <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">  port link-type trunk</span><br><span class="line">  port trunk allow-pass vlan <span class="number">100</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">lsw3</span><br><span class="line">  <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">  port link-type trunk</span><br><span class="line">  port trunk allow-pass vlan <span class="number">10</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">  port link-type access</span><br><span class="line">  port <span class="keyword">default</span> vlan <span class="number">10</span></span><br><span class="line">    </span><br><span class="line">  <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line">  port link-type access</span><br><span class="line">  port <span class="keyword">default</span> vlan <span class="number">30</span></span><br><span class="line">  </span><br><span class="line">    </span><br><span class="line">   </span><br></pre></td></tr></table></figure>





<h4 id="灵活qinq（单个vlan映射单个vlan）"><a href="#灵活qinq（单个vlan映射单个vlan）" class="headerlink" title="灵活qinq（单个vlan映射单个vlan）"></a>灵活qinq（单个vlan映射单个vlan）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">lsw1</span><br><span class="line">    vlan batch 100 300//创建vlan</span><br><span class="line">    //配置qinq端口//</span><br><span class="line">    int g0/0/1</span><br><span class="line">    //port link-type hybrid</span><br><span class="line">    //port hybrid untag 100 300</span><br><span class="line">  	//port vlan translation enable</span><br><span class="line">    //port vlan-stacking vlan 10 stack 100</span><br><span class="line">    //port vlan-stacking vlan 30 stack 300</span><br><span class="line">    </span><br><span class="line">    //配置trunk口，在g0/0/2开启trunk模式并且允许vlan100</span><br><span class="line">  int g0/0/2</span><br><span class="line">  port link-type trunk</span><br><span class="line">  port trunk allow-pass vlan 100 300</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">lsw3</span><br><span class="line">vlan batch 10 30</span><br><span class="line">  int g0/0/1</span><br><span class="line">  port link-type trunk</span><br><span class="line">  port trunk allow-pass vlan 10 30</span><br><span class="line"></span><br><span class="line">  int g0/0/2</span><br><span class="line">  port link-type access</span><br><span class="line">  port default vlan 10</span><br><span class="line">    </span><br><span class="line">  int g0/0/3</span><br><span class="line">  port link-type access</span><br><span class="line">  port default vlan 30</span><br><span class="line">  </span><br></pre></td></tr></table></figure>





<h2 id="VLAN-MAPPING"><a href="#VLAN-MAPPING" class="headerlink" title="VLAN-MAPPING"></a>VLAN-MAPPING</h2><p>不同于QINQ的在原来的tag头部前再添加一个头部进行映射，mapping直接<strong>将一个vlan转换成另一个vlan</strong></p>
<h3 id="实验配置-12"><a href="#实验配置-12" class="headerlink" title="实验配置"></a>实验配置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20180521131532123" alt="这里写图片描述"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">lsw1/lsw4</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet0/0/1</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">10</span> <span class="number">20</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet0/0/2</span></span><br><span class="line"> port link-type access</span><br><span class="line"> port <span class="keyword">default</span> vlan <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet0/0/3</span></span><br><span class="line"> port link-type access</span><br><span class="line"> port <span class="keyword">default</span> vlan <span class="number">20</span></span><br><span class="line">#</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">lsw2/lsw3   </span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet0/0/1</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">100</span> <span class="number">200</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet0/0/2</span></span><br><span class="line"> qinq vlan-translation enable</span><br><span class="line"> <span class="comment">//开启vlan转换功能</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">100</span> <span class="number">200</span></span><br><span class="line"> port vlan-mapping vlan <span class="number">10</span> <span class="built_in">map</span>-vlan <span class="number">100</span><span class="comment">//最重要的一步，类似于灵活qinq的配置模式</span></span><br><span class="line">  <span class="comment">//配置VLAN10映射为VLAN100</span></span><br><span class="line"> port vlan-mapping vlan <span class="number">20</span> <span class="built_in">map</span>-vlan <span class="number">200</span></span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="数据通信10"><a href="#数据通信10" class="headerlink" title="数据通信10"></a>数据通信10</h1><p>从计网入门到网络黑客大成</p>
<p>[TOC]</p>
<h2 id="MAC地址表项配置"><a href="#MAC地址表项配置" class="headerlink" title="MAC地址表项配置"></a>MAC地址表项配置</h2><h3 id="配置静态mac表项"><a href="#配置静态mac表项" class="headerlink" title="配置静态mac表项"></a>配置静态mac表项</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mac-address <span class="type">static</span> mac-address interface-type inter-number vlan XX</span><br></pre></td></tr></table></figure>



<h3 id="配置mac黑洞MAC表项"><a href="#配置mac黑洞MAC表项" class="headerlink" title="配置mac黑洞MAC表项"></a>配置mac黑洞MAC表项</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mac-address blackhole mac-address 【vlan xx】</span><br></pre></td></tr></table></figure>



<h3 id="配置动态MAC表项的老化时间"><a href="#配置动态MAC表项的老化时间" class="headerlink" title="配置动态MAC表项的老化时间"></a>配置动态MAC表项的老化时间</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mac-address aging-time ading-time</span><br></pre></td></tr></table></figure>



<h3 id="MAC地址表安全配置举例"><a href="#MAC地址表安全配置举例" class="headerlink" title="MAC地址表安全配置举例"></a>MAC地址表安全配置举例</h3><p><strong>防止其他人的mac地址表攻击：</strong>发送大量的假的mac地址占据交换机的mac地址表，然后接收它的泛洪信息以破解命令(kali	的macof)</p>
<h3 id="端口安全技术"><a href="#端口安全技术" class="headerlink" title="端口安全技术"></a>端口安全技术</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">port-security enable</span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">port-security mac-address sticky<span class="comment">//开启粘性mac模式</span></span><br><span class="line">port-security max-mac-num xx<span class="comment">//前xx个加入的pc的mac地址会记录，只有这些可以上网</span></span><br><span class="line">port-security protect-action &#123; protect | <span class="keyword">restrict</span> | shutdown &#125;<span class="comment">//配置端口安全保护动作</span></span><br><span class="line"><span class="comment">/*protect：当学习到的MAC地址数达到接口限制数时，接口丢弃源地址在MAC表以外的报文。</span></span><br><span class="line"><span class="comment">restrict：当学习到的MAC地址数超过接口限制数时，接口丢弃源地址在MAC表以外的报文，同时发出告警。</span></span><br><span class="line"><span class="comment">shutdown：当学习到的MAC地址数超过接口限制数时，将接口Error-Down，同时发出告警。*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="DHCP-snooping（窥探）"><a href="#DHCP-snooping（窥探）" class="headerlink" title="DHCP snooping（窥探）"></a>DHCP snooping（窥探）</h2><h3 id="出现背景"><a href="#出现背景" class="headerlink" title="出现背景"></a>出现背景</h3><p>一种攻击方式是打掉原来局域网的dhcp服务器然后再自己当上dhcp，为其他主机写ip地址，并且将相关的网关设置成自己，以此来”引流”</p>
<p><strong>dos dhcp discover 不断广播discover报文把原来的服务器搞崩，然后自己再假冒dhcp服务器分发ip</strong></p>
<h3 id="实验配置-13"><a href="#实验配置-13" class="headerlink" title="实验配置"></a>实验配置</h3><p>先<strong>全部设置为不信任端口</strong>（这时候收不到一点offer），再手动设置信任端口，信任端口可以通过offer包，不信任端口不通过offer包</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dhcp snooping enable<span class="comment">//全局</span></span><br><span class="line"><span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span><span class="comment">//进入接口或者vlan</span></span><br><span class="line">dhcp snooping enable</span><br><span class="line"></span><br><span class="line">dhcp snooping trusted<span class="comment">//配置信任端口</span></span><br></pre></td></tr></table></figure>





<h2 id="IPSG"><a href="#IPSG" class="headerlink" title="IPSG"></a>IPSG</h2><p><strong>IP源防攻击</strong></p>
<p>出现原因：一些攻击者通过伪造合法用户的IP地址获取网络访问权限，非法访问网络</p>
<p><strong>实验配置</strong></p>
<p>基于dhcp snooping功能</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP source check user-bind enable</span><br></pre></td></tr></table></figure>

<p>如果说有人在一个路由器上接线并且伪造了原网络的一个设备的ip的话，路由器查ipsg的绑定表发现不对后会堵塞掉新接入的那个端口</p>
<h2 id="VXLAN：虚拟拓展局域网–隧道技术"><a href="#VXLAN：虚拟拓展局域网–隧道技术" class="headerlink" title="VXLAN：虚拟拓展局域网–隧道技术"></a>VXLAN：虚拟拓展局域网–隧道技术</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><strong>将三层的设备两两相连，在逻辑上构成一个二层交换机，实现l2封装在l4上并且在l3中传输</strong></p>
<p><strong><u>采用mac in udp 封装，将以太报文封装在ip报文上</u></strong></p>
<h3 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h3><h4 id="bdif"><a href="#bdif" class="headerlink" title="bdif"></a>bdif</h4><p>BDIF接口的功能与VLANIF接口类似，是基于BD创建的三层逻辑接口，用以实现不同子网之间的通信，或VXLAN网络与非VXLAN网络之间的通信。</p>
<h4 id="VAP"><a href="#VAP" class="headerlink" title="VAP"></a>VAP</h4><p>虚拟接入点VAP，即VXLAN业务接入点，可以是二层子接口或VLAN</p>
<p>当接入节点是二层子接口时，通过在二层子接口上配置<strong>流封装类型</strong>（那4种）实现不同的接口接入不同的数据报文，将二层子接口关联广播域BD后，可实现数据报文通过BD转发。当业务接入点是VLAN时，需要将VLAN绑定到广播域BD，也可以实现数据报文通过BD转发。</p>
<h4 id="spine-leaf"><a href="#spine-leaf" class="headerlink" title="spine-leaf"></a>spine-leaf</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231209145518270.png" alt="image-20231209145518270"></p>
<p>vxlan<strong>配置在leaf（交换机）之间</strong>，完成vxlan的封装和解封装，spine节点（<strong>路由器）只进行路由转发</strong>，类似于之前学习到的ibgp之间进行配置，而中间那个路由器就不管了</p>
<h4 id="NVE"><a href="#NVE" class="headerlink" title="NVE"></a>NVE</h4><p>网络虚拟边缘节点NVE，实现网络虚拟化功能的网络实体。报文经过NVE封装转换后，NVE间就可基于三层基础网络建立二层虚拟化网络。（设备和服务器上的虚拟交换机VSwitch都可以作为NVE）</p>
<ul>
<li><p>硬件模式：所有的NVE都部署在支持NVE的设备上，所有的VXLAN报文封装与解封装都在设备上进行。</p>
</li>
<li><p>软件模式：所有的NVE都部署在vSwitch（开放的虚拟交换机）上，所有的VXLAN报文封装与解封装都在vSwitch上进行。</p>
</li>
<li><p>混合模式：部分NVE部署在vSwitch上，部分NVE部署在支持NVE的设备上，在vSwitch和设备上都有可能会进行VXLAN报文封装与解封装。</p>
</li>
</ul>
<h3 id="vxlan出现的原因"><a href="#vxlan出现的原因" class="headerlink" title="vxlan出现的原因"></a>vxlan出现的原因</h3><ol>
<li>虚拟机的动态迁移需要无障碍接入</li>
<li>租户过多，传统的valn技术不再适用，需要隔离海量的租户</li>
</ol>
<h3 id="服务器虚拟化技术"><a href="#服务器虚拟化技术" class="headerlink" title="服务器虚拟化技术"></a>服务器虚拟化技术</h3><p>将<strong>物理服务器</strong>分成多个<strong>虚拟服务器</strong>，这些服务器<strong>通过虚拟交换机（vswitch）与外界相连</strong></p>
<p>虚拟化的问题：</p>
<ol>
<li>vlan个数不够</li>
<li>mac地址表过大</li>
</ol>
<h3 id="服务器动态迁移"><a href="#服务器动态迁移" class="headerlink" title="服务器动态迁移"></a>服务器动态迁移</h3><p>原服务器正常运行的同时，将系统从一个物理服务器迁移到另一个物理服务器上，这要求服务器的<strong>tcp会话状态不变</strong>（ip不改变），所以<strong>只能在二层之中进行迁移</strong>，但是大型网络都会有三层结构，服务器迁移就需要<strong>vxlan技术将三层设备抽象成二层交换机</strong></p>
<h3 id="vxlan的报文格式"><a href="#vxlan的报文格式" class="headerlink" title="vxlan的报文格式"></a>vxlan的报文格式</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231209150126013.png" alt="image-20231209150126013"></p>
<h4 id="VTEP"><a href="#VTEP" class="headerlink" title="VTEP"></a>VTEP</h4><p><strong>VXLAN Tunnel Endpoints，VXLAN隧道端点</strong></p>
<p>就是之前的leaf节点，完成vxlan的封装和解封装</p>
<p>VTEP既可以是一台<strong>独立的网络设备</strong>（比如华为的CloudEngine系列交换机），也可以是在服务器中的<strong>虚拟交换机</strong>（vswitch）</p>
<h4 id="VNI"><a href="#VNI" class="headerlink" title="VNI"></a>VNI</h4><p><strong>VXLAN Network Identifier，VXLAN 网络标识符</strong></p>
<p>解决掉vlan id 不足的问题，功能类似，一个vni代表一个租户（虚拟机）</p>
<p>二层&#x2F;三层vni？</p>
<h4 id="vxlan报文"><a href="#vxlan报文" class="headerlink" title="vxlan报文"></a>vxlan报文</h4><ul>
<li><p>vxlan header :24比特的vni字段用来定义不同的租户，类似于vlan id。还有vxlan flags（0000 1000），两个保留字段</p>
</li>
<li><p>udp header：vxlan头部和原始数据帧组成udp数据。源udp端口通过哈希算法得到，源端口固定为4789</p>
</li>
<li><p>外部 IP 头部：源ip—源端vtep的ip地址   目的ip—目的端vtep的ip地址</p>
</li>
<li><p>外部mac头部：源mac—源端vtep的mac地址   目的mac—目的端vtep的mac地址</p>
</li>
</ul>
<h3 id="哪些vtep建立隧道连接"><a href="#哪些vtep建立隧道连接" class="headerlink" title="哪些vtep建立隧道连接"></a>哪些vtep建立隧道连接</h3><h4 id="大二层网络"><a href="#大二层网络" class="headerlink" title="大二层网络"></a>大二层网络</h4><p>两两互连</p>
<h4 id="同一大二层域BD"><a href="#同一大二层域BD" class="headerlink" title="同一大二层域BD"></a>同一大二层域BD</h4><p>类似于之前的vlan区域，但是vxlan这里叫BD（bridge-domain）</p>
<p><strong>创建配置</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bride-domain <span class="number">10</span><span class="comment">//创建bd 10</span></span><br><span class="line">vxlan vni <span class="number">5000</span><span class="comment">//bd 10下与之关联的是vni 500</span></span><br><span class="line"><span class="comment">//感觉像进入端口配置模式acess再default的感觉</span></span><br></pre></td></tr></table></figure>

<p>一个vni对应一个bd，一个bd下可以有多个vni</p>
<h3 id="哪些报文会走vxlan隧道"><a href="#哪些报文会走vxlan隧道" class="headerlink" title="哪些报文会走vxlan隧道"></a>哪些报文会走vxlan隧道</h3><h4 id="传统派"><a href="#传统派" class="headerlink" title="传统派"></a>传统派</h4><p>传统vlan技术中定义了三种不同类型的接口：Access、Trunk、Hybrid。这三种类型的接口虽然应用场景不同，但它们的最终目的是一样的：一是<strong>根据配置来检查哪些报文是允许通过的</strong>；二是判断对<strong>检查通过的报文做怎样的处理。</strong></p>
<h4 id="维新派"><a href="#维新派" class="headerlink" title="维新派"></a>维新派</h4><p>VXLAN网络中，VTEP上的<strong>“二层子接口”的逻辑接口</strong>也承担着类似的任务。二层子接口主要做两件事：一是<strong>根据配置来检查哪些报文需要进入VXLAN隧道</strong>；二是<strong>判断对检查通过的报文做怎样的处理</strong>。支持的流封装类型有<strong>dot1q</strong>、<strong>untag</strong>、<strong>qinq</strong>和<strong>default</strong>四种类型：</p>
<ul>
<li>dot1q：对于带有<strong>一层VLAN Tag</strong>的报文，该类型接口<strong>只接收与指定VLAN Ta</strong>g匹配的报文；对于带有<strong>两层VLAN</strong><br><strong>Tag的报文</strong>，该类型接口<strong>只接收外层VLAN Tag</strong>与指定VLAN Tag匹配的报文。（1层对应，两层对vni）</li>
<li>untag：该类型接口只接收<u>不带VLAN Tag</u>的报文。（0）</li>
<li>qinq：该类型接口<strong>只接收带有指定两层VLAN Tag</strong>的报文。（两层都对）</li>
<li>default：允许接口<strong>接收所有报文</strong>，不区分报文中是否带VLAN Tag。该类型接口都<strong>不会对原始报文进行任何VLAN Tag处理</strong>，包括添加、替换或剥离。（1）</li>
</ul>
<p><u>类型三变四，任务类似</u></p>
<p><strong>将二层子接口加入到指定的BD，再根据二层子接口上的配置，设备就可以确定报文属于哪个BD了</strong></p>
<h4 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a><strong>栗子</strong></h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20201112101102241.png" alt="在这里插入图片描述"></p>
<ol>
<li><p>分别在VTEP的物理接口10GE 1&#x2F;0&#x2F;1上，分别针对VM1和VM2封装不同的二层子接口1&#x2F;0&#x2F;1.1</p>
</li>
<li><p>在VTEP的接入口上创建两个二层子接口，分别配置为dot1q和untag的封装类型，并将其分别加入不同的BD</p>
</li>
<li><p>vSwitch的上行口配置成Trunk模式，这样vSwitch发给VTEP的报文中，既有带tag的VM1流量，又有untag的VM2流量（pvid是20，truck口出去的时候会把vlan 20的标签删掉）</p>
</li>
</ol>
<p>标签复习一下：</p>
<table>
<thead>
<tr>
<th>access</th>
<th>truck</th>
</tr>
</thead>
<tbody><tr>
<td>收：没标签，打上，进入|有标签，丢弃数据</td>
<td>收：没有vid，打上pvid，进入|有vid，允许进入，不允许丢弃</td>
</tr>
<tr>
<td><strong>发：去掉标签</strong></td>
<td>发：<strong>vid&#x3D;&#x3D;pvid，去标签</strong>发|vid！&#x3D;pvid，直接发送</td>
</tr>
</tbody></table>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/v2-8b9d084da4096742fcd8215187274765_1440w.webp" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="number">10</span>GE1/<span class="number">0</span>/<span class="number">1.1</span> mode l2<span class="comment">//创建二层接口</span></span><br><span class="line">encapsulation dolt1q vid <span class="number">10</span><span class="comment">//只允许vlan tag 10的报文进入vxlan隧道</span></span><br><span class="line">bride-domain <span class="number">10</span><span class="comment">//绑定bd 10</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="type">int</span> <span class="number">10</span>GE1/<span class="number">0</span>/<span class="number">1.2</span> mode l2<span class="comment">//创建二层接口</span></span><br><span class="line">encapsulation untag<span class="comment">//只允许vlan tag 20的报文进入vxlan隧道</span></span><br><span class="line">bride-domain <span class="number">20</span><span class="comment">//绑定bd 20</span></span><br></pre></td></tr></table></figure>

<p><strong>本质上还是靠标签进行确认</strong></p>
<h3 id="VXLAN隧道的建立"><a href="#VXLAN隧道的建立" class="headerlink" title="VXLAN隧道的建立"></a>VXLAN隧道的建立</h3><h4 id="手动"><a href="#手动" class="headerlink" title="手动"></a>手动</h4><p><strong>用户手动指定VXLAN隧道的源IP为本端VTEP的IP、目的IP为对端VTEP的IP</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> Nve <span class="number">1</span><span class="comment">//创建逻辑接口Nve 1</span></span><br><span class="line">source <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="comment">//源ip</span></span><br><span class="line">vni <span class="number">5000</span> head-end peer-<span class="built_in">list</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span><span class="comment">//对端ip（1）</span></span><br><span class="line">vni <span class="number">5000</span> head-end peer-<span class="built_in">list</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.3</span><span class="comment">//对端ip（2）</span></span><br></pre></td></tr></table></figure>



<p><strong>头端复制列表</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20201112103425968.png" alt="**头端复制列表**"></p>
<p>感觉上类似于转发表，Peer List指明同一个bd下的vtep有哪些</p>
<p>，bum指Broadcast&amp;Unknown-unicast&amp;Multicast，广播&amp;未知单播&amp;组播报文，一个vtep收到bum时会发给其他的对端vtep</p>
<h4 id="自动"><a href="#自动" class="headerlink" title="自动"></a>自动</h4><p>evpn学</p>
<h3 id="VXLAN隧道的选择"><a href="#VXLAN隧道的选择" class="headerlink" title="VXLAN隧道的选择"></a>VXLAN隧道的选择</h3><h4 id="VXLAN网关"><a href="#VXLAN网关" class="headerlink" title="VXLAN网关"></a>VXLAN网关</h4><p>不同的vni之间的主机不能相互通信，为此出现了vxlan网关</p>
<ul>
<li>VXLAN二层网关：用于终端接入VXLAN网络，也可用于同一VXLAN网络的子网通信。</li>
<li>VXLAN三层网关：用于VXLAN网络中跨子网通信以及访问外部网络。</li>
</ul>
<p>其中三层网关又分为<strong>集中式网关与分布式网关</strong></p>
<h4 id="集中式网关"><a href="#集中式网关" class="headerlink" title="集中式网关"></a>集中式网关</h4><h3 id="集中式VXLAN中不同子网互通流程"><a href="#集中式VXLAN中不同子网互通流程" class="headerlink" title="集中式VXLAN中不同子网互通流程"></a>集中式VXLAN中不同子网互通流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231213144040730.png" alt="image-20231213144040730"></p>
<ol>
<li>A将报文先交给vtep1，源ip是自己，源mac是自己，目标ip是b的ip，<strong>目标mac是自己网关的mac（下一跳</strong>：bdif 10）</li>
<li>vtep1收到报文之后识别到报文要走vni隧道，进行报文封装，将源ip和mac修改成vtep1的ip和mac地址</li>
<li>vtep3收到报文发现数据要去b，于是根据路由表得到下一跳（bdif20），将源ip和mac进行修改</li>
<li>bdif20收到报文后进行发送的过程和vtep1发的过程类似</li>
<li>vtep2收到数据后解封装发送给b</li>
</ol>
<p><strong>集中式网关由spine结点做三层网关，分布式也可以用leaf节点做三层网关</strong></p>
<h2 id="实验配置-14"><a href="#实验配置-14" class="headerlink" title="实验配置"></a>实验配置</h2><h3 id="配置同网段用户通过VXLAN隧道互通"><a href="#配置同网段用户通过VXLAN隧道互通" class="headerlink" title="配置同网段用户通过VXLAN隧道互通"></a>配置同网段用户通过VXLAN隧道互通</h3><h4 id="拓扑图"><a href="#拓扑图" class="headerlink" title="拓扑图"></a><strong>拓扑图</strong></h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231214001656597.png" alt="image-20231214001656597"></p>
<ol>
<li>基础配置：设备名称，ip地址，vlan，接口模式等</li>
<li>配置ospf路由协议，使得环回口互通</li>
<li>vxlan配置</li>
<li>验证</li>
</ol>
<h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">ce1</span><br><span class="line">bridge-domain <span class="number">10</span></span><br><span class="line"> vxlan vni <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GE1/0/0</span></span><br><span class="line"> undo portswitch</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> un shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">int lo 0</span></span><br><span class="line">ip ad <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GE1/0/1</span></span><br><span class="line"> undo shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">interface GE1/0/1.1 mode l2</span></span><br><span class="line"> encapsulation dot1q vid <span class="number">10</span></span><br><span class="line"> bridge-domain <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Nve1</span></span><br><span class="line"> source <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span></span><br><span class="line"> vni <span class="number">10</span> head-end peer-<span class="built_in">list</span> <span class="number">30.30</span><span class="number">.30</span><span class="number">.30</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">ospf 1</span></span><br><span class="line"> area <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">#</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ce2</span><br><span class="line">bridge-domain <span class="number">10</span></span><br><span class="line"> vxlan vni <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GE1/0/0</span></span><br><span class="line"> undo portswitch</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">12.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> un shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">interface GE1/0/1</span></span><br><span class="line"> undo portswitch</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> un shutdown</span><br><span class="line"> <span class="meta">#</span></span><br><span class="line"><span class="meta">int lo 0</span></span><br><span class="line">ip ad <span class="number">20.20</span><span class="number">.20</span><span class="number">.20</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">ospf 1</span></span><br><span class="line"> area <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">23.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">20.20</span><span class="number">.20</span><span class="number">.20</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">#</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ce3</span><br><span class="line">bridge-domain <span class="number">10</span></span><br><span class="line"> vxlan vni <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GE1/0/0</span></span><br><span class="line"> undo portswitch</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">23.1</span><span class="number">.1</span><span class="number">.3</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> un shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">int lo 0</span></span><br><span class="line">ip ad <span class="number">30.30</span><span class="number">.30</span><span class="number">.30</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GE1/0/1</span></span><br><span class="line"> undo shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">interface GE1/0/1.1 mode l2</span></span><br><span class="line"> encapsulation dot1q vid <span class="number">10</span></span><br><span class="line"> bridge-domain <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Nve1</span></span><br><span class="line"> source <span class="number">30.30</span><span class="number">.30</span><span class="number">.30</span></span><br><span class="line"> vni <span class="number">10</span> head-end peer-<span class="built_in">list</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">ospf 1</span></span><br><span class="line"> area <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">23.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">30.30</span><span class="number">.30</span><span class="number">.30</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">#</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lsw2</span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">2</span> to <span class="number">4094</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"> port link-type access</span><br><span class="line"> port <span class="keyword">default</span> vlan <span class="number">10</span></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lsw3</span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">2</span> to <span class="number">4094</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"> port link-type access</span><br><span class="line"> port <span class="keyword">default</span> vlan <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h4 id="结果验证"><a href="#结果验证" class="headerlink" title="结果验证"></a>结果验证</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231213234315233.png" alt="image-20231213234315233"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231214001503541.png" alt="image-20231214001503541"></p>
<h3 id="配置不同网段用户通过VXLAN三层网关通信"><a href="#配置不同网段用户通过VXLAN三层网关通信" class="headerlink" title="配置不同网段用户通过VXLAN三层网关通信"></a>配置不同网段用户通过VXLAN三层网关通信</h3><h4 id="拓扑图-1"><a href="#拓扑图-1" class="headerlink" title="拓扑图"></a><strong>拓扑图</strong></h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231214013253705.png" alt="image-20231214013253705"></p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><ol>
<li>分别在ce1、ce2和ce3上配置ospf路由协议，保证网络三层互通。</li>
<li>分别在ce1和ce3上配置业务接入点实现区分业务流量。</li>
<li>分别在ce1、ce2和ce3上配置VXLAN隧道转发业务流量。</li>
<li><strong>在ce2上配置VXLAN三层网关，实现不同网段用户通过VXLAN三层网关互</strong></li>
</ol>
<p><strong><u>和同网段实验的区别就在于中间设备进行了配置：分别和leaf建立隧道并且设立了三层网关bdif</u></strong></p>
<h4 id="实验配置-15"><a href="#实验配置-15" class="headerlink" title="实验配置"></a>实验配置</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ce1</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">sysname Device1</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">bridge-domain 10</span></span><br><span class="line"> vxlan vni <span class="number">5010</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet1/0/1</span></span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet1/0/2</span></span><br><span class="line"> undo shutdown</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet1/0/2.1 mode l2</span></span><br><span class="line"> encapsulation dot1q vid <span class="number">10</span></span><br><span class="line"> rewrite pop single</span><br><span class="line"> bridge-domain <span class="number">10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface LoopBack1</span></span><br><span class="line"> ip address <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Nve1</span></span><br><span class="line"> source <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line"> vni <span class="number">5010</span> head-end peer-<span class="built_in">list</span> <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">ospf 1</span></span><br><span class="line"> area <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">return</span></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">ce2</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">sysname Device2</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">bridge-domain 10</span></span><br><span class="line"> vxlan vni <span class="number">5010</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">bridge-domain 20</span></span><br><span class="line"> vxlan vni <span class="number">5020</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Vbdif10</span></span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.10</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Vbdif20</span></span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.20</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet1/0/1</span></span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface GigabitEthernet1/0/2</span></span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface LoopBack1</span></span><br><span class="line"> ip address <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">interface Nve1</span></span><br><span class="line"> source <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span></span><br><span class="line"> vni <span class="number">5010</span> head-end peer-<span class="built_in">list</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line"> vni <span class="number">5020</span> head-end peer-<span class="built_in">list</span> <span class="number">4.4</span><span class="number">.4</span><span class="number">.4</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">ospf 1</span></span><br><span class="line"> area <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  network <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">  network <span class="number">192.168</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">return</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ce3</span><br><span class="line">#</span><br><span class="line">sysname Device3</span><br><span class="line">#</span><br><span class="line">bridge-domain 20</span><br><span class="line"> vxlan vni 5020</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/1</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address 192.168.2.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/2</span><br><span class="line"> undo shutdown</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/2.1 mode l2</span><br><span class="line"> encapsulation dot1q vid 20</span><br><span class="line"> rewrite pop single</span><br><span class="line"> bridge-domain 20</span><br><span class="line">#</span><br><span class="line">interface LoopBack1</span><br><span class="line"> ip address 4.4.4.4 255.255.255.255</span><br><span class="line">#</span><br><span class="line">interface Nve1</span><br><span class="line"> source 4.4.4.4</span><br><span class="line"> vni 5020 head-end peer-list 3.3.3.3</span><br><span class="line">#</span><br><span class="line">ospf 1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 4.4.4.4 0.0.0.0</span><br><span class="line">  network 10.2.1.0 0.0.0.255</span><br><span class="line">  network 192.168.2.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lsw2</span><br><span class="line">    vlan <span class="number">10</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">2</span> to <span class="number">4094</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"> port link-type access</span><br><span class="line"> port <span class="keyword">default</span> vlan <span class="number">10</span></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lsw3</span><br><span class="line">    vlan <span class="number">20</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan <span class="number">2</span> to <span class="number">4094</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"> port link-type access</span><br><span class="line"> port <span class="keyword">default</span> vlan <span class="number">20</span></span><br></pre></td></tr></table></figure>



<h4 id="结果检验"><a href="#结果检验" class="headerlink" title="结果检验"></a>结果检验</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231214012446954.png" alt="image-20231214012446954"></p>
<h1 id="数据通信11"><a href="#数据通信11" class="headerlink" title="数据通信11"></a>数据通信11</h1><p>要学会避责，成为甩锅大神</p>
<h2 id="网络准入控制NAC"><a href="#网络准入控制NAC" class="headerlink" title="网络准入控制NAC"></a>网络准入控制NAC</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p>NAC（Network Admission Control）称为网络接入控制，是一种“端到端”的安全结构，包括<strong>802.1x认证</strong>、<strong>MAC认证</strong>（不建议使用）与<strong>Portal</strong>认证。</p>
<p>NAC安全构架包括三个关键组件：NAC终端、网络准入设备和准入服务器。</p>
<p><strong>基本原理</strong></p>
<ol>
<li>终端和网络准入设备交换报文，准入设备获取身份认证信息</li>
<li>准入设备将认证信息发送给服务器进行对比认证</li>
<li>查看合不合法，发送认证结果和策略</li>
<li>准入设备再转发给终端</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231217095059072.png" alt="image-20231217095059072"></p>
<h3 id="802-1x认证"><a href="#802-1x认证" class="headerlink" title="802.1x认证"></a>802.1x认证</h3><p>前提：搭建acs服务器，丢个iso镜像进模拟器，一路下一步（硬盘给80个g，进入之后要做一系列预配置）</p>
<ol>
<li>终端发送认证请求给接入设备(EAPOL-Start)</li>
<li>接入设备询问终端的用户名(EAP-Request&#x2F;Identity)</li>
<li>响应询问请求，回复准入设备身份信息</li>
<li>接入设备转发终端的信息给服务器（EAP封装在RADIUS报文中）</li>
<li>RADIUS服务器收到设备端转发的用户名信息后，将该信息与数据库中的用户名列表中对比，找到该用户名对应的密码信息，用<strong>随机生成的一个MD5 Challenge对密码进行加密处理</strong>，同时将此MD5 Challenge通过RADIUS Access-Challenge报文发送给设备端。</li>
<li>接入设备转发给终端MD5 challenge</li>
<li>终端又将这个报文对密码加密在发回去一个EAP-Response&#x2F;MD5 Challenge报文</li>
<li>接入设备封装后再转发</li>
<li>RADIUS服务器将收到的已加密的密码信息和本地经过加密运算后的密码信息进行对比，如果相同，则认为该用户为合法用户，并向设备端发送认证<strong>通过报文（RADIUS Access-Accept）。</strong>（双加密认证）</li>
<li>接入设备收到通过报文后打开端口允许通信</li>
<li>之后会有类似于ospf的邻居维持的过程：设备端会通过向客户端<strong>定期发送握手报文</strong>的方法，对用户的在线情况进行监测，若设备端发送的<strong>两次握手请求报文都未得到客户端应答，设备端就会让用户下线</strong>，防止用户因为异常原因下线而设备无法感知。</li>
<li>客户端可以发送EAPOL-Logoff帧给设备端，主动要求下线，设备端把端口状态从授权状态改变成未授权状态，并向客户端发送EAP-Failure报文。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/fig_dc_fd_nac_000403.png" alt="img"></p>
<p>实验爆炸了，acs服务器玩不了</p>
<h3 id="实验配置-16"><a href="#实验配置-16" class="headerlink" title="实验配置"></a>实验配置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231222003055211.png" alt="image-20231222003055211"></p>
<h2 id="pppoe"><a href="#pppoe" class="headerlink" title="pppoe"></a>pppoe</h2><h3 id="概述-7"><a href="#概述-7" class="headerlink" title="概述"></a>概述</h3><p>ppp就是之前学的点对点通信，有两种认证方式，后面的oabcde就是封装在什么协议上，比如oe就是在以太网进行的ppp</p>
<h3 id="实验配置-17"><a href="#实验配置-17" class="headerlink" title="实验配置"></a>实验配置</h3><ol>
<li>配置R1为pppoe服务端</li>
<li>在R1上创建认证用户（账号：02365308051密码:992713,账号一般是手机号，密码一般是身份证后六位）</li>
<li>配置R2为pppoe客户端</li>
</ol>
<p>关键点：服务器端口为virtual-template客户端为dialer口</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">一、預配置，配置路由器接口</span><br><span class="line">r1：<span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">ip ad <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">r2：<span class="type">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">ip ad <span class="number">192.168</span><span class="number">.77</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">    </span><br><span class="line">二、AR1上配置pppoe service</span><br><span class="line">a，配置ip地址池</span><br><span class="line">    ip pool ben</span><br><span class="line">    net <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> mask <span class="number">24</span></span><br><span class="line">b，配置认证用户</span><br><span class="line">    aaa</span><br><span class="line">    local-user <span class="number">02365308051</span> password ciper <span class="number">992713</span></span><br><span class="line">    local-user <span class="number">02365308051</span> service-type ppp</span><br><span class="line">c、创建虚拟vt接口</span><br><span class="line">    <span class="type">int</span> virtual-template <span class="number">1</span></span><br><span class="line">    ppp authentication-mode pap</span><br><span class="line">    ip ad <span class="number">10.1</span><span class="number">.2</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">    remote add pool ben</span><br><span class="line">d，关联物理接口</span><br><span class="line">    <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">    pppoe-sever bind virtual-template <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">三、AR2上配置pppoe client</span><br><span class="line">a，创建虚拟接口dialer</span><br><span class="line">    <span class="type">int</span> dialer <span class="number">2</span></span><br><span class="line">link-protocol ppp<span class="comment">//配置链路为ppp</span></span><br><span class="line">ppp ipcp <span class="keyword">default</span>-route<span class="comment">//通过ipcp自动获取默认路由</span></span><br><span class="line">ppp pap  local-user <span class="number">02365308051</span> password ciper <span class="number">992713</span><span class="comment">//配置ppp用户名密码</span></span><br><span class="line">ppp chap user <span class="number">02365308051</span> 	<span class="comment">//配置chap用户名密码</span></span><br><span class="line">ppp chap password cipher <span class="number">992713</span><span class="comment">//配置chap用户名密码</span></span><br><span class="line">ip ad ppp-negotiate<span class="comment">//地址为自动协商</span></span><br><span class="line">dialer user <span class="number">02365308051</span><span class="comment">//配置为共享拨号中心</span></span><br><span class="line">dialer bundle <span class="number">2</span><span class="comment">//配置拨号捆绑接口为2</span></span><br><span class="line">    </span><br><span class="line">四、配置nat地址转换（easy ip）</span><br><span class="line">a,配置acl</span><br><span class="line">acl number <span class="number">2000</span></span><br><span class="line">rule permit </span><br><span class="line">b，配置easy nat</span><br><span class="line"><span class="type">int</span> dialer <span class="number">1</span><span class="comment">//三层通信是进行在这个虚拟接口上，物理接口变成了二层通信</span></span><br><span class="line">nat outbound <span class="number">2000</span></span><br></pre></td></tr></table></figure>



<h2 id="路由堆叠"><a href="#路由堆叠" class="headerlink" title="路由堆叠"></a>路由堆叠</h2><h3 id="堆叠的优点"><a href="#堆叠的优点" class="headerlink" title="堆叠的优点"></a>堆叠的优点</h3><ul>
<li>提高可靠性（一个坏了还有另外一个）</li>
<li>扩展端口数量（增加接入用户）</li>
<li>简化组网（逻辑上变成一个路由器，可以避免stp生成树的问题）</li>
<li>长距离堆叠（？）</li>
</ul>
<h3 id="成员交换机"><a href="#成员交换机" class="headerlink" title="成员交换机"></a>成员交换机</h3><ul>
<li><p>主交换机（<strong>Master</strong>）</p>
<p>主交换机负责管理整个堆叠。堆叠系统中只有一台主交换机。</p>
</li>
<li><p>备交换机（<strong>Standby</strong>）</p>
<p>备交换机是主交换机的备份交换机。堆叠系统中只有一台备交换机。当主交换机故障时，备交换机会接替原主交换机的所有业务。</p>
</li>
<li><p>从交换机（<strong>Slave</strong>）</p>
<p>从交换机用于业务转发，堆叠系统中可以有多台从交换机。从交换机数量越多，堆叠系统的转发带宽越大。</p>
</li>
</ul>
<h3 id="堆叠ID"><a href="#堆叠ID" class="headerlink" title="堆叠ID"></a>堆叠ID</h3><p>堆叠ID用来标识堆叠成员交换机，是成员交换机的<strong>槽位号</strong>。每个堆叠成员交换机在堆叠系统中具<strong>有唯一的堆叠ID。</strong></p>
<h3 id="堆叠优先级"><a href="#堆叠优先级" class="headerlink" title="堆叠优先级"></a>堆叠优先级</h3><p>堆叠优先级是成员交换机的一个属性<strong>，主要用于角色选举过程中确定成员交换机的角色</strong>，优先级值越大表示优先级越高<strong>，优先级越高当选为主交换机的可能性越大</strong></p>
<h3 id="实验配置-18"><a href="#实验配置-18" class="headerlink" title="实验配置"></a>实验配置</h3><h4 id="拓扑图-2"><a href="#拓扑图-2" class="headerlink" title="拓扑图"></a>拓扑图</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/v2-39cfb4594def153284ad964e72ccaea2_1440w.webp" alt="img"></p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如拓扑图所示，完成2台SR8800路由器的IRF堆叠配置</span></span><br><span class="line"></span><br><span class="line">SR8808<span class="number">-01</span>路由器IRF配置：</span><br><span class="line"></span><br><span class="line">步骤<span class="number">1</span>：将运行模式由独立运行模式切换为IRF模式</span><br><span class="line"></span><br><span class="line">[H3C]chassis convert mode irf <span class="comment">//将运行模式由独立运行模式切换为IRF模式</span></span><br><span class="line"></span><br><span class="line">步骤<span class="number">2</span>：配置IRF</span><br><span class="line"></span><br><span class="line">[H3C]irf member <span class="number">1</span> priority <span class="number">20</span> <span class="comment">//配置成员编号及优先级</span></span><br><span class="line"></span><br><span class="line">[H3C]irf member <span class="number">1</span> description SR8808<span class="number">-01</span> <span class="comment">//配置成员编号及成员描述</span></span><br><span class="line"></span><br><span class="line">[H3C]irf domain <span class="number">100</span> <span class="comment">//配置域编号（2台IRF成员设备必须属于同一个域否则堆叠没法形成IRF关系）</span></span><br><span class="line"> </span><br><span class="line">步骤<span class="number">3</span>：将用于IRF堆叠的的成员端口切为二层模式，并shutdown，并关闭stp(可选）</span><br><span class="line">[H3C-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>]port link-mode bridge</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>]shutdown</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>]undo stp enable</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]port link-mode bridge</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]shutdown</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]undo stp enable</span><br><span class="line"></span><br><span class="line">步骤<span class="number">4</span>：配置irf-port</span><br><span class="line"></span><br><span class="line">irf-port <span class="number">1</span>/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">port group interface GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span> <span class="comment">//添加用于IRF堆叠的成员端口</span></span><br><span class="line"></span><br><span class="line">port group interface GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"></span><br><span class="line">步骤<span class="number">5</span>：开启用于IRF堆叠的成员端口</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>]undo shutdown</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]undo shutdown</span><br><span class="line"></span><br><span class="line">步骤<span class="number">5</span>：保存配置，并激活irf-port配置</span><br><span class="line"></span><br><span class="line">&lt;H3C&gt;Save</span><br><span class="line"></span><br><span class="line">[H3C]irf-port-configuration active <span class="comment">//激活irf-port配置</span></span><br><span class="line"></span><br><span class="line">SR8808<span class="number">-02</span>路由器IRF配置：</span><br><span class="line"></span><br><span class="line">步骤<span class="number">1</span>：将运行模式由独立运行模式切换为IRF模式</span><br><span class="line"></span><br><span class="line">[H3C]chassis convert mode irf <span class="comment">//将运行模式由独立运行模式切换为IRF模式</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">步骤<span class="number">2</span>：将SR8808<span class="number">-02</span>设备的成员编号修改为<span class="number">2</span>（默认为<span class="number">1</span>），然后重启</span><br><span class="line"></span><br><span class="line">[H3C]irf member <span class="number">1</span> renumber <span class="number">2</span></span><br><span class="line"></span><br><span class="line">&lt;H3C&gt;reboot</span><br><span class="line"></span><br><span class="line">步骤<span class="number">3</span>：配置IRF</span><br><span class="line"></span><br><span class="line">[H3C]irf member <span class="number">2</span> priority <span class="number">10</span> <span class="comment">//配置成员编号及优先级</span></span><br><span class="line"></span><br><span class="line">[H3C]irf member <span class="number">2</span> description SR8808<span class="number">-02</span> <span class="comment">//配置成员编号及成员描述</span></span><br><span class="line"></span><br><span class="line">[H3C]irf domain <span class="number">100</span> <span class="comment">//配置域编号（2台IRF成员设备必须属于同一个域否则堆叠没法形成IRF关系）</span></span><br><span class="line"></span><br><span class="line">步骤<span class="number">4</span>：将用于IRF堆叠的的成员端口切为二层模式，并shutdown</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet2/<span class="number">0</span>/<span class="number">0</span>]port link-mode bridge</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet2/<span class="number">0</span>/<span class="number">0</span>]shutdown</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet2/<span class="number">0</span>/<span class="number">0</span>]undo stp enable</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet2/<span class="number">0</span>/<span class="number">1</span>]port link-mode bridge</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet2/<span class="number">0</span>/<span class="number">1</span>]shutdown</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet2/<span class="number">0</span>/<span class="number">1</span>]undo stp enable</span><br><span class="line"></span><br><span class="line">步骤<span class="number">5</span>：配置irf-port</span><br><span class="line"></span><br><span class="line">irf-port <span class="number">2</span>/<span class="number">1</span></span><br><span class="line"></span><br><span class="line">port group interface GigabitEthernet2/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"></span><br><span class="line">port group interface GigabitEthernet2/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"></span><br><span class="line">步骤<span class="number">6</span>：开启用于IRF堆叠的成员端口</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet2/<span class="number">0</span>/<span class="number">0</span>]undo shutdown</span><br><span class="line"></span><br><span class="line">[H3C-GigabitEthernet2/<span class="number">0</span>/<span class="number">1</span>]undo shutdown</span><br><span class="line"></span><br><span class="line">步骤<span class="number">7</span>：保存、连接IRF堆叠线缆</span><br><span class="line"></span><br><span class="line">&lt;H3C&gt;Save</span><br><span class="line"></span><br><span class="line">连接<span class="number">2</span>台路由器之间的IRF堆叠线缆</span><br><span class="line"></span><br><span class="line">步骤<span class="number">8</span>：并激活irf-port配置，此时<span class="number">2</span>台路由器会相互发送IRF协议报文(携带成员编号、优先级、域编号），优先级大的成为Master，优先级小的称为Slave(并自动重启)，然后形成IRF堆叠</span><br><span class="line"></span><br><span class="line">[H3C]irf-port-configuration active <span class="comment">//激活irf-port配置</span></span><br></pre></td></tr></table></figure>

<h1 id="数据通信12"><a href="#数据通信12" class="headerlink" title="数据通信12"></a>数据通信12</h1><p>&#x2F;&#x2F;寒假回来第一次上课</p>
<p>[TOC]</p>
<h2 id="信息安全"><a href="#信息安全" class="headerlink" title="信息安全"></a>信息安全</h2><p><strong>目标：</strong></p>
<ul>
<li><p>完整性</p>
</li>
<li><p>可用性</p>
</li>
<li><p>保密性</p>
</li>
</ul>
<p> <strong>攻击类别：</strong></p>
<ul>
<li>ddos</li>
<li>勒索攻击</li>
<li>dns</li>
<li>sql注入</li>
<li>dns隧道</li>
</ul>
<h2 id="防火墙web安装"><a href="#防火墙web安装" class="headerlink" title="防火墙web安装"></a>防火墙web安装</h2><ol>
<li>打开pnet，按如图连接拓扑图</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240305110539550.png" alt="image-20240305110539550"></p>
<ol start="2">
<li>mgmt是管理员端口，进入该端口进行配置</li>
<li>配置IP（ip add 192.168.32.132  和模拟器在同一个网段）、打开service服务（service-manage all permit）</li>
<li>接着在浏览器输入地址进入web界面（192.168.32.132：8443    部分浏览器由于版本过高进入不了，使用火狐浏览器并且修改tls解决）</li>
</ol>
<h2 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h2><h3 id="安全区域"><a href="#安全区域" class="headerlink" title="安全区域"></a>安全区域</h3><p>是一个或者多个接口的集合，是防火墙区别于路由器的主要特性（有点像ospf域）</p>
<p>DMZ–缓冲区，可以访问untrust区，不可以访问trust区，一般是服务器区</p>
<p>trust区–办公设备</p>
<p>untrust–外网</p>
<h3 id="防火墙策略"><a href="#防火墙策略" class="headerlink" title="防火墙策略"></a>防火墙策略</h3><p>防火墙必备检测命令：display firewall session table verbose source inside x.x.x.x</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240302152031459.png" alt="image-20240302152031459"></p>
<p>多条策略被同一动作匹配按顺序使用</p>
<h3 id="状态检测"><a href="#状态检测" class="headerlink" title="状态检测"></a>状态检测</h3><ul>
<li><p>针对数据的首包</p>
</li>
<li><p>如果是一个首包，并且安全策略为允许的话，就会为该流量建立一个会话表，该流量其他的数据包就可以根据会话表而不是安全策略转发了。</p>
</li>
</ul>
<p>例如，如果要配置允许Trust区域PING Untrust区域。则在防火墙策略配置的时候，只需要配置Trust区域到Untrust区域的ICMP协议为允许即可，而不需要考虑ICMP Reply报文需要从Untrust区域发到Trust区域。</p>
<p>在状态检测机制开启状态下，只有首包通过设备才能建立会话表项，后续包直接匹配会话表项进行转发。在状态检测机制<strong>关闭状态下，<em>即使首包没有经过防火墙</em></strong>，后续包<strong>只需要通过防火墙也可以生成会话表项。</strong></p>
<p>关闭状态检测命令：undo firewall session link-state check</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/20190314110851442.png" alt="在这里插入图片描述"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TCP: SYN ---------首包</span><br><span class="line"> SYN+ACK</span><br><span class="line"> ACK</span><br><span class="line"></span><br><span class="line">ICMP echo-request----首包</span><br><span class="line"> echo-reply</span><br><span class="line"></span><br><span class="line">UDP没有首包概念</span><br></pre></td></tr></table></figure>



<h3 id="会话机制"><a href="#会话机制" class="headerlink" title="会话机制"></a>会话机制</h3><p><strong>会话表的十三项参数</strong></p>
<ul>
<li><p>协议—指明会话的协议</p>
</li>
<li><p>VPN—在虚拟防火墙中使用</p>
</li>
<li><p>ID—标志唯一的会话</p>
</li>
<li><p>ZONE（区域）—指明流量的区域走向。</p>
</li>
<li><p>TTL—会话的老化时间。</p>
</li>
<li><p>Left—会话剩余时间</p>
</li>
<li><p>output-interface—出接口</p>
</li>
<li><p>nextHop—下一跳</p>
</li>
<li><p>MAC—mac地址,</p>
</li>
<li><p>MAC地址为全0的情况：</p>
</li>
<li><p>反向流量统计</p>
</li>
<li><p>正向流量统计</p>
</li>
<li><p>五元组—<strong>源地址</strong>：<strong>源端口</strong>–&gt;<strong>目的地址</strong>：<strong>目的端口</strong>+<strong>4层通信协议</strong></p>
</li>
<li><p>PolicyName—匹配的策略名称</p>
</li>
</ul>
<p>栗子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[FW1]<span class="comment">//display firewall session table  ---------------查看会话表简要信息</span></span><br><span class="line"> Current Total Sessions : <span class="number">5</span></span><br><span class="line">  https  VPN:public --&gt; public <span class="number">192.168</span><span class="number">.0</span><span class="number">.100</span>:<span class="number">49363</span>--&gt;<span class="number">192.168</span><span class="number">.0</span><span class="number">.10</span>:<span class="number">8443</span></span><br><span class="line">  协议（https等）    虚拟防火墙有作用（vpn）         源地址：源端口 目标地址：目标端口</span><br><span class="line">  https  VPN:public --&gt; public <span class="number">192.168</span><span class="number">.0</span><span class="number">.100</span>:<span class="number">49350</span>--&gt;<span class="number">192.168</span><span class="number">.0</span><span class="number">.10</span>:<span class="number">8443</span></span><br><span class="line">  tcp  VPN:public --&gt; public <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span>:<span class="number">49395</span>--&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>:<span class="number">17889</span></span><br><span class="line">  ftp-data  VPN:public --&gt; public <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>:<span class="number">20</span>--&gt;<span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span>:<span class="number">49396</span></span><br><span class="line">  ftp  VPN:public --&gt; public <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span>:<span class="number">49393</span>+-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>:<span class="number">21</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><h4 id="双机热备实验"><a href="#双机热备实验" class="headerlink" title="双机热备实验"></a><strong>双机热备实验</strong></h4><h5 id="vrrp的特点"><a href="#vrrp的特点" class="headerlink" title="vrrp的特点"></a><strong>vrrp的特点</strong></h5><ul>
<li><p>默认优先级100-一样的情况下比较接口ip，IP大的是master</p>
</li>
<li><p>数据从master走</p>
</li>
<li><p>通过arp请求控制来让下层明白谁才是老大</p>
</li>
<li><p>一秒发hello包</p>
</li>
<li><p>三秒完成主备切换</p>
</li>
<li><p>上层线路可能会断开，需要进行检测</p>
</li>
</ul>
<h5 id="vrrp状态机"><a href="#vrrp状态机" class="headerlink" title="vrrp状态机"></a>vrrp状态机</h5><ul>
<li>initialize</li>
<li>backup</li>
<li>master</li>
</ul>
<h5 id="vrrp用于防火墙bug"><a href="#vrrp用于防火墙bug" class="headerlink" title="vrrp用于防火墙bug"></a><strong>vrrp用于防火墙bug</strong></h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240302210456607.png" alt="image-20240302210456607"></p>
<p>主要问题是由于两台防火墙<strong>的备份组角色不同</strong>导致出现线路故障而丢包（）</p>
<p>为了解决vrrp在防火墙配置中的bug，vrrp的升级版出现了—<strong>VGMP</strong></p>
<h5 id="VGMP特点"><a href="#VGMP特点" class="headerlink" title="VGMP特点"></a>VGMP特点</h5><ul>
<li>双机间增加线路心跳线用于检测对方是否正常工作，否则切换角色</li>
<li>主设备状态叫active，备份机叫standby</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240302211714218.png" alt="image-20240302211714218"></p>
<h5 id="VGMP状态机"><a href="#VGMP状态机" class="headerlink" title="VGMP状态机"></a>VGMP状态机</h5><ul>
<li>Initialise： 启用双机热备功能后，VGMP管理组的初始状态。</li>
<li><strong>Load Blance</strong>： 当防火墙本端的VGMP管理组与对端的VGMP管理组优先级相等时，两端的VGMP组都处于Load Blance状态。报文转发负载均衡。</li>
<li>Active： 当本端的VGMP管理组高于对端时，本端的VGMP组处于Active状态，负责报文的转发。</li>
<li>Standby： 当本端的VGMP管理组低于对端时，本端的VGMP组处于Standby状态，负责监听Active端的状态。</li>
</ul>
<h5 id="VGMP状态切换"><a href="#VGMP状态切换" class="headerlink" title="VGMP状态切换"></a>VGMP状态切换</h5><ul>
<li>接口故障导致优先级降低</li>
<li>心跳线故障（3s切换）</li>
<li>主机恢复</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240302190658065.png" alt="image-20240302190658065"></p>
<h6 id="切换原则"><a href="#切换原则" class="headerlink" title="切换原则"></a>切换原则</h6><ul>
<li>每个接口down，VGMP管理组优先级降低2。计算公式为：<strong>VGMP优先级&#x3D;VGMP初始优先级-2*接口宕的个数</strong></li>
<li>每台设备的VGMP管理组<strong>初始状态由用户指定</strong>（Active或Standby），且用户只能指定状态，<strong>不能指定VGMP组的具体的优先级</strong></li>
<li>③VGMP管理组的状态决定了该设备的主备状态，也决定了VGMP管理组成员（VRRP备份组成员或接口）的状态。（？）</li>
</ul>
<p>*实验下周</p>
<p><strong>拓扑图</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240305111446633.png" alt="image-20240305111446633"># 数据通信13</p>
<p>[TOC]</p>
<p>多模模块光纤会有可见光</p>
<h2 id="双机热备实验-1"><a href="#双机热备实验-1" class="headerlink" title="双机热备实验"></a>双机热备实验</h2><h3 id="拓扑图-3"><a href="#拓扑图-3" class="headerlink" title="拓扑图"></a>拓扑图</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240305111446633.png" alt="image-20240305111446633"></p>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>为了<strong>规避一台设备故障导致网络业务中断的风险</strong>，可以在网络节点处同时部署两台设备，形成双机热备组网。当其中一台设备出现故障时，业务流量能<strong>平滑地切换到备用设备上</strong>，保证业务不中断，使内外网用户交互的时候感知不到曾经出现过网络故障。</p>
<ul>
<li>主备备份</li>
<li>负载分担</li>
</ul>
<h3 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h3><p>一般两个路由器就是使用vrrp，但是用在防火墙上就会产生一些bug，上节课有说，故我们<strong>使用vgmp</strong></p>
<h3 id="VGMP状态机-1"><a href="#VGMP状态机-1" class="headerlink" title="VGMP状态机"></a>VGMP状态机</h3><ul>
<li>initialize：VGMP管理组处于未启用状态。</li>
<li>Active：本端VGMP管理组的优先级比对端的VGMP管理组优先级高。</li>
<li>Standby：本端VGMP管理组的优先级比对端的VGMP管理组优先级低</li>
</ul>
<p>（vrrp是initialize和backup，master）</p>
<h3 id="VGMP主从切换"><a href="#VGMP主从切换" class="headerlink" title="VGMP主从切换"></a>VGMP主从切换</h3><ul>
<li>每个接口down，VGMP管理组优先级降低2。计算公式为：<strong>VGMP优先级&#x3D;VGMP初始优先级-2*接口宕的个数</strong></li>
<li>每台设备的VGMP管理组<strong>初始状态由用户指定</strong>（Active或Standby），且用户只能指定状态，<strong>不能指定VGMP组的具体的优先级</strong></li>
<li>③VGMP管理组的状态决定了该设备的主备状态，也决定了VGMP管理组成员（VRRP备份组成员或接口）的状态。（？）</li>
</ul>
<h3 id="实验配置-19"><a href="#实验配置-19" class="headerlink" title="实验配置"></a>实验配置</h3><p><strong>步骤一：配置ip地址</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#FW1</span><br><span class="line">[FW1]<span class="type">int</span> g1/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[FW1-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>]ip address <span class="number">10.1</span><span class="number">.2</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[FW1]<span class="type">int</span> g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[FW1-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[FW1]firewall zone trust </span><br><span class="line">[FW1-zone-trust]add interface g1/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"></span><br><span class="line">[FW1]firewall zone untrust </span><br><span class="line">[FW1-zone-untrust]add interface g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#FW2</span><br><span class="line">[FW2]<span class="type">int</span> g1/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[FW2-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>]ip address <span class="number">10.1</span><span class="number">.2</span><span class="number">.2</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[FW2]<span class="type">int</span> g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[FW2-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[FW2]firewall zone  trust </span><br><span class="line">[FW2-zone-trust]add interface g1/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"></span><br><span class="line">[FW2]firewall zone untrust </span><br><span class="line">[FW2-zone-untrust]add interface g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>步骤二：配置区域策略</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#FW1</span><br><span class="line">[FW1]security-policy </span><br><span class="line"></span><br><span class="line">[FW1-policy-security]rule name T2U</span><br><span class="line"></span><br><span class="line">[FW1-policy-security-rule-T2U]source-zone trust </span><br><span class="line"></span><br><span class="line">[FW1-policy-security-rule-T2U]destination-zone untrust </span><br><span class="line"></span><br><span class="line">[FW1-policy-security-rule-T2U]action permit </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#FW2</span><br><span class="line">[FW2]security-policy </span><br><span class="line"></span><br><span class="line">[FW2-policy-security]rule name T2U</span><br><span class="line"></span><br><span class="line">[FW2-policy-security-rule-T2U]source-zone trust </span><br><span class="line"></span><br><span class="line">[FW2-policy-security-rule-T2U]destination-zone untrust </span><br><span class="line"></span><br><span class="line">[FW2-policy-security-rule-T2U]action permit</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>步骤三：配置vrrp</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#FW1</span><br><span class="line">[FW1]int g1/0/1</span><br><span class="line"></span><br><span class="line">[FW1-GigabitEthernet1/0/1]vrrp vrid 1 virtual-ip 10.1.1.254 active </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[FW1]int g1/0/0</span><br><span class="line"></span><br><span class="line">[FW1-GigabitEthernet1/0/0]vrrp vrid 1 virtual-ip 10.1.2.254 active </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#FW2</span><br><span class="line">[FW2]int g1/0/1</span><br><span class="line"></span><br><span class="line">[FW2-GigabitEthernet1/0/1]vrrp vrid 1 virtual-ip 10.1.1.254 standby </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[FW2]int g1/0/0</span><br><span class="line"></span><br><span class="line">[FW2-GigabitEthernet1/0/0]vrrp vrid 1 virtual-ip 10.1.2.254 standby</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>步骤四：配置hrp热备份</strong>!!!!</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ FW1]hrp enable</span><br><span class="line"></span><br><span class="line">HRP_ S [FW1]hrp interface g1/<span class="number">0</span>/<span class="number">2</span> remote <span class="number">10.1</span><span class="number">.3</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">[ FW2]hrp enable</span><br><span class="line"></span><br><span class="line">HRP_ S [FW2]hrp interface g1/<span class="number">0</span>/<span class="number">2</span> remote <span class="number">10.1</span><span class="number">.3</span><span class="number">.1</span>HRP_ M[ FW2]hrp standby-device</span><br><span class="line"></span><br><span class="line"><span class="comment">//感觉上就和那个ospf虚连接差不多</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="VPN"><a href="#VPN" class="headerlink" title="VPN"></a>VPN</h2><p>&#x2F;&#x2F;科学上网，请勿乱用</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p><strong>二层</strong></p>
<ul>
<li>l2tp</li>
<li>pptp(淘汰但简单)</li>
<li>mpls l2 vpn</li>
</ul>
<p><strong>三层</strong></p>
<ul>
<li>gre（重点简单）</li>
<li>ipsec（重点巅峰）</li>
<li>bgp&#x2F;mpls vpn</li>
</ul>
<h3 id="其他vpn"><a href="#其他vpn" class="headerlink" title="其他vpn"></a>其他vpn</h3><ul>
<li>ssl</li>
<li>l2f</li>
<li>dvpn</li>
<li>基于vlan的vpn</li>
<li>802.1qinq</li>
<li>xot</li>
</ul>
<h3 id="GRE（ip协议号47）"><a href="#GRE（ip协议号47）" class="headerlink" title="GRE（ip协议号47）"></a>GRE（ip协议号47）</h3><p><strong>虚拟的隧道（Tunnel接口）</strong></p>
<h4 id="定义-5"><a href="#定义-5" class="headerlink" title="定义"></a>定义</h4><p>通用路由封装协议（Generic Rrouting Encapsulation），他的作用是<strong>把一种协议的报文封装在另外一种协议的报文中</strong>的技术，是一种隧道技术（只要这样子做，都称为隧道技术）</p>
<h4 id="报文结构（加封装）"><a href="#报文结构（加封装）" class="headerlink" title="报文结构（加封装）"></a>报文结构（加封装）</h4><p>在原始封装的数据报文字段中<strong>加入新的IP头部</strong>，在<strong>新的IP报头和老的IP报头中间加一个协议</strong>，这就是GRE报头。 </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240309141300500.png" alt="image-20240309141300500"></p>
<p><strong>头部</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image7(421).png" alt="img"></p>
<p>把原本的IP报头当成货物，这个被称为<strong>乘客协议</strong>，GRE负责承载乘客协议的IP报文，<strong>GRE可以理解为车辆</strong>，然后由新的IP报头在公网进行传输，<strong>公网设备只会查看新的IP报头</strong>，然后进行转发。</p>
<h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><ul>
<li>支持多种协议</li>
<li>靠IP做为承载网络</li>
<li><strong>支持路由协议和IP组播</strong></li>
<li>配置简单</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>点对点隧道</li>
<li>静态配置隧道参数</li>
<li>部署复杂连接时代价大</li>
<li><strong>不安全</strong></li>
</ul>
<h3 id="传输过程"><a href="#传输过程" class="headerlink" title="传输过程"></a>传输过程</h3><ul>
<li>私网数据报文保留，加上GRE报头和新的IP报头（隧道源和隧道目标）。</li>
<li><strong>数据报文发送出去后，中途运营商的设备会根据外层的IP报头进行转发。</strong></li>
<li>目标设备收到数据报文后，进行<strong>解封装</strong>，<strong>看到GRE报文后</strong>，会继续解封装，然后在看到原先发送的数据报文，<strong>发现是私网包头，进行查找路由</strong>，发现有就进行转发，回包也是如此，这就完成通讯。</li>
</ul>
<p><strong><u>做GRE时严禁将公网进行ospf宣告</u></strong></p>
<h3 id="GRE隧道keeplive"><a href="#GRE隧道keeplive" class="headerlink" title="GRE隧道keeplive"></a>GRE隧道keeplive</h3><p>和ospf保持邻居关系、心跳线设置差不多，都是检测对方或者线路有无故障</p>
<h3 id="GRE实验配置"><a href="#GRE实验配置" class="headerlink" title="GRE实验配置"></a>GRE实验配置</h3><h4 id="拓扑图-4"><a href="#拓扑图-4" class="headerlink" title="拓扑图"></a>拓扑图</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/45599" alt="img"></p>
<h4 id="配置设备IP地址"><a href="#配置设备IP地址" class="headerlink" title="配置设备IP地址"></a>配置设备IP地址</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">FW1]inter g1/<span class="number">0</span>/<span class="number">2</span> </span><br><span class="line">[FW1-GigabitEthernet1/<span class="number">0</span>/<span class="number">2</span>]ip add <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line"><span class="number">24</span> </span><br><span class="line">[FW1-GigabitEthernet1/<span class="number">0</span>/<span class="number">2</span>]inter g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> [FW1-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]ip add <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line"><span class="number">24</span> </span><br><span class="line">[Huawei]inter g0/<span class="number">0</span>/<span class="number">0</span> </span><br><span class="line">[Huawei-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]ip add </span><br><span class="line"><span class="number">13.1</span><span class="number">.1</span><span class="number">.3</span> <span class="number">24</span> </span><br><span class="line">[Huawei]inter g0/<span class="number">0</span>/<span class="number">1</span> </span><br><span class="line">[Huawei-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]ip add </span><br><span class="line"><span class="number">23.1</span><span class="number">.1</span><span class="number">.3</span> <span class="number">24</span></span><br><span class="line"><span class="comment">// [Huawei]int lo 0</span></span><br><span class="line"><span class="comment">//[Huawei-Loopback0]ip add 1.1.1.1 24</span></span><br><span class="line">[FW2]inter g1/<span class="number">0</span>/<span class="number">2</span> </span><br><span class="line">[FW2-GigabitEthernet1/<span class="number">0</span>/<span class="number">2</span>]ip add <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> </span><br><span class="line"><span class="number">24</span> </span><br><span class="line">[FW2]inter g1/<span class="number">0</span>/<span class="number">1</span> </span><br><span class="line">[FW2-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]ip add <span class="number">10.1</span><span class="number">.2</span><span class="number">.1</span> </span><br><span class="line"><span class="number">24</span></span><br></pre></td></tr></table></figure>



<h4 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#FW1</span></span><br><span class="line"> [<span class="meta">FW1</span>]firewall zone untrust </span><br><span class="line">[<span class="meta">FW1-zone-untrust</span>]<span class="keyword">add</span> <span class="keyword">interface</span> <span class="title">g1</span>/0/2 </span><br><span class="line">    </span><br><span class="line">[<span class="title">FW1</span>]<span class="title">firewall</span> <span class="title">zone</span> <span class="title">trust</span> </span><br><span class="line">[<span class="title">FW1</span>-<span class="title">zone</span>-<span class="title">trust</span>]<span class="title">add</span> <span class="title">interface</span> <span class="title">g1</span>/0/1 </span><br><span class="line">    </span><br><span class="line">#<span class="title">FW2</span></span><br><span class="line"> [<span class="title">FW2</span>]<span class="title">firewall</span> <span class="title">zone</span> <span class="title">untrust</span> </span><br><span class="line">[<span class="title">FW2</span>-<span class="title">zone</span>-<span class="title">untrust</span>]<span class="title">add</span> <span class="title">interface</span> <span class="title">g1</span>/0/2 </span><br><span class="line">    </span><br><span class="line">[<span class="title">FW2</span>]<span class="title">firewall</span> <span class="title">zone</span> <span class="title">trust</span> </span><br><span class="line">[<span class="title">FW2</span>-<span class="title">zone</span>-<span class="title">trust</span>]<span class="title">add</span> <span class="title">interface</span> <span class="title">g1</span>/0/1</span><br></pre></td></tr></table></figure>



<h4 id="配置OSPF"><a href="#配置OSPF" class="headerlink" title="配置OSPF"></a>配置OSPF</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//严禁将公网ip通过ospf进行宣告 </span></span><br><span class="line">[FW1]ospf <span class="number">1</span> </span><br><span class="line">[FW1-ospf<span class="number">-1</span>]area <span class="number">0</span></span><br><span class="line"> [FW1-ospf<span class="number">-1</span>-area<span class="number">-0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> </span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">    </span><br><span class="line"> [AR3]ospf <span class="number">1</span> </span><br><span class="line">[AR3-ospf<span class="number">-1</span>]area <span class="number">0</span> </span><br><span class="line">[AR3-ospf<span class="number">-1</span>-area<span class="number">-0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">13.1</span><span class="number">.1</span><span class="number">.0</span> </span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"> [AR3-ospf<span class="number">-1</span>-area<span class="number">-0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">23.1</span><span class="number">.1</span><span class="number">.0</span> </span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"> [AR3-ospf<span class="number">-1</span>-area<span class="number">-0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    </span><br><span class="line"> [FW2]ospf <span class="number">1</span> </span><br><span class="line">[FW2-ospf<span class="number">-1</span>]area <span class="number">0</span> </span><br><span class="line">[FW2-ospf<span class="number">-1</span>-area<span class="number">-0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> </span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br></pre></td></tr></table></figure>



<h4 id="配置NAT"><a href="#配置NAT" class="headerlink" title="配置NAT"></a>配置NAT</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//FW1 安全策略</span></span><br><span class="line">[FW1]security-policy </span><br><span class="line">[FW1-policy-security]rule name T2U</span><br><span class="line"> [FW1-policy-security-rule-T2U]source-zone </span><br><span class="line">trust </span><br><span class="line">[FW1-policy-security-rule-T2U]destination</span><br><span class="line">zone untrust </span><br><span class="line">[FW1-policy-security-rule-T2U]action permit</span><br><span class="line">    </span><br><span class="line"> <span class="comment">//FW1 配置NAT</span></span><br><span class="line"> [FW1]nat-policy </span><br><span class="line">[FW1-policy-nat]rule name all </span><br><span class="line">[FW1-policy-nat-rule-all] source-zone trust</span><br><span class="line"> [FW1-policy-nat-rule-all]egress-interface </span><br><span class="line">GigabitEthernet1/<span class="number">0</span>/<span class="number">2</span><span class="comment">//选择出接口</span></span><br><span class="line"> [FW1-policy-nat-rule-all]action source-nat </span><br><span class="line">easy-ip<span class="comment">//转换ip靠接口</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//FW2 流量策略</span></span><br><span class="line">[FW2]security-policy </span><br><span class="line">[FW2-policy-security]rule name T2U </span><br><span class="line">[FW2-policy-security-rule-T2U]source-zone </span><br><span class="line">trust </span><br><span class="line">[FW2-policy-security-rule-T2U]destination</span><br><span class="line">zone untrust </span><br><span class="line">[FW2-policy-security-rule-T2U]action permit</span><br><span class="line">    </span><br><span class="line"> <span class="comment">//FW2 配置NAT</span></span><br><span class="line"> [FW2]nat-policy </span><br><span class="line">[FW2-policy-nat]rule name all </span><br><span class="line">[FW2-policy-nat-rule-all]source-zone trust </span><br><span class="line">[FW2-policy-nat-rule-all]egress-interface </span><br><span class="line">GigabitEthernet1/<span class="number">0</span>/<span class="number">2</span> </span><br><span class="line">[FW2-policy-nat-rule-all]action source-nat </span><br><span class="line">easy-ip</span><br></pre></td></tr></table></figure>



<h4 id="配置GRE-VPN"><a href="#配置GRE-VPN" class="headerlink" title="配置GRE VPN"></a>配置GRE VPN</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FW1</span></span><br><span class="line"> [FW1]interface Tunnel <span class="number">0</span> </span><br><span class="line"><span class="comment">//[FW1-Tunnel0]tunnel-protocol gre </span></span><br><span class="line">[FW1-Tunnel0]source <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">[FW1-Tunnel0]destination <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> </span><br><span class="line">[FW1-Tunnel0]ip add <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">//FW2</span></span><br><span class="line"> [FW2]interface Tunnel <span class="number">0</span></span><br><span class="line"> [FW2-Tunnel0]tunnel-protocol gre </span><br><span class="line">[FW2-Tunnel0]source <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> </span><br><span class="line">[FW2-Tunnel0]destination <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">[FW2-Tunnel0]ip add <span class="number">12.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置虚拟接口所属区域</span></span><br><span class="line"><span class="comment">//FW1</span></span><br><span class="line"> [FW1]firewall zone untrust </span><br><span class="line">[FW1-zone-untrust]add interface Tunnel <span class="number">0</span></span><br><span class="line"> <span class="comment">//FW2</span></span><br><span class="line"> [FW2]firewall zone untrust </span><br><span class="line">[FW2-zone-untrust]add interface Tunnel <span class="number">0</span></span><br></pre></td></tr></table></figure>



<h4 id="配置VPN路由"><a href="#配置VPN路由" class="headerlink" title="配置VPN路由"></a>配置VPN路由</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FW1</span></span><br><span class="line"> [FW1]ip route-<span class="type">static</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> <span class="number">24</span> <span class="number">12.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"> <span class="comment">//FW2</span></span><br><span class="line"> [FW2]ip route-<span class="type">static</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">24</span> <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>



<h4 id="配置VPN接口的策略"><a href="#配置VPN接口的策略" class="headerlink" title="配置VPN接口的策略"></a>配置VPN接口的策略</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fw1（配置这个的目的是等下做策略要使用的地址）</span></span><br><span class="line"> [FW1]ip address-<span class="built_in">set</span> <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> type object </span><br><span class="line">[FW1-object-address-<span class="built_in">set</span><span class="number">-23.1</span><span class="number">.1</span><span class="number">.2</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> mask <span class="number">32</span></span><br><span class="line"> </span><br><span class="line"> [FW1]ip address-<span class="built_in">set</span> <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> type object </span><br><span class="line">[FW1-object-address-<span class="built_in">set</span><span class="number">-13.1</span><span class="number">.1</span><span class="number">.1</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> mask <span class="number">32</span></span><br><span class="line"> </span><br><span class="line"> [FW1]ip address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> type object </span><br><span class="line">[FW1-object-address-<span class="built_in">set</span><span class="number">-10.1</span><span class="number">.1</span><span class="number">.0</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> mask <span class="number">24</span></span><br><span class="line"></span><br><span class="line"> [FW1]ip address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> type object </span><br><span class="line">[FW1-object-address-<span class="built_in">set</span><span class="number">-10.1</span><span class="number">.2</span><span class="number">.0</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> mask <span class="number">24</span></span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> <span class="comment">// 配置策略</span></span><br><span class="line">[FW1]security-policy</span><br><span class="line"> [FW1-policy-security]rule name U2T</span><br><span class="line"> [FW1-policy-security-rule-U2T]  source-zone </span><br><span class="line">untrust</span><br><span class="line"> [FW1-policy-security-rule-U2T]  </span><br><span class="line">destination-zone trust</span><br><span class="line">     </span><br><span class="line"> [FW1-policy-security-rule-U2T]  source</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span></span><br><span class="line"> [FW1-policy-security-rule-U2T]  </span><br><span class="line">destination-address address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line"> [FW1-policy-security-rule-U2T]  action </span><br><span class="line">permit</span><br><span class="line">     </span><br><span class="line"> [FW1-policy-security-rule-U2T] rule name </span><br><span class="line">U2L</span><br><span class="line"> [FW1-policy-security-rule-U2L]  source-zone </span><br><span class="line">untrust</span><br><span class="line"> [FW1-policy-security-rule-U2L]  </span><br><span class="line">destination-zone local</span><br><span class="line">     </span><br><span class="line"> [FW1-policy-security-rule-U2L]  source</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"> [FW1-policy-security-rule-U2L]  </span><br><span class="line">destination-address address-<span class="built_in">set</span> <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> [FW1-policy-security-rule-U2L]  action </span><br><span class="line">permit</span><br><span class="line"> <span class="comment">//！！再添加Local to Untrust的策略！！</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">//fw2</span></span><br><span class="line"> [FW2]ip address-<span class="built_in">set</span> <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> type object </span><br><span class="line">[FW2-object-address-<span class="built_in">set</span><span class="number">-13.1</span><span class="number">.1</span><span class="number">.1</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> mask <span class="number">32</span></span><br><span class="line"> </span><br><span class="line"> [FW2]ip address-<span class="built_in">set</span>  <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> type object </span><br><span class="line">[FW2-object-address-<span class="built_in">set</span><span class="number">-23.1</span><span class="number">.1</span><span class="number">.2</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> mask <span class="number">32</span></span><br><span class="line"></span><br><span class="line"> [FW2]ip address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> type object </span><br><span class="line">[FW2-object-address-<span class="built_in">set</span><span class="number">-10.1</span><span class="number">.1</span><span class="number">.0</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> mask <span class="number">24</span></span><br><span class="line"> </span><br><span class="line"> [FW2]ip address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> type object </span><br><span class="line">[FW2-object-address-<span class="built_in">set</span><span class="number">-10.1</span><span class="number">.2</span><span class="number">.0</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> mask <span class="number">24</span></span><br><span class="line"><span class="comment">// 配置策略</span></span><br><span class="line">[FW2]security-policy </span><br><span class="line">[FW2-policy-security]rule name U2T</span><br><span class="line"> [FW2-policy-security-rule-U2T]source-zone </span><br><span class="line">untrust </span><br><span class="line">[FW2-policy-security-rule-U2T]destination</span><br><span class="line">zone trust </span><br><span class="line">     </span><br><span class="line">[FW2-policy-security-rule-U2T]source</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line"> [FW2-policy-security-rule-U2T]destination</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span></span><br><span class="line"> [FW2-policy-security-rule-U2T]action permit </span><br><span class="line">     </span><br><span class="line">[FW2-policy-security]rule name U2L</span><br><span class="line"> [FW2-policy-security-rule-U2L]source-zone </span><br><span class="line">untrust </span><br><span class="line">[FW2-policy-security-rule-U2L]destination</span><br><span class="line">zone local </span><br><span class="line">     </span><br><span class="line">[FW2-policy-security-rule-U2L]source</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> [FW2-policy-security-rule-U2L]destination</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"> [FW2-policy-security-rule-U2L]action permit </span><br><span class="line"><span class="comment">//！！再添加Local to Untrust的策略！！</span></span><br></pre></td></tr></table></figure>



<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><h5 id="pc互ping"><a href="#pc互ping" class="headerlink" title="pc互ping"></a>pc互ping</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240309181925871.png" alt="image-20240309181925871"></p>
<h5 id="虚接口互ping"><a href="#虚接口互ping" class="headerlink" title="虚接口互ping"></a>虚接口互ping</h5><p><strong>加上两条命令</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[FW1-Tunnel1]service-manage ping permit</span><br><span class="line"> [FW2-Tunnel1]service-manage ping permit</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240309182133724.png" alt="image-20240309182133724"></p>
<p>我的结果成功了，但是延迟普遍上了100ms，不知为何# 数据通信14</p>
<p>[TOC]</p>
<h2 id="IPsec"><a href="#IPsec" class="headerlink" title="IPsec"></a>IPsec</h2><p><strong>IPsec VPN最经典的应用场景为点到点建立IPsec隧道的场景</strong></p>
<ul>
<li>不能走组播</li>
<li>包含协议：</li>
<li>安全传输、防止监听</li>
<li>对等体加密密钥（非对称）</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316103753120.png" alt="image-20240316103753120"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316103836251.png" alt="image-20240316103836251"></p>
<h3 id="AH（别用）"><a href="#AH（别用）" class="headerlink" title="AH（别用）"></a>AH（别用）</h3><ul>
<li>AH头不做加密，只做验证，和NAT矛盾（AH会把NAT报错）</li>
<li>ESP才进行数据加密&#x2F;解密</li>
<li>AH用IP协议号51来标识</li>
</ul>
<h3 id="ESP"><a href="#ESP" class="headerlink" title="ESP"></a>ESP</h3><ul>
<li>数据<strong>完整性</strong>，数据**<u>机密性</u>**（HMAC–key？）都有涉猎，比AH好得多</li>
<li>ip协议号52</li>
<li>和ah不同，esp可以和ip中的nat协议共存，校验除ip的部分</li>
</ul>
<h3 id="协议封装模式"><a href="#协议封装模式" class="headerlink" title="协议封装模式"></a>协议封装模式</h3><ol>
<li>传输模式（不加上新的ip地址，将ipsec报文插入传输层协议和ip之间）</li>
<li>隧道模式（原来的ip报文保持，在头部再加上一个新IP报头“总部和总部互连”）</li>
</ol>
<h3 id="DH算法"><a href="#DH算法" class="headerlink" title="DH算法"></a>DH算法</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316111337845.png" alt="image-20240316111337845"></p>
<ul>
<li>a，b之间共享的p和g分别是17和3（dh-group一般非常大）</li>
<li>a，b之间选择自己的私钥，a拿15，b拿13</li>
<li>a计算公钥，3^15 mode p（17）&#x3D;6，发送给对方</li>
<li>b计算公钥，3^13 mode p（17）&#x3D;12，发送给对方</li>
<li>a共享密钥计算&#x3D;12^15 mod 17&#x3D;10</li>
<li>b共享密钥计算&#x3D;6^13 mod 17&#x3D;10</li>
</ul>
<h3 id="IKE协商"><a href="#IKE协商" class="headerlink" title="IKE协商"></a>IKE协商</h3><p>为什么要用IKE？为了将<strong>密钥通过自动协商</strong>产生（手动配浪费时间）</p>
<ul>
<li>通过地府赫尔曼算法进行密钥协商</li>
<li>dh-group中放的就是p，g</li>
</ul>
<h2 id="安全要素"><a href="#安全要素" class="headerlink" title="安全要素"></a>安全要素</h2><ul>
<li>机密性</li>
<li>完整性</li>
<li>身份验证</li>
<li>不可抵赖</li>
</ul>
<h2 id="加解密"><a href="#加解密" class="headerlink" title="加解密"></a>加解密</h2><h3 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h3><p>例子：des加密&#x2F;解密</p>
<p>密文加密钥（但是密钥要怎么传送给对方？）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316091706463.png" alt="image-20240316091706463"></p>
<h3 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h3><p>例子：RSA，分公钥和私钥</p>
<p>私钥加内容进行加密，只有一个公钥也可以解密出信息</p>
<p>公钥加密私钥解密，私钥加密公钥解密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316092359455.png" alt="image-20240316092359455"></p>
<p>缺点：只能用公钥加密，而且速度太慢了</p>
<h3 id="混合加密"><a href="#混合加密" class="headerlink" title="混合加密"></a>混合加密</h3><p>des加rsa，将des的密钥进行rsa加密</p>
<h2 id="完整性校验"><a href="#完整性校验" class="headerlink" title="完整性校验"></a>完整性校验</h2><p>ah</p>
<p>关键元素：哈希值</p>
<h3 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h3><p>将收到的文件和哈希值进行校验</p>
<h3 id="HMAC"><a href="#HMAC" class="headerlink" title="HMAC"></a>HMAC</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316094929671.png" alt="image-20240316094929671"></p>
<p>收到信息时再加入一定的数据再计算哈希值</p>
<h2 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316095953073.png" alt="image-20240316095953073"></p>
<p>可以类比于赛博身份证</p>
<p>第三方用私钥给a的信息进行加密，然后a给b发信息带上第三方的密文，那么b就可以用第三方的公钥验证a到底是不是a</p>
<p>display ike sa</p>
<h2 id="L2TP"><a href="#L2TP" class="headerlink" title="L2TP"></a>L2TP</h2><p>二层VPN，真正使用的是ppp协议，ppp协议外添加l2tp协议再添加ip报头（类似于pppoe协议，只是l2tp变成了pppoe）</p>
<h2 id="ipsec配置"><a href="#ipsec配置" class="headerlink" title="ipsec配置"></a>ipsec配置</h2><h3 id="网络拓扑图"><a href="#网络拓扑图" class="headerlink" title="网络拓扑图"></a>网络拓扑图</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240327174207628.png" alt="image-20240327174207628"></p>
<h3 id="配置过程"><a href="#配置过程" class="headerlink" title="配置过程"></a>配置过程</h3><p><strong>二、配置过程</strong></p>
<p><strong>在FW1上配置IPSec策略，并在接口上应用此IPSec策略。</strong></p>
<p>a、定义被保护的数据流。配置高级ACL 3000，允许10.1.1.0&#x2F;24网段访问10.1.2.0&#x2F;24网段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] acl 3000</span><br><span class="line">[FW_A-acl-adv-3000] rule 5 permit ip source 10.1.1.0 0.0.0.255 destination 10.1.2.0 0.0.0.255</span><br><span class="line">[FW_A-acl-adv-3000] quit</span><br></pre></td></tr></table></figure>

<p>b、配置IPSec安全提议，缺省参数可不配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ipsec proposal tran1</span><br><span class="line">[FW_A-ipsec-proposal-tran1] esp authentication-algorithm sha2-256</span><br><span class="line">[FW_A-ipsec-proposal-tran1] esp encryption-algorithm aes-256</span><br><span class="line">[FW_A-ipsec-proposal-tran1] quit</span><br></pre></td></tr></table></figure>

<p>c、配置IKE安全提议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ike proposal 10</span><br><span class="line">[FW_A-ike-proposal-10] authentication-method pre-share</span><br><span class="line">[FW_A-ike-proposal-10] encryption-algorithm aes-256</span><br><span class="line">[FW_A-ike-proposal-10] authentication-algorithm sha2-256</span><br><span class="line">[FW_A-ike-proposal-10] dh group14</span><br><span class="line">[FW_A-ike-proposal-10] quit</span><br></pre></td></tr></table></figure>

<p>d、配置IKE peer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ike peer b</span><br><span class="line">[FW_A-ike-peer-b] ike-proposal 10</span><br><span class="line">[FW_A-ike-peer-b] remote-address 23.1.1.2</span><br><span class="line">[FW_A-ike-peer-b] pre-shared-key Test!1234</span><br><span class="line">[FW_A-ike-peer-b] quit</span><br></pre></td></tr></table></figure>

<p>e、配置IPSec策略</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ipsec policy map1 10 isakmp</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] security acl 3000</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] proposal tran1</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] ike-peer b</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] quit</span><br></pre></td></tr></table></figure>

<p>f、在接口GE1&#x2F;0&#x2F;1上应用IPSec策略组map1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] interface gigabitethernet 1/0/1</span><br><span class="line">[FW_A-GigabitEthernet1/0/1] ipsec policy map1</span><br><span class="line">[FW_A-GigabitEthernet1/0/1] quit</span><br></pre></td></tr></table></figure>

<p><strong>在FW_B上配置IPSec策略，并在接口上应用此IPSec策略。</strong></p>
<p>a、配置高级ACL 3000，允许10.1.2.0&#x2F;24网段访问10.1.1.0&#x2F;24网段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] acl 3000</span><br><span class="line">[FW_B-acl-adv-3000] rule 5 permit ip source 10.1.2.0 0.0.0.255 destination 10.1.1.0 0.0.0.255</span><br><span class="line">[FW_B-acl-adv-3000] quit</span><br></pre></td></tr></table></figure>

<p>b、配置IPSec安全提议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ipsec proposal tran1</span><br><span class="line">[FW_B-ipsec-proposal-tran1] esp authentication-algorithm sha2-256</span><br><span class="line">[FW_B-ipsec-proposal-tran1] esp encryption-algorithm aes-256</span><br><span class="line">[FW_B-ipsec-proposal-tran1] quit</span><br></pre></td></tr></table></figure>

<p>c、配置IKE安全提议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ike proposal 10</span><br><span class="line">[FW_B-ike-proposal-10] authentication-method pre-share</span><br><span class="line">[FW_B-ike-proposal-10] prf hmac-sha2-256</span><br><span class="line">[FW_B-ike-proposal-10] encryption-algorithm aes-256</span><br><span class="line">[FW_B-ike-proposal-10] dh group14</span><br><span class="line">[FW_B-ike-proposal-10] integrity-algorithm hmac-sha2-256 </span><br><span class="line">[FW_B-ike-proposal-10] quit</span><br></pre></td></tr></table></figure>

<p>d、配置IKE peer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ike peer a </span><br><span class="line">[FW_B-ike-peer-a] ike-proposal 10 </span><br><span class="line">[FW_B-ike-peer-a] remote-address 1.1.3.1 </span><br><span class="line">[FW_B-ike-peer-a] pre-shared-key Test!1234 </span><br><span class="line">[FW_B-ike-peer-a] quit</span><br></pre></td></tr></table></figure>

<p>e、配置IPSec策略</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ipsec policy map1 10 isakmp </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] security acl 3000 </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] proposal tran1 </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] ike-peer a </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] quit</span><br></pre></td></tr></table></figure>

<p>f、在接口GE1&#x2F;0&#x2F;1上应用IPSec策略组map1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] interface gigabitethernet 1/0/1</span><br><span class="line">[FW_B-GigabitEthernet1/0/1] ipsec policy map1</span><br><span class="line">[FW_B-GigabitEthernet1/0/1] quit</span><br></pre></td></tr></table></figure>

<p><strong>二、GRE over IPSEC</strong></p>
<p>1、修改ACL,重新定义ipsec 感兴趣流</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[FW1]acl number 3000</span><br><span class="line">[FW2-acl-adv-3000]undo rule 5 </span><br><span class="line">  Warning: The ACL is referenced by IPSec, if the data flows to be encrypted are deleted, this may cause service interruption. Are you sure to d ：y</span><br><span class="line">[FW2-acl-adv-3000]rule  5 permit gre </span><br></pre></td></tr></table></figure>



<h1 id="数据通信13"><a href="#数据通信13" class="headerlink" title="数据通信13"></a>数据通信13</h1><p>[TOC]</p>
<p>多模模块光纤会有可见光</p>
<h2 id="双机热备实验-2"><a href="#双机热备实验-2" class="headerlink" title="双机热备实验"></a>双机热备实验</h2><h3 id="拓扑图-5"><a href="#拓扑图-5" class="headerlink" title="拓扑图"></a>拓扑图</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240305111446633.png" alt="image-20240305111446633"></p>
<h3 id="目的-1"><a href="#目的-1" class="headerlink" title="目的"></a>目的</h3><p>为了<strong>规避一台设备故障导致网络业务中断的风险</strong>，可以在网络节点处同时部署两台设备，形成双机热备组网。当其中一台设备出现故障时，业务流量能<strong>平滑地切换到备用设备上</strong>，保证业务不中断，使内外网用户交互的时候感知不到曾经出现过网络故障。</p>
<ul>
<li>主备备份</li>
<li>负载分担</li>
</ul>
<h3 id="实现方法-1"><a href="#实现方法-1" class="headerlink" title="实现方法"></a>实现方法</h3><p>一般两个路由器就是使用vrrp，但是用在防火墙上就会产生一些bug，上节课有说，故我们<strong>使用vgmp</strong></p>
<h3 id="VGMP状态机-2"><a href="#VGMP状态机-2" class="headerlink" title="VGMP状态机"></a>VGMP状态机</h3><ul>
<li>initialize：VGMP管理组处于未启用状态。</li>
<li>Active：本端VGMP管理组的优先级比对端的VGMP管理组优先级高。</li>
<li>Standby：本端VGMP管理组的优先级比对端的VGMP管理组优先级低</li>
</ul>
<p>（vrrp是initialize和backup，master）</p>
<h3 id="VGMP主从切换-1"><a href="#VGMP主从切换-1" class="headerlink" title="VGMP主从切换"></a>VGMP主从切换</h3><ul>
<li>每个接口down，VGMP管理组优先级降低2。计算公式为：<strong>VGMP优先级&#x3D;VGMP初始优先级-2*接口宕的个数</strong></li>
<li>每台设备的VGMP管理组<strong>初始状态由用户指定</strong>（Active或Standby），且用户只能指定状态，<strong>不能指定VGMP组的具体的优先级</strong></li>
<li>③VGMP管理组的状态决定了该设备的主备状态，也决定了VGMP管理组成员（VRRP备份组成员或接口）的状态。（？）</li>
</ul>
<h3 id="实验配置-20"><a href="#实验配置-20" class="headerlink" title="实验配置"></a>实验配置</h3><p><strong>步骤一：配置ip地址</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#FW1</span><br><span class="line">[FW1]<span class="type">int</span> g1/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[FW1-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>]ip address <span class="number">10.1</span><span class="number">.2</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[FW1]<span class="type">int</span> g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[FW1-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[FW1]firewall zone trust </span><br><span class="line">[FW1-zone-trust]add interface g1/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"></span><br><span class="line">[FW1]firewall zone untrust </span><br><span class="line">[FW1-zone-untrust]add interface g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#FW2</span><br><span class="line">[FW2]<span class="type">int</span> g1/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[FW2-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>]ip address <span class="number">10.1</span><span class="number">.2</span><span class="number">.2</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[FW2]<span class="type">int</span> g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[FW2-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[FW2]firewall zone  trust </span><br><span class="line">[FW2-zone-trust]add interface g1/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"></span><br><span class="line">[FW2]firewall zone untrust </span><br><span class="line">[FW2-zone-untrust]add interface g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>步骤二：配置区域策略</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#FW1</span><br><span class="line">[FW1]security-policy </span><br><span class="line"></span><br><span class="line">[FW1-policy-security]rule name T2U</span><br><span class="line"></span><br><span class="line">[FW1-policy-security-rule-T2U]source-zone trust </span><br><span class="line"></span><br><span class="line">[FW1-policy-security-rule-T2U]destination-zone untrust </span><br><span class="line"></span><br><span class="line">[FW1-policy-security-rule-T2U]action permit </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#FW2</span><br><span class="line">[FW2]security-policy </span><br><span class="line"></span><br><span class="line">[FW2-policy-security]rule name T2U</span><br><span class="line"></span><br><span class="line">[FW2-policy-security-rule-T2U]source-zone trust </span><br><span class="line"></span><br><span class="line">[FW2-policy-security-rule-T2U]destination-zone untrust </span><br><span class="line"></span><br><span class="line">[FW2-policy-security-rule-T2U]action permit</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>步骤三：配置vrrp</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#FW1</span><br><span class="line">[FW1]int g1/0/1</span><br><span class="line"></span><br><span class="line">[FW1-GigabitEthernet1/0/1]vrrp vrid 1 virtual-ip 10.1.1.254 active </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[FW1]int g1/0/0</span><br><span class="line"></span><br><span class="line">[FW1-GigabitEthernet1/0/0]vrrp vrid 1 virtual-ip 10.1.2.254 active </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#FW2</span><br><span class="line">[FW2]int g1/0/1</span><br><span class="line"></span><br><span class="line">[FW2-GigabitEthernet1/0/1]vrrp vrid 1 virtual-ip 10.1.1.254 standby </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[FW2]int g1/0/0</span><br><span class="line"></span><br><span class="line">[FW2-GigabitEthernet1/0/0]vrrp vrid 1 virtual-ip 10.1.2.254 standby</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>步骤四：配置hrp热备份</strong>!!!!</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ FW1]hrp enable</span><br><span class="line"></span><br><span class="line">HRP_ S [FW1]hrp interface g1/<span class="number">0</span>/<span class="number">2</span> remote <span class="number">10.1</span><span class="number">.3</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">[ FW2]hrp enable</span><br><span class="line"></span><br><span class="line">HRP_ S [FW2]hrp interface g1/<span class="number">0</span>/<span class="number">2</span> remote <span class="number">10.1</span><span class="number">.3</span><span class="number">.1</span>HRP_ M[ FW2]hrp standby-device</span><br><span class="line"></span><br><span class="line"><span class="comment">//感觉上就和那个ospf虚连接差不多</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="VPN-1"><a href="#VPN-1" class="headerlink" title="VPN"></a>VPN</h2><p>&#x2F;&#x2F;科学上网，请勿乱用</p>
<h3 id="分类-1"><a href="#分类-1" class="headerlink" title="分类"></a>分类</h3><p><strong>二层</strong></p>
<ul>
<li>l2tp</li>
<li>pptp(淘汰但简单)</li>
<li>mpls l2 vpn</li>
</ul>
<p><strong>三层</strong></p>
<ul>
<li>gre（重点简单）</li>
<li>ipsec（重点巅峰）</li>
<li>bgp&#x2F;mpls vpn</li>
</ul>
<h3 id="其他vpn-1"><a href="#其他vpn-1" class="headerlink" title="其他vpn"></a>其他vpn</h3><ul>
<li>ssl</li>
<li>l2f</li>
<li>dvpn</li>
<li>基于vlan的vpn</li>
<li>802.1qinq</li>
<li>xot</li>
</ul>
<h3 id="GRE（ip协议号47）-1"><a href="#GRE（ip协议号47）-1" class="headerlink" title="GRE（ip协议号47）"></a>GRE（ip协议号47）</h3><p><strong>虚拟的隧道（Tunnel接口）</strong></p>
<h4 id="定义-6"><a href="#定义-6" class="headerlink" title="定义"></a>定义</h4><p>通用路由封装协议（Generic Rrouting Encapsulation），他的作用是<strong>把一种协议的报文封装在另外一种协议的报文中</strong>的技术，是一种隧道技术（只要这样子做，都称为隧道技术）</p>
<h4 id="报文结构（加封装）-1"><a href="#报文结构（加封装）-1" class="headerlink" title="报文结构（加封装）"></a>报文结构（加封装）</h4><p>在原始封装的数据报文字段中<strong>加入新的IP头部</strong>，在<strong>新的IP报头和老的IP报头中间加一个协议</strong>，这就是GRE报头。 </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240309141300500.png" alt="image-20240309141300500"></p>
<p><strong>头部</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image7(421).png" alt="img"></p>
<p>把原本的IP报头当成货物，这个被称为<strong>乘客协议</strong>，GRE负责承载乘客协议的IP报文，<strong>GRE可以理解为车辆</strong>，然后由新的IP报头在公网进行传输，<strong>公网设备只会查看新的IP报头</strong>，然后进行转发。</p>
<h4 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h4><ul>
<li>支持多种协议</li>
<li>靠IP做为承载网络</li>
<li><strong>支持路由协议和IP组播</strong></li>
<li>配置简单</li>
</ul>
<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>点对点隧道</li>
<li>静态配置隧道参数</li>
<li>部署复杂连接时代价大</li>
<li><strong>不安全</strong></li>
</ul>
<h3 id="传输过程-1"><a href="#传输过程-1" class="headerlink" title="传输过程"></a>传输过程</h3><ul>
<li>私网数据报文保留，加上GRE报头和新的IP报头（隧道源和隧道目标）。</li>
<li><strong>数据报文发送出去后，中途运营商的设备会根据外层的IP报头进行转发。</strong></li>
<li>目标设备收到数据报文后，进行<strong>解封装</strong>，<strong>看到GRE报文后</strong>，会继续解封装，然后在看到原先发送的数据报文，<strong>发现是私网包头，进行查找路由</strong>，发现有就进行转发，回包也是如此，这就完成通讯。</li>
</ul>
<p><strong><u>做GRE时严禁将公网进行ospf宣告</u></strong></p>
<h3 id="GRE隧道keeplive-1"><a href="#GRE隧道keeplive-1" class="headerlink" title="GRE隧道keeplive"></a>GRE隧道keeplive</h3><p>和ospf保持邻居关系、心跳线设置差不多，都是检测对方或者线路有无故障</p>
<h3 id="GRE实验配置-1"><a href="#GRE实验配置-1" class="headerlink" title="GRE实验配置"></a>GRE实验配置</h3><h4 id="拓扑图-6"><a href="#拓扑图-6" class="headerlink" title="拓扑图"></a>拓扑图</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/45599" alt="img"></p>
<h4 id="配置设备IP地址-1"><a href="#配置设备IP地址-1" class="headerlink" title="配置设备IP地址"></a>配置设备IP地址</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">FW1]inter g1/<span class="number">0</span>/<span class="number">2</span> </span><br><span class="line">[FW1-GigabitEthernet1/<span class="number">0</span>/<span class="number">2</span>]ip add <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line"><span class="number">24</span> </span><br><span class="line">[FW1-GigabitEthernet1/<span class="number">0</span>/<span class="number">2</span>]inter g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> [FW1-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]ip add <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line"><span class="number">24</span> </span><br><span class="line">[Huawei]inter g0/<span class="number">0</span>/<span class="number">0</span> </span><br><span class="line">[Huawei-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]ip add </span><br><span class="line"><span class="number">13.1</span><span class="number">.1</span><span class="number">.3</span> <span class="number">24</span> </span><br><span class="line">[Huawei]inter g0/<span class="number">0</span>/<span class="number">1</span> </span><br><span class="line">[Huawei-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]ip add </span><br><span class="line"><span class="number">23.1</span><span class="number">.1</span><span class="number">.3</span> <span class="number">24</span></span><br><span class="line"><span class="comment">// [Huawei]int lo 0</span></span><br><span class="line"><span class="comment">//[Huawei-Loopback0]ip add 1.1.1.1 24</span></span><br><span class="line">[FW2]inter g1/<span class="number">0</span>/<span class="number">2</span> </span><br><span class="line">[FW2-GigabitEthernet1/<span class="number">0</span>/<span class="number">2</span>]ip add <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> </span><br><span class="line"><span class="number">24</span> </span><br><span class="line">[FW2]inter g1/<span class="number">0</span>/<span class="number">1</span> </span><br><span class="line">[FW2-GigabitEthernet1/<span class="number">0</span>/<span class="number">1</span>]ip add <span class="number">10.1</span><span class="number">.2</span><span class="number">.1</span> </span><br><span class="line"><span class="number">24</span></span><br></pre></td></tr></table></figure>



<h4 id="配置防火墙-1"><a href="#配置防火墙-1" class="headerlink" title="配置防火墙"></a>配置防火墙</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#FW1</span></span><br><span class="line"> [<span class="meta">FW1</span>]firewall zone untrust </span><br><span class="line">[<span class="meta">FW1-zone-untrust</span>]<span class="keyword">add</span> <span class="keyword">interface</span> <span class="title">g1</span>/0/2 </span><br><span class="line">    </span><br><span class="line">[<span class="title">FW1</span>]<span class="title">firewall</span> <span class="title">zone</span> <span class="title">trust</span> </span><br><span class="line">[<span class="title">FW1</span>-<span class="title">zone</span>-<span class="title">trust</span>]<span class="title">add</span> <span class="title">interface</span> <span class="title">g1</span>/0/1 </span><br><span class="line">    </span><br><span class="line">#<span class="title">FW2</span></span><br><span class="line"> [<span class="title">FW2</span>]<span class="title">firewall</span> <span class="title">zone</span> <span class="title">untrust</span> </span><br><span class="line">[<span class="title">FW2</span>-<span class="title">zone</span>-<span class="title">untrust</span>]<span class="title">add</span> <span class="title">interface</span> <span class="title">g1</span>/0/2 </span><br><span class="line">    </span><br><span class="line">[<span class="title">FW2</span>]<span class="title">firewall</span> <span class="title">zone</span> <span class="title">trust</span> </span><br><span class="line">[<span class="title">FW2</span>-<span class="title">zone</span>-<span class="title">trust</span>]<span class="title">add</span> <span class="title">interface</span> <span class="title">g1</span>/0/1</span><br></pre></td></tr></table></figure>



<h4 id="配置OSPF-1"><a href="#配置OSPF-1" class="headerlink" title="配置OSPF"></a>配置OSPF</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//严禁将公网ip通过ospf进行宣告 </span></span><br><span class="line">[FW1]ospf <span class="number">1</span> </span><br><span class="line">[FW1-ospf<span class="number">-1</span>]area <span class="number">0</span></span><br><span class="line"> [FW1-ospf<span class="number">-1</span>-area<span class="number">-0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> </span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">    </span><br><span class="line"> [AR3]ospf <span class="number">1</span> </span><br><span class="line">[AR3-ospf<span class="number">-1</span>]area <span class="number">0</span> </span><br><span class="line">[AR3-ospf<span class="number">-1</span>-area<span class="number">-0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">13.1</span><span class="number">.1</span><span class="number">.0</span> </span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"> [AR3-ospf<span class="number">-1</span>-area<span class="number">-0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">23.1</span><span class="number">.1</span><span class="number">.0</span> </span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"> [AR3-ospf<span class="number">-1</span>-area<span class="number">-0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    </span><br><span class="line"> [FW2]ospf <span class="number">1</span> </span><br><span class="line">[FW2-ospf<span class="number">-1</span>]area <span class="number">0</span> </span><br><span class="line">[FW2-ospf<span class="number">-1</span>-area<span class="number">-0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> </span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br></pre></td></tr></table></figure>



<h4 id="配置NAT-1"><a href="#配置NAT-1" class="headerlink" title="配置NAT"></a>配置NAT</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//FW1 安全策略</span></span><br><span class="line">[FW1]security-policy </span><br><span class="line">[FW1-policy-security]rule name T2U</span><br><span class="line"> [FW1-policy-security-rule-T2U]source-zone </span><br><span class="line">trust </span><br><span class="line">[FW1-policy-security-rule-T2U]destination</span><br><span class="line">zone untrust </span><br><span class="line">[FW1-policy-security-rule-T2U]action permit</span><br><span class="line">    </span><br><span class="line"> <span class="comment">//FW1 配置NAT</span></span><br><span class="line"> [FW1]nat-policy </span><br><span class="line">[FW1-policy-nat]rule name all </span><br><span class="line">[FW1-policy-nat-rule-all] source-zone trust</span><br><span class="line"> [FW1-policy-nat-rule-all]egress-interface </span><br><span class="line">GigabitEthernet1/<span class="number">0</span>/<span class="number">2</span><span class="comment">//选择出接口</span></span><br><span class="line"> [FW1-policy-nat-rule-all]action source-nat </span><br><span class="line">easy-ip<span class="comment">//转换ip靠接口</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//FW2 流量策略</span></span><br><span class="line">[FW2]security-policy </span><br><span class="line">[FW2-policy-security]rule name T2U </span><br><span class="line">[FW2-policy-security-rule-T2U]source-zone </span><br><span class="line">trust </span><br><span class="line">[FW2-policy-security-rule-T2U]destination</span><br><span class="line">zone untrust </span><br><span class="line">[FW2-policy-security-rule-T2U]action permit</span><br><span class="line">    </span><br><span class="line"> <span class="comment">//FW2 配置NAT</span></span><br><span class="line"> [FW2]nat-policy </span><br><span class="line">[FW2-policy-nat]rule name all </span><br><span class="line">[FW2-policy-nat-rule-all]source-zone trust </span><br><span class="line">[FW2-policy-nat-rule-all]egress-interface </span><br><span class="line">GigabitEthernet1/<span class="number">0</span>/<span class="number">2</span> </span><br><span class="line">[FW2-policy-nat-rule-all]action source-nat </span><br><span class="line">easy-ip</span><br></pre></td></tr></table></figure>



<h4 id="配置GRE-VPN-1"><a href="#配置GRE-VPN-1" class="headerlink" title="配置GRE VPN"></a>配置GRE VPN</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FW1</span></span><br><span class="line"> [FW1]interface Tunnel <span class="number">0</span> </span><br><span class="line"><span class="comment">//[FW1-Tunnel0]tunnel-protocol gre </span></span><br><span class="line">[FW1-Tunnel0]source <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">[FW1-Tunnel0]destination <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> </span><br><span class="line">[FW1-Tunnel0]ip add <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">//FW2</span></span><br><span class="line"> [FW2]interface Tunnel <span class="number">0</span></span><br><span class="line"> [FW2-Tunnel0]tunnel-protocol gre </span><br><span class="line">[FW2-Tunnel0]source <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> </span><br><span class="line">[FW2-Tunnel0]destination <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">[FW2-Tunnel0]ip add <span class="number">12.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置虚拟接口所属区域</span></span><br><span class="line"><span class="comment">//FW1</span></span><br><span class="line"> [FW1]firewall zone untrust </span><br><span class="line">[FW1-zone-untrust]add interface Tunnel <span class="number">0</span></span><br><span class="line"> <span class="comment">//FW2</span></span><br><span class="line"> [FW2]firewall zone untrust </span><br><span class="line">[FW2-zone-untrust]add interface Tunnel <span class="number">0</span></span><br></pre></td></tr></table></figure>



<h4 id="配置VPN路由-1"><a href="#配置VPN路由-1" class="headerlink" title="配置VPN路由"></a>配置VPN路由</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FW1</span></span><br><span class="line"> [FW1]ip route-<span class="type">static</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> <span class="number">24</span> <span class="number">12.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"> <span class="comment">//FW2</span></span><br><span class="line"> [FW2]ip route-<span class="type">static</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">24</span> <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>



<h4 id="配置VPN接口的策略-1"><a href="#配置VPN接口的策略-1" class="headerlink" title="配置VPN接口的策略"></a>配置VPN接口的策略</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fw1（配置这个的目的是等下做策略要使用的地址）</span></span><br><span class="line"> [FW1]ip address-<span class="built_in">set</span> <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> type object </span><br><span class="line">[FW1-object-address-<span class="built_in">set</span><span class="number">-23.1</span><span class="number">.1</span><span class="number">.2</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> mask <span class="number">32</span></span><br><span class="line"> </span><br><span class="line"> [FW1]ip address-<span class="built_in">set</span> <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> type object </span><br><span class="line">[FW1-object-address-<span class="built_in">set</span><span class="number">-13.1</span><span class="number">.1</span><span class="number">.1</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> mask <span class="number">32</span></span><br><span class="line"> </span><br><span class="line"> [FW1]ip address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> type object </span><br><span class="line">[FW1-object-address-<span class="built_in">set</span><span class="number">-10.1</span><span class="number">.1</span><span class="number">.0</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> mask <span class="number">24</span></span><br><span class="line"></span><br><span class="line"> [FW1]ip address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> type object </span><br><span class="line">[FW1-object-address-<span class="built_in">set</span><span class="number">-10.1</span><span class="number">.2</span><span class="number">.0</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> mask <span class="number">24</span></span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> <span class="comment">// 配置策略</span></span><br><span class="line">[FW1]security-policy</span><br><span class="line"> [FW1-policy-security]rule name U2T</span><br><span class="line"> [FW1-policy-security-rule-U2T]  source-zone </span><br><span class="line">untrust</span><br><span class="line"> [FW1-policy-security-rule-U2T]  </span><br><span class="line">destination-zone trust</span><br><span class="line">     </span><br><span class="line"> [FW1-policy-security-rule-U2T]  source</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span></span><br><span class="line"> [FW1-policy-security-rule-U2T]  </span><br><span class="line">destination-address address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line"> [FW1-policy-security-rule-U2T]  action </span><br><span class="line">permit</span><br><span class="line">     </span><br><span class="line"> [FW1-policy-security-rule-U2T] rule name </span><br><span class="line">U2L</span><br><span class="line"> [FW1-policy-security-rule-U2L]  source-zone </span><br><span class="line">untrust</span><br><span class="line"> [FW1-policy-security-rule-U2L]  </span><br><span class="line">destination-zone local</span><br><span class="line">     </span><br><span class="line"> [FW1-policy-security-rule-U2L]  source</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"> [FW1-policy-security-rule-U2L]  </span><br><span class="line">destination-address address-<span class="built_in">set</span> <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> [FW1-policy-security-rule-U2L]  action </span><br><span class="line">permit</span><br><span class="line"> <span class="comment">//！！再添加Local to Untrust的策略！！</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">//fw2</span></span><br><span class="line"> [FW2]ip address-<span class="built_in">set</span> <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> type object </span><br><span class="line">[FW2-object-address-<span class="built_in">set</span><span class="number">-13.1</span><span class="number">.1</span><span class="number">.1</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span> mask <span class="number">32</span></span><br><span class="line"> </span><br><span class="line"> [FW2]ip address-<span class="built_in">set</span>  <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> type object </span><br><span class="line">[FW2-object-address-<span class="built_in">set</span><span class="number">-23.1</span><span class="number">.1</span><span class="number">.2</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span> mask <span class="number">32</span></span><br><span class="line"></span><br><span class="line"> [FW2]ip address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> type object </span><br><span class="line">[FW2-object-address-<span class="built_in">set</span><span class="number">-10.1</span><span class="number">.1</span><span class="number">.0</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> mask <span class="number">24</span></span><br><span class="line"> </span><br><span class="line"> [FW2]ip address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> type object </span><br><span class="line">[FW2-object-address-<span class="built_in">set</span><span class="number">-10.1</span><span class="number">.2</span><span class="number">.0</span>]address <span class="number">0</span> </span><br><span class="line"><span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> mask <span class="number">24</span></span><br><span class="line"><span class="comment">// 配置策略</span></span><br><span class="line">[FW2]security-policy </span><br><span class="line">[FW2-policy-security]rule name U2T</span><br><span class="line"> [FW2-policy-security-rule-U2T]source-zone </span><br><span class="line">untrust </span><br><span class="line">[FW2-policy-security-rule-U2T]destination</span><br><span class="line">zone trust </span><br><span class="line">     </span><br><span class="line">[FW2-policy-security-rule-U2T]source</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line"> [FW2-policy-security-rule-U2T]destination</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span></span><br><span class="line"> [FW2-policy-security-rule-U2T]action permit </span><br><span class="line">     </span><br><span class="line">[FW2-policy-security]rule name U2L</span><br><span class="line"> [FW2-policy-security-rule-U2L]source-zone </span><br><span class="line">untrust </span><br><span class="line">[FW2-policy-security-rule-U2L]destination</span><br><span class="line">zone local </span><br><span class="line">     </span><br><span class="line">[FW2-policy-security-rule-U2L]source</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">13.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> [FW2-policy-security-rule-U2L]destination</span><br><span class="line">address address-<span class="built_in">set</span> <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"> [FW2-policy-security-rule-U2L]action permit </span><br><span class="line"><span class="comment">//！！再添加Local to Untrust的策略！！</span></span><br></pre></td></tr></table></figure>



<h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><h5 id="pc互ping-1"><a href="#pc互ping-1" class="headerlink" title="pc互ping"></a>pc互ping</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240309181925871.png" alt="image-20240309181925871"></p>
<h5 id="虚接口互ping-1"><a href="#虚接口互ping-1" class="headerlink" title="虚接口互ping"></a>虚接口互ping</h5><p><strong>加上两条命令</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[FW1-Tunnel1]service-manage ping permit</span><br><span class="line"> [FW2-Tunnel1]service-manage ping permit</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240309182133724.png" alt="image-20240309182133724"></p>
<p>我的结果成功了，但是延迟普遍上了100ms，不知为何# 数据通信14</p>
<p>[TOC]</p>
<h2 id="IPsec-1"><a href="#IPsec-1" class="headerlink" title="IPsec"></a>IPsec</h2><p><strong>IPsec VPN最经典的应用场景为点到点建立IPsec隧道的场景</strong></p>
<ul>
<li>不能走组播</li>
<li>包含协议：</li>
<li>安全传输、防止监听</li>
<li>对等体加密密钥（非对称）</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316103753120.png" alt="image-20240316103753120"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316103836251.png" alt="image-20240316103836251"></p>
<h3 id="AH（别用）-1"><a href="#AH（别用）-1" class="headerlink" title="AH（别用）"></a>AH（别用）</h3><ul>
<li>AH头不做加密，只做验证，和NAT矛盾（AH会把NAT报错）</li>
<li>ESP才进行数据加密&#x2F;解密</li>
<li>AH用IP协议号51来标识</li>
</ul>
<h3 id="ESP-1"><a href="#ESP-1" class="headerlink" title="ESP"></a>ESP</h3><ul>
<li>数据<strong>完整性</strong>，数据**<u>机密性</u>**（HMAC–key？）都有涉猎，比AH好得多</li>
<li>ip协议号52</li>
<li>和ah不同，esp可以和ip中的nat协议共存，校验除ip的部分</li>
</ul>
<h3 id="协议封装模式-1"><a href="#协议封装模式-1" class="headerlink" title="协议封装模式"></a>协议封装模式</h3><ol>
<li>传输模式（不加上新的ip地址，将ipsec报文插入传输层协议和ip之间）</li>
<li>隧道模式（原来的ip报文保持，在头部再加上一个新IP报头“总部和总部互连”）</li>
</ol>
<h3 id="DH算法-1"><a href="#DH算法-1" class="headerlink" title="DH算法"></a>DH算法</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316111337845.png" alt="image-20240316111337845"></p>
<ul>
<li>a，b之间共享的p和g分别是17和3（dh-group一般非常大）</li>
<li>a，b之间选择自己的私钥，a拿15，b拿13</li>
<li>a计算公钥，3^15 mode p（17）&#x3D;6，发送给对方</li>
<li>b计算公钥，3^13 mode p（17）&#x3D;12，发送给对方</li>
<li>a共享密钥计算&#x3D;12^15 mod 17&#x3D;10</li>
<li>b共享密钥计算&#x3D;6^13 mod 17&#x3D;10</li>
</ul>
<h3 id="IKE协商-1"><a href="#IKE协商-1" class="headerlink" title="IKE协商"></a>IKE协商</h3><p>为什么要用IKE？为了将<strong>密钥通过自动协商</strong>产生（手动配浪费时间）</p>
<ul>
<li>通过地府赫尔曼算法进行密钥协商</li>
<li>dh-group中放的就是p，g</li>
</ul>
<h2 id="安全要素-1"><a href="#安全要素-1" class="headerlink" title="安全要素"></a>安全要素</h2><ul>
<li>机密性</li>
<li>完整性</li>
<li>身份验证</li>
<li>不可抵赖</li>
</ul>
<h2 id="加解密-1"><a href="#加解密-1" class="headerlink" title="加解密"></a>加解密</h2><h3 id="对称加密-1"><a href="#对称加密-1" class="headerlink" title="对称加密"></a>对称加密</h3><p>例子：des加密&#x2F;解密</p>
<p>密文加密钥（但是密钥要怎么传送给对方？）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316091706463.png" alt="image-20240316091706463"></p>
<h3 id="非对称加密-1"><a href="#非对称加密-1" class="headerlink" title="非对称加密"></a>非对称加密</h3><p>例子：RSA，分公钥和私钥</p>
<p>私钥加内容进行加密，只有一个公钥也可以解密出信息</p>
<p>公钥加密私钥解密，私钥加密公钥解密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316092359455.png" alt="image-20240316092359455"></p>
<p>缺点：只能用公钥加密，而且速度太慢了</p>
<h3 id="混合加密-1"><a href="#混合加密-1" class="headerlink" title="混合加密"></a>混合加密</h3><p>des加rsa，将des的密钥进行rsa加密</p>
<h2 id="完整性校验-1"><a href="#完整性校验-1" class="headerlink" title="完整性校验"></a>完整性校验</h2><p>ah</p>
<p>关键元素：哈希值</p>
<h3 id="md5-1"><a href="#md5-1" class="headerlink" title="md5"></a>md5</h3><p>将收到的文件和哈希值进行校验</p>
<h3 id="HMAC-1"><a href="#HMAC-1" class="headerlink" title="HMAC"></a>HMAC</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316094929671.png" alt="image-20240316094929671"></p>
<p>收到信息时再加入一定的数据再计算哈希值</p>
<h2 id="数字签名-1"><a href="#数字签名-1" class="headerlink" title="数字签名"></a>数字签名</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316095953073.png" alt="image-20240316095953073"></p>
<p>可以类比于赛博身份证</p>
<p>第三方用私钥给a的信息进行加密，然后a给b发信息带上第三方的密文，那么b就可以用第三方的公钥验证a到底是不是a</p>
<p>display ike sa</p>
<h2 id="L2TP-1"><a href="#L2TP-1" class="headerlink" title="L2TP"></a>L2TP</h2><p>二层VPN，真正使用的是ppp协议，ppp协议外添加l2tp协议再添加ip报头（类似于pppoe协议，只是l2tp变成了pppoe）</p>
<h2 id="ipsec配置-1"><a href="#ipsec配置-1" class="headerlink" title="ipsec配置"></a>ipsec配置</h2><h3 id="网络拓扑图-1"><a href="#网络拓扑图-1" class="headerlink" title="网络拓扑图"></a>网络拓扑图</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240327174207628.png" alt="image-20240327174207628"></p>
<h3 id="配置过程-1"><a href="#配置过程-1" class="headerlink" title="配置过程"></a>配置过程</h3><p><strong>二、配置过程</strong></p>
<p><strong>在FW1上配置IPSec策略，并在接口上应用此IPSec策略。</strong></p>
<p>a、定义被保护的数据流。配置高级ACL 3000，允许10.1.1.0&#x2F;24网段访问10.1.2.0&#x2F;24网段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] acl 3000</span><br><span class="line">[FW_A-acl-adv-3000] rule 5 permit ip source 10.1.1.0 0.0.0.255 destination 10.1.2.0 0.0.0.255</span><br><span class="line">[FW_A-acl-adv-3000] quit</span><br></pre></td></tr></table></figure>

<p>b、配置IPSec安全提议，缺省参数可不配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ipsec proposal tran1</span><br><span class="line">[FW_A-ipsec-proposal-tran1] esp authentication-algorithm sha2-256</span><br><span class="line">[FW_A-ipsec-proposal-tran1] esp encryption-algorithm aes-256</span><br><span class="line">[FW_A-ipsec-proposal-tran1] quit</span><br></pre></td></tr></table></figure>

<p>c、配置IKE安全提议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ike proposal 10</span><br><span class="line">[FW_A-ike-proposal-10] authentication-method pre-share</span><br><span class="line">[FW_A-ike-proposal-10] encryption-algorithm aes-256</span><br><span class="line">[FW_A-ike-proposal-10] authentication-algorithm sha2-256</span><br><span class="line">[FW_A-ike-proposal-10] dh group14</span><br><span class="line">[FW_A-ike-proposal-10] quit</span><br></pre></td></tr></table></figure>

<p>d、配置IKE peer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ike peer b</span><br><span class="line">[FW_A-ike-peer-b] ike-proposal 10</span><br><span class="line">[FW_A-ike-peer-b] remote-address 23.1.1.2</span><br><span class="line">[FW_A-ike-peer-b] pre-shared-key Test!1234</span><br><span class="line">[FW_A-ike-peer-b] quit</span><br></pre></td></tr></table></figure>

<p>e、配置IPSec策略</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ipsec policy map1 10 isakmp</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] security acl 3000</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] proposal tran1</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] ike-peer b</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] quit</span><br></pre></td></tr></table></figure>

<p>f、在接口GE1&#x2F;0&#x2F;1上应用IPSec策略组map1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] interface gigabitethernet 1/0/1</span><br><span class="line">[FW_A-GigabitEthernet1/0/1] ipsec policy map1</span><br><span class="line">[FW_A-GigabitEthernet1/0/1] quit</span><br></pre></td></tr></table></figure>

<p><strong>在FW_B上配置IPSec策略，并在接口上应用此IPSec策略。</strong></p>
<p>a、配置高级ACL 3000，允许10.1.2.0&#x2F;24网段访问10.1.1.0&#x2F;24网段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] acl 3000</span><br><span class="line">[FW_B-acl-adv-3000] rule 5 permit ip source 10.1.2.0 0.0.0.255 destination 10.1.1.0 0.0.0.255</span><br><span class="line">[FW_B-acl-adv-3000] quit</span><br></pre></td></tr></table></figure>

<p>b、配置IPSec安全提议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ipsec proposal tran1</span><br><span class="line">[FW_B-ipsec-proposal-tran1] esp authentication-algorithm sha2-256</span><br><span class="line">[FW_B-ipsec-proposal-tran1] esp encryption-algorithm aes-256</span><br><span class="line">[FW_B-ipsec-proposal-tran1] quit</span><br></pre></td></tr></table></figure>

<p>c、配置IKE安全提议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ike proposal 10</span><br><span class="line">[FW_B-ike-proposal-10] authentication-method pre-share</span><br><span class="line">[FW_B-ike-proposal-10] prf hmac-sha2-256</span><br><span class="line">[FW_B-ike-proposal-10] encryption-algorithm aes-256</span><br><span class="line">[FW_B-ike-proposal-10] dh group14</span><br><span class="line">[FW_B-ike-proposal-10] integrity-algorithm hmac-sha2-256 </span><br><span class="line">[FW_B-ike-proposal-10] quit</span><br></pre></td></tr></table></figure>

<p>d、配置IKE peer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ike peer a </span><br><span class="line">[FW_B-ike-peer-a] ike-proposal 10 </span><br><span class="line">[FW_B-ike-peer-a] remote-address 1.1.3.1 </span><br><span class="line">[FW_B-ike-peer-a] pre-shared-key Test!1234 </span><br><span class="line">[FW_B-ike-peer-a] quit</span><br></pre></td></tr></table></figure>

<p>e、配置IPSec策略</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ipsec policy map1 10 isakmp </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] security acl 3000 </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] proposal tran1 </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] ike-peer a </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] quit</span><br></pre></td></tr></table></figure>

<p>f、在接口GE1&#x2F;0&#x2F;1上应用IPSec策略组map1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] interface gigabitethernet 1/0/1</span><br><span class="line">[FW_B-GigabitEthernet1/0/1] ipsec policy map1</span><br><span class="line">[FW_B-GigabitEthernet1/0/1] quit</span><br></pre></td></tr></table></figure>

<p><strong>二、GRE over IPSEC</strong></p>
<p>1、修改ACL,重新定义ipsec 感兴趣流</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[FW1]acl number 3000</span><br><span class="line">[FW2-acl-adv-3000]undo rule 5 </span><br><span class="line">  Warning: The ACL is referenced by IPSec, if the data flows to be encrypted are deleted, this may cause service interruption. Are you sure to d ：y</span><br><span class="line">[FW2-acl-adv-3000]rule  5 permit gre </span><br></pre></td></tr></table></figure>

<h1 id="数据通信14"><a href="#数据通信14" class="headerlink" title="数据通信14"></a>数据通信14</h1><p>[TOC]</p>
<h2 id="IPsec-2"><a href="#IPsec-2" class="headerlink" title="IPsec"></a>IPsec</h2><p><strong>IPsec VPN最经典的应用场景为点到点建立IPsec隧道的场景</strong></p>
<ul>
<li>不能走组播</li>
<li>包含协议：</li>
<li>安全传输、防止监听</li>
<li>对等体加密密钥（非对称）</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316103753120.png" alt="image-20240316103753120"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316103836251.png" alt="image-20240316103836251"></p>
<h3 id="AH（别用）-2"><a href="#AH（别用）-2" class="headerlink" title="AH（别用）"></a>AH（别用）</h3><ul>
<li>AH头不做加密，只做验证，和NAT矛盾（AH会把NAT报错）</li>
<li>ESP才进行数据加密&#x2F;解密</li>
<li>AH用IP协议号51来标识</li>
</ul>
<h3 id="ESP-2"><a href="#ESP-2" class="headerlink" title="ESP"></a>ESP</h3><ul>
<li>数据<strong>完整性</strong>，数据**<u>机密性</u>**（HMAC–key？）都有涉猎，比AH好得多</li>
<li>ip协议号52</li>
<li>和ah不同，esp可以和ip中的nat协议共存，校验除ip的部分</li>
</ul>
<h3 id="协议封装模式-2"><a href="#协议封装模式-2" class="headerlink" title="协议封装模式"></a>协议封装模式</h3><ol>
<li>传输模式（不加上新的ip地址，将ipsec报文插入传输层协议和ip之间）</li>
<li>隧道模式（原来的ip报文保持，在头部再加上一个新IP报头“总部和总部互连”）</li>
</ol>
<h3 id="DH算法-2"><a href="#DH算法-2" class="headerlink" title="DH算法"></a>DH算法</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316111337845.png" alt="image-20240316111337845"></p>
<ul>
<li>a，b之间共享的p和g分别是17和3（dh-group一般非常大）</li>
<li>a，b之间选择自己的私钥，a拿15，b拿13</li>
<li>a计算公钥，3^15 mode p（17）&#x3D;6，发送给对方</li>
<li>b计算公钥，3^13 mode p（17）&#x3D;12，发送给对方</li>
<li>a共享密钥计算&#x3D;12^15 mod 17&#x3D;10</li>
<li>b共享密钥计算&#x3D;6^13 mod 17&#x3D;10</li>
</ul>
<h3 id="IKE协商-2"><a href="#IKE协商-2" class="headerlink" title="IKE协商"></a>IKE协商</h3><p>为什么要用IKE？为了将<strong>密钥通过自动协商</strong>产生（手动配浪费时间）</p>
<ul>
<li>通过地府赫尔曼算法进行密钥协商</li>
<li>dh-group中放的就是p，g</li>
</ul>
<h2 id="安全要素-2"><a href="#安全要素-2" class="headerlink" title="安全要素"></a>安全要素</h2><ul>
<li>机密性</li>
<li>完整性</li>
<li>身份验证</li>
<li>不可抵赖</li>
</ul>
<h2 id="加解密-2"><a href="#加解密-2" class="headerlink" title="加解密"></a>加解密</h2><h3 id="对称加密-2"><a href="#对称加密-2" class="headerlink" title="对称加密"></a>对称加密</h3><p>例子：des加密&#x2F;解密</p>
<p>密文加密钥（但是密钥要怎么传送给对方？）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316091706463.png" alt="image-20240316091706463"></p>
<h3 id="非对称加密-2"><a href="#非对称加密-2" class="headerlink" title="非对称加密"></a>非对称加密</h3><p>例子：RSA，分公钥和私钥</p>
<p>私钥加内容进行加密，只有一个公钥也可以解密出信息</p>
<p>公钥加密私钥解密，私钥加密公钥解密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316092359455.png" alt="image-20240316092359455"></p>
<p>缺点：只能用公钥加密，而且速度太慢了</p>
<h3 id="混合加密-2"><a href="#混合加密-2" class="headerlink" title="混合加密"></a>混合加密</h3><p>des加rsa，将des的密钥进行rsa加密</p>
<h2 id="完整性校验-2"><a href="#完整性校验-2" class="headerlink" title="完整性校验"></a>完整性校验</h2><p>ah</p>
<p>关键元素：哈希值</p>
<h3 id="md5-2"><a href="#md5-2" class="headerlink" title="md5"></a>md5</h3><p>将收到的文件和哈希值进行校验</p>
<h3 id="HMAC-2"><a href="#HMAC-2" class="headerlink" title="HMAC"></a>HMAC</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316094929671.png" alt="image-20240316094929671"></p>
<p>收到信息时再加入一定的数据再计算哈希值</p>
<h2 id="数字签名-2"><a href="#数字签名-2" class="headerlink" title="数字签名"></a>数字签名</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240316095953073.png" alt="image-20240316095953073"></p>
<p>可以类比于赛博身份证</p>
<p>第三方用私钥给a的信息进行加密，然后a给b发信息带上第三方的密文，那么b就可以用第三方的公钥验证a到底是不是a</p>
<p>display ike sa</p>
<h2 id="L2TP-2"><a href="#L2TP-2" class="headerlink" title="L2TP"></a>L2TP</h2><p>二层VPN，真正使用的是ppp协议，ppp协议外添加l2tp协议再添加ip报头（类似于pppoe协议，只是l2tp变成了pppoe）</p>
<h2 id="ipsec配置-2"><a href="#ipsec配置-2" class="headerlink" title="ipsec配置"></a>ipsec配置</h2><h3 id="网络拓扑图-2"><a href="#网络拓扑图-2" class="headerlink" title="网络拓扑图"></a>网络拓扑图</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240327174207628.png" alt="image-20240327174207628"></p>
<h3 id="配置过程-2"><a href="#配置过程-2" class="headerlink" title="配置过程"></a>配置过程</h3><p><strong>二、配置过程</strong></p>
<p><strong>在FW1上配置IPSec策略，并在接口上应用此IPSec策略。</strong></p>
<p>a、定义被保护的数据流。配置高级ACL 3000，允许10.1.1.0&#x2F;24网段访问10.1.2.0&#x2F;24网段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] acl 3000</span><br><span class="line">[FW_A-acl-adv-3000] rule 5 permit ip source 10.1.1.0 0.0.0.255 destination 10.1.2.0 0.0.0.255</span><br><span class="line">[FW_A-acl-adv-3000] quit</span><br></pre></td></tr></table></figure>

<p>b、配置IPSec安全提议，缺省参数可不配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ipsec proposal tran1</span><br><span class="line">[FW_A-ipsec-proposal-tran1] esp authentication-algorithm sha2-256</span><br><span class="line">[FW_A-ipsec-proposal-tran1] esp encryption-algorithm aes-256</span><br><span class="line">[FW_A-ipsec-proposal-tran1] quit</span><br></pre></td></tr></table></figure>

<p>c、配置IKE安全提议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ike proposal 10</span><br><span class="line">[FW_A-ike-proposal-10] authentication-method pre-share</span><br><span class="line">[FW_A-ike-proposal-10] encryption-algorithm aes-256</span><br><span class="line">[FW_A-ike-proposal-10] authentication-algorithm sha2-256</span><br><span class="line">[FW_A-ike-proposal-10] dh group14</span><br><span class="line">[FW_A-ike-proposal-10] quit</span><br></pre></td></tr></table></figure>

<p>d、配置IKE peer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ike peer b</span><br><span class="line">[FW_A-ike-peer-b] ike-proposal 10</span><br><span class="line">[FW_A-ike-peer-b] remote-address 23.1.1.2</span><br><span class="line">[FW_A-ike-peer-b] pre-shared-key Test!1234</span><br><span class="line">[FW_A-ike-peer-b] quit</span><br></pre></td></tr></table></figure>

<p>e、配置IPSec策略</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] ipsec policy map1 10 isakmp</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] security acl 3000</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] proposal tran1</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] ike-peer b</span><br><span class="line">[FW_A-ipsec-policy-isakmp-map1-10] quit</span><br></pre></td></tr></table></figure>

<p>f、在接口GE1&#x2F;0&#x2F;1上应用IPSec策略组map1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_A] interface gigabitethernet 1/0/1</span><br><span class="line">[FW_A-GigabitEthernet1/0/1] ipsec policy map1</span><br><span class="line">[FW_A-GigabitEthernet1/0/1] quit</span><br></pre></td></tr></table></figure>

<p><strong>在FW_B上配置IPSec策略，并在接口上应用此IPSec策略。</strong></p>
<p>a、配置高级ACL 3000，允许10.1.2.0&#x2F;24网段访问10.1.1.0&#x2F;24网段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] acl 3000</span><br><span class="line">[FW_B-acl-adv-3000] rule 5 permit ip source 10.1.2.0 0.0.0.255 destination 10.1.1.0 0.0.0.255</span><br><span class="line">[FW_B-acl-adv-3000] quit</span><br></pre></td></tr></table></figure>

<p>b、配置IPSec安全提议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ipsec proposal tran1</span><br><span class="line">[FW_B-ipsec-proposal-tran1] esp authentication-algorithm sha2-256</span><br><span class="line">[FW_B-ipsec-proposal-tran1] esp encryption-algorithm aes-256</span><br><span class="line">[FW_B-ipsec-proposal-tran1] quit</span><br></pre></td></tr></table></figure>

<p>c、配置IKE安全提议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ike proposal 10</span><br><span class="line">[FW_B-ike-proposal-10] authentication-method pre-share</span><br><span class="line">[FW_B-ike-proposal-10] prf hmac-sha2-256</span><br><span class="line">[FW_B-ike-proposal-10] encryption-algorithm aes-256</span><br><span class="line">[FW_B-ike-proposal-10] dh group14</span><br><span class="line">[FW_B-ike-proposal-10] integrity-algorithm hmac-sha2-256 </span><br><span class="line">[FW_B-ike-proposal-10] quit</span><br></pre></td></tr></table></figure>

<p>d、配置IKE peer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ike peer a </span><br><span class="line">[FW_B-ike-peer-a] ike-proposal 10 </span><br><span class="line">[FW_B-ike-peer-a] remote-address 1.1.3.1 </span><br><span class="line">[FW_B-ike-peer-a] pre-shared-key Test!1234 </span><br><span class="line">[FW_B-ike-peer-a] quit</span><br></pre></td></tr></table></figure>

<p>e、配置IPSec策略</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] ipsec policy map1 10 isakmp </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] security acl 3000 </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] proposal tran1 </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] ike-peer a </span><br><span class="line">[FW_B-ipsec-policy-isakmp-map1-10] quit</span><br></pre></td></tr></table></figure>

<p>f、在接口GE1&#x2F;0&#x2F;1上应用IPSec策略组map1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[FW_B] interface gigabitethernet 1/0/1</span><br><span class="line">[FW_B-GigabitEthernet1/0/1] ipsec policy map1</span><br><span class="line">[FW_B-GigabitEthernet1/0/1] quit</span><br></pre></td></tr></table></figure>

<p><strong>二、GRE over IPSEC</strong></p>
<p>1、修改ACL,重新定义ipsec 感兴趣流</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[FW1]acl number 3000</span><br><span class="line">[FW2-acl-adv-3000]undo rule 5 </span><br><span class="line">  Warning: The ACL is referenced by IPSec, if the data flows to be encrypted are deleted, this may cause service interruption. Are you sure to d ：y</span><br><span class="line">[FW2-acl-adv-3000]rule  5 permit gre </span><br></pre></td></tr></table></figure>

<h1 id="数据通信15"><a href="#数据通信15" class="headerlink" title="数据通信15"></a>数据通信15</h1><p>[TOC]</p>
<h2 id="SSL-VPN"><a href="#SSL-VPN" class="headerlink" title="SSL VPN"></a>SSL VPN</h2><h3 id="概述-8"><a href="#概述-8" class="headerlink" title="概述"></a>概述</h3><p>SSL VPN是采用<a target="_blank" rel="noopener" href="https://info.support.huawei.com/info-finder/encyclopedia/zh/SSL.html">SSL</a>（Security Socket Layer）&#x2F;TLS（Transport Layer Security）协议来实现远程接入的一种轻量级<a target="_blank" rel="noopener" href="https://info.support.huawei.com/info-finder/encyclopedia/zh/VPN.html">VPN</a>技术。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240327092835589.png" alt="image-20240327092835589"></p>
<h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ul>
<li>基于证书的认证</li>
<li>ssl协议内置于浏览器中</li>
<li>构建隧道后即可访问企业内网</li>
</ul>
<h3 id="工作流程-1"><a href="#工作流程-1" class="headerlink" title="工作流程"></a>工作流程</h3><ol>
<li>用户访问企业内网时先与SSL VPN服务器之间建立安全<strong>连接隧道</strong></li>
<li>用户访问SSL VPN服务器，<strong>服务器对用户身份进行认证</strong></li>
<li>接着SSL服务器将报文转发给特定的内部服务器（web ftp ）</li>
</ol>
<h3 id="与ipsec对比优点"><a href="#与ipsec对比优点" class="headerlink" title="与ipsec对比优点"></a>与ipsec对比优点</h3><ul>
<li><strong>轻量级</strong></li>
<li><strong>安全性</strong>不输于ipsec vpn</li>
<li>浏览器登录，便捷性（无需客户端）</li>
<li><strong>低成本</strong></li>
<li><strong>只能基于五元组数据流建立IPSec</strong>，无法明确区分出使用某终端接入IPSec的人是否为指定的授权用户，即<strong>管理员无法确知是谁在利用VPN</strong>访问内网资源</li>
<li>SSL VPN工作在传输层和应用层之间，<strong>不会改变IP报文头和TCP报文头</strong>，不会影响原有网络拓扑。如果网络中部署了防火墙，只需放行传统的HTTPS（443）端口。</li>
<li>更重要的，相对于IPSec网络层的控制，SSL VPN的所有访问控制都是基于应用层，其<strong>细分程度可以达到URL或文件级别</strong>，可以大大提高企业远程接入的安全级别。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240327093403440.png" alt="image-20240327093403440"></p>
<h3 id="访问SSL-VPN服务器的典型步骤"><a href="#访问SSL-VPN服务器的典型步骤" class="headerlink" title="访问SSL VPN服务器的典型步骤"></a>访问SSL VPN服务器的典型步骤</h3><ol>
<li>打开浏览器，输入https：&#x2F;&#x2F;SSL VPN服务器地址：端口或者https：&#x2F;&#x2F;域名</li>
<li>可能会显示网站证书有问题，我们选择“继续浏览该网站”</li>
<li>进入服务器web登录界面，输入用户名和密码，登录成功</li>
</ol>
<h3 id="SSL运行机制"><a href="#SSL运行机制" class="headerlink" title="SSL运行机制"></a>SSL运行机制</h3><h4 id="ssl特点"><a href="#ssl特点" class="headerlink" title="ssl特点"></a>ssl特点</h4><p>（1）所有要传输的数据信息都是加密传输，第三方无法解密<br>（2）具有校验机制，信息一旦被篡改，通信双方会立刻发现。<br>（3）配备身份证书，防止身份被冒充。</p>
<h4 id="ssl协议结构"><a href="#ssl协议结构" class="headerlink" title="ssl协议结构"></a>ssl协议结构</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240327160846755.png" alt="image-20240327160846755"></p>
<ul>
<li>握手协议：身份认证、协商加密、交换加密密钥（服务器端将其<strong>公钥告诉客户端</strong>，然后客户端用服务器的<strong>公钥加密信息</strong>，服务器收到密文后，<strong>用自己的私钥解密</strong>。）</li>
<li>密码变化协议：通知对方将使用新的算法和密钥</li>
<li>警告协议：发现任何异常通知对方</li>
</ul>
<h4 id="ssl打补丁"><a href="#ssl打补丁" class="headerlink" title="ssl打补丁"></a>ssl打补丁</h4><p> （1）公钥如何不被篡改？</p>
<pre><code>        &lt;u&gt;将服务器公钥放入服务器证书中，由服务器将证书传给客户端&lt;/u&gt;
</code></pre>
<p> （2）加解密计算量大，如何提升效率？</p>
<pre><code>        客户端与服务器采用公钥加密法协商出此“会话密钥”，而后续			的数据报文都使用此**“会话密钥”**进行加密和解密（即对称加密			法）
</code></pre>
<h4 id="ssl四次握手"><a href="#ssl四次握手" class="headerlink" title="ssl四次握手"></a>ssl四次握手</h4><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20240327162630041.png" alt="image-20240327162630041"></p>
<ol>
<li>client hello:握手第一步是客户端向服务端发送 Client Hello 消息，这个消息里包含了一个客户端生成的随机数 <strong>Random1</strong>、客户端支持的加密套件（Support Ciphers）和 SSL Version 等信息</li>
<li>server hello :server从 Client Hello 传过来的 Support Ciphers 里确定一份加密套件，这个套件决定了后续加密和生成摘要时具体使用哪些算法，另外还会生成一份随机数 <strong>Random2</strong>。</li>
<li>certificate: 发送服务端的证书及其根证书</li>
<li>Server Key Exchange:服务端交换通信密钥，如图发送了服务端加密公钥和签名算法</li>
<li>Server Hello Done</li>
<li>Client Key Exchange: 交换客户端的加密密钥,一个随机数<strong>pre-master-key</strong>，稍后用于生成“会话密钥”</li>
<li>Application Data Protocol: http-over-tls 业务数据安全传输</li>
</ol>
<p><strong><u>为什么是三个随机数呢？</u></strong></p>
<p><strong>为了增强安全性</strong>，每个随机数都是伪随机，但是元素变三个随机性就加了很多</p>
<p><strong><u>server hello过程就是不安全网站显示的原因</u></strong></p>
<p>从第1步骤客户端（远程用户）发起https访问SSL VPN服务器起，SSL协议已开始运行，第2步骤的提示，恰恰可以与SSL握手协议的第②次通信相对应：<strong>此时服务器将自己的本地证书传给了客户端，客户端要对服务器的证书进行认证，客户端发现该证书不可靠</strong></p>
<h2 id="SSL配置"><a href="#SSL配置" class="headerlink" title="SSL配置"></a>SSL配置</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image001.png" alt="img"></p>
<p><strong>配置管理ip</strong></p>
<p>使用默认用户名密码登录命令行</p>
<table>
<thead>
<tr>
<th>1</th>
<th>SG-6000#    show interface  #默认e0&#x2F;0所使用的的ip为自动获取</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>配置ip</strong></p>
<table>
<thead>
<tr>
<th>1</th>
<th>SG-6000#  configure</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>SG-6000(config)#    interface ethernet0&#x2F;0              2</td>
</tr>
<tr>
<td>3</td>
<td>SG-6000(config-if-eth0&#x2F;0)#    no ip add dhcp  #删除掉自动获取ip地址配置              3</td>
</tr>
<tr>
<td>4</td>
<td>SG-6000(config-if-eth0&#x2F;0)#    ip add 192.168.1.199 255.255.255.0               4</td>
</tr>
</tbody></table>
<p><strong>一</strong> <strong>、配置安全域</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image003.jpg" alt="img"></p>
<p><strong>二、配置****SSLVPN</strong></p>
<p><strong>1<strong><strong>、添加</strong></strong>sslvpn</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image005.jpg" alt="img"></p>
<p><strong>配置<strong><strong>sslvpen</strong></strong>认证域</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image007.jpg" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image009.jpg" alt="img"></p>
<p><strong>配置出接口和服务端口、</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image011.jpg" alt="img"></p>
<p><strong>配置虚拟接口</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image013.jpg" alt="img"></p>
<p><strong>配置<strong><strong>dhcp</strong></strong>分配，帮助<strong><strong>vpn</strong></strong>拨号进来用户分配<strong><strong>ip</strong></strong>地址</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image015.jpg" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image016.png" alt="img"></p>
<p><strong>配置客户端路由信息</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image018.jpg" alt="img"></p>
<p><strong>高级配置</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image020.jpg" alt="img"></p>
<p><strong>三、创建用户</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image022.jpg" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image024.jpg" alt="img"></p>
<p><strong>四、创建流量策略</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image026.jpg" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/.io//Users/alex/AppData/Local/Temp/msohtmlclip1/01/clip_image028.jpg" alt="img"></p>
<h2 id="几类VPN之间的对比"><a href="#几类VPN之间的对比" class="headerlink" title="几类VPN之间的对比"></a>几类VPN之间的对比</h2><h3 id="PPTP"><a href="#PPTP" class="headerlink" title="PPTP"></a>PPTP</h3><p><strong>点对点隧道协议</strong></p>
<h4 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h4><p>PPTP协议使用GRE（Generic Routing Encapsulation）协议来封装数据，通过这种封装方式可以在公共网络上建立一个安全的加密通道。由于PPTP协议较为简单，因此在实现和维护方面相对容易。</p>
<h4 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h4><p>PPTP协议适用于小型企业或个人用户，可以在家庭或小型企业网络中实现安全的远程访问。</p>
<h3 id="L2TP-3"><a href="#L2TP-3" class="headerlink" title="L2TP"></a>L2TP</h3><p><strong>L2TP是一种二层隧道协议</strong>，它可以将数据封装在L2TP协议中，然后通过公共网络进行传输。（pppoe）</p>
<h4 id="特点-3"><a href="#特点-3" class="headerlink" title="特点"></a>特点</h4><p>L2TP协议可以提供更好的安全性，因为<strong>它支持数据加密和身份验证功能</strong>。同时，L2TP协议还支持多隧道和负载均衡功能，可以更好地满足大规模网络的需求。</p>
<h4 id="应用场景-2"><a href="#应用场景-2" class="headerlink" title="应用场景"></a>应用场景</h4><p>L2TP协议适用于大型企业或服务提供商，可以在广域网或虚拟专用网络中实现安全的远程访问。</p>
<h3 id="IPSEC"><a href="#IPSEC" class="headerlink" title="IPSEC"></a>IPSEC</h3><p>IPSec是一种<strong>基于IP层的</strong>网络安全协议，它可以为IP数据包提供加密和认证功能</p>
<h4 id="特点-4"><a href="#特点-4" class="headerlink" title="特点"></a>特点</h4><p>IPSec协议可以提供端到端的安全性，因为它可以在数据传输过程中对数据进行加密和身份验证。同时，IPSec协议还支持多种加密算法和认证方式，可以更好地满足不同的安全需求。</p>
<h4 id="应用场景-3"><a href="#应用场景-3" class="headerlink" title="应用场景"></a>应用场景</h4><p>IPSec协议适用于需要在<strong>不同网络之间实现安全通信的场景</strong>，例如企业网、云服务和虚拟专用网络等。</p>
<h3 id="SSL"><a href="#SSL" class="headerlink" title="SSL"></a>SSL</h3><p>SSL&#x2F;TLS是一种<strong>基于传输层的</strong>网络安全协议，它可以为应用程序提供加密和身份验证功能。</p>
<h4 id="特点-5"><a href="#特点-5" class="headerlink" title="特点"></a>特点</h4><p>SSL&#x2F;TLS协议可以提供端到端的安全性，数据传输过程被加密，保证了数据的机密性和完整性。此外，SSL&#x2F;TLS协议还<strong>支持双向认证和公钥基础设施（PKI）技术</strong>，增强了通信的安全性。</p>
<h4 id="应用场景-4"><a href="#应用场景-4" class="headerlink" title="应用场景"></a>应用场景</h4><p>SSL&#x2F;TLS协议广泛应用于Web浏览器和服务器之间的通信、电子邮件、即时消息传输等场景。它可以在不安全的网络环境中为应用程序提供安全通信的能力。</p>
<h3 id="异同点"><a href="#异同点" class="headerlink" title="异同点"></a>异同点</h3><h4 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h4><p>IPSec VPN：<br>  IPSec协议提供了端到端的安全性，可以确保数据传输过程中的机密性和完整性。它支持多种加密算法和认证方式，提供了更高级别的安全性保障。在网络隔离性方面，IPSec VPN通常只能在相同网络环境中的设备之间建立安全的连接，难以实现不同网络环境之间的安全通信。</p>
<p>L2TP VPN：<br> L2TP协议可以提供数据加密和身份验证功能，具有一定的安全性。但是相对于IPSec VPN，其安全性较低。在网络隔离性方面，L2TP VPN可以在不同网络环境中的设备之间建立安全的连接，实现较好的网络隔离性。</p>
<p>SSL VPN：<br>  SSL&#x2F;TLS协议提供了端到端的安全性，可以确保数据传输过程中的机密性和完整性。它还支持双向认证和公钥基础设施（PKI）技术，增强了通信的安全性。在网络隔离性方面，SSL&#x2F;TLS VPN可以实现不同网络环境之间的安全通信，但相对于L2TP VPN，其隔离性可能较弱。</p>
<p>PPTP VPN：<br> 安全性相对较弱，因为它只提供基本的加密和身份验证功能。对网络隔离性的支持较弱，适用于家庭或小型企业网络环境。</p>
<p><strong>总而言之，PPTP、L2TP、IPSec和SSL&#x2F;TLS四种VPN技术在协议和技术特点方面存在差异。</strong></p>
<p><strong>PPTP和L2TP主要应用于远程接入VPN场景，而IPSec和SSL&#x2F;TLS则更适用于虚拟专用网络或云服务的安全通信场景。</strong></p>
<p><strong>此外，PPTP和L2TP适用于小型或大型企业网络环境，而IPSec和SSL&#x2F;TLS则广泛应用于各种规模的网络环境。</strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://charles-webebr.github.io">charles-webber</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/">http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://charles-webebr.github.io" target="_blank">asuka&ayanami</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/">数据通信</a></div><div class="post_share"><div class="social-share" data-image="https://images.wallpaperscraft.com/image/single/sakura_flowers_bloom_125940_1280x720.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/07/10/openeuler/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.wallpaperscraft.com/image/single/snowflake_winter_macro_98434_1280x720.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">openeuler</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NzUzOS8zNDAwMw=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/6o/wallhaven-6o36qq.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">charles-webber</div><div class="author-info__description">never give up,keep moving</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/charles-webber"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://bilibili.com/" target="_blank" title="bilibili"><i class="fa-regular fa-heart"></i></a><a class="social-icon" href="mailto:1484145649@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://leetcode.cn/" target="_blank" title="gaming()"><i class="fa-solid fa-gamepad"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Dear Miss.? When i think of you'I'm reminded of the beautiful plains of Iowa.The distance between us is breaking my spirit. My time and experiences without you are meaningless to me. Falling in love with you was the easiest thing i have ever done.Nothing matters but you.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A11"><span class="toc-number">1.</span> <span class="toc-text">数据通信1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E8%AF%BE%E7%9F%A5%E8%AF%86%E7%A7%91%E6%99%AE%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">开课知识科普：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#osi%E4%B8%83%E5%B1%82%E7%BB%93%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">osi七层结结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%A9%E7%90%86%E5%B1%82%EF%BC%9A"><span class="toc-number">1.2.1.</span> <span class="toc-text">物理层：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%EF%BC%9A"><span class="toc-number">1.2.2.</span> <span class="toc-text">数据链路层：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#MAC%E5%B1%82%EF%BC%9A"><span class="toc-number">1.2.2.0.1.</span> <span class="toc-text">MAC层：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9A"><span class="toc-number">1.2.3.</span> <span class="toc-text">网络层：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#abc%E7%B1%BB%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">abc类地址分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8AIP%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">特殊IP地址：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A7%81%E6%9C%89%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">私有地址：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E8%81%9A%E5%90%88%EF%BC%9A"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">地址聚合：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86ARP"><span class="toc-number">1.2.3.5.</span> <span class="toc-text">代理ARP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Gratuitous-ARP"><span class="toc-number">1.2.3.6.</span> <span class="toc-text">Gratuitous ARP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RARP"><span class="toc-number">1.2.3.7.</span> <span class="toc-text">RARP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IP"><span class="toc-number">1.2.3.8.</span> <span class="toc-text">IP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82%EF%BC%9A"><span class="toc-number">1.2.4.</span> <span class="toc-text">传输层：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tcp%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">tcp首部格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%EF%BC%9A"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">三次握手：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">四次挥手</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">UDP的首部格式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">设备配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-number">1.4.</span> <span class="toc-text">问题：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.5.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A12"><span class="toc-number">2.</span> <span class="toc-text">数据通信2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ICMP%EF%BC%88%E4%BA%92%E8%81%94%E7%BD%91%E6%8E%A7%E5%88%B6%E4%BF%A1%E6%81%AF%E5%8D%8F%E8%AE%AE%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">ICMP（互联网控制信息协议）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ping%E4%BD%BF%E7%94%A8icmp%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">ping使用icmp的流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#traceroute%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.3.</span> <span class="toc-text">traceroute命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.4.</span> <span class="toc-text">协议类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FTP-Client"><span class="toc-number">2.2.</span> <span class="toc-text">FTP-Client</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8D%A2%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C%EF%BC%9A"><span class="toc-number">2.2.1.</span> <span class="toc-text">换镜像操作：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86FTP"><span class="toc-number">2.3.</span> <span class="toc-text">文件管理FTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-1"><span class="toc-number">2.4.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DHCP%EF%BC%88UDP%EF%BC%89"><span class="toc-number">2.5.</span> <span class="toc-text">DHCP（UDP）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B%EF%BC%9A"><span class="toc-number">2.5.1.</span> <span class="toc-text">简介：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%EF%BC%9A"><span class="toc-number">2.5.2.</span> <span class="toc-text">特点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DHCP%E7%B3%BB%E7%BB%9F%E7%BB%84%E6%88%90"><span class="toc-number">2.5.3.</span> <span class="toc-text">DHCP系统组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DHCP%E7%9A%84%E5%9C%B0%E5%9D%80%E5%88%86%E9%85%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">2.5.4.</span> <span class="toc-text">DHCP的地址分配方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96%E8%BF%87%E7%A8%8B"><span class="toc-number">2.5.5.</span> <span class="toc-text">IP地址的动态获取过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DHCP%E5%AE%9E%E9%AA%8C"><span class="toc-number">2.6.</span> <span class="toc-text">DHCP实验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3"><span class="toc-number">2.6.1.</span> <span class="toc-text">基于端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80DHCP"><span class="toc-number">2.6.2.</span> <span class="toc-text">全局DHCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E7%BB%A7DHCP"><span class="toc-number">2.6.3.</span> <span class="toc-text">中继DHCP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.6.3.1.</span> <span class="toc-text">服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E5%85%B3%E8%B7%AF%E7%94%B1"><span class="toc-number">2.6.3.2.</span> <span class="toc-text">网关路由</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8E%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3"><span class="toc-number">2.7.</span> <span class="toc-text">华为设备密码破解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">2.7.0.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C"><span class="toc-number">2.7.0.2.</span> <span class="toc-text">实验</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LLDP"><span class="toc-number">2.8.</span> <span class="toc-text">LLDP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VLAN%E6%8A%80%E6%9C%AF"><span class="toc-number">2.9.</span> <span class="toc-text">VLAN技术</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VLAN%E6%A0%87%E7%AD%BE"><span class="toc-number">2.10.</span> <span class="toc-text">VLAN标签</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A13"><span class="toc-number">3.</span> <span class="toc-text">数据通信3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#VLAN%E8%B7%AF%E7%94%B1"><span class="toc-number">3.1.</span> <span class="toc-text">VLAN路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VLAN-%E5%8D%95%E8%87%82%E8%B7%AF%E7%94%B1"><span class="toc-number">3.2.</span> <span class="toc-text">VLAN-单臂路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E7%BD%91%E7%AB%AF%E5%8F%A3%E6%8A%80%E6%9C%AF"><span class="toc-number">3.3.</span> <span class="toc-text">以太网端口技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8D%8F%E5%95%86"><span class="toc-number">3.3.1.</span> <span class="toc-text">自协商</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-number">3.3.2.</span> <span class="toc-text">流量控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88"><span class="toc-number">3.3.3.</span> <span class="toc-text">链路聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">手动模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LACP%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.3.3.2.</span> <span class="toc-text">LACP模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">3.3.3.2.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">3.3.3.2.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">3.3.3.2.3.</span> <span class="toc-text">实验配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">3.3.3.2.4.</span> <span class="toc-text">实验结果</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%A8%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88"><span class="toc-number">3.3.3.3.</span> <span class="toc-text">跨交换机的链路聚合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E9%95%9C%E5%83%8F"><span class="toc-number">3.3.4.</span> <span class="toc-text">端口镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STP%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.</span> <span class="toc-text">STP的原理及配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E8%BD%AC%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">3.4.1.</span> <span class="toc-text">交换机的转发流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E8%B7%AF%E9%97%AE%E9%A2%98"><span class="toc-number">3.4.2.</span> <span class="toc-text">环路问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">3.4.3.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E9%99%A4%E7%8E%AF%E8%B7%AF"><span class="toc-number">3.4.3.1.</span> <span class="toc-text">消除环路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-number">3.4.3.2.</span> <span class="toc-text">根交换机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.4.3.3.</span> <span class="toc-text">根端口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.4.3.4.</span> <span class="toc-text">指定端口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E7%8A%B6%E6%80%81%E6%8F%8F%E8%BF%B0"><span class="toc-number">3.4.3.5.</span> <span class="toc-text">端口状态描述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stp%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.3.6.</span> <span class="toc-text">stp配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RSTP%EF%BC%88%E5%BF%AB%EF%BC%81%EF%BC%89"><span class="toc-number">3.5.</span> <span class="toc-text">RSTP（快！）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%98%E6%9B%B4"><span class="toc-number">3.6.</span> <span class="toc-text">拓扑变更</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A"><span class="toc-number">4.</span> <span class="toc-text">课后作业</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5"><span class="toc-number">4.1.</span> <span class="toc-text">故障排查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82"><span class="toc-number">4.1.1.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E6%9D%A5%E6%BA%90%EF%BC%9A"><span class="toc-number">4.1.2.</span> <span class="toc-text">问题来源：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mstp-%E5%A4%9A%E7%94%9F%E6%88%90%E6%A0%91"><span class="toc-number">4.2.</span> <span class="toc-text">mstp(多生成树)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.2.1.</span> <span class="toc-text">单实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.2.2.</span> <span class="toc-text">多实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C"><span class="toc-number">4.3.</span> <span class="toc-text">综合实验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MSTP%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">4.4.</span> <span class="toc-text">MSTP的原理与配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MSTP%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">4.4.1.</span> <span class="toc-text">MSTP的基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%94%9F%E6%88%90%E6%A0%91%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.4.2.</span> <span class="toc-text">多生成树实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSTP%E9%85%8D%E7%BD%AE"><span class="toc-number">4.4.3.</span> <span class="toc-text">MSTP配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSTP%E5%8C%BA%E5%9F%9F"><span class="toc-number">4.4.4.</span> <span class="toc-text">MSTP区域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E8%A7%92%E8%89%B2"><span class="toc-number">4.4.5.</span> <span class="toc-text">端口角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%B9%E7%BC%98%E7%AB%AF%E5%8F%A3"><span class="toc-number">4.4.6.</span> <span class="toc-text">边缘端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-1"><span class="toc-number">4.4.7.</span> <span class="toc-text">实验配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%88%E6%A0%B9%E6%A1%A5%EF%BC%89%E8%AE%BE%E7%BD%AE"><span class="toc-number">4.4.8.</span> <span class="toc-text">优先级（根桥）设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">4.5.</span> <span class="toc-text">路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%9D%A5%E6%BA%90"><span class="toc-number">4.5.1.</span> <span class="toc-text">路由来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%B0%E5%AE%9E%E6%8A%93%E5%8C%85"><span class="toc-number">4.5.2.</span> <span class="toc-text">现实抓包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%E5%88%86%E7%B1%BB"><span class="toc-number">4.5.3.</span> <span class="toc-text">路由协议分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-number">4.5.4.</span> <span class="toc-text">路由表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%89%E4%BB%B7%E8%B7%AF%E7%94%B1%EF%BC%9AECMP"><span class="toc-number">4.5.5.</span> <span class="toc-text">等价路由：ECMP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E9%95%BF%E5%8C%B9%E9%85%8D%E5%8E%9F%E5%88%99"><span class="toc-number">4.5.6.</span> <span class="toc-text">最长匹配原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%8E%AF%E8%B7%AF"><span class="toc-number">4.5.7.</span> <span class="toc-text">路由环路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%AE%E5%8A%A8%E8%B7%AF%E7%94%B1"><span class="toc-number">4.5.8.</span> <span class="toc-text">浮动路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.6.</span> <span class="toc-text">动态路由协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0"><span class="toc-number">4.6.1.</span> <span class="toc-text">协议概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%B3%9B%E6%B4%AA"><span class="toc-number">4.6.2.</span> <span class="toc-text">路由泛洪</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%8E%AF%E8%B7%AF-1"><span class="toc-number">4.6.3.</span> <span class="toc-text">路由环路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E7%8E%AF%E8%B7%AF%E6%96%B9%E6%B3%95%E2%80%93%E6%9C%80%E5%A4%A7%E8%B7%B3%E6%95%B016"><span class="toc-number">4.6.3.1.</span> <span class="toc-text">解决环路方法–最大跳数16</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E7%8E%AF%E8%B7%AF%E6%96%B9%E6%B3%95%E2%80%93%E6%B0%B4%E5%B9%B3%E5%88%86%E5%89%B2"><span class="toc-number">4.6.3.2.</span> <span class="toc-text">解决环路方法–水平分割</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E7%8E%AF%E8%B7%AF%E6%96%B9%E6%B3%95%E2%80%93%E8%B7%AF%E7%94%B1%E6%8A%91%E5%88%B6"><span class="toc-number">4.6.3.3.</span> <span class="toc-text">解决环路方法–路由抑制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RIP"><span class="toc-number">4.6.4.</span> <span class="toc-text">RIP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0-1"><span class="toc-number">4.6.4.1.</span> <span class="toc-text">协议概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#V1%E5%92%8CV2%E5%8C%BA%E5%88%AB"><span class="toc-number">4.6.4.2.</span> <span class="toc-text">V1和V2区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">4.6.4.3.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RIP%E6%8E%A5%E5%8F%A3%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.6.4.4.</span> <span class="toc-text">RIP接口密码登录模式</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A14"><span class="toc-number">5.</span> <span class="toc-text">数据通信4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE"><span class="toc-number">5.1.</span> <span class="toc-text">思维导图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OSPF%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80"><span class="toc-number">5.2.</span> <span class="toc-text">OSPF路由协议基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%89%B9%E7%82%B9"><span class="toc-number">5.2.1.</span> <span class="toc-text">基本特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E7%8A%B6%E6%80%81%E7%AE%97%E6%B3%95%E7%9A%84%E8%B7%AF%E7%94%B1%E8%AE%A1%E7%AE%97%E8%BF%87%E7%A8%8B"><span class="toc-number">5.2.2.</span> <span class="toc-text">链路状态算法的路由计算过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OSPF%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">5.2.3.</span> <span class="toc-text">OSPF的基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9FAS"><span class="toc-number">5.2.3.1.</span> <span class="toc-text">自治系统AS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Router-ID"><span class="toc-number">5.2.3.2.</span> <span class="toc-text">Router ID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%92%E5%88%86%E5%8C%BA%E5%9F%9F"><span class="toc-number">5.2.3.3.</span> <span class="toc-text">划分区域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%86%E7%B1%BB"><span class="toc-number">5.2.3.4.</span> <span class="toc-text">路由器分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OSPF%E7%9A%84%E4%BA%94%E4%B8%AA%E6%8A%A5%E6%96%87"><span class="toc-number">5.2.3.5.</span> <span class="toc-text">OSPF的五个报文</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OSPF%E7%9A%84%E4%B8%83%E4%B8%AA%E9%82%BB%E5%B1%85%E7%8A%B6%E6%80%81"><span class="toc-number">5.2.3.6.</span> <span class="toc-text">OSPF的七个邻居状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">5.2.4.</span> <span class="toc-text">实验基本配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E7%9F%A5%E8%AF%86"><span class="toc-number">5.3.</span> <span class="toc-text">进阶知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%BB%E5%B1%85%E5%92%8C%E9%82%BB%E6%8E%A5"><span class="toc-number">5.3.1.</span> <span class="toc-text">邻居和邻接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DR%E5%92%8CBDR%E7%9A%84%E9%80%89%E4%B8%BE%E8%BF%87%E7%A8%8B"><span class="toc-number">5.3.2.</span> <span class="toc-text">DR和BDR的选举过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OSPF%E6%94%AF%E6%8C%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.3.3.</span> <span class="toc-text">OSPF支持的网络类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%BB%E5%B1%85%E5%BB%BA%E7%AB%8B"><span class="toc-number">5.3.4.</span> <span class="toc-text">邻居建立</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%82%BB%E5%B1%85%E7%8A%B6%E6%80%81"><span class="toc-number">5.3.4.0.1.</span> <span class="toc-text">邻居状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B"><span class="toc-number">5.3.4.0.2.</span> <span class="toc-text">邻居关系建立</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LSA%EF%BC%886%E7%A7%8D%E5%B8%B8%E8%A7%81%EF%BC%89"><span class="toc-number">5.3.5.</span> <span class="toc-text">LSA（6种常见）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Router-LSA%EF%BC%881%EF%BC%89"><span class="toc-number">5.3.5.1.</span> <span class="toc-text">Router-LSA（1）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Network-LSA%EF%BC%882%EF%BC%89"><span class="toc-number">5.3.5.2.</span> <span class="toc-text">Network-LSA（2）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Network-summary-LSA%EF%BC%883%EF%BC%89"><span class="toc-number">5.3.5.3.</span> <span class="toc-text">Network-summary-LSA（3）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ASBR-Summary-LSA%EF%BC%884%EF%BC%89"><span class="toc-number">5.3.5.4.</span> <span class="toc-text">ASBR-Summary-LSA（4）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AS-external-LSA%EF%BC%885%EF%BC%89"><span class="toc-number">5.3.5.5.</span> <span class="toc-text">AS-external-LSA（5）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NSSA-LSA%EF%BC%887%EF%BC%89"><span class="toc-number">5.3.5.6.</span> <span class="toc-text">NSSA LSA（7）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-2"><span class="toc-number">5.4.</span> <span class="toc-text">实验配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">5.4.1.</span> <span class="toc-text">虚连接的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OSPF%E7%89%B9%E6%AE%8A%E5%8C%BA%E5%9F%9F"><span class="toc-number">5.4.2.</span> <span class="toc-text">OSPF特殊区域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-3"><span class="toc-number">5.4.2.1.</span> <span class="toc-text">实验配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#stub"><span class="toc-number">5.4.2.1.1.</span> <span class="toc-text">stub</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#nssa"><span class="toc-number">5.4.2.1.2.</span> <span class="toc-text">nssa</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ospf%E4%B8%8B%E6%94%BE%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1"><span class="toc-number">5.4.3.</span> <span class="toc-text">ospf下放默认路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">5.4.3.1.</span> <span class="toc-text">手动配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E5%8C%BA%E5%9F%9F%E9%85%8D%E7%BD%AE"><span class="toc-number">5.4.3.2.</span> <span class="toc-text">特殊区域配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ospf%E8%AE%A4%E8%AF%81"><span class="toc-number">5.4.4.</span> <span class="toc-text">ospf认证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F%E8%AE%A4%E8%AF%81%EF%BC%9A"><span class="toc-number">5.4.4.1.</span> <span class="toc-text">区域认证：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E8%AE%A4%E8%AF%81%EF%BC%9A"><span class="toc-number">5.4.4.2.</span> <span class="toc-text">链路认证：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ospf%E8%B7%AF%E7%94%B1%E8%81%9A%E5%90%88%EF%BC%88%EF%BC%9F%EF%BC%89"><span class="toc-number">5.4.5.</span> <span class="toc-text">ospf路由聚合（？）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-number">5.4.5.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">5.4.5.2.</span> <span class="toc-text">命令配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F%E5%86%85%E9%83%A8%E8%81%9A%E5%90%88"><span class="toc-number">5.4.5.2.1.</span> <span class="toc-text">区域内部聚合</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88"><span class="toc-number">5.4.5.2.2.</span> <span class="toc-text">外部链路聚合</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ospf%E5%A4%9A%E8%BF%9B%E7%A8%8B"><span class="toc-number">5.4.6.</span> <span class="toc-text">ospf多进程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACL%EF%BC%9A%E7%AC%AC%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">5.5.</span> <span class="toc-text">ACL：第一代防火墙</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%99"><span class="toc-number">5.5.1.</span> <span class="toc-text">规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%ACACL%EF%BC%9A%EF%BC%88%E6%A0%B9%E6%8D%AE%EF%BC%89%E6%BA%90IP%E5%9C%B0%E5%9D%80%EF%BC%88%E8%BF%87%E6%BB%A4%EF%BC%89"><span class="toc-number">5.5.1.1.</span> <span class="toc-text">基本ACL：（根据）源IP地址（过滤）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7ACL%EF%BC%9A%E6%95%B4%E4%B8%AA%E7%BD%91%E6%AE%B5%E3%80%81%E6%9F%90%E4%B8%AAIP%E3%80%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.5.1.2.</span> <span class="toc-text">高级ACL：整个网段、某个IP、协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E5%B1%82ACL%EF%BC%9Amac%E5%9C%B0%E5%9D%80%E3%80%81802-1q%E3%80%81%E4%BA%8C%E5%B1%82%E5%8D%8F%E8%AE%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.5.1.3.</span> <span class="toc-text">二层ACL：mac地址、802.1q、二层协议类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89ACL-%EF%BC%9F"><span class="toc-number">5.5.1.4.</span> <span class="toc-text">用户自定义ACL:？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7ACL-%EF%BC%9F"><span class="toc-number">5.5.1.5.</span> <span class="toc-text">用户ACL:？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E6%88%90"><span class="toc-number">5.5.2.</span> <span class="toc-text">组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E6%9C%BA%E5%88%B6"><span class="toc-number">5.5.3.</span> <span class="toc-text">匹配机制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ospf%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5"><span class="toc-number">5.6.</span> <span class="toc-text">ospf故障排查</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A15"><span class="toc-number">6.</span> <span class="toc-text">数据通信5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8%E5%AE%9E%E7%8E%B0%E5%8C%85%E8%BF%87%E6%BB%A4%EF%BC%88acl%EF%BC%89"><span class="toc-number">6.1.</span> <span class="toc-text">访问控制列表实现包过滤（acl）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">6.1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACL%E5%8C%85%E8%BF%87%E6%BB%A4%E6%8A%80%E6%9C%AF"><span class="toc-number">6.1.2.</span> <span class="toc-text">ACL包过滤技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">6.1.3.</span> <span class="toc-text">工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6%E6%8E%A9%E7%A0%81"><span class="toc-number">6.1.4.</span> <span class="toc-text">*通配符掩码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACL%E7%9A%84%E6%A0%87%E8%AF%86"><span class="toc-number">6.1.5.</span> <span class="toc-text">ACL的标识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACL%E7%9A%84%E5%88%86%E7%B1%BB%EF%BC%88%E6%8C%89%E8%A7%84%E5%88%99%E5%AE%9A%E4%B9%89%E6%96%B9%E5%BC%8F%EF%BC%89"><span class="toc-number">6.1.6.</span> <span class="toc-text">ACL的分类（按规则定义方式）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%96%B9%E9%9D%A2"><span class="toc-number">6.1.7.</span> <span class="toc-text">应用方面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%95%88%E6%97%B6%E9%97%B4%EF%BC%88%E5%84%BF%E7%AB%A5%E9%94%81%EF%BC%89"><span class="toc-number">6.1.8.</span> <span class="toc-text">生效时间（儿童锁）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%91%A8%E6%9C%9F%E6%97%B6%E9%97%B4%E6%AE%B5"><span class="toc-number">6.1.8.1.</span> <span class="toc-text">第一种模式——周期时间段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E7%BB%9D%E5%AF%B9%E6%97%B6%E9%97%B4%E6%AE%B5"><span class="toc-number">6.1.8.2.</span> <span class="toc-text">第二种模式——绝对时间段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-4"><span class="toc-number">6.1.9.</span> <span class="toc-text">实验配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9Aacl%EF%BC%882000-2999%EF%BC%89"><span class="toc-number">6.1.9.1.</span> <span class="toc-text">普通acl（2000-2999）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7acl%EF%BC%883000-3999%EF%BC%89"><span class="toc-number">6.1.9.2.</span> <span class="toc-text">高级acl（3000-3999）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAT%E7%BB%84%E7%BD%91"><span class="toc-number">6.2.</span> <span class="toc-text">NAT组网</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-NAT"><span class="toc-number">6.2.1.</span> <span class="toc-text">Basic NAT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NAPT"><span class="toc-number">6.2.2.</span> <span class="toc-text">NAPT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3NAT%EF%BC%9A"><span class="toc-number">6.2.2.1.</span> <span class="toc-text">端口NAT：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%EF%BC%88%E8%BD%AC%E5%8F%91%EF%BC%89%EF%BC%9A"><span class="toc-number">6.2.2.2.</span> <span class="toc-text">端口映射（转发）：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Easy-IP"><span class="toc-number">6.2.2.3.</span> <span class="toc-text">Easy IP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81NAT"><span class="toc-number">6.2.3.</span> <span class="toc-text">动态NAT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81NAT"><span class="toc-number">6.2.3.1.</span> <span class="toc-text">静态NAT</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PPP%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.3.</span> <span class="toc-text">PPP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A7%E6%A0%BC%E5%BC%8F"><span class="toc-number">6.3.1.</span> <span class="toc-text">帧格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E5%BB%BA%E7%AB%8B%E8%BF%87%E7%A8%8B"><span class="toc-number">6.3.2.</span> <span class="toc-text">链路建立过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E7%BB%84%E6%88%90"><span class="toc-number">6.3.3.</span> <span class="toc-text">协议组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PPP%E5%9C%B0%E5%9D%80%E5%8D%8F%E5%95%86"><span class="toc-number">6.3.4.</span> <span class="toc-text">PPP地址协商</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PAP%E9%AA%8C%E8%AF%81"><span class="toc-number">6.3.5.</span> <span class="toc-text">PAP验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E6%96%B9"><span class="toc-number">6.3.5.1.</span> <span class="toc-text">认证方</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A2%AB%E8%AE%A4%E8%AF%81%E6%96%B9"><span class="toc-number">6.3.5.2.</span> <span class="toc-text">被认证方</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CHAP%E9%AA%8C%E8%AF%81"><span class="toc-number">6.3.6.</span> <span class="toc-text">CHAP验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E6%96%B9-1"><span class="toc-number">6.3.6.1.</span> <span class="toc-text">认证方</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A2%AB%E8%AE%A4%E8%AF%81%E6%96%B9-1"><span class="toc-number">6.3.6.2.</span> <span class="toc-text">被认证方</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E4%B9%A0"><span class="toc-number">6.4.</span> <span class="toc-text">预习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E5%89%8D%E7%BC%80%E5%88%97%E8%A1%A8"><span class="toc-number">6.4.1.</span> <span class="toc-text">地址前缀列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="toc-number">6.4.1.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E4%BE%9D%E6%8D%AE"><span class="toc-number">6.4.1.2.</span> <span class="toc-text">匹配依据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E5%8C%B9%E9%85%8D"><span class="toc-number">6.4.1.3.</span> <span class="toc-text">顺序匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%92%8Cacl%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.4.1.4.</span> <span class="toc-text">和acl的区别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%EF%BC%88%EF%BC%9F%EF%BC%89"><span class="toc-number">6.4.2.</span> <span class="toc-text">路由策略（？）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="toc-number">6.4.2.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">6.4.2.2.</span> <span class="toc-text">应用方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1%EF%BC%88%EF%BC%9F%EF%BC%89"><span class="toc-number">6.4.3.</span> <span class="toc-text">策略路由（？）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%BC%95%E5%85%A5%EF%BC%88%EF%BC%9F%EF%BC%89"><span class="toc-number">6.4.4.</span> <span class="toc-text">路由引入（？）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">6.4.4.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F"><span class="toc-number">6.4.4.2.</span> <span class="toc-text">方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%B7%A5%E5%85%B7"><span class="toc-number">6.5.</span> <span class="toc-text">路由选择工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ACL%E8%BF%87%E6%BB%A4%E8%B7%AF%E7%94%B1"><span class="toc-number">6.5.1.</span> <span class="toc-text">使用ACL过滤路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BC%80%E8%BF%87%E6%BB%A4%E8%B7%AF%E7%94%B1"><span class="toc-number">6.5.2.</span> <span class="toc-text">前缀过滤路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-3"><span class="toc-number">6.5.2.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E4%BE%9D%E6%8D%AE-1"><span class="toc-number">6.5.2.2.</span> <span class="toc-text">匹配依据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E5%8C%B9%E9%85%8D-1"><span class="toc-number">6.5.2.3.</span> <span class="toc-text">顺序匹配</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EBGP%E7%9A%84%E9%83%A8%E5%88%86%E5%B7%A5%E5%85%B7"><span class="toc-number">6.5.3.</span> <span class="toc-text">基于BGP的部分工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5"><span class="toc-number">6.6.</span> <span class="toc-text">路由策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%BC%95%E5%85%A5"><span class="toc-number">6.6.1.</span> <span class="toc-text">路由引入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rip-x2F-ospf%E5%BC%95%E5%85%A5"><span class="toc-number">6.6.1.1.</span> <span class="toc-text">rip&#x2F;ospf引入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%BF%87%E6%BB%A4"><span class="toc-number">6.6.2.</span> <span class="toc-text">路由过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#acl%E8%BF%87%E6%BB%A4%E8%B7%AF%E7%94%B1"><span class="toc-number">6.6.2.1.</span> <span class="toc-text">acl过滤路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IP%E5%89%8D%E7%BC%80%E5%88%97%E8%A1%A8%E8%BF%87%E6%BB%A4"><span class="toc-number">6.6.2.2.</span> <span class="toc-text">IP前缀列表过滤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8OSPF%E8%BF%87%E6%BB%A4%E8%B7%AF%E7%94%B1"><span class="toc-number">6.6.2.3.</span> <span class="toc-text">使用OSPF过滤路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%BC%95%E5%85%A5%E6%97%B6%E8%BF%87%E6%BB%A4%E8%B7%AF%E7%94%B1"><span class="toc-number">6.6.2.4.</span> <span class="toc-text">路由引入时过滤路由</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%BC%95%E5%85%A5%E5%AF%BC%E8%87%B4%E6%AC%A1%E4%BC%98%E8%B7%AF%E5%BE%84"><span class="toc-number">6.7.</span> <span class="toc-text">路由引入导致次优路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E6%AD%A2%E8%B7%AF%E7%94%B1%E7%8E%AF%E8%B7%AF"><span class="toc-number">6.8.</span> <span class="toc-text">防止路由环路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1"><span class="toc-number">6.9.</span> <span class="toc-text">策略路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-4"><span class="toc-number">6.9.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B"><span class="toc-number">6.9.2.</span> <span class="toc-text">流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A17"><span class="toc-number">7.</span> <span class="toc-text">数据通信7</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1-1"><span class="toc-number">7.1.</span> <span class="toc-text">策略路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">7.2.</span> <span class="toc-text">策略路由的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1%E5%92%8C%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">7.3.</span> <span class="toc-text">策略路由和路由策略的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1"><span class="toc-number">7.4.</span> <span class="toc-text">接口策略路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">7.4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4"><span class="toc-number">7.4.2.</span> <span class="toc-text">配置步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IPV6"><span class="toc-number">7.5.</span> <span class="toc-text">IPV6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IPV6%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0"><span class="toc-number">7.5.1.</span> <span class="toc-text">IPV6协议概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPV6%E5%92%8CIPV4"><span class="toc-number">7.5.2.</span> <span class="toc-text">IPV6和IPV4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB"><span class="toc-number">7.5.3.</span> <span class="toc-text">IPv6地址分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84"><span class="toc-number">7.5.4.</span> <span class="toc-text">IPv6地址结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E5%8D%95%E6%92%AD%E5%9C%B0%E5%9D%80"><span class="toc-number">7.5.5.</span> <span class="toc-text">IPv6单播地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E6%9C%AC%E5%9C%B0%E5%9C%B0%E5%9D%80%EF%BC%88fe80-x2F-10%E2%80%94-1111111010%EF%BC%89"><span class="toc-number">7.5.5.1.</span> <span class="toc-text">链路本地地址（fe80::&#x2F;10—-1111111010）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E6%9C%AC%E5%9C%B0%E5%9C%B0%E5%9D%80"><span class="toc-number">7.5.5.2.</span> <span class="toc-text">唯一本地地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E7%90%83%E5%8D%95%E6%92%AD%E5%9C%B0%E5%9D%80"><span class="toc-number">7.5.5.3.</span> <span class="toc-text">全球单播地址</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E4%BB%BB%E6%92%AD%E5%9C%B0%E5%9D%80"><span class="toc-number">7.5.6.</span> <span class="toc-text">IPv6任播地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E7%BB%84%E6%92%AD%E5%9C%B0%E5%9D%80"><span class="toc-number">7.5.7.</span> <span class="toc-text">IPv6组播地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPV6%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8C%85%E5%B0%81%E8%A3%85"><span class="toc-number">7.5.8.</span> <span class="toc-text">IPV6的数据包封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E5%9C%B0%E5%9D%80%E7%9A%84%E8%A1%A8%E7%A4%BA%E6%96%B9%E5%BC%8F"><span class="toc-number">7.5.9.</span> <span class="toc-text">IPv6地址的表示方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E5%9C%B0%E5%9D%80%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">7.5.10.</span> <span class="toc-text">IPv6地址的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E7%9A%84%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E5%BC%95%E5%85%A5"><span class="toc-number">7.5.11.</span> <span class="toc-text">IPv6的静态路由引入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E7%9A%84OSPFv3"><span class="toc-number">7.5.12.</span> <span class="toc-text">IPv6的OSPFv3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E7%9A%84rip"><span class="toc-number">7.5.13.</span> <span class="toc-text">IPv6的rip</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A18"><span class="toc-number">8.</span> <span class="toc-text">数据通信8</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">8.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bgp%E7%89%B9%E5%BE%81"><span class="toc-number">8.2.</span> <span class="toc-text">bgp特征</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BGP%E4%BA%94%E6%9D%A15%E6%8A%A5%E6%96%87"><span class="toc-number">8.3.</span> <span class="toc-text">BGP五条5报文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BGP%E7%9A%84%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">8.4.</span> <span class="toc-text">BGP的状态机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">8.5.</span> <span class="toc-text">工作过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B"><span class="toc-number">8.5.1.</span> <span class="toc-text">连接过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%9D%A0%E8%B7%AF%E7%94%B1%E6%9B%B4%E6%96%B0"><span class="toc-number">8.5.2.</span> <span class="toc-text">可靠路由更新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-5"><span class="toc-number">8.6.</span> <span class="toc-text">实验配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BGP%E7%AE%A1%E7%90%86%E8%B7%9D%E7%A6%BB%EF%BC%88%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%89"><span class="toc-number">8.7.</span> <span class="toc-text">BGP管理距离（优先级）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bgp%E8%A1%A8%E7%9A%84%E5%88%86%E6%9E%90"><span class="toc-number">8.8.</span> <span class="toc-text">bgp表的分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BGP%E5%B1%9E%E6%80%A7%E5%92%8C%E8%B7%AF%E5%BE%84%E9%80%89%E6%8B%A9%E5%A4%84%E7%90%86"><span class="toc-number">8.9.</span> <span class="toc-text">BGP属性和路径选择处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BGP%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">8.9.1.</span> <span class="toc-text">BGP的属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%88%86%E7%B1%BB"><span class="toc-number">8.9.2.</span> <span class="toc-text">属性分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BGP%E7%9A%84%E8%B7%AF%E5%BE%84%E9%80%89%E6%8B%A9"><span class="toc-number">8.9.3.</span> <span class="toc-text">BGP的路径选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%8F%8D%E5%B0%84"><span class="toc-number">8.10.</span> <span class="toc-text">路由反射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%81%94%E7%9B%9F"><span class="toc-number">8.11.</span> <span class="toc-text">路由联盟</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A19"><span class="toc-number">9.</span> <span class="toc-text">数据通信9</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#smart-link%EF%BC%88%E6%96%AD%E4%BA%86%E9%80%89%E8%B7%AF%EF%BC%89"><span class="toc-number">9.1.</span> <span class="toc-text">smart-link（断了选路）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-3"><span class="toc-number">9.1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">9.1.2.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-6"><span class="toc-number">9.1.3.</span> <span class="toc-text">实验配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#monitor-link%EF%BC%88%E4%B8%80%E8%B5%B7%E6%96%AD%EF%BC%89"><span class="toc-number">9.2.</span> <span class="toc-text">monitor-link（一起断）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-4"><span class="toc-number">9.2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-7"><span class="toc-number">9.2.2.</span> <span class="toc-text">实验配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VRRP%EF%BC%88%E5%A4%87%E4%BB%BD-%E4%B8%80%E4%B8%AA%E6%96%AD%E4%BA%86%E5%8F%A6%E4%B8%80%E4%B8%AA%E8%A1%A5%E4%B8%8A%EF%BC%89"><span class="toc-number">9.3.</span> <span class="toc-text">VRRP（备份-一个断了另一个补上）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-5"><span class="toc-number">9.3.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-8"><span class="toc-number">9.3.2.</span> <span class="toc-text">实验配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E7%8A%B6%E6%80%81%E7%9B%91%E6%B5%8B"><span class="toc-number">9.3.3.</span> <span class="toc-text">链路状态监测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3-1"><span class="toc-number">9.3.3.1.</span> <span class="toc-text">基于端口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Enqa"><span class="toc-number">9.3.3.2.</span> <span class="toc-text">基于nqa</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MUX-VLAN%EF%BC%88%E5%88%86%E9%9A%94vlan%EF%BC%89"><span class="toc-number">9.4.</span> <span class="toc-text">MUX-VLAN（分隔vlan）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%A7%84%E5%88%99"><span class="toc-number">9.4.1.</span> <span class="toc-text">访问规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-9"><span class="toc-number">9.4.2.</span> <span class="toc-text">实验配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VLAN%E8%81%9A%E5%90%88%EF%BC%88SUPER-VLAN%EF%BC%89"><span class="toc-number">9.5.</span> <span class="toc-text">VLAN聚合（SUPER VLAN）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-6"><span class="toc-number">9.5.0.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-10"><span class="toc-number">9.5.0.2.</span> <span class="toc-text">实验配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VLAN-QinQ%EF%BC%88vlan%E7%9A%84%E5%B5%8C%E5%A5%97%E6%98%A0%E5%B0%84%E5%A2%9E%E5%8A%A0%EF%BC%89"><span class="toc-number">9.6.</span> <span class="toc-text">VLAN-QinQ（vlan的嵌套映射增加）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-11"><span class="toc-number">9.6.1.</span> <span class="toc-text">实验配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95qinq-%E5%A4%9Avlan%E6%98%A0%E5%B0%84%E4%B8%80%E4%B8%AAvlan"><span class="toc-number">9.6.1.1.</span> <span class="toc-text">简单qinq(多vlan映射一个vlan)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%81%B5%E6%B4%BBqinq%EF%BC%88%E5%8D%95%E4%B8%AAvlan%E6%98%A0%E5%B0%84%E5%8D%95%E4%B8%AAvlan%EF%BC%89"><span class="toc-number">9.6.1.2.</span> <span class="toc-text">灵活qinq（单个vlan映射单个vlan）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VLAN-MAPPING"><span class="toc-number">9.7.</span> <span class="toc-text">VLAN-MAPPING</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-12"><span class="toc-number">9.7.1.</span> <span class="toc-text">实验配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A110"><span class="toc-number">10.</span> <span class="toc-text">数据通信10</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MAC%E5%9C%B0%E5%9D%80%E8%A1%A8%E9%A1%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">10.1.</span> <span class="toc-text">MAC地址表项配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81mac%E8%A1%A8%E9%A1%B9"><span class="toc-number">10.1.1.</span> <span class="toc-text">配置静态mac表项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEmac%E9%BB%91%E6%B4%9EMAC%E8%A1%A8%E9%A1%B9"><span class="toc-number">10.1.2.</span> <span class="toc-text">配置mac黑洞MAC表项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%8A%A8%E6%80%81MAC%E8%A1%A8%E9%A1%B9%E7%9A%84%E8%80%81%E5%8C%96%E6%97%B6%E9%97%B4"><span class="toc-number">10.1.3.</span> <span class="toc-text">配置动态MAC表项的老化时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MAC%E5%9C%B0%E5%9D%80%E8%A1%A8%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E4%B8%BE%E4%BE%8B"><span class="toc-number">10.1.4.</span> <span class="toc-text">MAC地址表安全配置举例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF"><span class="toc-number">10.1.5.</span> <span class="toc-text">端口安全技术</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DHCP-snooping%EF%BC%88%E7%AA%A5%E6%8E%A2%EF%BC%89"><span class="toc-number">10.2.</span> <span class="toc-text">DHCP snooping（窥探）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BA%E7%8E%B0%E8%83%8C%E6%99%AF"><span class="toc-number">10.2.1.</span> <span class="toc-text">出现背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-13"><span class="toc-number">10.2.2.</span> <span class="toc-text">实验配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IPSG"><span class="toc-number">10.3.</span> <span class="toc-text">IPSG</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VXLAN%EF%BC%9A%E8%99%9A%E6%8B%9F%E6%8B%93%E5%B1%95%E5%B1%80%E5%9F%9F%E7%BD%91%E2%80%93%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">10.4.</span> <span class="toc-text">VXLAN：虚拟拓展局域网–隧道技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">10.4.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">10.4.2.</span> <span class="toc-text">相关概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bdif"><span class="toc-number">10.4.2.1.</span> <span class="toc-text">bdif</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VAP"><span class="toc-number">10.4.2.2.</span> <span class="toc-text">VAP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#spine-leaf"><span class="toc-number">10.4.2.3.</span> <span class="toc-text">spine-leaf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NVE"><span class="toc-number">10.4.2.4.</span> <span class="toc-text">NVE</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vxlan%E5%87%BA%E7%8E%B0%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">10.4.3.</span> <span class="toc-text">vxlan出现的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">10.4.4.</span> <span class="toc-text">服务器虚拟化技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A8%E6%80%81%E8%BF%81%E7%A7%BB"><span class="toc-number">10.4.5.</span> <span class="toc-text">服务器动态迁移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vxlan%E7%9A%84%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F"><span class="toc-number">10.4.6.</span> <span class="toc-text">vxlan的报文格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VTEP"><span class="toc-number">10.4.6.1.</span> <span class="toc-text">VTEP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VNI"><span class="toc-number">10.4.6.2.</span> <span class="toc-text">VNI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vxlan%E6%8A%A5%E6%96%87"><span class="toc-number">10.4.6.3.</span> <span class="toc-text">vxlan报文</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%AA%E4%BA%9Bvtep%E5%BB%BA%E7%AB%8B%E9%9A%A7%E9%81%93%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.7.</span> <span class="toc-text">哪些vtep建立隧道连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A7%E4%BA%8C%E5%B1%82%E7%BD%91%E7%BB%9C"><span class="toc-number">10.4.7.1.</span> <span class="toc-text">大二层网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8C%E4%B8%80%E5%A4%A7%E4%BA%8C%E5%B1%82%E5%9F%9FBD"><span class="toc-number">10.4.7.2.</span> <span class="toc-text">同一大二层域BD</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E6%8A%A5%E6%96%87%E4%BC%9A%E8%B5%B0vxlan%E9%9A%A7%E9%81%93"><span class="toc-number">10.4.8.</span> <span class="toc-text">哪些报文会走vxlan隧道</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E6%B4%BE"><span class="toc-number">10.4.8.1.</span> <span class="toc-text">传统派</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%B4%E6%96%B0%E6%B4%BE"><span class="toc-number">10.4.8.2.</span> <span class="toc-text">维新派</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%97%E5%AD%90"><span class="toc-number">10.4.8.3.</span> <span class="toc-text">栗子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VXLAN%E9%9A%A7%E9%81%93%E7%9A%84%E5%BB%BA%E7%AB%8B"><span class="toc-number">10.4.9.</span> <span class="toc-text">VXLAN隧道的建立</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8"><span class="toc-number">10.4.9.1.</span> <span class="toc-text">手动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8"><span class="toc-number">10.4.9.2.</span> <span class="toc-text">自动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VXLAN%E9%9A%A7%E9%81%93%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">10.4.10.</span> <span class="toc-text">VXLAN隧道的选择</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VXLAN%E7%BD%91%E5%85%B3"><span class="toc-number">10.4.10.1.</span> <span class="toc-text">VXLAN网关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E4%B8%AD%E5%BC%8F%E7%BD%91%E5%85%B3"><span class="toc-number">10.4.10.2.</span> <span class="toc-text">集中式网关</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E4%B8%AD%E5%BC%8FVXLAN%E4%B8%AD%E4%B8%8D%E5%90%8C%E5%AD%90%E7%BD%91%E4%BA%92%E9%80%9A%E6%B5%81%E7%A8%8B"><span class="toc-number">10.4.11.</span> <span class="toc-text">集中式VXLAN中不同子网互通流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-14"><span class="toc-number">10.5.</span> <span class="toc-text">实验配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%90%8C%E7%BD%91%E6%AE%B5%E7%94%A8%E6%88%B7%E9%80%9A%E8%BF%87VXLAN%E9%9A%A7%E9%81%93%E4%BA%92%E9%80%9A"><span class="toc-number">10.5.1.</span> <span class="toc-text">配置同网段用户通过VXLAN隧道互通</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%9B%BE"><span class="toc-number">10.5.1.1.</span> <span class="toc-text">拓扑图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-number">10.5.1.2.</span> <span class="toc-text">命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E9%AA%8C%E8%AF%81"><span class="toc-number">10.5.1.3.</span> <span class="toc-text">结果验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E7%BD%91%E6%AE%B5%E7%94%A8%E6%88%B7%E9%80%9A%E8%BF%87VXLAN%E4%B8%89%E5%B1%82%E7%BD%91%E5%85%B3%E9%80%9A%E4%BF%A1"><span class="toc-number">10.5.2.</span> <span class="toc-text">配置不同网段用户通过VXLAN三层网关通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%9B%BE-1"><span class="toc-number">10.5.2.1.</span> <span class="toc-text">拓扑图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">10.5.2.2.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-15"><span class="toc-number">10.5.2.3.</span> <span class="toc-text">实验配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E6%A3%80%E9%AA%8C"><span class="toc-number">10.5.2.4.</span> <span class="toc-text">结果检验</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A111"><span class="toc-number">11.</span> <span class="toc-text">数据通信11</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%87%86%E5%85%A5%E6%8E%A7%E5%88%B6NAC"><span class="toc-number">11.1.</span> <span class="toc-text">网络准入控制NAC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="toc-number">11.1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#802-1x%E8%AE%A4%E8%AF%81"><span class="toc-number">11.1.2.</span> <span class="toc-text">802.1x认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-16"><span class="toc-number">11.1.3.</span> <span class="toc-text">实验配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pppoe"><span class="toc-number">11.2.</span> <span class="toc-text">pppoe</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-7"><span class="toc-number">11.2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-17"><span class="toc-number">11.2.2.</span> <span class="toc-text">实验配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%A0%86%E5%8F%A0"><span class="toc-number">11.3.</span> <span class="toc-text">路由堆叠</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">11.3.1.</span> <span class="toc-text">堆叠的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%90%E5%91%98%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-number">11.3.2.</span> <span class="toc-text">成员交换机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0ID"><span class="toc-number">11.3.3.</span> <span class="toc-text">堆叠ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">11.3.4.</span> <span class="toc-text">堆叠优先级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-18"><span class="toc-number">11.3.5.</span> <span class="toc-text">实验配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%9B%BE-2"><span class="toc-number">11.3.5.1.</span> <span class="toc-text">拓扑图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">11.3.5.2.</span> <span class="toc-text">代码</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A112"><span class="toc-number">12.</span> <span class="toc-text">数据通信12</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8"><span class="toc-number">12.1.</span> <span class="toc-text">信息安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99web%E5%AE%89%E8%A3%85"><span class="toc-number">12.2.</span> <span class="toc-text">防火墙web安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">12.3.</span> <span class="toc-text">防火墙</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E5%8C%BA%E5%9F%9F"><span class="toc-number">12.3.1.</span> <span class="toc-text">安全区域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99%E7%AD%96%E7%95%A5"><span class="toc-number">12.3.2.</span> <span class="toc-text">防火墙策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B"><span class="toc-number">12.3.3.</span> <span class="toc-text">状态检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E6%9C%BA%E5%88%B6"><span class="toc-number">12.3.4.</span> <span class="toc-text">会话机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">12.3.5.</span> <span class="toc-text">应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87%E5%AE%9E%E9%AA%8C"><span class="toc-number">12.3.5.1.</span> <span class="toc-text">双机热备实验</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#vrrp%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">12.3.5.1.1.</span> <span class="toc-text">vrrp的特点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vrrp%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">12.3.5.1.2.</span> <span class="toc-text">vrrp状态机</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vrrp%E7%94%A8%E4%BA%8E%E9%98%B2%E7%81%AB%E5%A2%99bug"><span class="toc-number">12.3.5.1.3.</span> <span class="toc-text">vrrp用于防火墙bug</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#VGMP%E7%89%B9%E7%82%B9"><span class="toc-number">12.3.5.1.4.</span> <span class="toc-text">VGMP特点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#VGMP%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">12.3.5.1.5.</span> <span class="toc-text">VGMP状态机</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#VGMP%E7%8A%B6%E6%80%81%E5%88%87%E6%8D%A2"><span class="toc-number">12.3.5.1.6.</span> <span class="toc-text">VGMP状态切换</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E5%8E%9F%E5%88%99"><span class="toc-number">12.3.5.1.6.1.</span> <span class="toc-text">切换原则</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87%E5%AE%9E%E9%AA%8C-1"><span class="toc-number">12.4.</span> <span class="toc-text">双机热备实验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%9B%BE-3"><span class="toc-number">12.4.1.</span> <span class="toc-text">拓扑图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84"><span class="toc-number">12.4.2.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95"><span class="toc-number">12.4.3.</span> <span class="toc-text">实现方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VGMP%E7%8A%B6%E6%80%81%E6%9C%BA-1"><span class="toc-number">12.4.4.</span> <span class="toc-text">VGMP状态机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VGMP%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2"><span class="toc-number">12.4.5.</span> <span class="toc-text">VGMP主从切换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-19"><span class="toc-number">12.4.6.</span> <span class="toc-text">实验配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VPN"><span class="toc-number">12.5.</span> <span class="toc-text">VPN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">12.5.1.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96vpn"><span class="toc-number">12.5.2.</span> <span class="toc-text">其他vpn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GRE%EF%BC%88ip%E5%8D%8F%E8%AE%AE%E5%8F%B747%EF%BC%89"><span class="toc-number">12.5.3.</span> <span class="toc-text">GRE（ip协议号47）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-5"><span class="toc-number">12.5.3.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84%EF%BC%88%E5%8A%A0%E5%B0%81%E8%A3%85%EF%BC%89"><span class="toc-number">12.5.3.2.</span> <span class="toc-text">报文结构（加封装）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-1"><span class="toc-number">12.5.3.3.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">12.5.3.4.</span> <span class="toc-text">缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E8%BF%87%E7%A8%8B"><span class="toc-number">12.5.4.</span> <span class="toc-text">传输过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GRE%E9%9A%A7%E9%81%93keeplive"><span class="toc-number">12.5.5.</span> <span class="toc-text">GRE隧道keeplive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GRE%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">12.5.6.</span> <span class="toc-text">GRE实验配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%9B%BE-4"><span class="toc-number">12.5.6.1.</span> <span class="toc-text">拓扑图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AE%BE%E5%A4%87IP%E5%9C%B0%E5%9D%80"><span class="toc-number">12.5.6.2.</span> <span class="toc-text">配置设备IP地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">12.5.6.3.</span> <span class="toc-text">配置防火墙</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEOSPF"><span class="toc-number">12.5.6.4.</span> <span class="toc-text">配置OSPF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AENAT"><span class="toc-number">12.5.6.5.</span> <span class="toc-text">配置NAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEGRE-VPN"><span class="toc-number">12.5.6.6.</span> <span class="toc-text">配置GRE VPN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEVPN%E8%B7%AF%E7%94%B1"><span class="toc-number">12.5.6.7.</span> <span class="toc-text">配置VPN路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEVPN%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%AD%96%E7%95%A5"><span class="toc-number">12.5.6.8.</span> <span class="toc-text">配置VPN接口的策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">12.5.6.9.</span> <span class="toc-text">测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#pc%E4%BA%92ping"><span class="toc-number">12.5.6.9.1.</span> <span class="toc-text">pc互ping</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%99%9A%E6%8E%A5%E5%8F%A3%E4%BA%92ping"><span class="toc-number">12.5.6.9.2.</span> <span class="toc-text">虚接口互ping</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IPsec"><span class="toc-number">12.6.</span> <span class="toc-text">IPsec</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AH%EF%BC%88%E5%88%AB%E7%94%A8%EF%BC%89"><span class="toc-number">12.6.1.</span> <span class="toc-text">AH（别用）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ESP"><span class="toc-number">12.6.2.</span> <span class="toc-text">ESP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E5%B0%81%E8%A3%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.6.3.</span> <span class="toc-text">协议封装模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DH%E7%AE%97%E6%B3%95"><span class="toc-number">12.6.4.</span> <span class="toc-text">DH算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IKE%E5%8D%8F%E5%95%86"><span class="toc-number">12.6.5.</span> <span class="toc-text">IKE协商</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E8%A6%81%E7%B4%A0"><span class="toc-number">12.7.</span> <span class="toc-text">安全要素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%A7%A3%E5%AF%86"><span class="toc-number">12.8.</span> <span class="toc-text">加解密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="toc-number">12.8.1.</span> <span class="toc-text">对称加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="toc-number">12.8.2.</span> <span class="toc-text">非对称加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E5%8A%A0%E5%AF%86"><span class="toc-number">12.8.3.</span> <span class="toc-text">混合加密</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C"><span class="toc-number">12.9.</span> <span class="toc-text">完整性校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#md5"><span class="toc-number">12.9.1.</span> <span class="toc-text">md5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HMAC"><span class="toc-number">12.9.2.</span> <span class="toc-text">HMAC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D"><span class="toc-number">12.10.</span> <span class="toc-text">数字签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#L2TP"><span class="toc-number">12.11.</span> <span class="toc-text">L2TP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ipsec%E9%85%8D%E7%BD%AE"><span class="toc-number">12.12.</span> <span class="toc-text">ipsec配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E5%9B%BE"><span class="toc-number">12.12.1.</span> <span class="toc-text">网络拓扑图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B"><span class="toc-number">12.12.2.</span> <span class="toc-text">配置过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A113"><span class="toc-number">13.</span> <span class="toc-text">数据通信13</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87%E5%AE%9E%E9%AA%8C-2"><span class="toc-number">13.1.</span> <span class="toc-text">双机热备实验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%9B%BE-5"><span class="toc-number">13.1.1.</span> <span class="toc-text">拓扑图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-1"><span class="toc-number">13.1.2.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95-1"><span class="toc-number">13.1.3.</span> <span class="toc-text">实现方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VGMP%E7%8A%B6%E6%80%81%E6%9C%BA-2"><span class="toc-number">13.1.4.</span> <span class="toc-text">VGMP状态机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VGMP%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2-1"><span class="toc-number">13.1.5.</span> <span class="toc-text">VGMP主从切换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-20"><span class="toc-number">13.1.6.</span> <span class="toc-text">实验配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VPN-1"><span class="toc-number">13.2.</span> <span class="toc-text">VPN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB-1"><span class="toc-number">13.2.1.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96vpn-1"><span class="toc-number">13.2.2.</span> <span class="toc-text">其他vpn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GRE%EF%BC%88ip%E5%8D%8F%E8%AE%AE%E5%8F%B747%EF%BC%89-1"><span class="toc-number">13.2.3.</span> <span class="toc-text">GRE（ip协议号47）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-6"><span class="toc-number">13.2.3.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84%EF%BC%88%E5%8A%A0%E5%B0%81%E8%A3%85%EF%BC%89-1"><span class="toc-number">13.2.3.2.</span> <span class="toc-text">报文结构（加封装）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-2"><span class="toc-number">13.2.3.3.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-1"><span class="toc-number">13.2.3.4.</span> <span class="toc-text">缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E8%BF%87%E7%A8%8B-1"><span class="toc-number">13.2.4.</span> <span class="toc-text">传输过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GRE%E9%9A%A7%E9%81%93keeplive-1"><span class="toc-number">13.2.5.</span> <span class="toc-text">GRE隧道keeplive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GRE%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE-1"><span class="toc-number">13.2.6.</span> <span class="toc-text">GRE实验配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%9B%BE-6"><span class="toc-number">13.2.6.1.</span> <span class="toc-text">拓扑图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AE%BE%E5%A4%87IP%E5%9C%B0%E5%9D%80-1"><span class="toc-number">13.2.6.2.</span> <span class="toc-text">配置设备IP地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99-1"><span class="toc-number">13.2.6.3.</span> <span class="toc-text">配置防火墙</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEOSPF-1"><span class="toc-number">13.2.6.4.</span> <span class="toc-text">配置OSPF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AENAT-1"><span class="toc-number">13.2.6.5.</span> <span class="toc-text">配置NAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEGRE-VPN-1"><span class="toc-number">13.2.6.6.</span> <span class="toc-text">配置GRE VPN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEVPN%E8%B7%AF%E7%94%B1-1"><span class="toc-number">13.2.6.7.</span> <span class="toc-text">配置VPN路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEVPN%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%AD%96%E7%95%A5-1"><span class="toc-number">13.2.6.8.</span> <span class="toc-text">配置VPN接口的策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="toc-number">13.2.6.9.</span> <span class="toc-text">测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#pc%E4%BA%92ping-1"><span class="toc-number">13.2.6.9.1.</span> <span class="toc-text">pc互ping</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%99%9A%E6%8E%A5%E5%8F%A3%E4%BA%92ping-1"><span class="toc-number">13.2.6.9.2.</span> <span class="toc-text">虚接口互ping</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IPsec-1"><span class="toc-number">13.3.</span> <span class="toc-text">IPsec</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AH%EF%BC%88%E5%88%AB%E7%94%A8%EF%BC%89-1"><span class="toc-number">13.3.1.</span> <span class="toc-text">AH（别用）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ESP-1"><span class="toc-number">13.3.2.</span> <span class="toc-text">ESP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E5%B0%81%E8%A3%85%E6%A8%A1%E5%BC%8F-1"><span class="toc-number">13.3.3.</span> <span class="toc-text">协议封装模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DH%E7%AE%97%E6%B3%95-1"><span class="toc-number">13.3.4.</span> <span class="toc-text">DH算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IKE%E5%8D%8F%E5%95%86-1"><span class="toc-number">13.3.5.</span> <span class="toc-text">IKE协商</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E8%A6%81%E7%B4%A0-1"><span class="toc-number">13.4.</span> <span class="toc-text">安全要素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%A7%A3%E5%AF%86-1"><span class="toc-number">13.5.</span> <span class="toc-text">加解密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86-1"><span class="toc-number">13.5.1.</span> <span class="toc-text">对称加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86-1"><span class="toc-number">13.5.2.</span> <span class="toc-text">非对称加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E5%8A%A0%E5%AF%86-1"><span class="toc-number">13.5.3.</span> <span class="toc-text">混合加密</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C-1"><span class="toc-number">13.6.</span> <span class="toc-text">完整性校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#md5-1"><span class="toc-number">13.6.1.</span> <span class="toc-text">md5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HMAC-1"><span class="toc-number">13.6.2.</span> <span class="toc-text">HMAC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D-1"><span class="toc-number">13.7.</span> <span class="toc-text">数字签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#L2TP-1"><span class="toc-number">13.8.</span> <span class="toc-text">L2TP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ipsec%E9%85%8D%E7%BD%AE-1"><span class="toc-number">13.9.</span> <span class="toc-text">ipsec配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E5%9B%BE-1"><span class="toc-number">13.9.1.</span> <span class="toc-text">网络拓扑图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B-1"><span class="toc-number">13.9.2.</span> <span class="toc-text">配置过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A114"><span class="toc-number">14.</span> <span class="toc-text">数据通信14</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IPsec-2"><span class="toc-number">14.1.</span> <span class="toc-text">IPsec</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AH%EF%BC%88%E5%88%AB%E7%94%A8%EF%BC%89-2"><span class="toc-number">14.1.1.</span> <span class="toc-text">AH（别用）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ESP-2"><span class="toc-number">14.1.2.</span> <span class="toc-text">ESP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E5%B0%81%E8%A3%85%E6%A8%A1%E5%BC%8F-2"><span class="toc-number">14.1.3.</span> <span class="toc-text">协议封装模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DH%E7%AE%97%E6%B3%95-2"><span class="toc-number">14.1.4.</span> <span class="toc-text">DH算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IKE%E5%8D%8F%E5%95%86-2"><span class="toc-number">14.1.5.</span> <span class="toc-text">IKE协商</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E8%A6%81%E7%B4%A0-2"><span class="toc-number">14.2.</span> <span class="toc-text">安全要素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%A7%A3%E5%AF%86-2"><span class="toc-number">14.3.</span> <span class="toc-text">加解密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86-2"><span class="toc-number">14.3.1.</span> <span class="toc-text">对称加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86-2"><span class="toc-number">14.3.2.</span> <span class="toc-text">非对称加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E5%8A%A0%E5%AF%86-2"><span class="toc-number">14.3.3.</span> <span class="toc-text">混合加密</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C-2"><span class="toc-number">14.4.</span> <span class="toc-text">完整性校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#md5-2"><span class="toc-number">14.4.1.</span> <span class="toc-text">md5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HMAC-2"><span class="toc-number">14.4.2.</span> <span class="toc-text">HMAC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D-2"><span class="toc-number">14.5.</span> <span class="toc-text">数字签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#L2TP-2"><span class="toc-number">14.6.</span> <span class="toc-text">L2TP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ipsec%E9%85%8D%E7%BD%AE-2"><span class="toc-number">14.7.</span> <span class="toc-text">ipsec配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E5%9B%BE-2"><span class="toc-number">14.7.1.</span> <span class="toc-text">网络拓扑图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B-2"><span class="toc-number">14.7.2.</span> <span class="toc-text">配置过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A115"><span class="toc-number">15.</span> <span class="toc-text">数据通信15</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSL-VPN"><span class="toc-number">15.1.</span> <span class="toc-text">SSL VPN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-8"><span class="toc-number">15.1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-1"><span class="toc-number">15.1.2.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B-1"><span class="toc-number">15.1.3.</span> <span class="toc-text">工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8Eipsec%E5%AF%B9%E6%AF%94%E4%BC%98%E7%82%B9"><span class="toc-number">15.1.4.</span> <span class="toc-text">与ipsec对比优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AESSL-VPN%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%85%B8%E5%9E%8B%E6%AD%A5%E9%AA%A4"><span class="toc-number">15.1.5.</span> <span class="toc-text">访问SSL VPN服务器的典型步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSL%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6"><span class="toc-number">15.1.6.</span> <span class="toc-text">SSL运行机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl%E7%89%B9%E7%82%B9"><span class="toc-number">15.1.6.1.</span> <span class="toc-text">ssl特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl%E5%8D%8F%E8%AE%AE%E7%BB%93%E6%9E%84"><span class="toc-number">15.1.6.2.</span> <span class="toc-text">ssl协议结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl%E6%89%93%E8%A1%A5%E4%B8%81"><span class="toc-number">15.1.6.3.</span> <span class="toc-text">ssl打补丁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl%E5%9B%9B%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="toc-number">15.1.6.4.</span> <span class="toc-text">ssl四次握手</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSL%E9%85%8D%E7%BD%AE"><span class="toc-number">15.2.</span> <span class="toc-text">SSL配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%A0%E7%B1%BBVPN%E4%B9%8B%E9%97%B4%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">15.3.</span> <span class="toc-text">几类VPN之间的对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PPTP"><span class="toc-number">15.3.1.</span> <span class="toc-text">PPTP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-2"><span class="toc-number">15.3.1.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="toc-number">15.3.1.2.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#L2TP-3"><span class="toc-number">15.3.2.</span> <span class="toc-text">L2TP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-3"><span class="toc-number">15.3.2.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="toc-number">15.3.2.2.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPSEC"><span class="toc-number">15.3.3.</span> <span class="toc-text">IPSEC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-4"><span class="toc-number">15.3.3.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="toc-number">15.3.3.2.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSL"><span class="toc-number">15.3.4.</span> <span class="toc-text">SSL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-5"><span class="toc-number">15.3.4.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="toc-number">15.3.4.2.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%90%8C%E7%82%B9"><span class="toc-number">15.3.5.</span> <span class="toc-text">异同点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-number">15.3.5.1.</span> <span class="toc-text">安全性</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/" title="数据通信"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.wallpaperscraft.com/image/single/sakura_flowers_bloom_125940_1280x720.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据通信"/></a><div class="content"><a class="title" href="/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/" title="数据通信">数据通信</a><time datetime="2024-07-10T07:46:10.557Z" title="发表于 2024-07-10 15:46:10">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/openeuler/" title="openeuler"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.wallpaperscraft.com/image/single/snowflake_winter_macro_98434_1280x720.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="openeuler"/></a><div class="content"><a class="title" href="/2024/07/10/openeuler/" title="openeuler">openeuler</a><time datetime="2024-07-10T07:43:40.118Z" title="发表于 2024-07-10 15:43:40">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%80%83%E6%A0%B8%E6%80%BB%E7%BB%93/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%80%83%E6%A0%B8%E6%80%BB%E7%BB%93/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.130Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/openwrt/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/openwrt/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.128Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/ict%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%80%83%E6%A0%B8%E6%80%BB%E7%BB%93/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/ict%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%80%83%E6%A0%B8%E6%80%BB%E7%BB%93/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.116Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div></div></div></div></div></main><footer id="footer" style="background: -#77D78D"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By charles-webber</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Nice to meet you!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><div class="aplayer no-destroy" data-id="770116495" data-server="netease" data-type="playlist"   data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true" ></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'be1b66712a57497892f4e70a9fc0e4f9';
  var gaud_map_key = 'ec1c17e08135f345b1f956f3fa268b0c# 锟�??得�?�拷图web锟斤拷锟斤拷key';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.6534116,27.96920845';
  var clock_default_rectangle_enable = 'true';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item swiper_container_card" style="height: auto;width: 100%"><div id="random"><div id="random-banner"><canvas id="peoplecanvas"></canvas></div><a id="random-hover" style="width:100%;height:auto;" href="javascript:toRandomPost()" rel="external nofollow noreferrer" one-link-mark="yes"><i class="fa fa-paper-plane" style="margin-left:10px"></i><div style="margin-left:10px">随便逛逛<i class="fa-solid fa-arrow-right" style="margin-left:10px"></i></div></a></div><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/07/10/数据通信/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.wallpaperscraft.com/image/single/sakura_flowers_bloom_125940_1280x720.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-07-10</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/07/10/数据通信/&quot;);" href="javascript:void(0);" alt="">数据通信</a><div class="blog-slider__text">ict培训数据通信</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/07/10/数据通信/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/07/10/云计算/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.wallpaperscraft.com/image/single/silhouette_wall_screens_1067807_1280x720.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-07-10</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/07/10/云计算/&quot;);" href="javascript:void(0);" alt="">云计算</a><div class="blog-slider__text">ict培训云计算</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/07/10/云计算/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/07/10/openeuler/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.wallpaperscraft.com/image/single/snowflake_winter_macro_98434_1280x720.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-07-10</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/07/10/openeuler/&quot;);" href="javascript:void(0);" alt="">openeuler</a><div class="blog-slider__text">ict培训linux</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/07/10/openeuler/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/07/10/云服务/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.wallpaperscraft.com/image/single/cosmonaut_space_suit_multicolored_123724_1280x720.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-07-10</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/07/10/云服务/&quot;);" href="javascript:void(0);" alt="">云服务</a><div class="blog-slider__text">ict培训云服务</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/07/10/云服务/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/10/09/python学习之路/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://wallhaven.cc/w/85j9qo" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-09</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/10/09/python学习之路/&quot;);" href="javascript:void(0);" alt="">python learning</a><div class="blog-slider__text">python learning for AI</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/10/09/python学习之路/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/10/29/answer/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/zy/wallhaven-zygeko.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/10/29/answer/&quot;);" href="javascript:void(0);" alt="">answer</a><div class="blog-slider__text">a freshman's practice</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/10/29/answer/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/js/swiper.min.js"></script><script defer data-pjax src="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper_init.js"></script><script data-pjax src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/gsap/3.9.1/gsap.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/people.min.js"></script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('article-sort-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__slideInRight');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>