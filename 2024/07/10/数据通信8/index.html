<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>asuka&amp;ayanami | asuka&amp;ayanami</title><meta name="author" content="charles-webber"><meta name="copyright" content="charles-webber"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#78D77D"><meta name="description" content="数据通信8[TOC] 概述介绍  bgp的前身叫egp  自治系统内部ibgp，外部ebgp  可以将一个自治系统看成运营商，运营商的内部用什么协议无所谓，之间必须用bgp统一沟通方法   ibgp和ebgp对比  ibgp作用于区域内部，engp作用于区域之间 使用的bgp的属性不同 避免环路的措施不同：i—不转发学习到的路由前缀  e—as_path里有自己就会丢弃，as短越优先  bgp特征">
<meta property="og:type" content="article">
<meta property="og:title" content="asuka&amp;ayanami">
<meta property="og:url" content="http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A18/index.html">
<meta property="og:site_name" content="asuka&amp;ayanami">
<meta property="og:description" content="数据通信8[TOC] 概述介绍  bgp的前身叫egp  自治系统内部ibgp，外部ebgp  可以将一个自治系统看成运营商，运营商的内部用什么协议无所谓，之间必须用bgp统一沟通方法   ibgp和ebgp对比  ibgp作用于区域内部，engp作用于区域之间 使用的bgp的属性不同 避免环路的措施不同：i—不转发学习到的路由前缀  e—as_path里有自己就会丢弃，as短越优先  bgp特征">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg">
<meta property="article:published_time" content="2024-07-10T07:22:42.510Z">
<meta property="article:modified_time" content="2024-05-18T13:03:00.103Z">
<meta property="article:author" content="charles-webber">
<meta property="article:tag" content="i need something to cure me">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A18/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'asuka&ayanami',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-05-18 21:03:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#FF855DFF')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#78D77D')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/clock.min.css" /><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="asuka&ayanami" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/6o/wallhaven-6o36qq.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fa-solid fa-bell"></i><span> ACG</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> Message</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">asuka&amp;ayanami</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fa-solid fa-bell"></i><span> ACG</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> Message</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-10T07:22:42.510Z" title="发表于 2024-07-10 15:22:42">2024-07-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-05-18T13:03:00.103Z" title="更新于 2024-05-18 21:03:00">2024-05-18</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>13分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="数据通信8"><a href="#数据通信8" class="headerlink" title="数据通信8"></a>数据通信8</h1><p>[TOC]</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>介绍</strong></p>
<ul>
<li><p>bgp的前身叫egp</p>
</li>
<li><p><strong>自治系统内部ibgp</strong>，外部ebgp</p>
</li>
<li><p>可以将一个自治系统看成运营商，运营商的内部用什么协议无所谓，之间必须用bgp统一沟通方法</p>
</li>
</ul>
<p><strong>ibgp和ebgp对比</strong></p>
<ul>
<li>ibgp作用于区域内部，engp作用于区域之间</li>
<li>使用的bgp的属性不同</li>
<li>避免环路的措施不同：i—不转发学习到的路由前缀  e—as_path里有自己就会丢弃，as短越优先</li>
</ul>
<h2 id="bgp特征"><a href="#bgp特征" class="headerlink" title="bgp特征"></a>bgp特征</h2><p><strong>是一种增强的距离矢量路由协议</strong></p>
<p><strong>特点</strong></p>
<ul>
<li><p>设计避免了路由环路</p>
</li>
<li><p>路由附加信息多</p>
</li>
<li><p>路由过滤和路由策略多</p>
</li>
<li><p>可靠的路由更新机制</p>
</li>
<li><p><strong>丰富的Metric度量方法</strong></p>
</li>
<li><p>从设计上避免了环路的发生</p>
</li>
<li><p>支持CIDR（无类别域间选路）</p>
</li>
<li><p>每一个设备只能有一个as</p>
</li>
</ul>
<h2 id="BGP五条5报文"><a href="#BGP五条5报文" class="headerlink" title="BGP五条5报文"></a>BGP五条5报文</h2><ul>
<li><p>open：建立邻居关系（打开心扉）</p>
</li>
<li><p>KeepAlive：字面意思，维持邻居关系</p>
</li>
<li><p>Update：更新路由的报文</p>
</li>
<li><p>Notification：翻译为注意，相当于一个告警,当你配错了会指出你的问题</p>
</li>
<li><p>route-refresh:用于在改变<strong>路由策略</strong>后请求对等体重新发送路由信息（请求更新）</p>
</li>
</ul>
<h2 id="BGP的状态机"><a href="#BGP的状态机" class="headerlink" title="BGP的状态机"></a>BGP的状态机</h2><p>connect：tcp的连接（三次握手）</p>
<p>open-sent：tcp连接成功后发送open报文</p>
<p>open-confirm：准备接收对方报文（keep alive？notici？）</p>
<p>active：connet的tcp连接失败进入active不断尝试tcp建立</p>
<p>established：建立完成后的状态</p>
<p>idle：出现错误之后的状态</p>
<p><strong>可能的active原因（待补充）</strong></p>
<ul>
<li>过滤了本设备IP流量或者TCP流量或者TCP-179端口数据</li>
<li>本BGP设备配置错误的对等体地址</li>
</ul>
<h2 id="工作过程"><a href="#工作过程" class="headerlink" title="工作过程"></a>工作过程</h2><h3 id="连接过程"><a href="#连接过程" class="headerlink" title="连接过程"></a>连接过程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231121233214701.png" alt="image-20231121233214701"></p>
<ol>
<li>先进入到connect进行tcp三次握手tcp连接（失败后进入alive不断进行tcp连接，成功后发送open-sent ）</li>
<li>之后发送open报文</li>
<li>进入到openconfirm 后等待对方发送报文（接收到keep alive 进入established ，收到noticification进入到idle）</li>
<li>之后在established之间发update报文更新新加入路由，发keep alive维持邻居关系（ospf 是hello）</li>
<li><strong>idle是bgp的初始状态，任何状态出错都会回到idle</strong></li>
</ol>
<h3 id="可靠路由更新"><a href="#可靠路由更新" class="headerlink" title="可靠路由更新"></a>可靠路由更新</h3><p><strong>BGP也会利用IGP</strong></p>
<ul>
<li><p>协议：tcp 端口：179</p>
</li>
<li><p>无周期（路由）更新</p>
</li>
<li><p>更新增加的路由</p>
</li>
<li><p>周期发keepalive报文检测tcp连通</p>
</li>
</ul>
<h2 id="实验配置"><a href="#实验配置" class="headerlink" title="实验配置"></a>实验配置</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231118111336011.png" alt="image-20231118111336011"></p>
<ol>
<li>先宣告as：bgp 1（as 1）</li>
<li>宣告相连as：peer xxxx（目的地址）asnumber xxxx（双向奔赴）</li>
<li>如果要使用环回口进行bgp连接不能直接加目的地址，还要加上自己的发送环回口：（1）peer  4.4.4.4 asnumer 16（2）<strong>peer 4.4.4.4 connect-interface loop 0</strong>（注意：bgp建立邻居关系不能使用默认路由 ）</li>
<li><strong>nexthop</strong>：ibgp得到的路由信息只是简单的copy，但是中间的路由器下一跳路由表里面没有，增加一个下一跳行为（<strong>方式一</strong>：添加静态路由  <strong>方式二</strong>：<strong>next-hop-local</strong>—–[R2-bgp]peer 4.4.4.4 next-hop-local ）(?)</li>
<li>ebgp的一个特性是ttl值默认为1，那么在两个路由器之间跳数大于1时tcp就连接不了（双向修改ttl—peer 6.6.6.6 ebgp-max-hop 255）</li>
<li><strong>路由黑洞</strong>：中间的路由器缺少路由丢包</li>
</ol>
<p>​		解决方法：</p>
<ul>
<li><p>直接写一个静态路由（缺点有些路由器空间可能不够）</p>
</li>
<li><p>配置MPLS，用MPLS的标签交换数据包（?）</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[R2]route recursive-lookup tunnel </span><br><span class="line">[R2]mpls lsr-id <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line">[R2]mpls </span><br><span class="line">[R2]mpls ldp </span><br><span class="line">[R2]inter g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[R2-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]mpls </span><br><span class="line">[R2-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]mpls ldp </span><br><span class="line"></span><br><span class="line">[R2]display  mpls lsp #查看标签转发规则</span><br><span class="line"></span><br><span class="line">[R3]route recursive-lookup tunnel </span><br><span class="line">[R3]mpls lsr-id <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> </span><br><span class="line">[R3]mpls 	</span><br><span class="line">[R3]mpls ldp </span><br><span class="line">[R3]inter g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[R3-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]mpls</span><br><span class="line">[R3-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]mpls ldp </span><br><span class="line">[R3]inter g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[R3-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]mpls </span><br><span class="line">[R3-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]mpls ldp</span><br><span class="line"></span><br><span class="line">[R4]route recursive-lookup tunnel </span><br><span class="line">[R4]mpls lsr-id <span class="number">4.4</span><span class="number">.4</span><span class="number">.4</span></span><br><span class="line">[R4]mpls </span><br><span class="line">[R4]mpls ldp </span><br><span class="line">[R4]inter g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[R4-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]mpls </span><br><span class="line">[R4-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]mpls ldp </span><br></pre></td></tr></table></figure>

<p>解释：在进入到mpls区域里面之前不打标签（r2的0接口），进入到mpls之后启动mpls ldp的接口会为数据打上标签，按照标签表进行转发（可以打dis mpls lsp 查看标签表），出mpls的出接口不做配置，会自己将标签解除。</p>
<ul>
<li>使用路由联盟和路由反射</li>
<li>bgp同步</li>
<li>路由引入</li>
<li></li>
</ul>
<ol start="7">
<li><p><strong>bgp认证</strong>：bgp 1 然后peer 4.4.4.4 password cipher 123456</p>
</li>
<li><p><strong>bgp中使用路由策略</strong>：1.acl 2000 2.rule x deny&#x2F;permit 3.peer 4.4.4.4 as-num 16 filter-policy 2000 export&#x2F;import</p>
</li>
<li><p><strong>路由聚合</strong>：</p>
</li>
</ol>
<p>方式1(自动)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. bgp 1</span><br><span class="line">2. import-route direct</span><br><span class="line">3. summary automatic（只能聚合路由引入的路由）</span><br></pre></td></tr></table></figure>

<p>方式2（静态）：</p>
<p>太暴力了，能不能自定义聚合的长度呢？</p>
<p>有！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[R1]bgp 1</span><br><span class="line">[R1-bgp]network 10.1.0.0 24</span><br><span class="line">[R1-bgp]network 10.1.1.0 24</span><br><span class="line">[R1-bgp]network 10.1.2.0 24</span><br><span class="line">[R1-bgp]network 10.1.3.0 24</span><br><span class="line">[R1-bgp]ip route-static 10.1.0.0 22 null 0</span><br></pre></td></tr></table></figure>

<p>用引入路由聚合会直接聚合范围太大了，可以用引入静态路由的方法，优点是既可以自定义掩码长度，又可以防止成环（一个路由down了就跑到10.10.0.0 22 ，又因为是null 0直接就丢弃了，不会再去请求路由了）</p>
<p>​	方式3（手动）：</p>
<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[R1]bgp <span class="number">1</span></span><br><span class="line">[R1-bgp]network <span class="number">10</span><span class="variable">.1</span><span class="variable">.0</span><span class="variable">.0</span> <span class="number">24</span></span><br><span class="line">[R1-bgp]network <span class="number">10</span><span class="variable">.1</span><span class="variable">.1</span><span class="variable">.0</span> <span class="number">24</span></span><br><span class="line">[R1-bgp]network <span class="number">10</span><span class="variable">.1</span><span class="variable">.2</span><span class="variable">.0</span> <span class="number">24</span></span><br><span class="line">[R1-bgp]network <span class="number">10</span><span class="variable">.1</span><span class="variable">.3</span><span class="variable">.0</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[R1-bgp]aggregate <span class="number">10</span><span class="variable">.1</span><span class="variable">.0</span><span class="variable">.0</span> <span class="number">22</span>   使用此命令会使明细路由和汇总路由同时被宣告</span><br><span class="line">[R1-bgp]aggregate <span class="number">10</span><span class="variable">.1</span><span class="variable">.0</span><span class="variable">.0</span> <span class="number">22</span> detail-suppressed   只宣告汇总路由</span><br></pre></td></tr></table></figure>



<ol start="10">
<li><strong>peer group</strong></li>
</ol>
<p>​	就是为了方便打命令，类似于ctrl + v</p>
<p>​	</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[R2-bgp]group benben </span><br><span class="line">[R2-bgp]peer benben as-number <span class="number">16</span> </span><br><span class="line">[R2-bgp]peer <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> group benben</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​	</p>
<h2 id="BGP管理距离（优先级）"><a href="#BGP管理距离（优先级）" class="headerlink" title="BGP管理距离（优先级）"></a>BGP管理距离（优先级）</h2><p>ibgp：200</p>
<p>ebgp：255</p>
<h2 id="bgp表的分析"><a href="#bgp表的分析" class="headerlink" title="bgp表的分析"></a>bgp表的分析</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231118100119104.png" alt="image-20231118100119104"></p>
<ol>
<li>path用来防环操作</li>
<li>ogn表示用什么学习到路由，i代表igp，e代表bgp，？代表其他</li>
<li>*&gt;奇怪的命名，bgp和ibgp的这个符号不同(i)</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">                   </span><br><span class="line">Origin : i - IGP, e - EGP, ? - incomplete（引入路由）</span><br></pre></td></tr></table></figure>



<h2 id="BGP属性和路径选择处理"><a href="#BGP属性和路径选择处理" class="headerlink" title="BGP属性和路径选择处理"></a><strong>BGP属性和路径选择处理</strong></h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231123105752364.png" alt="image-20231123105752364"></p>
<h3 id="BGP的属性"><a href="#BGP的属性" class="headerlink" title="BGP的属性"></a>BGP的属性</h3><table>
<thead>
<tr>
<th>属性名</th>
<th>传播范围</th>
<th>默认值</th>
<th>评判标准</th>
</tr>
</thead>
<tbody><tr>
<td>PV</td>
<td>不传播</td>
<td>0</td>
<td>越大越好</td>
</tr>
<tr>
<td>LP</td>
<td>IGBP之间传播</td>
<td>100</td>
<td>越大越好</td>
</tr>
<tr>
<td>AS_PATH</td>
<td>EBGP 之间</td>
<td>无</td>
<td>记录数越少越好</td>
</tr>
<tr>
<td>OGN</td>
<td>EBGP 之间</td>
<td>根据起源类型决定</td>
<td>i&gt;e&gt;?</td>
</tr>
<tr>
<td>MED</td>
<td>EBGP 之间</td>
<td>继承了路由表中该路由条目的开销值</td>
<td>越小越优先</td>
</tr>
</tbody></table>
<h3 id="属性分类"><a href="#属性分类" class="headerlink" title="属性分类"></a>属性分类</h3><table>
<thead>
<tr>
<th>公认必遵（Well-known mandatory</th>
<th>公认任意（Well-known discretionary）</th>
<th>可选过渡（Optional transtive）</th>
<th>可选非过渡（Optional non-transtive）</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Origin(起源)</strong></td>
<td><strong>LOCAL-PREF（本地优先级）</strong></td>
<td><strong>AGGREGATOR（聚合）</strong></td>
<td><strong>MED（多出口鉴别器）</strong></td>
</tr>
<tr>
<td><strong>AS_PATH（AS路径）</strong></td>
<td><strong>ATOMIC_AGGREGATE（原子聚合）</strong></td>
<td><strong>COMMUNITY（团体）</strong></td>
<td><strong>ORIGINATOR_ ID（发起人ID）</strong></td>
</tr>
<tr>
<td><strong>NEXT_HOP（下一跳）</strong></td>
<td>&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</td>
<td>&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</td>
<td><strong>WEIGHT（权重值）</strong></td>
</tr>
</tbody></table>
<h3 id="BGP的路径选择"><a href="#BGP的路径选择" class="headerlink" title="BGP的路径选择"></a>BGP的路径选择</h3><ol>
<li><strong>WEIGHT&#x2F;Prefval属性</strong></li>
</ol>
<ul>
<li><p>多条路径weight&#x2F;prefval值高就先选哪一个</p>
</li>
<li><p>本地有效</p>
</li>
<li><p>路由策略永远都是import</p>
</li>
</ul>
<p>​	方式一：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[r4-bgp]peer <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> preferred-value <span class="number">100</span></span><br></pre></td></tr></table></figure>

<p>​	方式二：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>，抓取流量</span><br><span class="line">[r4]ip ip-prefix PV permit <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line"><span class="number">2</span>，做路由策略</span><br><span class="line">[r4]route-policy PV permit node <span class="number">10</span></span><br><span class="line">[r4-route-policy]<span class="keyword">if</span>-match ip-prefix pv</span><br><span class="line">[r4-route-policy]apply preferred-value <span class="number">100</span></span><br><span class="line">[r4]route-policy PV permit node <span class="number">20</span> --- 注意，必须要配置空表放通剩余所有流量</span><br><span class="line"><span class="number">3</span>，在BGP中调用路由策略</span><br><span class="line">[r4-bgp]peer <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> route-policy PV import</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>local preference</strong></li>
</ol>
<ul>
<li>Local preference是被用作去通告IBGP邻居怎样去离开他们的AS</li>
<li>Local preference被仅仅被发送给IBGP邻居的，（即仅同一AS内，是AS内部最常用的选路属性）</li>
<li>默认值是100</li>
</ul>
<p>方式一（全局）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[r3-bgp]<span class="keyword">default</span> local-preference <span class="number">200</span> --- R3之后发给IBGP对等体的路由的LP属性都将被改为<span class="number">200</span></span><br></pre></td></tr></table></figure>

<p>方式二（精细）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在R3的出方向做</span><br><span class="line"><span class="number">1</span>，抓取流量</span><br><span class="line">[r3]ip ip-prefix lp permit <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line"><span class="number">2</span>，做路由策略</span><br><span class="line">[r3]route-policy lp permit node <span class="number">10</span></span><br><span class="line">[r3-route-policy]<span class="keyword">if</span>-match ip-prefix lp</span><br><span class="line">[r3-route-policy]apply local-preference <span class="number">300</span></span><br><span class="line">[r3]route-policy lp permit node <span class="number">20</span></span><br><span class="line"><span class="number">3</span>，在BGP进程中调用</span><br><span class="line">[r3-bgp]peer <span class="number">4.4</span><span class="number">.4</span><span class="number">.4</span> route-policy lp export</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>路由起源于<strong>本地优先</strong>于从其他bgp邻居中学习到</li>
</ol>
<p>手工聚合 &gt; 自动聚合 &gt; network &gt; import</p>
<ol start="4">
<li><strong>ASPath越短越优先</strong></li>
</ol>
<ul>
<li>​	<strong>仅在EBGP中有效</strong></li>
<li>AS_PATH属性在进行选路时，<strong>仅关注AS号的长短</strong>，不关注内容。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">方法一：在R1的出方向修改AS_PATH属性。</span><br><span class="line"><span class="number">1</span>，抓取流量</span><br><span class="line">[r1]ip ip-prefix as permit <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line"><span class="number">2</span>，配置路由策略</span><br><span class="line">[r1]route-policy as permit node <span class="number">10</span></span><br><span class="line">[r1-route-policy]<span class="keyword">if</span>-match ip-prefix as</span><br><span class="line">[r1-route-policy]apply as-path <span class="number">11</span> <span class="number">22</span> <span class="number">33</span> ?</span><br><span class="line"><span class="comment">/*additive*/</span> Append to original As Number ---- 在原有AS_PATH属性的基础上添加配置的AS号</span><br><span class="line"><span class="comment">/*overwrite*/</span> Overwrite original As Number ---- 直接覆盖原有的AS_PATH属性值</span><br><span class="line">  </span><br><span class="line">[r1-route-policy]apply as-path <span class="number">11</span> <span class="number">22</span> <span class="number">33</span> additive --- 建议使用添加，因为AS_path属性主要任务用来防止环路，将原有属性覆盖可能导致路由回传，造成环路产生。</span><br><span class="line">[r1]route-policy as permit node <span class="number">20</span><span class="comment">//放行其他</span></span><br><span class="line"><span class="number">3</span>，在BGP中调用策略</span><br><span class="line">[r1-bgp]peer <span class="number">12.0</span><span class="number">.0</span><span class="number">.2</span> route-policy as export</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ol start="5">
<li><strong>路由起源属性</strong></li>
</ol>
<ul>
<li>​		<strong>全局有效</strong></li>
<li>I — 代表该<strong>路由信息起源于IGP协议</strong></li>
<li>E — 代表该路由信息<strong>起源于EGP协议</strong> — EGP指的是BGP之前使用的外部网关协议</li>
<li>？ — 通过除了以上两种方式学习到的路由 -<strong>– 重发布导入的路由</strong>起源码都是？</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">控制选路的方法：</span><br><span class="line"><span class="number">1</span>，抓流量</span><br><span class="line">[r2]ip ip-prefix ogn permit <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line"><span class="number">2</span>，配置路由策略</span><br><span class="line">[r2]route-policy ogn permit node <span class="number">10</span></span><br><span class="line">[r2-route-policy]<span class="keyword">if</span>-match ip-prefix ogn</span><br><span class="line">[r2-route-policy]apply origin incomplete</span><br><span class="line">[r2]route-policy ogn permit node <span class="number">20</span></span><br><span class="line"><span class="number">3</span>，在BGP中进行调用</span><br><span class="line">[r2-bgp]peer <span class="number">12.0</span><span class="number">.0</span><span class="number">.1</span> route-policy ogn import</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<ol start="6">
<li><p><strong>MED</strong>：</p>
<ul>
<li>只能用于EGBP</li>
<li>路由引入的cost值引入到bgp里面不变，存到med中，开销小优先（多路选择）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">在R2上配置，影响R1的选路</span><br><span class="line"><span class="number">1</span>，抓取流量</span><br><span class="line">[r2]ip ip-prefix med permit <span class="number">4.4</span><span class="number">.4</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line"><span class="number">2</span>，配置路由策略</span><br><span class="line">[r2]route-policy med permit node <span class="number">10</span></span><br><span class="line">[r2-route-policy]<span class="keyword">if</span>-match ip-prefix med</span><br><span class="line">[r2-route-policy]apply cost <span class="number">10</span></span><br><span class="line">[r2]route-policy med permit node <span class="number">20</span></span><br><span class="line"><span class="number">3</span>，在BGP进程中调用</span><br><span class="line">[r2-bgp]peer <span class="number">12.0</span><span class="number">.0</span><span class="number">.1</span> route-policy med export</span><br><span class="line">注意：MED值影响的是别的AS的流量通过多个出口进入到本AS内部，如果流入的不是同一个AS，即收到的路由条目中AS_PATH属性最左边的AS号不同，则将不比较第六条，直接比较第<span class="number">7</span>条。</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231118161507165.png" alt="image-20231118161507165"></p>
</li>
</ol>
<p>​		剩下的省略…</p>
<p>总结（？）：</p>
<ol>
<li>一个路由器有多个出口时一般用weight&#x2F;pv来控制选路</li>
<li>一个AS内有多个出口时一般用Local_pref</li>
<li>影响其他人选路用MED out方向，影响自己选路用MED in方向</li>
<li>影响多个AS选路用AS-path</li>
<li>origin next-hop一般不用，有时会影响BGP的正常选路</li>
</ol>
<h2 id="路由反射"><a href="#路由反射" class="headerlink" title="路由反射"></a>路由反射</h2><ul>
<li>水平分割不允许ibgp转发从ibgp学习到的路由，但是你把它升级成路由反射器再配置相应的客户机就可以进行路由转发了</li>
<li>当RR从<strong>客户机</strong>收到一个路由更新时，会将它发送给<strong>客户机和非客户机。</strong></li>
<li>当RR从<strong>非客户机</strong>收到一个路由更新时，只发送给<strong>客户机</strong>路由器，而不发送给其他非客户机路由器</li>
<li>当RR从<strong>EBGP</strong>收到一个路由更新时，会将它发送给<strong>客户机和非客户机。</strong></li>
</ul>
<p>​	<strong><u>省流：非非不传，其他全传</u></strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231122004449268.png" alt="image-20231122004449268"></p>
<p>在图中的ar2和3建立一个连接，ar3和4建立一个连接（r3做rr，r2和r4做客户端）</p>
<p><strong>配置</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[r3]bgp <span class="number">16</span></span><br><span class="line">[r3-bgp]peer <span class="number">23.1</span><span class="number">.1</span><span class="number">.2</span>  reflect-client </span><br><span class="line">[r3-bgp]peer <span class="number">34.1</span><span class="number">.1</span><span class="number">.4</span>  reflect-client</span><br></pre></td></tr></table></figure>



<p>路由反射问题解决：</p>
<ul>
<li><strong>反射簇</strong>解决路由<strong>环路</strong></li>
<li><strong>Originator ID属性</strong>解决<strong>再次学习</strong>问题</li>
</ul>
<h2 id="路由联盟"><a href="#路由联盟" class="headerlink" title="路由联盟"></a>路由联盟</h2><p>在大的as中分割出更小的as</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/Charles-Webber/blog-image1/raw/master/img/image-20231118163953382.png" alt="image-20231118163953382"></p>
<p>在这个图中r1发送给r2，r2可以再把数据给r3，一般的r3不能发给r4，但是我们做了两个小的as，那么逻辑上r2和r3就成为了ebgp，可以进行路由转发</p>
<p><strong>配置</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*在R1上配置：*/</span></span><br><span class="line">bgp <span class="number">1</span></span><br><span class="line">peer <span class="number">12.0</span><span class="number">.0</span><span class="number">.2</span> as-number <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*R2上关键配置：*/</span></span><br><span class="line">bgp <span class="number">65512</span> <span class="comment">//本机AS为成员AS号（小as）</span></span><br><span class="line">confederation id <span class="number">2</span><span class="comment">//联盟ID，外部路由器看来，连接AS仍然为2</span></span><br><span class="line">confederation peer-as <span class="number">65512</span> <span class="comment">//说明本机连接了其他哪些成员AS，都是小区域（as3）</span></span><br><span class="line"></span><br><span class="line">peer <span class="number">23.0</span><span class="number">.0</span><span class="number">.3</span> as-number <span class="number">65512</span> <span class="comment">//和成员建立EBGP邻居关系</span></span><br><span class="line">    </span><br><span class="line">peer <span class="number">12.0</span><span class="number">.0</span><span class="number">.1</span> as-number <span class="number">1</span> <span class="comment">//和非成员建立IBGP邻居关系</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*R3上关键配置：*/</span></span><br><span class="line">bgp <span class="number">65512</span> <span class="comment">//本机AS为成员AS号（小as）</span></span><br><span class="line">confederation id <span class="number">2</span><span class="comment">//联盟ID，外部路由器看来，连接AS仍然为2</span></span><br><span class="line">confederation peer-as <span class="number">65512</span> <span class="comment">//说明本机连接了其他哪些成员AS（as3）</span></span><br><span class="line">confederation peer-as <span class="number">65513</span> <span class="comment">//说明本机连接了其他哪些成员AS（as3）</span></span><br><span class="line"></span><br><span class="line">peer <span class="number">23.0</span><span class="number">.0</span><span class="number">.2</span> as-number <span class="number">65512</span> <span class="comment">//和成员建立EBGP邻居关系</span></span><br><span class="line">    </span><br><span class="line">peer <span class="number">34.0</span><span class="number">.0</span><span class="number">.4</span> as-number <span class="number">63513</span><span class="comment">//和非成员建立IBGP邻居关系</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*R4上关键配置：*/</span></span><br><span class="line">bgp <span class="number">65513</span> <span class="comment">//本机AS为成员AS号（小as）</span></span><br><span class="line">confederation id <span class="number">2</span><span class="comment">//联盟ID，外部路由器看来，连接AS仍然为2</span></span><br><span class="line">confederation peer-as <span class="number">65512</span> <span class="comment">//说明本机连接了其他哪些成员AS（as3）</span></span><br><span class="line">confederation peer-as <span class="number">65513</span> <span class="comment">//说明本机连接了其他哪些成员AS（as3）</span></span><br><span class="line"></span><br><span class="line">peer <span class="number">45.0</span><span class="number">.0</span><span class="number">.5</span> as-number <span class="number">65513</span> <span class="comment">//和成员建立EBGP邻居关系</span></span><br><span class="line">    </span><br><span class="line">peer <span class="number">34.0</span><span class="number">.0</span><span class="number">.3</span> as-number <span class="number">63512</span><span class="comment">//和非成员建立IBGP邻居关系</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">/*R5上关键配置：*/</span></span><br><span class="line">bgp <span class="number">65513</span> <span class="comment">//本机AS为成员AS号（小as）</span></span><br><span class="line">confederation id <span class="number">2</span><span class="comment">//联盟ID，外部路由器看来，连接AS仍然为2</span></span><br><span class="line">    </span><br><span class="line">confederation peer-as <span class="number">65513</span> <span class="comment">//说明本机连接了其他哪些成员AS（as3）</span></span><br><span class="line"></span><br><span class="line">peer <span class="number">45.0</span><span class="number">.0</span><span class="number">.4</span> as-number <span class="number">65513</span> <span class="comment">//和成员建立EBGP邻居关系</span></span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://charles-webebr.github.io">charles-webber</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A18/">http://charles-webebr.github.io/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A18/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://charles-webebr.github.io" target="_blank">asuka&ayanami</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A19/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div><div class="next-post pull-right"><a href="/2024/07/10/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A17/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NzUzOS8zNDAwMw=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/6o/wallhaven-6o36qq.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">charles-webber</div><div class="author-info__description">never give up,keep moving</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/charles-webber"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://bilibili.com/" target="_blank" title="bilibili"><i class="fa-regular fa-heart"></i></a><a class="social-icon" href="mailto:1484145649@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://leetcode.cn/" target="_blank" title="gaming()"><i class="fa-solid fa-gamepad"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Dear Miss.? When i think of you'I'm reminded of the beautiful plains of Iowa.The distance between us is breaking my spirit. My time and experiences without you are meaningless to me. Falling in love with you was the easiest thing i have ever done.Nothing matters but you.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A18"><span class="toc-number">1.</span> <span class="toc-text">数据通信8</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bgp%E7%89%B9%E5%BE%81"><span class="toc-number">1.2.</span> <span class="toc-text">bgp特征</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BGP%E4%BA%94%E6%9D%A15%E6%8A%A5%E6%96%87"><span class="toc-number">1.3.</span> <span class="toc-text">BGP五条5报文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BGP%E7%9A%84%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">1.4.</span> <span class="toc-text">BGP的状态机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">工作过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">连接过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%9D%A0%E8%B7%AF%E7%94%B1%E6%9B%B4%E6%96%B0"><span class="toc-number">1.5.2.</span> <span class="toc-text">可靠路由更新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.</span> <span class="toc-text">实验配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BGP%E7%AE%A1%E7%90%86%E8%B7%9D%E7%A6%BB%EF%BC%88%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%89"><span class="toc-number">1.7.</span> <span class="toc-text">BGP管理距离（优先级）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bgp%E8%A1%A8%E7%9A%84%E5%88%86%E6%9E%90"><span class="toc-number">1.8.</span> <span class="toc-text">bgp表的分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BGP%E5%B1%9E%E6%80%A7%E5%92%8C%E8%B7%AF%E5%BE%84%E9%80%89%E6%8B%A9%E5%A4%84%E7%90%86"><span class="toc-number">1.9.</span> <span class="toc-text">BGP属性和路径选择处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BGP%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">1.9.1.</span> <span class="toc-text">BGP的属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%88%86%E7%B1%BB"><span class="toc-number">1.9.2.</span> <span class="toc-text">属性分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BGP%E7%9A%84%E8%B7%AF%E5%BE%84%E9%80%89%E6%8B%A9"><span class="toc-number">1.9.3.</span> <span class="toc-text">BGP的路径选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%8F%8D%E5%B0%84"><span class="toc-number">1.10.</span> <span class="toc-text">路由反射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%81%94%E7%9B%9F"><span class="toc-number">1.11.</span> <span class="toc-text">路由联盟</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%80%83%E6%A0%B8%E6%80%BB%E7%BB%93/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%80%83%E6%A0%B8%E6%80%BB%E7%BB%93/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.130Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/openwrt/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/openwrt/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.128Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/openuler2/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/openuler2/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.126Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/openeuler4/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/openeuler4/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.123Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/openeuler3/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/q2/wallhaven-q2p6mr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/10/openeuler3/" title="无题">无题</a><time datetime="2024-07-10T07:22:46.121Z" title="发表于 2024-07-10 15:22:46">2024-07-10</time></div></div></div></div></div></div></main><footer id="footer" style="background: -#77D78D"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By charles-webber</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Nice to meet you!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><div class="aplayer no-destroy" data-id="770116495" data-server="netease" data-type="playlist"   data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true" ></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'be1b66712a57497892f4e70a9fc0e4f9';
  var gaud_map_key = 'ec1c17e08135f345b1f956f3fa268b0c# 锟�??得�?�拷图web锟斤拷锟斤拷key';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.6534116,27.96920845';
  var clock_default_rectangle_enable = 'true';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/clock.min.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('article-sort-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__slideInRight');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item swiper_container_card" style="height: auto;width: 100%"><div id="random"><div id="random-banner"><canvas id="peoplecanvas"></canvas></div><a id="random-hover" style="width:100%;height:auto;" href="javascript:toRandomPost()" rel="external nofollow noreferrer" one-link-mark="yes"><i class="fa fa-paper-plane" style="margin-left:10px"></i><div style="margin-left:10px">随便逛逛<i class="fa-solid fa-arrow-right" style="margin-left:10px"></i></div></a></div><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/10/09/python学习之路/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://wallhaven.cc/w/85j9qo" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-09</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/10/09/python学习之路/&quot;);" href="javascript:void(0);" alt="">python learning</a><div class="blog-slider__text">python learning for AI</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/10/09/python学习之路/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/11/27/预习作业：/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2022/11/27/预习作业：/S:\Blog\source\_posts\从0开始学习c语言\wallhaven-28p95m.png" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-27</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/11/27/预习作业：/&quot;);" href="javascript:void(0);" alt="">c for class</a><div class="blog-slider__text">a freshman's practice</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/11/27/预习作业：/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/10/29/answer/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/zy/wallhaven-zygeko.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/10/29/answer/&quot;);" href="javascript:void(0);" alt="">answer</a><div class="blog-slider__text">a freshman's practice</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/10/29/answer/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/js/swiper.min.js"></script><script defer data-pjax src="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper_init.js"></script><script data-pjax src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/gsap/3.9.1/gsap.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/people.min.js"></script><script async src="/anzhiyu/random.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>